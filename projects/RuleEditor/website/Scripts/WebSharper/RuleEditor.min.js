(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr;a=self;b=a.FsRoot=a.FsRoot||{};c=b.Library=b.Library||{};d=c.ResultMessage=c.ResultMessage||{};e=c.ResultMessageHelpers=c.ResultMessageHelpers||{};f=c.Monads=c.Monads||{};g=f.Seq=f.Seq||{};h=f.Option=f.Option||{};i=f.Async=f.Async||{};j=a.WebSharper;k=j&&j.Obj;l=f.Result=f.Result||{};m=l.Builder=l.Builder||{};n=l.Operators=l.Operators||{};o=f.FusionM=f.FusionM||{};p=o.Operators=o.Operators||{};q=o.Builder=o.Builder||{};r=q.Builder=q.Builder||{};s=f.FusionAsyncM=f.FusionAsyncM||{};t=s.Operators=s.Operators||{};u=s.Builder=s.Builder||{};v=u.Builder=u.Builder||{};w=c.ParseO=c.ParseO||{};x=c.MailboxProcessorExt=c.MailboxProcessorExt||{};y=c.Mailbox=c.Mailbox||{};z=y.StateFull=y.StateFull||{};A=b.LibraryJS=b.LibraryJS||{};B=A.View=A.View||{};C=A.Var=A.Var||{};D=A.ListModel=A.ListModel||{};E=b.Library2=b.Library2||{};F=E.WebSockets=E.WebSockets||{};G=F.Address=F.Address||{};H=F.BrokerRequest=F.BrokerRequest||{};I=F.MessageType=F.MessageType||{};J=F.BrokerMessage=F.BrokerMessage||{};K=F.Replier=F.Replier||{};L=F.MessageGeneric=F.MessageGeneric||{};M=b.CalculationModel=b.CalculationModel||{};N=M.CalculationModel=M.CalculationModel||{};O=N.DimType=N.DimType||{};P=N.CubeType=N.CubeType||{};Q=N.AttType=N.AttType||{};R=N.ElmType=N.ElmType||{};S=N.ModId=N.ModId||{};T=N.AttId=N.AttId||{};U=N.ElmId=N.ElmId||{};V=N.CubId=N.CubId||{};W=N.DimId=N.DimId||{};X=N.CalId=N.CalId||{};Y=N.TotId=N.TotId||{};Z=N.ForId=N.ForId||{};_0=N.RulId=N.RulId||{};_1=N.Attribute=N.Attribute||{};_2=N.Element=N.Element||{};_3=N.Dimension=N.Dimension||{};_4=N.UnaryOp=N.UnaryOp||{};_5=N.Operator=N.Operator||{};_6=N.ExpressionText=N.ExpressionText||{};_7=N.ExpressionNumber=N.ExpressionNumber||{};_8=N.ExpressionAny=N.ExpressionAny||{};_9=N.Slice=N.Slice||{};_=N.ForType=N.ForType||{};$=N.Formula=N.Formula||{};ba=N.Calculation=N.Calculation||{};bb=N.Total=N.Total||{};bc=N.RuleKey=N.RuleKey||{};bd=N.Cube=N.Cube||{};be=N.Rule=N.Rule||{};bf=N.RuleMsg=N.RuleMsg||{};bg=N.Model=N.Model||{};bh=N.HelperTypeN=N.HelperTypeN||{};bi=N.HelperTypeT=N.HelperTypeT||{};bj=N.HelperTypeA=N.HelperTypeA||{};bk=N.Model0=N.Model0||{};bl=N.ElementModule=N.ElementModule||{};bm=N.ElmReferenceModule=N.ElmReferenceModule||{};bn=N.SliceModule=N.SliceModule||{};bo=N.DimensionModule=N.DimensionModule||{};bp=N.CubeModule=N.CubeModule||{};bq=N.CalculationModule=N.CalculationModule||{};br=N.TotalModule=N.TotalModule||{};bs=N.ModelModule=N.ModelModule||{};bt=N.FormulaModule=N.FormulaModule||{};bu=N.RuleModule=N.RuleModule||{};bv=N.AttributeModule=N.AttributeModule||{};bw=b.RuleEditor=b.RuleEditor||{};bx=bw.Templating=bw.Templating||{};by=bw.TreeNodeId=bw.TreeNodeId||{};bz=bw.Version=bw.Version||{};bA=bw.VersionModule=bw.VersionModule||{};bB=bw.ModelUI=bw.ModelUI||{};bC=bw.MsgModel=bw.MsgModel||{};bD=bw.ModelUIModule=bw.ModelUIModule||{};bE=bw.Global=bw.Global||{};bF=bw.TableDimensions=bw.TableDimensions||{};bG=bw.MainProgram=bw.MainProgram||{};bH=a.StartupCode$RuleEditor$RuleEditor=a.StartupCode$RuleEditor$RuleEditor||{};bI=a.RuleEditor_Templates=a.RuleEditor_Templates||{};bJ=a.RuleEditor_GeneratedPrintf=a.RuleEditor_GeneratedPrintf||{};bK=a.IntelliFactory;bL=bK&&bK.Runtime;bM=j&&j.Utils;bN=j&&j.Strings;bO=j&&j.Seq;bP=j&&j.List;bQ=j&&j.Arrays;bR=j&&j.Concurrency;bS=j&&j.Enumerator;bT=j&&j.Result;bU=j&&j.Operators;bV=j&&j.Unchecked;bW=j&&j.Control;bX=bW&&bW.MailboxProcessor;bY=a.console;bZ=j&&j.UI;b0=bZ&&bZ.View;b1=bZ&&bZ.Var;b2=bZ&&bZ.FromView;b3=bZ&&bZ.Doc;b4=a.System;b5=b4&&b4.Guid;b6=j&&j.Collections;b7=b6&&b6.FSharpMap;b8=b6&&b6.FSharpSet;b9=b6&&b6.Set;b_=j&&j.Slice;b$=b6&&b6.Map;ca=a.Date;cb=bZ&&bZ.Var$1;cc=bZ&&bZ.Templating;cd=cc&&cc.Runtime;ce=cd&&cd.Server;cf=ce&&ce.ProviderBuilder;cg=ce&&ce.Handler;ch=ce&&ce.TemplateInstance;ci=A&&A.AppFramework;cj=ci&&ci.PlugIn;ck=j&&j.Lazy;cl=A&&A.LayoutEngineModule;cm=c&&c.String;cn=j&&j.DateUtil;co=j&&j.Numeric;cp=bZ&&bZ.ListModel;cq=bZ&&bZ.Client;cr=cq&&cq.Templates;d=c.ResultMessage=bL.Class({toString:function(){return this.$==1?(function(cs){return function(ct){return cs("Error    : "+bM.toSafe(ct));};}(a.id))(this.$0):this.$==2?(function(cs){return function(ct){return cs("Warning  : "+bM.toSafe(ct));};}(a.id))(this.$0):this.$==3?this.$0:this.$==4?(function(cs){return function(ct){return cs(a.String(ct));};}(a.id))(this.$0):this.$==5?(((bL.Curried3(function(cs,ct,cu){return cs("Exception: "+bM.toSafe(ct)+", "+bM.toSafe(cu));}))(a.id))(this.$0))(this.$1):this.$==6?bN.concat("\n",bO.map(a.String,bO.filter(function(cs){return cs.$!=0;},this.$0))):"";}},null,d);d.NoMsg=new d({$:0});e.infof=function(cs){return cs(function(ct){return new d({$:3,$0:ct});});};e.warningf=function(cs){return cs(function(ct){return new d({$:2,$0:ct});});};e.errorMsgf=function(cs){return cs(function(ct){return new d({$:1,$0:ct});});};d.summarizedI=function(cs){return d.summarizedF(function(){return[0,0,1];},cs);};d.summarizedW=function(cs){return d.summarizedF(function(){return[0,1,0];},cs);};d.summarized=function(cs){return d.summarizedF(function(){return[1,0,0];},cs);};d.summarizedF=function(cs,ct){return bN.concat("\n",bO.filter(function(cu){return""!==cu;},bP.ofArray([a.String(ct),d.summaryF(cs,ct)])));};d.summaryF=function(cs,ct){var cu,cv;cv=d.countF(cs,ct);switch(cv[0]===0?cv[1]===0?0:cv[1]===1?cv[2]===0?0:(cu=cv[1],2):(cu=cv[1],2):cv[0]===1?cv[1]===0?cv[2]===0?0:(cu=cv[0],1):(cu=[cv[0],cv[1]],3):cv[1]===0?(cu=cv[0],1):(cu=[cv[0],cv[1]],3)){case 0:return"";case 1:return(function(cw){return function(cx){return cw("Errors   : "+a.String(cx)+"\n");};}(a.id))(cu);case 2:return(function(cw){return function(cx){return cw("Warnings : "+a.String(cx)+"\n");};}(a.id))(cu);case 3:return(((bL.Curried3(function(cw,cx,cy){return cw("Errors   : "+a.String(cx)+", Warnings: "+a.String(cy)+"\n");}))(a.id))(cu[0]))(cu[1]);}};d.reduceMsgs=function(cs){return bO.fold(d.addMsg,d.NoMsg,cs);};d.addMsg=function(cs,ct){return cs.$==0?ct:cs.$==6?ct.$==0?cs:ct.$==6?new d({$:6,$0:cs.$0.concat(ct.$0)}):new d({$:6,$0:cs.$0.concat([ct])}):ct.$==0?cs:ct.$==6?new d({$:6,$0:[cs].concat(ct.$0)}):new d({$:6,$0:[cs,ct]});};d.countI=function(cs){return d.countF(function(){return[0,0,1];},cs);};d.countW=function(cs){return d.countF(function(){return[0,1,0];},cs);};d.count=function(cs){return d.countF(function(){return[1,0,0];},cs);};d.countF=function(cs,ct){function cu(cv,cw,cx){return function(cy){return[cv+cy[0],cw+cy[1],cx+cy[2]];};}return ct.$==0?[0,0,0]:ct.$==3?[0,0,1]:ct.$==2?[0,1,0]:ct.$==4?cs(ct.$0):ct.$==6?bO.fold(function(cv,cw){return(function(cx){return cu(cx[0],cx[1],cx[2]);}(cv))(cw);},[0,0,0],bO.map(function(cv){return d.countF(cs,cv);},d.exclnoMsg(ct.$0))):[1,0,0];};d.isFatalW=function(cs){return d.isFatalF(function(){return false;},cs);};d.isFatal=function(cs){return d.isFatalF(function(){return true;},cs);};d.isFatalF=function(cs,ct){return ct.$==0?false:ct.$==3?false:ct.$==2?false:ct.$==4?cs(ct.$0):ct.$==6?bO.exists(function(cu){return d.isFatalF(cs,cu);},ct.$0):true;};d.isWarningOrInfoW=function(cs){return d.isWarningOrInfoF(function(){return true;},cs);};d.isWarningOrInfo=function(cs){return d.isWarningOrInfoF(function(){return false;},cs);};d.isWarningOrInfoF=function(cs,ct){return ct.$==2||(ct.$==4?cs(ct.$0):ct.$==6&&bO.forall(function(cu){return d.isWarningOrInfoF(cs,cu)||d.isInfoF(cs,cu);},d.exclnoMsg(ct.$0)));};d.isInfoI=function(cs){return d.isInfoF(function(){return true;},cs);};d.isInfo=function(cs){return d.isInfoF(function(){return false;},cs);};d.isInfoF=function(cs,ct){return ct.$==3||(ct.$==4?cs(ct.$0):ct.$==6&&bO.forall(function(cu){return d.isInfoF(cs,cu);},d.exclnoMsg(ct.$0)));};d.freeMessageI=function(cs){var ct;function cu(cv){return new d({$:3,$0:cv});}return d.freeMessageF((ct=function(cv){return function(cw){return cv(a.String(cw));};}(a.id),function(cv){return cu(ct(cv));}),cs);};d.freeMessageW=function(cs){var ct;function cu(cv){return new d({$:2,$0:cv});}return d.freeMessageF((ct=function(cv){return function(cw){return cv(a.String(cw));};}(a.id),function(cv){return cu(ct(cv));}),cs);};d.freeMessage=function(cs){var ct;function cu(cv){return new d({$:1,$0:cv});}return d.freeMessageF((ct=function(cv){return function(cw){return cv(a.String(cw));};}(a.id),function(cv){return cu(ct(cv));}),cs);};d.freeMessageF=function(cs,ct){return d.bindMessage(cs,ct);};d.bindMessage=function(cs,ct){return ct.$==4?cs(ct.$0):ct.$==1?new d({$:1,$0:ct.$0}):ct.$==3?new d({$:3,$0:ct.$0}):ct.$==2?new d({$:2,$0:ct.$0}):ct.$==5?new d({$:5,$0:ct.$0,$1:ct.$1}):ct.$==6?new d({$:6,$0:bQ.map(function(cu){return d.bindMessage(cs,cu);},ct.$0)}):d.NoMsg;};d.exclnoMsg=function(cs){function ct(cu){return!cu;}return bO.filter(function(cu){return ct(d.noMsg(cu));},cs);};d.noMsg=function(cs){return cs.$==0;};g.absorbR=function(cs){return bO.choose(function(ct){return ct.$==0?{$:1,$0:ct.$0}:null;},cs);};g.absorbO=function(cs){return bO.choose(a.id,cs);};g.insertR=function(cs){return cs.$==0?bO.map(function(ct){return{$:0,$0:ct};},cs.$0):(g.rtn())(c.Error$1(cs.$0));};g.insertO=function(cs){var ct;ct=cs==null?null:{$:1,$0:bO.map(function(cu){return{$:1,$0:cu};},cs.$0)};return ct==null?(g.rtn())(null):ct.$0;};g.rtn=function(){bH.$cctor();return bH.rtn;};h.absorbR=function(cs){var ct,cu;return cs!=null&&cs.$==1&&(cu=cs.$0,cu.$==0&&(ct=cu.$0,true))?{$:1,$0:ct}:null;};h.insertR=function(cs){var ct;return cs.$==0?(ct=cs.$0,ct==null?null:{$:1,$0:{$:0,$0:ct.$0}}):h.rtn(c.Error$1(cs.$0));};h.sequenceSeq=function(cs){return h.traverseSeq(a.id,cs);};h.traverseSeq=function(cs,ct){var cu;cu=bQ.foldBack(function(cv,cw){return h.op_GreaterGreaterEquals(cs(cv),function(cx){return h.op_GreaterGreaterEquals(cw,function(cy){return h.rtn(new bP.T({$:1,$0:cx,$1:cy}));});});},bQ.ofSeq(ct),h.rtn(bP.T.Empty));return cu==null?null:{$:1,$0:cu.$0};};h.op_GreaterGreaterEquals=function(cs,ct){return cs==null?null:ct(cs.$0);};h.bindNone=function(cs,ct){return ct!=null&&ct.$==1?{$:1,$0:ct.$0}:cs();};h.mapNone=function(cs,ct){return ct==null?cs():ct.$0;};h.apply=function(cs,ct){var cu;return cs!=null&&cs.$==1&&(ct!=null&&ct.$==1&&(cu=[cs.$0,ct.$0],true))?{$:1,$0:cu[0](cu[1])}:null;};h.join=function(cs){return cs==null?null:cs.$0;};h.iter=function(cs){function ct(cv){return cv==null?null:{$:1,$0:cs(cv.$0)};}function cu(cv){if(cv==null);}return function(cv){return cu(ct(cv));};};h.rtn=function(cs){return{$:1,$0:cs};};i.insertR=function(cs){function ct(cv){return{$:0,$0:cv};}function cu(cv){return bR.Return(cv);}return cs.$==0?bR.Bind(cs.$0,function(cv){return cu(ct(cv));}):bR.Return(c.Error$1(cs.$0));};i.insertO=function(cs){var ct;function cu(cw){return{$:1,$0:cw};}function cv(cw){return bR.Return(cw);}ct=cs==null?null:{$:1,$0:bR.Bind(cs.$0,function(cw){return cv(cu(cw));})};return ct==null?bR.Return(null):ct.$0;};i.sequenceSeq=function(cs){return i.traverseSeq(a.id,cs);};i.traverseSeq=function(cs,ct){function cu(cv){return bR.Return(cv);}return bR.Bind(bQ.foldBack(function(cv,cw){return i.op_GreaterGreaterEquals(cs(cv),function(cx){return i.op_GreaterGreaterEquals(cw,function(cy){return bR.Return(new bP.T({$:1,$0:cx,$1:cy}));});});},bQ.ofSeq(ct),bR.Return(bP.T.Empty)),function(cv){return cu(a.id(cv));});};i.op_GreaterGreaterEquals=function(cs,ct){return bR.Bind(cs,ct);};i.sleepThen=function(cs,ct){var cu;cu=null;return bR.Delay(function(){return bR.Bind(bR.Sleep(ct),function(){return bR.Return(cs());});});};i.apply=function(cs,ct){var cu;cu=null;return bR.Delay(function(){return bR.Bind(bR.StartChild(cs,null),function(cv){return bR.Bind(bR.StartChild(ct,null),function(cw){return bR.Bind(cv,function(cx){return bR.Bind(cw,function(cy){return bR.Return(cx(cy));});});});});});};m=l.Builder=bL.Class({For:function(cs,ct){var cu;cu=this;return this.Using(bS.Get(cs),function(cv){return cu.While(function(){return cv.MoveNext();},cu.Delay(function(){return ct(cv.Current());}));});},While:function(cs,ct){function cu(cv,cw){return cv()?bT.Bind(function(){return cu(cv,cw);},cw()):l.rtn();}return cu(cs,ct);},Using:function(cs,ct){try{return ct(cs);}finally{cs.Dispose();}},TryFinally:function(cs,ct){try{return cs();}finally{ct();}},TryWith:function(cs,ct){try{return cs();}catch(cu){return ct(cu);}},Run:function(cs){return l.bindP(cs,{$:0,$0:null});},Combine:function(cs,ct){return bT.Bind(ct,cs);},Delay:a.id,Zero:function(){return l.rtn();},Bind:function(cs,ct){return bT.Bind(ct,cs);},ReturnFrom:a.id,Return:function(cs){return l.rtn(cs);}},k,m);m.New=bL.Ctor(function(){k.New.call(this);},m);n.result=function(){bH.$cctor();return bH.result$1;};n.rtn=function(cs){return l.rtn(cs);};n.op_GreaterEqualsGreater=function(cs,ct,cu){return n.op_GreaterGreaterEquals(cs(cu),ct);};n.op_RightShift=function(cs,ct,cu){return n.op_BarGreaterGreater(cs(cu),ct);};n.op_GreaterGreaterEquals=function(cs,ct){return l.bindP(ct,cs);};n.op_BarGreaterGreater=function(cs,ct){return l.mapP(ct,cs);};l.result=function(){bH.$cctor();return bH.result;};l.sequenceSeq=function(cs){return l.traverseSeq(a.id,cs);};l.traverseSeq=function(cs,ct){return bT.Map(a.id,bQ.foldBack(function(cu,cv){return l.op_GreaterGreaterEquals(cs(cu),function(cw){return l.op_GreaterGreaterEquals(cv,function(cx){return l.rtn(new bP.T({$:1,$0:cw,$1:cx}));});});},bQ.ofSeq(ct),l.rtn(bP.T.Empty)));};l.op_GreaterGreaterEquals=function(cs,ct){return bT.Bind(ct,cs);};l.absorbO=function(cs,ct){return l.bindP(function(cu){return l.ofOption(cs,cu);},ct);};l.insertO=function(cs){var ct;ct=cs==null?null:{$:1,$0:bT.Map(function(cu){return{$:1,$0:cu};},cs.$0)};return ct==null?{$:0,$0:null}:ct.$0;};l.ofOption=function(cs,ct){var cu;cu=ct==null?null:{$:1,$0:{$:0,$0:ct.$0}};return cu==null?function(cv){return c.Error$1(cs(cv));}():cu.$0;};l.get=function(cs){return l.defaultWith(function(ct){return bU.FailWith(a.String(ct));},cs);};l.iter=function(cs,ct,cu){l.defaultWith(cs,l.mapP(ct,cu));};l.mapP=function(cs,ct){return l.bindP(function(cu){return l.rtn(cs(cu));},ct);};l.bindP=function(cs,ct){if(ct.$==1)return c.Error$1(ct.$0);else try{return cs(ct.$0);}catch(cu){return c.Error$1(new d({$:5,$0:cu.message,$1:cu.stack}));}};l.failIfFalse=function(cs,ct){return!ct?c.Error$1(cs):{$:0,$0:null};};l.failIfTrue=function(cs,ct){return ct?c.Error$1(cs):{$:0,$0:null};};l.defaultValue=function(cs,ct){return ct.$==1?cs:ct.$0;};l.defaultWith=function(cs,ct){return ct.$==1?cs(ct.$0):ct.$0;};l.toOption=function(cs){return cs.$==0?{$:1,$0:cs.$0}:null;};l.rtn=function(cs){return{$:0,$0:cs};};l.freeMessage=function(cs){return cs.$==1?c.Error$1(d.freeMessage(cs.$0)):{$:0,$0:cs.$0};};p.rtn=function(cs){return o.rtn(cs);};p.op_GreaterEqualsGreater=function(cs,ct,cu){return p.op_GreaterGreaterEquals(cs(cu),ct);};p.op_RightShift=function(cs,ct,cu){return p.op_BarGreaterGreater(cs(cu),ct);};p.op_GreaterGreaterEquals=function(cs,ct){return o.bind(ct,cs);};p.op_BarGreaterGreater=function(cs,ct){return o.map(ct,cs);};p.op_LessMultiplyGreater=function(cs,ct){return o.apply(cs,ct);};r=q.Builder=bL.Class({For:function(cs,ct){var cu;cu=this;return this.Using(bS.Get(cs),function(cv){return cu.While(function(){return cv.MoveNext();},cu.Delay(function(){return ct(cv.Current());}));});},Using:function(cs,ct){return this.TryFinally(function(){return ct(cs);},function(){if(!bV.Equals(cs,null))cs.Dispose();});},TryFinally:function(cs,ct){return o.wrap(function(cu){try{return(o.getFun(cs()))(cu);}finally{ct();}});},TryWith:function(cs,ct){return o.wrap(function(cu){try{return(o.getFun(cs()))(cu);}catch(cv){return ct(cv);}});},While:function(cs,ct){function cu(cv,cw){return cv()?o.bind(function(){return cu(cv,cw);},cw()):o.rtn();}return cu(cs,ct);},Run:function(cs){return o.wrap(function(ct){return(o.getFun(cs()))(ct);});},Combine:function(cs,ct){return o.bind(ct,cs);},Delay:a.id,Zero:function(){return o.rtn();},Bind:function(cs,ct){return o.bind(ct,cs);},ReturnFrom:function(cs){return o.from(cs);},Return:function(cs){return o.rtn(cs);}},k,r);r.New=bL.Ctor(function(){k.New.call(this);},r);o.fusion=function(){bH.$cctor();return bH.fusion;};o.absorbO=function(cs,ct){return o.absorbR(o.map(function(cu){return l.ofOption(cs,cu);},ct));};o.absorbR=function(cs){return o.bind(o.ofResultRM,cs);};o.insertSnd=function(cs,ct){return o.map(function(cu){return[cu,ct];},cs);};o.insertFst=function(cs,ct){return o.map(function(cu){return[cs,cu];},ct);};o.insertR=function(cs){return cs.$==0?o.map(function(ct){return{$:0,$0:ct};},cs.$0):o.rtn(c.Error$1(cs.$0));};o.insertO=function(cs){var ct;ct=cs==null?null:{$:1,$0:o.map(function(cu){return{$:1,$0:cu};},cs.$0)};return ct==null?o.rtn(null):ct.$0;};o.iterResultPrint=function(cs){function ct(cu){c.print$1(cu);}o.iterReader(function(cu){return ct(d.summarized(cu));},function(cu){c.print$1(cu);},null,cs);};o.iterResult=function(cs,ct,cu){o.iterReader(cs,ct,null,cu);};o.runResult=function(cs){return o.runReader(null,cs);};o.runReader=function(cs,ct){var cu,cv,cw;cu=o.run(cs,ct);cv=cu[2];return l.ofOption(function(){return cv;},(cw=cu[0],cw==null?null:{$:1,$0:[cw.$0,cv]}));};o.mapReader=function(cs,ct){return o.mapState(function(){return cs;},a.id,ct);};o.readerFun=function(cs){return o.map(cs,o.getS());};o.sequenceSeq=function(cs){return o.traverseSeq(a.id,cs);};o.traverseSeq=function(cs,ct){return o.map(a.id,bQ.foldBack(function(cu,cv){return o.op_GreaterGreaterEquals(cs(cu),function(cw){return o.op_GreaterGreaterEquals(cv,function(cx){return o.rtn(new bP.T({$:1,$0:cw,$1:cx}));});});},bQ.ofSeq(ct),o.rtn(bP.T.Empty)));};o.op_GreaterGreaterEquals=function(cs,ct){return o.bind(ct,cs);};o.apply=function(cs,ct){return o.bind(function(cu){return o.map(cu,ct);},cs);};o.memoizeRm=function(cs,ct,cu){return{$:0,$0:function(cv){var cw,cx,cy,cz,cA;function cB(cC,cD){return(cy(cC))(function(){return cD;});}cw=cv[0];cx=cs(cw);cy=cx[1];return o.run(cw,(cz=(cA=cx[0](cu),cA==null?null:{$:1,$0:o.rtn(cA.$0)}),cz==null?o.map(function(cC){return cB(cu,cC);},ct(cu)):cz.$0));}};};o.iterReader=function(cs,ct,cu,cv){var cw,cx;cw=o.run(cu,o.map(ct,cv));cx=cw[2];(h.iter(a.ignore))(cw[0]);cx.$!==0?cs(cx):void 0;};o.mapState=function(cs,ct,cu){return{$:0,$0:function(cv){var cw,cx;cw=cv[0];cx=(o.getFun(cu))([cs(cw),cv[1]]);return[cx[0],ct(cw,cx[1]),cx[2]];}};};o.freeMessageW=function(cs){var ct;function cu(cv){return new d({$:2,$0:cv});}return o.freeMessageF((ct=function(cv){return function(cw){return cv(a.String(cw));};}(a.id),function(cv){return cu(ct(cv));}),cs);};o.freeMessage=function(cs){var ct;function cu(cv){return new d({$:1,$0:cv});}return o.freeMessageF((ct=function(cv){return function(cw){return cv(a.String(cw));};}(a.id),function(cv){return cu(ct(cv));}),cs);};o.freeMessageF=function(cs,ct){return{$:0,$0:function(cu){var cv,cw,cx;cv=cu[0];cw=cu[1];try{cx=ct.$0([cv,d.freeMessage(cw)]);return[cx[0],cx[1],d.freeMessageF(cs,cx[2])];}catch(cy){return[null,cv,d.freeMessage(d.addMsg(cw,new d({$:5,$0:cy.message,$1:cy.stack})))];}}};};o.ofFusionM=function(cs){return o.from(cs);};o.ofResultMessage=function(cs){return o.OkFMsg(null,cs);};o.ofMessage=function(cs){return o.OkFMsg(null,new d({$:4,$0:cs}));};o.ofOption=function(cs,ct){return ct==null?o.ErrorF(cs()):o.OkF(ct.$0);};o.ofResult=function(cs){return cs.$==1?o.ErrorF(new d({$:1,$0:(function(ct){return function(cu){return ct(bM.prettyPrint(cu));};}(a.id))(cs.$0)})):o.OkF(cs.$0);};o.ofResultS=function(cs){return cs.$==1?o.ErrorF(new d({$:1,$0:cs.$0})):o.OkF(cs.$0);};o.ofResultM=function(cs){return cs.$==1?o.ErrorF(new d({$:4,$0:cs.$0})):o.OkF(cs.$0);};o.ofResultRM=function(cs){return cs.$==1?o.ErrorF(cs.$0):o.OkF(cs.$0);};o.inling=function(cs,ct){return{$:0,$0:function(cu){var cv,cw,cx;cv=cu[0];cw=cu[1];try{cx=ct.$0([cv,cw]);return[{$:1,$0:cx[0]},cx[1],cx[2]];}catch(cy){return[null,cv,d.addMsg(cw,new d({$:5,$0:cy.message,$1:cy.stack}))];}}};};o.check=function(){return{$:0,$0:function(cs){return[d.isFatal(cs[1])?null:{$:1,$0:null},cs[0],d.NoMsg];}};};o.putS=function(cs){return{$:0,$0:function(){return[{$:1,$0:null},cs,d.NoMsg];}};};o.getR=function(){return{$:0,$0:function(cs){return[{$:1,$0:cs[1]},cs[0],d.NoMsg];}};};o.getS=function(){return{$:0,$0:function(cs){var ct;ct=cs[0];return[{$:1,$0:ct},ct,d.NoMsg];}};};o.ErrorF=function(cs){return{$:0,$0:function(ct){return[null,ct[0],cs];}};};o.OkFMsg=function(cs,ct){return{$:0,$0:function(cu){return[{$:1,$0:cs},cu[0],ct];}};};o.OkF=function(cs){return{$:0,$0:function(ct){return[{$:1,$0:cs},ct[0],d.NoMsg];}};};o.run=function(cs,ct){return(o.getFun(ct))([cs,d.NoMsg]);};o.from=a.id;o.getFun=function(cs){return cs.$0;};o.wrap=function(cs){return{$:0,$0:cs};};o.map=function(cs,ct){return o.bind(function(cu){return o.rtn(cs(cu));},ct);};o.bind=function(cs,ct){return{$:0,$0:function(cu){var cv,cw,cx,cy,cz,cA,cB;cv=cu[0];cw=cu[1];try{cx=ct.$0([cv,cw]);cy=cx[0];cz=cx[1];cA=cx[2];return cy!=null&&cy.$==1?(cB=cs(cy.$0).$0([cz,d.addMsg(cw,cA)]),[cB[0],cB[1],d.addMsg(cA,cB[2])]):[null,cz,cA];}catch(cC){return[null,cv,d.addMsg(cw,new d({$:5,$0:cC.message,$1:cC.stack}))];}}};};o.rtn=function(cs){return{$:0,$0:function(ct){return[{$:1,$0:cs},ct[0],d.NoMsg];}};};t.rtn=function(cs){return s.rtn(cs);};t.op_GreaterEqualsGreater=function(cs,ct,cu){return t.op_GreaterGreaterEquals(cs(cu),ct);};t.op_RightShift=function(cs,ct,cu){return t.op_BarGreaterGreater(cs(cu),ct);};t.op_GreaterGreaterEquals=function(cs,ct){return s.bind(ct,cs);};t.op_BarGreaterGreater=function(cs,ct){return s.map(ct,cs);};t.op_LessMultiplyGreater=function(cs,ct){return s.apply(cs,ct);};v=u.Builder=bL.Class({For:function(cs,ct){var cu;cu=this;return this.Using(bS.Get(cs),function(cv){return cu.While(function(){return cv.MoveNext();},cu.Delay(function(){return ct(cv.Current());}));});},Using:function(cs,ct){function cu(cv,cw){return bR.Using(cs,function(cx){return(s.getFun(ct(cx)))([cv,cw]);});}return s.wrap(function(cv){return cu(cv[0],cv[1]);});},TryFinally:function(cs,ct){function cu(cv,cw){return bR.TryFinally((s.getFun(cs()))([cv,cw]),ct);}return s.wrap(function(cv){return cu(cv[0],cv[1]);});},TryWith:function(cs,ct){function cu(cv,cw){return bR.TryWith((s.getFun(cs()))([cv,cw]),ct);}return s.wrap(function(cv){return cu(cv[0],cv[1]);});},While:function(cs,ct){function cu(cv,cw){return cv()?s.bind(function(){return cu(cv,cw);},cw()):s.rtn();}return cu(cs,ct);},Run:function(cs){return s.wrap(function(ct){return(s.getFun(cs()))(ct);});},Combine:function(cs,ct){return s.bind(ct,cs);},Delay:a.id,Zero:function(){return s.rtn();},Bind:function(cs,ct){return s.bind(ct,cs);},ReturnFrom:function(cs){return s.from(cs);},Return:function(cs){return s.rtn(cs);}},k,v);v.New=bL.Ctor(function(){k.New.call(this);},v);s.fusion=function(){bH.$cctor();return bH.fusion$1;};s.iterResultPrintA=function(cs){function ct(cu){c.print$1(cu);}s.iterReaderA(function(cu){return ct(d.summarized(cu));},function(cu){c.print$1(cu);},null,cs);};s.iterResultPrint=function(cs){function ct(cu){c.print$1(cu);}s.iterReader(function(cu){return ct(d.summarized(cu));},function(cu){c.print$1(cu);},null,cs);};s.iterResultA=function(cs,ct,cu){s.iterReaderA(cs,ct,null,cu);};s.iterResult=function(cs,ct,cu){s.iterReader(cs,ct,null,cu);};s.runResult=function(cs){return s.runReader(null,cs);};s.runReader=function(cs,ct){function cu(cw,cx,cy){return l.ofOption(function(){return cy;},cw==null?null:{$:1,$0:[cw.$0,cy]});}function cv(cw){return bR.Return(cw);}return bR.Bind(s.run(cs,ct),function(cw){return cv(cu.apply(null,cw));});};s.mapReader=function(cs,ct){return s.mapState(function(){return cs;},a.id,ct);};s.absorbO=function(cs,ct){return s.absorbR(s.map(function(cu){return l.ofOption(cs,cu);},ct));};s.absorbR=function(cs){return s.bind(s.ofResultRM,cs);};s.insertSnd=function(cs,ct){return s.map(function(cu){return[cu,ct];},cs);};s.insertFst=function(cs,ct){return s.map(function(cu){return[cs,cu];},ct);};s.insertR=function(cs){return cs.$==0?s.map(function(ct){return{$:0,$0:ct};},cs.$0):s.rtn(c.Error$1(cs.$0));};s.insertO=function(cs){var ct;ct=cs==null?null:{$:1,$0:s.map(function(cu){return{$:1,$0:cu};},cs.$0)};return ct==null?s.rtn(null):ct.$0;};s.readerFun=function(cs){return s.map(cs,s.getS());};s.freeMessageW=function(cs){var ct;function cu(cv){return new d({$:2,$0:cv});}return s.freeMessageF((ct=function(cv){return function(cw){return cv(a.String(cw));};}(a.id),function(cv){return cu(ct(cv));}),cs);};s.freeMessage=function(cs){var ct;function cu(cv){return new d({$:1,$0:cv});}return s.freeMessageF((ct=function(cv){return function(cw){return cv(a.String(cw));};}(a.id),function(cv){return cu(ct(cv));}),cs);};s.sequenceSeq=function(cs){return s.traverseSeq(a.id,cs);};s.traverseSeq=function(cs,ct){return s.map(a.id,bQ.foldBack(function(cu,cv){return s.op_GreaterGreaterEquals(cs(cu),function(cw){return s.op_GreaterGreaterEquals(cv,function(cx){return s.rtn(new bP.T({$:1,$0:cw,$1:cx}));});});},bQ.ofSeq(ct),s.rtn(bP.T.Empty)));};s.op_GreaterGreaterEquals=function(cs,ct){return s.bind(ct,cs);};s.apply=function(cs,ct){return s.bind(function(cu){return s.map(cu,ct);},cs);};s.memoizeRm=function(cs,ct,cu){return{$:0,$0:function(cv){var cw,cx;cw=cv[0];cx=null;return bR.Delay(function(){var cy,cz,cA,cB;function cC(cD,cE){return(cz(cD))(function(){return cE;});}cy=cs(cw);cz=cy[1];return s.run(cw,(cA=(cB=cy[0](cu),cB==null?null:{$:1,$0:s.rtn(cB.$0)}),cA==null?s.map(function(cD){return cC(cu,cD);},ct(cu)):cA.$0));});}};};s.iterReaderA=function(cs,ct,cu,cv){function cw(cy,cz,cA){(h.iter(a.ignore))(cy);cA.$!==0?cs(cA):void 0;}function cx(cy){return bR.Return(cy);}bR.Start(bR.Bind(s.run(cu,s.map(ct,cv)),function(cy){return cx(cw.apply(null,cy));}),null);};s.iterReader=function(cs,ct,cu,cv){var cw;cw=s.run(cu,s.map(ct,cv));throw"iterS cannot be used in JavaScript!";};s.mapState=function(cs,ct,cu){return{$:0,$0:function(cv){var cw,cx,cy;cw=cv[0];cx=cv[1];cy=null;return bR.Delay(function(){return bR.Bind((s.getFun(cu))([cs(cw),cx]),function(cz){return bR.Return([cz[0],ct(cw,cz[1]),cz[2]]);});});}};};s.freeMessageF=function(cs,ct){return{$:0,$0:function(cu){var cv,cw,cx;cv=cu[0];cw=cu[1];cx=null;return bR.Delay(function(){return bR.TryWith(bR.Delay(function(){return bR.Bind(ct.$0([cv,d.freeMessage(cw)]),function(cy){return bR.Return([cy[0],cy[1],d.freeMessageF(cs,cy[2])]);});}),function(cy){return bR.Return([null,cv,d.freeMessage(d.addMsg(cw,new d({$:5,$0:cy.message,$1:cy.stack})))]);});});}};};s.ofFusionM=function(cs){var ct;ct=cs.$0;return{$:0,$0:function(cu){return bR.Return(ct([cu[0],cu[1]]));}};};s.ofAsyncResultRM=function(cs){return s.bind(s.ofResultRM,s.ofAsync(cs));};s.ofAsync=function(cs){return{$:0,$0:function(ct){var cu;function cv(cx){return[{$:1,$0:cx},cu,d.NoMsg];}function cw(cx){return bR.Return(cx);}cu=ct[0];return bR.Bind(cs,function(cx){return cw(cv(cx));});}};};s.ofResultMessage=function(cs){return s.OkFMsg(null,cs);};s.ofMessage=function(cs){return s.OkFMsg(null,new d({$:4,$0:cs}));};s.ofOption=function(cs,ct){var cu;cu=ct==null?null:{$:1,$0:s.OkF(ct.$0)};return cu==null?function(cv){return s.ErrorF(cs(cv));}():cu.$0;};s.ofResult=function(cs){return cs.$==1?s.ErrorF(new d({$:1,$0:(function(ct){return function(cu){return ct(bM.prettyPrint(cu));};}(a.id))(cs.$0)})):s.OkF(cs.$0);};s.ofResultS=function(cs){return cs.$==1?s.ErrorF(new d({$:1,$0:cs.$0})):s.OkF(cs.$0);};s.ofResultM=function(cs){return cs.$==1?s.ErrorF(new d({$:4,$0:cs.$0})):s.OkF(cs.$0);};s.ofResultRM=function(cs){return cs.$==1?s.ErrorF(cs.$0):s.OkF(cs.$0);};s.getOption=function(cs){return{$:0,$0:function(ct){var cu,cv,cw;cu=ct[0];cv=ct[1];cw=null;return bR.Delay(function(){return bR.TryWith(bR.Delay(function(){return bR.Bind(cs.$0([cu,cv]),function(cx){return bR.Return([{$:1,$0:cx[0]},cx[1],cx[2]]);});}),function(cx){return bR.Return([null,cu,d.addMsg(cv,new d({$:5,$0:cx.message,$1:cx.stack}))]);});});}};};s.check=function(){return{$:0,$0:function(cs){return bR.Return([d.isFatal(cs[1])?null:{$:1,$0:null},cs[0],d.NoMsg]);}};};s.putS=function(cs){return{$:0,$0:function(){return bR.Return([{$:1,$0:null},cs,d.NoMsg]);}};};s.getR=function(){return{$:0,$0:function(cs){return bR.Return([{$:1,$0:cs[1]},cs[0],d.NoMsg]);}};};s.getS=function(){return{$:0,$0:function(cs){var ct;ct=cs[0];return bR.Return([{$:1,$0:ct},ct,d.NoMsg]);}};};s.ErrorF=function(cs){return{$:0,$0:function(ct){return bR.Return([null,ct[0],cs]);}};};s.OkFMsg=function(cs,ct){return{$:0,$0:function(cu){return bR.Return([{$:1,$0:cs},cu[0],ct]);}};};s.OkF=function(cs){return{$:0,$0:function(ct){return bR.Return([{$:1,$0:cs},ct[0],d.NoMsg]);}};};s.run=function(cs,ct){return(s.getFun(ct))([cs,d.NoMsg]);};s.from=a.id;s.getFun=function(cs){return cs.$0;};s.wrap=function(cs){return{$:0,$0:cs};};s.map=function(cs,ct){return s.bind(function(cu){return s.rtn(cs(cu));},ct);};s.bind=function(cs,ct){return{$:0,$0:function(cu){var cv,cw,cx;cv=cu[0];cw=cu[1];cx=null;return bR.Delay(function(){return bR.TryWith(bR.Delay(function(){return bR.Bind(ct.$0([cv,cw]),function(cy){var cz,cA,cB;cz=cy[0];cA=cy[1];cB=cy[2];return cz!=null&&cz.$==1?bR.Bind(cs(cz.$0).$0([cA,d.addMsg(cw,cB)]),function(cC){return bR.Return([cC[0],cC[1],d.addMsg(cB,cC[2])]);}):bR.Return([null,cA,cB]);});}),function(cy){return bR.Return([null,cv,d.addMsg(cw,new d({$:5,$0:cy.message,$1:cy.stack}))]);});});}};};s.rtn=function(cs){return{$:0,$0:function(ct){return bR.Return([{$:1,$0:cs},ct[0],d.NoMsg]);}};};w.Guid$1=function(){bH.$cctor();return bH["|Guid|_|"];};w.Double$1=function(){bH.$cctor();return bH["|Double|_|"];};w.Single$1=function(){bH.$cctor();return bH["|Single|_|"];};w.Int$1=function(){bH.$cctor();return bH["|Int|_|"];};w.Date$1=function(){bH.$cctor();return bH["|Date|_|"];};w.parseGuidO$1=function(){bH.$cctor();return bH.parseGuidO;};w.parseDoubleO$1=function(){bH.$cctor();return bH.parseDoubleO;};w.parseSingleO$1=function(){bH.$cctor();return bH.parseSingleO;};w.parseIntO$1=function(){bH.$cctor();return bH.parseIntO;};w.parseDateO$1=function(){bH.$cctor();return bH.parseDateO;};w.tryParseWith$1=function(cs){function ct(cu,cv){return cu?{$:1,$0:cv}:null;}return function(cu){return ct.apply(null,cs(cu));};};x.PostAndAsyncReply=function(cs,ct,cu){return cs.PostAndAsyncReply(function(cv){return[cv,ct];},cu);};z.applyReply=function(cs,ct){return z.applyReplyA(function(cu){var cv;cv=null;return bR.Delay(function(){return bR.Return(cs(cu));});},ct);};z.applyReplyA=function(cs,ct){return ct.PostAndAsyncReply(function(cu){return function(cv){var cw;cw=null;return bR.Delay(function(){return bR.Bind(cs(cv),function(cx){cu(cx[1]);return bR.Return(cx[0]);});});};},null);};z.apply=function(cs,ct){z.applyA(function(cu){var cv;cv=null;return bR.Delay(function(){return bR.Return(cs(cu));});},ct);};z.applyA=function(cs,ct){ct.mailbox.AddLast(function(cu){var cv;cv=null;return bR.Delay(function(){return cs(cu);});});ct.resume();};z.setState=function(cs,ct){ct.mailbox.AddLast(function(){var cu;cu=null;return bR.Delay(function(){return bR.Return(cs);});});ct.resume();};z.getStateA=function(cs){return cs.PostAndAsyncReply(function(ct){return function(cu){var cv;cv=null;return bR.Delay(function(){ct(cu);return bR.Return(cu);});};},null);};y.defHandler=function(cs,ct){c.print$1(cs);return ct;};y.stateFull=function(cs,ct){return bX.Start(function(cu){function cv(cw){var cx;cx=null;return bR.Delay(function(){return bR.TryWith(bR.Delay(function(){return bR.Bind(cu.Receive(null),function(cy){return bR.Bind(cy(cw),function(cz){return cv(cz);});});}),function(cy){return cv(cs(cy,cw));});});}return cv(ct);},null);};y.fold=function(cs,ct,cu){return y.foldA(cs,function(cv,cw){var cx;cx=null;return bR.Delay(function(){return bR.Return(ct(cv,cw));});},cu);};y.foldA=function(cs,ct,cu){return bX.Start(function(cv){function cw(cx){var cy;cy=null;return bR.Delay(function(){return bR.TryWith(bR.Delay(function(){return bR.Bind(cv.Receive(null),function(cz){return bR.Bind(ct(cx,cz),function(cA){return cw(cA);});});}),function(cz){return cw(cs(cz,cx));});});}return cw(cu);},null);};y.call=function(cs,ct){return y.callA(cs,function(cu){var cv;cv=null;return bR.Delay(function(){return bR.Return(ct(cu));});});};y.callA=function(cs,ct){return y.iterA(cs,function(cu){var cv,cw,cx;cv=cu[0];cw=cu[1];cx=null;return bR.Delay(function(){return bR.Bind(ct(cw),function(cy){cv(cy);return bR.Zero();});});});};y.iter=function(cs,ct){return y.iterA(cs,function(cu){var cv;cv=null;return bR.Delay(function(){ct(cu);return bR.Zero();});});};y.iterA=function(cs,ct){return bX.Start(function(cu){var cv;cv=null;return bR.Delay(function(){return bR.While(function(){return true;},bR.Delay(function(){return bR.TryWith(bR.Delay(function(){return bR.Bind(cu.Receive(null),function(cw){return bR.Bind(ct(cw),function(){return bR.Return(null);});});}),function(cw){cs(cw);return bR.Zero();});}));});},null);};c.print$1=function(cs){if(typeof cs=="string")((function(ct){return function(cu){return ct(bM.toSafe(cu));};}(function(ct){bY.log(ct);}))(cs));else((function(ct){return function(cu){return ct(bM.prettyPrint(cu));};}(function(ct){bY.log(ct);}))(cs));};c.Error$1=function(cs){return{$:1,$0:cs};};B.sequenceSeq=function(cs){return B.traverseSeq(a.id,cs);};B.traverseSeq=function(cs,ct){return B.map(a.id,bQ.foldBack(function(cu,cv){return B.op_GreaterGreaterEquals(cs(cu),function(cw){return B.op_GreaterGreaterEquals(cv,function(cx){return B.rtn(new bP.T({$:1,$0:cw,$1:cx}));});});},bQ.ofSeq(ct),B.rtn(bP.T.Empty)));};B.op_GreaterGreaterEquals=function(cs,ct){return B.bind(ct,cs);};B.rtn=function(cs){return b0.Const(cs);};B.map=function(cs,ct){return b0.Map(cs,ct);};B.bind=function(cs,ct){return b0.Bind(cs,ct);};B.insertWO=function(cs){return cs==null?b0.Const(null):b0.Map(function(ct){return{$:1,$0:ct};},cs.$0);};C.lensView=function(cs,ct,cu,cv){var cw,cx,cy;cw=C.freshId();cx=b0.Map2(function(cz){return cs(cz);},cv.get_View(),cu);cy=new bZ.Var({Get:function(){return cs(cv.Get());},Set:function(cz){return cv.Update(function(cA){return ct(cA,cz);});},SetFinal:function(cz){return this.Set(cz);},Update:function(cz){return cv.Update(function(cA){return ct(cA,cz(cs(cA)));});},UpdateMaybe:function(cz){return cv.UpdateMaybe(function(cA){var cB;cB=cz(cs(cA));return cB==null?null:{$:1,$0:ct(cA,cB.$0)};});},get_View:function(){return cx;},get_Id:function(){return cw;}});b1.New.call(cy);return cy;};C.freshId=function(){C.set_counter(C.counter()+1);return"varuid"+a.String(C.counter());};C.counter=function(){bH.$cctor();return bH.counter;};C.set_counter=function(cs){bH.$cctor();bH.counter=cs;};D.currentLens=function(cs,ct,cu){return D["currentLensUpd'"](cs,ct,function(cv){cu.UpdateBy(function(){return cu.TryFindByKey(cu.key(cv))==null?null:{$:1,$0:cv};},cu.key(cv));},cu);};D["currentLensUpd'"]=function(cs,ct,cu,cv){return new b2.New(b0.Map2(function(cw,cx){var cy;cy=cx==null?null:cv.TryFindByKey(cx.$0);return cy==null?cs:cy.$0;},cv.v,ct),cu);};D.currentLensUpd=function(cs,ct,cu,cv){var cw;function cx(cz){return cv.TryFindByKey(cz);}function cy(cz){return cz==null?cs:cz.$0;}return C.lensView((cw=function(cz){return cz==null?null:cx(cz.$0);},function(cz){return cy(cw(cz));}),function(cz,cA){(h.iter(cu(cA)))(cz);return cz;},cv.v,ct);};D.lensDef=function(cs,ct,cu){function cv(cw){return cw==null?cs:cw.$0;}return D["lensIntoO'"](cu,cv,function(){return a.id;},ct,b0.Map(cv,cu.TryFindByKeyAsView(ct)));};D.docLensMapViewO=function(cs,ct,cu,cv){function cw(cx,cy){return cu(cx,D["lensIntoO'"](cv,function(cz){return cz==null?cs:cz.$0;},function(){return a.id;},cx,cy));}return b3.ConvertSeqBy(cv.key,function(cx){return function(cy){return cw(cx,cy);};},b0.Map(ct,cv.v));};D.docLensMapView=function(cs,ct,cu){function cv(cw,cx){return ct(cw,D["lensInto'"](cu,a.id,function(){return a.id;},cw,cx));}return b3.ConvertSeqBy(cu.key,function(cw){return function(cx){return cv(cw,cx);};},b0.Map(cs,cu.v));};D["lensIntoO'"]=function(cs,ct,cu,cv,cw){var cx,cy;cx=C.freshId();cy=new b1({Get:function(){return ct(cs.TryFindByKey(cv));},Set:function(cz){return cs.UpdateBy(function(cA){return{$:1,$0:(cu(cA))(cz)};},cv);},Update:function(cz){return cs.UpdateBy(function(cA){var cB;return{$:1,$0:(cB=cz(ct({$:1,$0:cA})),(cu(cA))(cB))};},cv);},UpdateMaybe:function(cz){return cs.UpdateBy(function(cA){var cB,cC;cB=cz(ct({$:1,$0:cA}));cC=cu(cA);return cB==null?null:{$:1,$0:cC(cB.$0)};},cv);},SetFinal:function(cz){return this.Set(cz);},get_View:function(){return cw;},get_Id:function(){return cx;}});b1.New.call(cy);return cy;};D["lensInto'"]=function(cs,ct,cu,cv,cw){var cx,cy;cx=C.freshId();cy=new b1({Get:function(){return ct(cs.FindByKey(cv));},Set:function(cz){return cs.UpdateBy(function(cA){return{$:1,$0:(cu(cA))(cz)};},cv);},Update:function(cz){return cs.UpdateBy(function(cA){var cB;return{$:1,$0:(cB=cz(ct(cA)),(cu(cA))(cB))};},cv);},UpdateMaybe:function(cz){return cs.UpdateBy(function(cA){var cB,cC;cB=cz(ct(cA));cC=cu(cA);return cB==null?null:{$:1,$0:cC(cB.$0)};},cv);},SetFinal:function(cz){return this.Set(cz);},get_View:function(){return cw;},get_Id:function(){return cx;}});b1.New.call(cy);return cy;};G=F.Address=bL.Class({get_txt:function(){return this.$0;}},null,G);H.BRGetProcessId={$:1};H.BRGetConnections={$:0};I.MsgRequestForEcho={$:5};I.MsgRequestForId={$:4};I.MsgFromBroker={$:3};I.MsgReply={$:2};I.MsgRequest={$:1};I.MsgInformation={$:0};J.BMReceiverCantReply={$:4};J.BMOnlyBrokerShouldUse={$:1};J.BMOk={$:0};K.Receiver={$:2};K.Broker={$:1};K.NoReply={$:0};L.New=function(cs,ct,cu,cv,cw,cx,cy){return{from:cs,destination:ct,msgType:cu,subtype:cv,id:cw,payload:cx,replier:cy};};F.makeReply=function(cs){return F.replier(K.NoReply,F.msgType(I.MsgReply,cs));};F.mapPayload=function(cs,ct){return L.New(ct.from,ct.destination,ct.msgType,ct.subtype,ct.id,cs(ct.payload),ct.replier);};F.msgId=function(cs,ct){return L.New(ct.from,ct.destination,ct.msgType,ct.subtype,cs,ct.payload,ct.replier);};F.replier=function(cs,ct){return L.New(ct.from,ct.destination,ct.msgType,ct.subtype,ct.id,ct.payload,cs);};F.subtype=function(cs,ct){return L.New(ct.from,ct.destination,ct.msgType,cs,ct.id,ct.payload,ct.replier);};F.msgType=function(cs,ct){return L.New(ct.from,ct.destination,cs,ct.subtype,ct.id,ct.payload,ct.replier);};F.destination=function(cs,ct){return L.New(ct.from,cs,ct.msgType,ct.subtype,ct.id,ct.payload,ct.replier);};F.from=function(cs,ct){return L.New(cs,ct.destination,ct.msgType,ct.subtype,ct.id,ct.payload,ct.replier);};F.MessageBrokerAddress=function(){bH.$cctor();return bH.MessageBrokerAddress;};F.MessageBrokerId=function(){bH.$cctor();return bH.MessageBrokerId;};O.DtOther={$:6};O.DtMeasure={$:5};O.DtCalc={$:4};O.DtTCalc={$:3};O.DtVersion={$:2};O.DtTime={$:1};O.DtDataType={$:0};P.CtFreeze={$:2};P.CtCalc={$:1};P.CtOther={$:0};Q.AtNumber={$:1};Q.AtString={$:0};R.EtNumber={$:1};R.EtString={$:0};S=N.ModId=bL.Class({get_Id:function(){return this.$0;}},null,S);T=N.AttId=bL.Class({get_Id:function(){return this.$0;}},null,T);U=N.ElmId=bL.Class({get_Id:function(){return this.$0;}},null,U);V=N.CubId=bL.Class({get_Id:function(){return this.$0;}},null,V);W=N.DimId=bL.Class({get_Id:function(){return this.$0;}},null,W);X=N.CalId=bL.Class({get_Id:function(){return this.$0;}},null,X);Y=N.TotId=bL.Class({get_Id:function(){return this.$0;}},null,Y);Z=N.ForId=bL.Class({get_Id:function(){return this.$0;}},null,Z);_0=N.RulId=bL.Class({get_Id:function(){return this.$0;}},null,_0);_1.New=function(cs,ct,cu,cv){return{attId:cs,attName:ct,attType:cu,attTableNum:cv};};_2.New=function(cs,ct,cu,cv,cw,cx,cy){return{elmId:cs,elmDim:ct,elmType:cu,elmName:cv,elmDescription:cw,elmAttributes:cx,elmParents:cy};};_3.New=function(cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC){return{dimId:cs,dimName:ct,dimPrefix:cu,dimOrder:cv,dimExclude:cw,dimFreeze:cx,dimType:cy,defaultElm:cz,dimElements:cA,dimAttributes:cB,isCalcDim:cC};};_4.UoPlus={$:1};_4.UoMinus={$:0};_5.OpOr={$:11};_5.OpAnd={$:10};_5.OpLE={$:9};_5.OpLT={$:8};_5.OpGE={$:7};_5.OpGT={$:6};_5.OpNE={$:5};_5.OpEQ={$:4};_5.OpDivide={$:3};_5.OpMultiply={$:2};_5.OpSubtract={$:1};_5.OpAdd={$:0};_6.ExtStet={$:1};_6.ExtNA={$:0};_7.ExnStet={$:1};_7.ExnNA={$:0};_8.ExiStet={$:1};_8.ExiNA={$:0};_9.New=function(cs,ct,cu){return{sliDims:cs,calculation:ct,cube:cu};};_.ForAll={$:2};_.ForConsolidated={$:1};_.ForBase={$:0};$.New=function(cs,ct,cu,cv,cw,cx,cy,cz){return{forId:cs,forDestDecl:ct,forDestination:cu,forDescription:cv,forText:cw,forExpression:cx,forType:cy,forOrder:cz};};ba.New=function(cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD){return{calId:cs,calName:ct,calDescription:cu,calOrder:cv,format:cw,isText:cx,isInput:cy,isBalance:cz,calDims:cA,calFormulas:cB,cubIdO:cC,properties:cD};};bb.New=function(cs,ct,cu,cv,cw){return{totId:cs,totName:ct,totOrder:cu,totFormat:cv,children:cw};};bc.ConsolidatedRuleKey={$:6};bc.InputRuleKey={$:5};bc.ActualRuleKey={$:4};bd.New=function(cs,ct,cu,cv,cw,cx,cy){return{cubId:cs,cubName:ct,cubRules:cu,cubRuleXmls:cv,cubDims:cw,measureDim:cx,cubType:cy};};be.New=function(cs,ct,cu,cv,cw,cx,cy,cz){return{rulId:cs,rulSourceId:ct,rulDescription:cu,rulDestination:cv,rulExpression:cw,rulType:cx,rulOrder:cy,rulXml:cz};};bf.GetInitModelStats={$:0};bg.New=function(cs,ct,cu,cv,cw,cx){return{modId:cs,server:ct,actualElem:cu,modDims:cv,modCubes:cw,modCalculations:cx};};bh.HelperTypeN={$:0};bh.op_AmpPercentGreater=function(cs,ct){return ct;};bh.op_AmpPercentGreater$1=function(cs,ct){return{$:2,$0:N.calcSlice(ct)};};bh.op_AmpPercentGreater$2=function(cs,ct){return{$:2,$0:ct};};bh.op_AmpPercentGreater$3=function(cs,ct){return{$:3,$0:ct};};bh.op_AmpPercentGreater$4=function(cs,ct){return{$:3,$0:ct};};bh.op_AmpPercentGreater$5=function(cs,ct){return{$:3,$0:ct?1:0};};bi.HelperTypeT={$:0};bi.op_AmpAmpGreater=function(cs,ct){return ct;};bi.op_AmpAmpGreater$1=function(cs,ct){return{$:2,$0:N.calcSlice(ct)};};bi.op_AmpAmpGreater$2=function(cs,ct){return{$:2,$0:ct};};bi.op_AmpAmpGreater$3=function(cs,ct){return{$:5,$0:ct.dimId};};bi.op_AmpAmpGreater$4=function(cs,ct){return{$:3,$0:ct};};bj.HelperTypeA={$:0};bk.getDimR=function(cs,ct){return l.ofOption(function(){return{$:0,$0:cs};},bk.getDimO(cs,ct));};bk.getDimO=function(cs,ct){return bO.tryFind(function(cu){return bV.Equals(cu.dimId,cs);},ct.modDims);};bk.getCubeO=function(cs,ct){return bO.tryFind(function(cu){return bV.Equals(cu.cubId,cs);},ct.modCubes);};bl.newElement=function(cs){return _2.New(new U({$:0,$0:b5.NewGuid()}),new W({$:0,$0:b5.NewGuid()}),R.EtString,cs,cs,new b7.New([]),[]);};bm.dimId=function(cs){return cs.$==1?cs.$0:cs.$0;};bn.containsDim=function(cs,ct){return ct.sliDims.ContainsKey(cs);};bn.addRef=function(cs,ct){return _9.New(ct.sliDims.Add(bm.dimId(cs),cs),ct.calculation,ct.cube);};bn.forAll=function(){bH.$cctor();return bH.forAll;};bn.newSlice=function(cs){return _9.New(new b7.New(bO.map(function(ct){return[bm.dimId(ct),ct];},cs)),null,null);};bo.filterSort=function(cs){var ct;ct=bo.filter(cs);return function(cu){return bo.sort(ct(cu));};};bo.sort=function(cs){return bO.sortBy(function(ct){return ct.dimOrder;},cs);};bo.filter=function(cs){function ct(cu){return bO.contains(cu.dimType,cs);}return function(cu){return bO.filter(ct,cu);};};bo.setName=function(cs,ct){return _3.New(ct.dimId,cs,ct.dimPrefix,ct.dimOrder,ct.dimExclude,ct.dimFreeze,ct.dimType,ct.defaultElm,ct.dimElements,ct.dimAttributes,ct.isCalcDim);};bo.dType=function(cs,ct){return _3.New(ct.dimId,ct.dimName,ct.dimPrefix,ct.dimOrder,ct.dimExclude,ct.dimFreeze,cs,ct.defaultElm,ct.dimElements,ct.dimAttributes,ct.isCalcDim);};bo.prefix=function(cs,ct){return _3.New(ct.dimId,ct.dimName,cs,ct.dimOrder,ct.dimExclude,ct.dimFreeze,ct.dimType,ct.defaultElm,ct.dimElements,ct.dimAttributes,ct.isCalcDim);};bo.New=function(cs){return bo.newDimension(new W({$:0,$0:b5.NewGuid()}),cs,false);};bo.newDimensionCalc=function(cs,ct){return bo.newDimension(cs,ct,true);};bo.newDimensionNonCalc=function(cs,ct){return bo.newDimension(cs,ct,false);};bo.newDimension=function(cs,ct,cu){return _3.New(cs,ct,"","",false,false,O.DtOther,null,[],[],cu);};bo.getElementR=function(cs,ct){return l.ofOption(function(){return{$:2,$0:ct.dimName,$1:cs};},bo.getElementO(cs,ct));};bo.getElementO=function(cs,ct){return bO.tryFind(function(cu){return bV.Equals(cu.elmId,cs);},ct.dimElements);};bp.measureDimNameR=function(cs,ct){return bT.Map(function(cu){return cu.dimName;},bp.measureDimR(cs,ct));};bp.measureDimR=function(cs,ct){return bT.Bind(function(cu){return bk.getDimR(cu,cs);},l.ofOption(function(){return{$:4,$0:ct.cubName};},ct.measureDim));};bp.measureDimO=function(cs,ct){var cu;cu=ct.measureDim;return cu==null?null:bk.getDimO(cu.$0,cs);};bp.dims=function(cs,ct){return bQ.filter(function(cu){var cv;return bQ.exists((cv=cu.dimId,function(cw){return bV.Equals(cv,cw);}),ct.cubDims);},cs.modDims);};bp.forElr=function(cs,ct){var cu;cu=bp.slice(ct);return _9.New(N.Map_adds(bP.map(function(cv){return[bm.dimId(cv),cv];},cs),bp.slice(ct).sliDims),cu.calculation,cu.cube);};bp.addRules=function(cs,ct){return bd.New(ct.cubId,ct.cubName,bO.fold(function(cu,cv){return cu.Add(cv[0],cv[1]);},ct.cubRules,cs),ct.cubRuleXmls,ct.cubDims,ct.measureDim,ct.cubType);};bp.addRule=function(cs,ct,cu){return bd.New(cu.cubId,cu.cubName,cu.cubRules.Add(cs,ct),cu.cubRuleXmls,cu.cubDims,cu.measureDim,cu.cubType);};bp.New=function(){return(((bp.newCube(""))([]))(null))(P.CtOther);};bp.newCubeDims=function(cs,ct,cu){return(((bp.newCube(cs))(bQ.ofSeq(bO.map(function(cv){return cv.dimId;},ct))))(cu))(P.CtOther);};bp.newCubeCalc=function(cs,ct,cu){return(((bp.newCube(cs))(ct))(cu))(P.CtCalc);};bp.newCube=function(cs){var ct;ct=new V({$:0,$0:b5.NewGuid()});return bL.Curried(bp.newCubeId,3,[ct,cs]);};bp.newCubeId=function(cs,ct,cu,cv,cw){return bd.New(cs,ct,new b7.New([]),new b7.New([]),cu,cv,cw);};bp.isCalcCube=function(cs){return cs.cubType.$===1;};bp.containsDim=function(cs,ct){return bO.contains(cs,ct.cubDims);};bp.slice=function(cs){return _9.New(new b7.New([]),null,{$:1,$0:cs.cubId});};bq.sort=function(cs){return bO.sortBy(function(ct){return ct.calOrder;},cs);};bq.cubeR=function(cs){return(N.ofOptF(function(){return(function(ct){return function(cu){return ct("Calculation '"+bM.toSafe(cu)+"' has no cube");};}(a.id))(cs.calName);}))(cs.cubIdO);};bq.withCube=function(cs,ct,cu){var cv,cw;cv=(cw=ct.cube,cw==null?null:bk.getCubeO(cw.$0,cs));return cv==null?null:cu(cv.$0);};bq.addFormulas=function(cs,ct){return bO.isEmpty(cs)?ct:ba.New(ct.calId,ct.calName,ct.calDescription,ct.calOrder,ct.format,ct.isText,ct.isInput,ct.isBalance,ct.calDims,ct.calFormulas.concat(bQ.ofSeq(cs)),ct.cubIdO,ct.properties);};bq.forSlice=function(cs,ct){var cu;cu=bq.slice(ct);return _9.New(N.Map_adds(bP.map(function(cv){return[bm.dimId(cv),cv];},cs),bq.slice(ct).sliDims),cu.calculation,cu.cube);};bq.addFormula=function(cs,ct){return ba.New(ct.calId,ct.calName,ct.calDescription,ct.calOrder,ct.format,ct.isText,ct.isInput,ct.isBalance,ct.calDims,ct.calFormulas.concat([cs]),ct.cubIdO,ct.properties);};bq.setOrder=function(cs,ct){return ba.New(ct.calId,ct.calName,ct.calDescription,cs,ct.format,ct.isText,ct.isInput,ct.isBalance,ct.calDims,ct.calFormulas,ct.cubIdO,ct.properties);};bq.setIsText=function(cs,ct){return ba.New(ct.calId,ct.calName,ct.calDescription,ct.calOrder,ct.format,cs,ct.isInput,ct.isBalance,ct.calDims,ct.calFormulas,ct.cubIdO,ct.properties);};bq.setName=function(cs,ct){return ba.New(ct.calId,cs,ct.calDescription,ct.calOrder,ct.format,ct.isText,ct.isInput,ct.isBalance,ct.calDims,ct.calFormulas,ct.cubIdO,ct.properties);};bq.New=function(){return bq.newInput(new X({$:0,$0:b5.NewGuid()}),"",[]);};bq.newCalc=function(cs,ct,cu){var cv;cv=bq.newInput(cs,ct,cu);return ba.New(cv.calId,cv.calName,cv.calDescription,cv.calOrder,cv.format,cv.isText,false,cv.isBalance,cv.calDims,cv.calFormulas,cv.cubIdO,cv.properties);};bq.newInput=function(cs,ct,cu){return ba.New(cs,bN.Trim(bN.Replace(ct,"_"," ")),"","","#,##0.00",false,true,false,new b8.New(cu),[],null,new b7.New([]));};bq.calcType=function(cs){return cs.isInput?"INPUT":"CALC";};bq.slice=function(cs){return N.calcSlice(cs);};br.New=function(){return br.newTotal("");};br.newTotal=function(cs){return bb.New(new Y({$:0,$0:b5.NewGuid()}),cs,"","",[]);};bs.addRules=function(cs,ct){return bO.fold(function(cu,cv){var cw,cx;function cy(cz,cA,cB){return[cA,cB];}cw=(cx=((bs.getCubeO())(cv[0]))(cu),cx==null?null:{$:1,$0:bs.setCube(bp.addRules(bO.map(function(cz){return cy(cz[0],cz[1],cz[2]);},cv[1]),cx.$0),cu)});return cw==null?cu:cw.$0;},ct,bO.groupBy(function(cu){return a.id(cu[0],cu[1],cu[2]);},cs));};bs.prepareModel=function(cs){return bs.fixCalcsAndCubes(bs.fixForDimensions(cs));};bs.fixCalcsAndCubes=function(cs){var ct,cu;function cv(cx){return bs.getCalcCube(cx,cs);}function cw(cx){return cx==null;}ct=bQ.filter(function(cx){var cy;return(cy=cx.cubIdO,cy==null?null:((bs.getCubeO())(cy.$0))(cs))==null;},cs.modCalculations);return bO.isEmpty(ct)?cs:(cu=bO.fold(function(cx,cy){return bs.newCalcCube(cy,cx);},cs,bO.filter(function(cx){return cw(cv(cx));},bO.distinct(bO.map(function(cx){return cx.calDims;},ct)))),bg.New(cu.modId,cu.server,cu.actualElem,cu.modDims,cu.modCubes,bQ.map(function(cx){var cy,cz,cA,cB;cy=(cz=bO.tryFind(function(cC){return bV.Equals(cC.calId,cx.calId);},ct),cz==null?null:{$:1,$0:(cA=cz.$0,ba.New(cA.calId,cA.calName,cA.calDescription,cA.calOrder,cA.format,cA.isText,cA.isInput,cA.isBalance,cA.calDims,cA.calFormulas,(cB=bs.getCalcCube(cA.calDims,cu),cB==null?null:{$:1,$0:cB.$0.cubId}),cA.properties))});return cy==null?cx:cy.$0;},cu.modCalculations)));};bs.newCalcCube=function(cs,ct){var cu,cv,cw;cu=bs.autoName(cs,ct);cv=bo.newDimensionCalc(new W({$:0,$0:b5.NewGuid()}),bs.measurePrefix()+cu);cw=bQ.ofSeq(bO.map(function(cx){return cx.dimId;},bO.append(bs.orderedDims(cs,ct),bP.ofArray([cv]))));return bg.New(ct.modId,ct.server,ct.actualElem,ct.modDims.concat([cv]),ct.modCubes.concat([bp.newCubeCalc(bs.cubePrefix()+cu,cw,{$:1,$0:cv.dimId})]),ct.modCalculations);};bs.fixForDimensions=function(cs){return bg.New(cs.modId,cs.server,cs.actualElem,cs.modDims,cs.modCubes,bQ.map(function(ct){return ba.New(ct.calId,ct.calName,ct.calDescription,ct.calOrder,ct.format,ct.isText,ct.isInput,ct.isBalance,b9.Filter(function(cu){return bO.exists(function(cv){return bV.Equals(cu,cv);},bs.dimIds(cs));},ct.calDims),ct.calFormulas,ct.cubIdO,ct.properties);},cs.modCalculations));};bs.dimIds=function(cs){return bQ.map(function(ct){return ct.dimId;},cs.modDims);};bs.autoName=function(cs,ct){var cu,cv,cw;cu=bN.concat("",bO.map(function(cx){return cx.dimPrefix;},bs.orderedDims(cs,ct)));cv=bO.choose(function(cx){var cy,cz;cy=bs.cubePrefix()+cu;return cx.cubName===cy?{$:1,$0:-1}:bN.StartsWith(cx.cubName,cy)?(cz=b_.string(cx.cubName,{$:1,$0:cu.length+1},null),(w.parseIntO$1())(cz)):null;},ct.modCubes);return cu+(bO.isEmpty(cv)?"":(cw=1+bO.max(cv),(function(cx){return function(cy){return cx(a.String(cy));};}(a.id))(cw)));};bs.orderedDims=function(cs,ct){return bO.filter(function(cu){var cv;return bO.exists((cv=cu.dimId,function(cw){return bV.Equals(cv,cw);}),cs);},ct.modDims);};bs.measurePrefix=function(){bH.$cctor();return bH.measurePrefix;};bs.cubePrefix=function(){bH.$cctor();return bH.cubePrefix;};bs.dimCombinations=function(cs){return bO.distinct(bO.map(function(ct){return ct.calDims;},cs.modCalculations));};bs.withDims=function(cs,ct,cu){return bs.withDimsO(cs,ct,bL.Curried(function(cv,cw,cx,cy){return{$:1,$0:cu(cv,cw,cx,cy)};},4));};bs.withDimsO=function(cs,ct,cu){var cv;return h.join(h.apply(h.apply(h.apply(h.apply({$:1,$0:cu},(cv=ct.measureDim,cv==null?null:((bs.getDimO())(cv.$0))(cs))),bs.dataTypeDimO(cs)),bs.versionDimO(cs)),bs.timeDimO(cs)));};bs.setCube=function(cs,ct){return bg.New(ct.modId,ct.server,ct.actualElem,ct.modDims,bQ.map(function(cu){return bV.Equals(cu.cubId,cs.cubId)?cs:cu;},ct.modCubes),ct.modCalculations);};bs.getCalcCube=function(cs,ct){return bO.tryFind(function(cu){return bV.Equals(new b8.New(bO.filter(function(cv){return!bV.Equals({$:1,$0:cv},cu.measureDim);},cu.cubDims)),cs);},bO.filter(bp.isCalcCube,ct.modCubes));};bs.isActualCalcO=function(cs){return bs.pickCalcO("IsActual",cs);};bs.versionDimO=function(cs){return bs.pickDimO(O.DtVersion,cs);};bs.timeDimO=function(cs){return bs.pickDimO(O.DtTime,cs);};bs.dataTypeDimO=function(cs){return bs.pickDimO(O.DtDataType,cs);};bs.tCalcDimO=function(cs){return bs.pickDimO(O.DtTCalc,cs);};bs.freezeCubeO=function(cs){return bs.pickCubeO(P.CtFreeze,cs);};bs.pickCalcO=function(cs,ct){return bO.tryPick(function(cu){return cu.calName===cs?{$:1,$0:cu}:null;},ct.modCalculations);};bs.pickDimO=function(cs,ct){return bO.tryPick(function(cu){return bV.Equals(cu.dimType,cs)?{$:1,$0:cu}:null;},ct.modDims);};bs.pickCubeO=function(cs,ct){return bO.tryPick(function(cu){return bV.Equals(cu.cubType,cs)?{$:1,$0:cu}:null;},ct.modCubes);};bs.getCubeR=function(cs,ct){return l.ofOption(function(){return{$:3,$0:cs};},((bs.getCubeO())(cs))(ct));};bs.getCalcR=function(cs,ct){return l.ofOption(function(){return{$:5,$0:cs};},bs.getCalcO(cs,ct));};bs.getCubeO=function(){bH.$cctor();return bH.getCubeO;};bs.getCalcO=function(cs,ct){return bO.tryFind(function(cu){return bV.Equals(cu.calId,cs);},ct.modCalculations);};bs.getDimR=function(){bH.$cctor();return bH.getDimR;};bs.getDimO=function(){bH.$cctor();return bH.getDimO;};bs.addForm=function(cs,ct,cu){return bg.New(cu.modId,cu.server,cu.actualElem,cu.modDims,cu.modCubes,bQ.map(function(cv){return bV.Equals(cv.calId,cs)?bq.addFormula(ct,cv):cv;},cu.modCalculations));};bs.addCube=function(cs,ct){return bg.New(ct.modId,ct.server,ct.actualElem,ct.modDims,ct.modCubes.concat([cs]),ct.modCalculations);};bs.addDim=function(cs,ct){return bg.New(ct.modId,ct.server,ct.actualElem,ct.modDims.concat([cs]),ct.modCubes,ct.modCalculations);};bs.addCalc=function(cs,ct){return bg.New(ct.modId,ct.server,ct.actualElem,ct.modDims,ct.modCubes,ct.modCalculations.concat([cs]));};bs.addForms=function(cs,ct){return bg.New(ct.modId,ct.server,ct.actualElem,ct.modDims,ct.modCubes,bQ.map(function(cu){var cv,cw;function cx(cy){return cy[0];}return bq.addFormulas(bO.map(function(cy){return cy[1];},bO.filter((cv=(cw=cu.calId,function(cy){return bV.Equals(cw,cy);}),function(cy){return cv(cx(cy));}),cs)),cu);},ct.modCalculations));};bs.addCubes=function(cs,ct){return bg.New(ct.modId,ct.server,ct.actualElem,ct.modDims,bs.mergeBy(function(cu){return cu.cubId;},cs,ct.modCubes),ct.modCalculations);};bs.addDims=function(cs,ct){return bg.New(ct.modId,ct.server,ct.actualElem,bs.mergeBy(function(cu){return cu.dimId;},cs,ct.modDims),ct.modCubes,ct.modCalculations);};bs.addCalcs=function(cs,ct){return bg.New(ct.modId,ct.server,ct.actualElem,ct.modDims,ct.modCubes,bs.mergeBy(function(cu){return cu.calId;},cs,ct.modCalculations));};bs.mergeBy=function(cs,ct,cu){return bQ.ofSeq(ct).concat(bQ.filter(function(cv){return!bO.contains(cs(cv),bO.map(cs,ct));},cu));};bt.getDimDest=function(cs,ct){return bO.tryPick(function(cu){return bV.Equals(bm.dimId(cu),cs.dimId)?{$:1,$0:cu}:null;},ct.forDestination);};bt.setOrder=function(cs,ct){return $.New(ct.forId,ct.forDestDecl,ct.forDestination,ct.forDescription,ct.forText,ct.forExpression,ct.forType,cs);};bt.setText=function(cs,ct){return $.New(ct.forId,ct.forDestDecl,ct.forDestination,ct.forDescription,cs,ct.forExpression,ct.forType,ct.forOrder);};bt.conso=function(cs){return $.New(cs.forId,cs.forDestDecl,cs.forDestination,cs.forDescription,cs.forText,cs.forExpression,_.ForConsolidated,cs.forOrder);};bu.conso=function(cs){return be.New(cs.rulId,cs.rulSourceId,cs.rulDescription,cs.rulDestination,cs.rulExpression,_.ForConsolidated,cs.rulOrder,cs.rulXml);};bu.New=function(){return be.New(new _0({$:0,$0:b5.NewGuid()}),null,"",bP.T.Empty,_8.ExiStet,_.ForBase,"","");};bv.New=function(){return _1.New(new T({$:0,$0:b5.NewGuid()}),"",Q.AtString,1);};N.ofOptS=function(cs){function ct(){return new d({$:4,$0:cs});}return function(cu){return l.ofOption(ct,cu);};};N.ofOptF=function(cs){function ct(){return new d({$:4,$0:cs()});}return function(cu){return l.ofOption(ct,cu);};};N.calcSlice=function(cs){return _9.New(new b7.New([]),{$:1,$0:cs.calId},null);};N.Map_adds=function(cs,ct){return new b7.New(bO.append(b$.ToSeq(ct),cs));};N.Xmodel=function(){bH.$cctor();return bH.Xmodel;};bx.TemplatesFileName=function(){bH.$cctor();return bH.TemplatesFileName;};bx.rootdir=function(){bH.$cctor();return bH.rootdir;};by.TreeNodeId={$:0};bz.New=function(cs,ct,cu,cv){return{major:cs,minor:ct,majorDate:cu,minorDate:cv};};bA.incrementMajor=function(cs){return bz.New(cs.major+1,0,function(ct){return ct.getFullYear()+"-"+("0"+(ct.getMonth()+1)).slice(-2)+"-"+("0"+ct.getDay()).slice(-2)+" "+("0"+ct.getHours()).slice(-2)+":"+("0"+ct.getMinutes()).slice(-2)+":"+("0"+ct.getSeconds()).slice(-2)+":"+("00"+ct.getMilliseconds()).slice(-3);}(new a.Date(ca.now())),function(ct){return ct.getFullYear()+"-"+("0"+(ct.getMonth()+1)).slice(-2)+"-"+("0"+ct.getDay()).slice(-2)+" "+("0"+ct.getHours()).slice(-2)+":"+("0"+ct.getMinutes()).slice(-2)+":"+("0"+ct.getSeconds()).slice(-2)+":"+("00"+ct.getMilliseconds()).slice(-3);}(new ca(ca.now())));};bA.incrementMinor=function(cs){return bz.New(cs.major,cs.minor+1,cs.majorDate,function(ct){return ct.getFullYear()+"-"+("0"+(ct.getMonth()+1)).slice(-2)+"-"+("0"+ct.getDay()).slice(-2)+" "+("0"+ct.getHours()).slice(-2)+":"+("0"+ct.getMinutes()).slice(-2)+":"+("0"+ct.getSeconds()).slice(-2)+":"+("00"+ct.getMilliseconds()).slice(-3);}(new ca(ca.now())));};bA.New=function(){return bz.New(0,0,"","");};bB.New=function(cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI){return{calculations:cs,totals:ct,dimensions:cu,cubes:cv,globalDefs:cw,server:cx,selection:cy,selectedDim:cz,selectedCube:cA,collapsed:cB,cubePrefix:cC,measurePrefix:cD,outputMsgs:cE,codeFS:cF,parserMsgs:cG,fileName:cH,version:cI};};bC.NoOp={$:22};bC.AddDimension={$:13};bC.AddCalculation={$:3};bC.AddTotal={$:0};bD.getDimsCubeO=a.id;bD.refreshNow=function(){bH.$cctor();return bH.refreshNow;};bD.refreshView=function(){bH.$cctor();return bH.refreshView;};bD.nonFormulaV=function(){bH.$cctor();return bH.nonFormulaV;};bD.nonCalculationV=function(){bH.$cctor();return bH.nonCalculationV;};bD.nonTotalV=function(){bH.$cctor();return bH.nonTotalV;};bD.nonFormula=function(){bH.$cctor();return bH.nonFormula;};bD.nonCalculation=function(){bH.$cctor();return bH.nonCalculation;};bD.nonTotal=function(){bH.$cctor();return bH.nonTotal;};bD.selectedString=function(cs,ct){return b0.Map(function(cu){return cu?cs:"";},ct);};bE.appendParser=function(cs){bE.appendText(bE.model().parserMsgs,cs);};bE.appendMsgs=function(cs){bE.appendText(bE.model().outputMsgs,cs);};bE.appendText=function(cs,ct){var cu;cs.Set((cu=cs.Get(),cu===""?ct:ct===""?cu:cu+"\n"+ct));};bE.processor=function(){bH.$cctor();return bH.processor;};bE.set_processor=function(cs){bH.$cctor();bH.processor=cs;};bE.model=function(){bH.$cctor();return bH.model;};bF.tableDimensions$2006$48=function(cs){return function(){(bE.processor())({$:15,$0:cs});};};bF.tableDimensions$2005$48=function(cs){return function(){(bE.processor())({$:14,$0:cs});};};bF.tableDimensions=function(){var cs,ct,cu,cv,cw;return(cs=(ct=(cu=bE.model().dimensions,D.docLensMapView(bo.filterSort(bF.dtypes()),function(cx,cy){var cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK;function cL(cM){return b_.string(cM,{$:1,$0:2},null);}return(cz=(cA=(cB=(cC=cb.Lens(cy,function(cM){return cM.dimFreeze;},function(cM,cN){return _3.New(cM.dimId,cM.dimName,cM.dimPrefix,cM.dimOrder,cM.dimExclude,cN,cM.dimType,cM.defaultElm,cM.dimElements,cM.dimAttributes,cM.isCalcDim);}),(cD=cb.Lens(cy,function(cM){return cM.dimExclude;},function(cM,cN){return _3.New(cM.dimId,cM.dimName,cM.dimPrefix,cM.dimOrder,cN,cM.dimFreeze,cM.dimType,cM.defaultElm,cM.dimElements,cM.dimAttributes,cM.isCalcDim);}),(cE=cb.Lens(cb.Lens(cy,function(cM){return cM.dimType;},function(cM,cN){return _3.New(cM.dimId,cM.dimName,cM.dimPrefix,cM.dimOrder,cM.dimExclude,cM.dimFreeze,cN,cM.defaultElm,cM.dimElements,cM.dimAttributes,cM.isCalcDim);}),(cF=function(cM){return function(cN){return cM(bJ.p(cN));};}(a.id),function(cM){return cL(cF(cM));}),function(cM,cN){return cN==="DataType"?O.DtDataType:cN==="Time"?O.DtTime:cN==="Version"?O.DtVersion:O.DtOther;}),(cG=cb.Lens(cy,function(cM){return cM.dimOrder;},function(cM,cN){return _3.New(cM.dimId,cM.dimName,cM.dimPrefix,cN,cM.dimExclude,cM.dimFreeze,cM.dimType,cM.defaultElm,cM.dimElements,cM.dimAttributes,cM.isCalcDim);}),(cH=cb.Lens(cy,function(cM){return cM.dimPrefix;},function(cM,cN){return _3.New(cM.dimId,cM.dimName,cN,cM.dimOrder,cM.dimExclude,cM.dimFreeze,cM.dimType,cM.defaultElm,cM.dimElements,cM.dimAttributes,cM.isCalcDim);}),(cI=cb.Lens(cy,function(cM){return cM.dimName;},function(cM,cN){return _3.New(cM.dimId,cN,cM.dimPrefix,cM.dimOrder,cM.dimExclude,cM.dimFreeze,cM.dimType,cM.defaultElm,cM.dimElements,cM.dimAttributes,cM.isCalcDim);}),cf.Make().WithHole({$:8,$0:"name",$1:cI})).WithHole({$:8,$0:"abbreviation",$1:cH})).WithHole({$:8,$0:"order",$1:cG})).WithHole({$:8,$0:"type",$1:cE})).WithHole({$:9,$0:"excludename",$1:cD})).WithHole({$:9,$0:"includefreeze",$1:cC})),cB.WithHole(cg.EventQ2(cB.k,"remove",function(){return cB.i;},function(){(bE.processor())({$:14,$0:cx});}))),cA.WithHole(cg.EventQ2(cA.k,"select",function(){return cA.i;},function(){(bE.processor())({$:15,$0:cx});}))),(cJ=cg.CompleteHoles(cz.k,cz.h,[["name",0],["abbreviation",0],["order",0],["type",0],["excludename",2],["includefreeze",2]]),(cK=new ch.New(cJ[1],bI.dimensionrow(cJ[0])),(cz.i=cK,cK)))).get_Doc();},cu)),cf.Make().WithHole({$:0,$0:"tbody",$1:ct})),(cv=cg.CompleteHoles(cs.k,cs.h,[]),(cw=new ch.New(cv[1],bI.dimensiontable(cv[0])),(cs.i=cw,cw)))).get_Doc();};bF.dtypes=function(){bH.$cctor();return bH.dtypes;};bG.mainProgram=function(){var cs,ct,cu,cv,cw;ci.addPlugIn(cj.New("RuleEditor",[],[],[ci.newDoc("Dimensions",ck.Create(bF.tableDimensions))],[ci.newAct("AddDimension",function(){(bE.processor())(bC.AddDimension);})],[]));cl.addLayout((cs=(cm.unindentStr())("\r\n                    menuEditor       horizontal  65       menuLogo                  editorMessages\r\n                    double           horizontal  0-50-100 AppFramework.AppFwkClient menuEditor\r\n                    menuLogo         vertical    350      logo                      menu\r\n                    logo             span       \"margin:0; color:gray; font-size: 55px; font-weight:530\" \"F# Station\"\r\n                    editorMessages   horizontal 10-83-100 editorButtons             messages\r\n                    messages         vertical   0-50-100  messagesLeft              messagesRight\r\n                    editorButtons    vertical -200 snippetsSnippet buttons\r\n                    buttons div      \"overflow: hidden; display: grid; grid-template-columns: 100%; grid-template-rows: repeat(15, calc(100% / 15)); bxackground-color: #eee; box-sizing: border-box; padding : 5px; grid-gap: 5px; margin-right: 21px\" btnSaveAs none x btnAddSnippet btnDeleteSnippet btnIndentIn btnIndentOut none x btnRunFS none x btnAbortFsi\r\n                    snippetsSnippet  vertical   0-20-100  snippets                  editorProperties\r\n                    snippets         horizontal 20        \"${FSharpStation.CurrentPath}\" FSharpStation.Snippets\r\n                    editorProperties vertical   0-100-100 snippet                   properties\r\n                    properties       div        \"\"        FSharpStation.Properties\r\n                    snippet          horizontal 35        Name                      FSharpStation.editor\r\n                    menu             span  \"\" btnLoad btnImport\r\n        \r\n                    btnSaveAs        button FSharpStation.SaveAs         \"class=btn ${FSharpStation.SaveNeeded}\" \"Save as...    \"\r\n                    btnAddDimension  button RuleEditor.AddDimension      \"\"                  \"Add Dimension \"\r\n                    btnDeleteSnippet button FSharpStation.RemoveSnippet  \"\"                  \"Delete Snippet\"\r\n                    btnIndentIn      button FSharpStation.IndentIn       \"\"                  \"Indent In  >> \"\r\n                    btnIndentOut     button FSharpStation.IndentOut      \"\"                  \"Indent Out << \"\r\n                    btnRunFS         button FSharpStation.RunFS          \"\"                  \"Run F#        \"\r\n                    btnAbortFsi      button FSharpStation.AbortFsi       \"\"                  \"Abort Fsi     \"\r\n        \r\n                    messagesLeft     wcomp-tabstrip                      \"\"                  Output FsCode\r\n                    messagesRight    wcomp-tabstrip                      \"\"                  Parser\r\n        \r\n                    Output           textarea  FSharpStation.Output      \"tabname=Output ; placeholder=Output messages ; spellcheck=false\" \r\n                    FsCode           textarea  FSharpStation.FsCode      \"tabname=F# Code; placeholder=F# Code         ; spellcheck=false\" \r\n                    Parser           textarea  FSharpStation.Parser      \"tabname=Parser ; placeholder=Parser messages; dblclick=${FSharpStation.JumpTo} ; spellcheck=false\" \r\n                    Name             Doc       InputLabel                \"\"     \"Name:\"        FSharpStation.SnippetName\r\n                    btnLoad          Doc       InputFile                 \"\"     \"Load File...\" FSharpStation.LoadFile  FileName\r\n                    btnImport        Doc       InputFile                 \"\"     \"Import...\"    FSharpStation.Import    \"\"\r\n                    FileName         div                                 \"class=form-control\"  FSharpStation.fileName\r\n                "),cl.newLyt(bG.RuleEditorLyt(),cs)));ct=(cu=null,(cv=bG.RuleEditorLyt(),cu==null?cv:cu.$0));ci.mainDocV().Set(ct);return b3.Async((cw=null,bR.Delay(function(){return bR.Return(ci.getMainDoc().f());})));};bG.scrollToBottom=function(cs,ct){var cu;bR.Start((cu=null,bR.Delay(function(){return bR.Bind(bR.Sleep(100),function(){cs.scrollTop=cs.scrollHeight;return bR.Zero();});})),null);};bG.RuleEditorLyt=function(){bH.$cctor();return bH.RuleEditorLyt;};bH.$cctor=function(){var cs,ct,cu,cv,cw;bH.$cctor=a.ignore;bH.rtn=function(cx){return[cx];};bH.result=new m.New();bH.result$1=l.result();bH.fusion=new r.New();bH.fusion$1=new v.New();bH.parseDateO=w.tryParseWith$1(function(cx){var cy,cz;cy=0;return[(cz=cn.TryParse(cx),cz!=null&&cz.$==1&&(cy=cz.$0,true)),cy];});bH.parseIntO=w.tryParseWith$1(function(cx){var cy;cy=0;return[co.TryParseInt32(cx,{get:function(){return cy;},set:function(cz){cy=cz;}}),cy];});bH.parseSingleO=w.tryParseWith$1(function(cx){var cy,cz;cy=0;return[(cz=a.Number(cx),a.isNaN(cz)?false:(cy=cz,true)),cy];});bH.parseDoubleO=w.tryParseWith$1(function(cx){var cy,cz;cy=0;return[(cz=a.Number(cx),a.isNaN(cz)?false:(cy=cz,true)),cy];});bH.parseGuidO=w.tryParseWith$1(function(cx){var cy;cy=null;return[b5.TryParse(cx,{get:function(){return cy;},set:function(cz){cy=cz;}}),cy];});bH["|Date|_|"]=w.parseDateO$1();bH["|Int|_|"]=w.parseIntO$1();bH["|Single|_|"]=w.parseSingleO$1();bH["|Double|_|"]=w.parseDoubleO$1();bH["|Guid|_|"]=w.parseGuidO$1();bH.counter=1;bH.MessageBrokerId="<MessageBroker>";bH.MessageBrokerAddress=new G({$:0,$0:F.MessageBrokerId()});bH.Xmodel=bg.New(new S({$:0,$0:b5.NewGuid()}),"local\\Budget","Actual",[],[],[]);bH.forAll=_9.New(new b7.New([]),null,null);bH.getDimO=function(cx){return function(cy){return bk.getDimO(cx,cy);};};bH.getDimR=function(cx){return function(cy){return bk.getDimR(cx,cy);};};bH.getCubeO=function(cx){return function(cy){return bk.getCubeO(cx,cy);};};bH.cubePrefix="Z";bH.measurePrefix="M";bH.rootdir="..\\website";bH.TemplatesFileName="..\\website"+"\\Templates.html";((function(cx){return function(cy){return cx(bM.toSafe(cy));};}(function(cx){bY.log(cx);}))("..\\website\\Templates.html"));bH.nonTotal=(cs=br.New(),bb.New(new Y({$:0,$0:"00000000-0000-0000-0000-000000000000"}),cs.totName,cs.totOrder,cs.totFormat,cs.children));bH.nonCalculation=(ct=bq.New(),ba.New(new X({$:0,$0:"00000000-0000-0000-0000-000000000000"}),ct.calName,ct.calDescription,ct.calOrder,ct.format,ct.isText,ct.isInput,ct.isBalance,ct.calDims,ct.calFormulas,ct.cubIdO,ct.properties));bH.nonFormula=(cu=$.New(new Z({$:0,$0:b5.NewGuid()}),new b7.New([]),bP.T.Empty,"","",_8.ExiStet,_.ForBase,""),$.New(new Z({$:0,$0:"00000000-0000-0000-0000-000000000000"}),cu.forDestDecl,cu.forDestination,cu.forDescription,cu.forText,cu.forExpression,cu.forType,cu.forOrder));bH.nonTotalV=cb.Lens(cb.Create$1(bD.nonFormula()),a.id,a.id);bH.nonCalculationV=cb.Lens(cb.Create$1(bD.nonCalculation()),a.id,a.id);bH.nonFormulaV=cb.Lens(cb.Create$1(bD.nonFormula()),a.id,a.id);cw=(cv=cb.Create$1(),[cv.get_View(),function(){cv.Set(null);}]);bH.refreshView=cw[0];bH.refreshNow=cw[1];bH.model=bB.New(cp.Create(function(cx){return cx.calId;},[]),cp.Create(function(cx){return cx.totId;},[]),cp.Create(function(cx){return cx.dimId;},[]),cp.Create(function(cx){return cx.cubId;},[]),cb.Create$1(""),cb.Create$1(""),cb.Create$1(null),cb.Create$1(null),cb.Create$1(null),cp.Create(a.id,[]),cb.Create$1("Z"),cb.Create$1("M"),cb.Create$1(""),cb.Create$1(""),cb.Create$1(""),cb.Create$1("NewFile.json"),cb.Create$1(bA.New()));bH.processor=a.ignore;bH.dtypes=bP.ofArray([O.DtDataType,O.DtTime,O.DtVersion,O.DtOther]);bH.RuleEditorLyt="RuleEditorLyt";};bI.dimensiontable=function(cs){cr.LoadLocalTemplates("templates");return cs?cr.NamedTemplate("templates",{$:1,$0:"dimensiontable"},cs):void 0;};bI.dimensionrow=function(cs){cr.LoadLocalTemplates("templates");return cs?cr.NamedTemplate("templates",{$:1,$0:"dimensionrow"},cs):void 0;};bJ.p=function(cs){return cs.$==6?"DtOther":cs.$==5?"DtMeasure":cs.$==4?"DtCalc":cs.$==3?"DtTCalc":cs.$==2?"DtVersion":cs.$==1?"DtTime":"DtDataType";};}());

//# sourceMappingURL=RuleEditor.min.map