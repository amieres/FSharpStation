(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp;a=self;b=a.FsRoot=a.FsRoot||{};c=b.Library=b.Library||{};d=c.ResultMessage=c.ResultMessage||{};e=c.Monads=c.Monads||{};f=e.Seq=e.Seq||{};g=e.Option=e.Option||{};h=e.Async=e.Async||{};i=a.WebSharper;j=i&&i.Obj;k=e.Result=e.Result||{};l=k.Builder=k.Builder||{};m=k.Operators=k.Operators||{};n=e.FusionM=e.FusionM||{};o=n.Operators=n.Operators||{};p=n.Builder=n.Builder||{};q=p.Builder=p.Builder||{};r=e.FusionAsyncM=e.FusionAsyncM||{};s=r.Operators=r.Operators||{};t=r.Builder=r.Builder||{};u=t.Builder=t.Builder||{};v=c.ParseO=c.ParseO||{};w=c.MailboxProcessorExt=c.MailboxProcessorExt||{};x=c.Mailbox=c.Mailbox||{};y=x.StateFull=x.StateFull||{};z=b.LibraryJS=b.LibraryJS||{};A=z.View=z.View||{};B=z.Var=z.Var||{};C=z.ListModel=z.ListModel||{};D=b.Library2=b.Library2||{};E=D.WebSockets=D.WebSockets||{};F=E.Address=E.Address||{};G=E.BrokerRequest=E.BrokerRequest||{};H=E.MessageType=E.MessageType||{};I=E.BrokerMessage=E.BrokerMessage||{};J=E.Replier=E.Replier||{};K=E.MessageGeneric=E.MessageGeneric||{};L=b.CalculationModel=b.CalculationModel||{};M=L.CalculationModel=L.CalculationModel||{};N=M.DimType=M.DimType||{};O=M.CubeType=M.CubeType||{};P=M.AttType=M.AttType||{};Q=M.ElmType=M.ElmType||{};R=M.ModId=M.ModId||{};S=M.AttId=M.AttId||{};T=M.ElmId=M.ElmId||{};U=M.CubId=M.CubId||{};V=M.DimId=M.DimId||{};W=M.CalId=M.CalId||{};X=M.TotId=M.TotId||{};Y=M.ForId=M.ForId||{};Z=M.RulId=M.RulId||{};_0=M.Attribute=M.Attribute||{};_1=M.Element=M.Element||{};_2=M.Dimension=M.Dimension||{};_3=M.UnaryOp=M.UnaryOp||{};_4=M.Operator=M.Operator||{};_5=M.ExpressionText=M.ExpressionText||{};_6=M.ExpressionNumber=M.ExpressionNumber||{};_7=M.ExpressionAny=M.ExpressionAny||{};_8=M.Slice=M.Slice||{};_9=M.ForType=M.ForType||{};_=M.Formula=M.Formula||{};$=M.Calculation=M.Calculation||{};ba=M.Total=M.Total||{};bb=M.RuleKey=M.RuleKey||{};bc=M.Cube=M.Cube||{};bd=M.Rule=M.Rule||{};be=M.RuleMsg=M.RuleMsg||{};bf=M.Model=M.Model||{};bg=M.HelperTypeN=M.HelperTypeN||{};bh=M.HelperTypeT=M.HelperTypeT||{};bi=M.HelperTypeA=M.HelperTypeA||{};bj=M.Model0=M.Model0||{};bk=M.ElementModule=M.ElementModule||{};bl=M.ElmReferenceModule=M.ElmReferenceModule||{};bm=M.SliceModule=M.SliceModule||{};bn=M.DimensionModule=M.DimensionModule||{};bo=M.CubeModule=M.CubeModule||{};bp=M.CalculationModule=M.CalculationModule||{};bq=M.TotalModule=M.TotalModule||{};br=M.ModelModule=M.ModelModule||{};bs=M.FormulaModule=M.FormulaModule||{};bt=M.RuleModule=M.RuleModule||{};bu=M.AttributeModule=M.AttributeModule||{};bv=b.RuleEditor=b.RuleEditor||{};bw=bv.Templating=bv.Templating||{};bx=bv.Version=bv.Version||{};by=bv.VersionModule=bv.VersionModule||{};bz=bv.ModelUI=bv.ModelUI||{};bA=bv.MsgModel=bv.MsgModel||{};bB=bv.ModelUIModule=bv.ModelUIModule||{};bC=bv.Global=bv.Global||{};bD=bv.TableDimensions=bv.TableDimensions||{};bE=bv.MainProgram=bv.MainProgram||{};bF=a.StartupCode$RuleEditor$RuleEditor=a.StartupCode$RuleEditor$RuleEditor||{};bG=a.RuleEditor_Templates=a.RuleEditor_Templates||{};bH=a.RuleEditor_GeneratedPrintf=a.RuleEditor_GeneratedPrintf||{};bI=a.IntelliFactory;bJ=bI&&bI.Runtime;bK=i&&i.Utils;bL=i&&i.Strings;bM=i&&i.Seq;bN=i&&i.Arrays;bO=i&&i.List;bP=i&&i.Concurrency;bQ=i&&i.Enumerator;bR=i&&i.Result;bS=i&&i.Operators;bT=i&&i.Unchecked;bU=i&&i.Control;bV=bU&&bU.MailboxProcessor;bW=a.console;bX=i&&i.UI;bY=bX&&bX.View;bZ=bX&&bX.Var;b0=bX&&bX.FromView;b1=bX&&bX.Doc;b2=a.System;b3=b2&&b2.Guid;b4=i&&i.Collections;b5=b4&&b4.FSharpMap;b6=b4&&b4.FSharpSet;b7=b4&&b4.Set;b8=i&&i.Slice;b9=b4&&b4.Map;b_=a.Date;b$=bX&&bX.Var$1;ca=bX&&bX.Templating;cb=ca&&ca.Runtime;cc=cb&&cb.Server;cd=cc&&cc.ProviderBuilder;ce=cc&&cc.Handler;cf=cc&&cc.TemplateInstance;cg=z&&z.AppFramework;ch=cg&&cg.PlugIn;ci=i&&i.Lazy;cj=z&&z.LayoutEngineModule;ck=c&&c.String;cl=i&&i.DateUtil;cm=i&&i.Numeric;cn=bX&&bX.ListModel;co=bX&&bX.Client;cp=co&&co.Templates;d=c.ResultMessage=bJ.Class({toString:function(){return this.$==1?(function(cq){return function(cr){return cq("Error    : "+bK.toSafe(cr));};}(a.id))(this.$0):this.$==2?(function(cq){return function(cr){return cq("Warning  : "+bK.toSafe(cr));};}(a.id))(this.$0):this.$==3?this.$0:this.$==4?(function(cq){return function(cr){return cq(a.String(cr));};}(a.id))(this.$0):this.$==5?(((bJ.Curried3(function(cq,cr,cs){return cq("Exception: "+bK.toSafe(cr)+", "+bK.toSafe(cs));}))(a.id))(this.$0))(this.$1):this.$==6?bL.concat("\n",bM.map(a.String,bM.filter(function(cq){return cq.$!=0;},this.$0))):"";}},null,d);d.NoMsg=new d({$:0});d.summarizedI=function(cq){return d.summarizedF(function(){return[0,0,1];},cq);};d.summarizedW=function(cq){return d.summarizedF(function(){return[0,1,0];},cq);};d.summarized=function(cq){return d.summarizedF(function(){return[1,0,0];},cq);};d.summarizedF=function(cq,cr){return d.summaryF(cq,cr)+a.String(cr);};d.summaryF=function(cq,cr){var cs,ct;ct=d.countF(cq,cr);switch(ct[0]===0?ct[1]===0?0:ct[1]===1?ct[2]===0?0:(cs=ct[1],2):(cs=ct[1],2):ct[0]===1?ct[1]===0?ct[2]===0?0:(cs=ct[0],1):(cs=[ct[0],ct[1]],3):ct[1]===0?(cs=ct[0],1):(cs=[ct[0],ct[1]],3)){case 0:return"";case 1:return(function(cu){return function(cv){return cu("Errors   : "+a.String(cv)+"\n");};}(a.id))(cs);case 2:return(function(cu){return function(cv){return cu("Warnings : "+a.String(cv)+"\n");};}(a.id))(cs);case 3:return(((bJ.Curried3(function(cu,cv,cw){return cu("Errors   : "+a.String(cv)+", Warnings: "+a.String(cw)+"\n");}))(a.id))(cs[0]))(cs[1]);}};d.reduceMsgs=function(cq){return bM.fold(d.addMsg,d.NoMsg,cq);};d.addMsg=function(cq,cr){return cq.$==0?cr:cq.$==6?cr.$==0?cq:cr.$==6?new d({$:6,$0:cq.$0.concat(cr.$0)}):new d({$:6,$0:cq.$0.concat([cr])}):cr.$==0?cq:cr.$==6?new d({$:6,$0:[cq].concat(cr.$0)}):new d({$:6,$0:[cq,cr]});};d.countI=function(cq){return d.countF(function(){return[0,0,1];},cq);};d.countW=function(cq){return d.countF(function(){return[0,1,0];},cq);};d.count=function(cq){return d.countF(function(){return[1,0,0];},cq);};d.countF=function(cq,cr){function cs(ct,cu,cv){return function(cw){return[ct+cw[0],cu+cw[1],cv+cw[2]];};}return cr.$==0?[0,0,0]:cr.$==3?[0,0,1]:cr.$==2?[0,1,0]:cr.$==4?cq(cr.$0):cr.$==6?bM.fold(function(ct,cu){return(function(cv){return cs(cv[0],cv[1],cv[2]);}(ct))(cu);},[0,0,0],bM.map(function(ct){return d.countF(cq,ct);},d.exclnoMsg(cr.$0))):[1,0,0];};d.isFatalW=function(cq){return d.isFatalF(function(){return false;},cq);};d.isFatal=function(cq){return d.isFatalF(function(){return true;},cq);};d.isFatalF=function(cq,cr){return cr.$==0?false:cr.$==3?false:cr.$==2?false:cr.$==4?cq(cr.$0):cr.$==6?bM.exists(function(cs){return d.isFatalF(cq,cs);},cr.$0):true;};d.isWarningOrInfoW=function(cq){return d.isWarningOrInfoF(function(){return true;},cq);};d.isWarningOrInfo=function(cq){return d.isWarningOrInfoF(function(){return false;},cq);};d.isWarningOrInfoF=function(cq,cr){return cr.$==2||(cr.$==4?cq(cr.$0):cr.$==6&&bM.forall(function(cs){return d.isWarningOrInfoF(cq,cs)||d.isInfoF(cq,cs);},d.exclnoMsg(cr.$0)));};d.isInfoI=function(cq){return d.isInfoF(function(){return true;},cq);};d.isInfo=function(cq){return d.isInfoF(function(){return false;},cq);};d.isInfoF=function(cq,cr){return cr.$==3||(cr.$==4?cq(cr.$0):cr.$==6&&bM.forall(function(cs){return d.isInfoF(cq,cs);},d.exclnoMsg(cr.$0)));};d.freeMessageI=function(cq){var cr;function cs(ct){return new d({$:3,$0:ct});}return d.freeMessageF((cr=function(ct){return function(cu){return ct(a.String(cu));};}(a.id),function(ct){return cs(cr(ct));}),cq);};d.freeMessageW=function(cq){var cr;function cs(ct){return new d({$:2,$0:ct});}return d.freeMessageF((cr=function(ct){return function(cu){return ct(a.String(cu));};}(a.id),function(ct){return cs(cr(ct));}),cq);};d.freeMessage=function(cq){var cr;function cs(ct){return new d({$:1,$0:ct});}return d.freeMessageF((cr=function(ct){return function(cu){return ct(a.String(cu));};}(a.id),function(ct){return cs(cr(ct));}),cq);};d.freeMessageF=function(cq,cr){return d.bindMessage(cq,cr);};d.bindMessage=function(cq,cr){return cr.$==4?cq(cr.$0):cr.$==1?new d({$:1,$0:cr.$0}):cr.$==3?new d({$:3,$0:cr.$0}):cr.$==2?new d({$:2,$0:cr.$0}):cr.$==5?new d({$:5,$0:cr.$0,$1:cr.$1}):cr.$==6?new d({$:6,$0:bN.map(function(cs){return d.bindMessage(cq,cs);},cr.$0)}):d.NoMsg;};d.exclnoMsg=function(cq){function cr(cs){return!cs;}return bM.filter(function(cs){return cr(d.noMsg(cs));},cq);};d.noMsg=function(cq){return cq.$==0;};f.absorbR=function(cq){return bM.choose(function(cr){return cr.$==0?{$:1,$0:cr.$0}:null;},cq);};f.absorbO=function(cq){return bM.choose(a.id,cq);};f.insertR=function(cq){return cq.$==0?bM.map(function(cr){return{$:0,$0:cr};},cq.$0):(f.rtn())(c.Error$1(cq.$0));};f.insertO=function(cq){var cr;cr=cq==null?null:{$:1,$0:bM.map(function(cs){return{$:1,$0:cs};},cq.$0)};return cr==null?(f.rtn())(null):cr.$0;};f.rtn=function(){bF.$cctor();return bF.rtn;};g.absorbR=function(cq){var cr,cs;return cq!=null&&cq.$==1&&(cs=cq.$0,cs.$==0&&(cr=cs.$0,true))?{$:1,$0:cr}:null;};g.insertR=function(cq){var cr;return cq.$==0?(cr=cq.$0,cr==null?null:{$:1,$0:{$:0,$0:cr.$0}}):g.rtn(c.Error$1(cq.$0));};g.sequenceSeq=function(cq){return g.traverseSeq(a.id,cq);};g.traverseSeq=function(cq,cr){var cs;cs=bN.foldBack(function(ct,cu){return g.op_GreaterGreaterEquals(cq(ct),function(cv){return g.op_GreaterGreaterEquals(cu,function(cw){return g.rtn(new bO.T({$:1,$0:cv,$1:cw}));});});},bN.ofSeq(cr),g.rtn(bO.T.Empty));return cs==null?null:{$:1,$0:cs.$0};};g.op_GreaterGreaterEquals=function(cq,cr){return cq==null?null:cr(cq.$0);};g.bindNone=function(cq,cr){return cr!=null&&cr.$==1?{$:1,$0:cr.$0}:cq();};g.mapNone=function(cq,cr){return cr==null?cq():cr.$0;};g.apply=function(cq,cr){var cs;return cq!=null&&cq.$==1&&(cr!=null&&cr.$==1&&(cs=[cq.$0,cr.$0],true))?{$:1,$0:cs[0](cs[1])}:null;};g.join=function(cq){return cq==null?null:cq.$0;};g.iter=function(cq){function cr(ct){return ct==null?null:{$:1,$0:cq(ct.$0)};}function cs(ct){if(ct==null);}return function(ct){return cs(cr(ct));};};g.rtn=function(cq){return{$:1,$0:cq};};h.insertR=function(cq){function cr(ct){return{$:0,$0:ct};}function cs(ct){return bP.Return(ct);}return cq.$==0?bP.Bind(cq.$0,function(ct){return cs(cr(ct));}):bP.Return(c.Error$1(cq.$0));};h.insertO=function(cq){var cr;function cs(cu){return{$:1,$0:cu};}function ct(cu){return bP.Return(cu);}cr=cq==null?null:{$:1,$0:bP.Bind(cq.$0,function(cu){return ct(cs(cu));})};return cr==null?bP.Return(null):cr.$0;};h.sequenceSeq=function(cq){return h.traverseSeq(a.id,cq);};h.traverseSeq=function(cq,cr){function cs(ct){return bP.Return(ct);}return bP.Bind(bN.foldBack(function(ct,cu){return h.op_GreaterGreaterEquals(cq(ct),function(cv){return h.op_GreaterGreaterEquals(cu,function(cw){return bP.Return(new bO.T({$:1,$0:cv,$1:cw}));});});},bN.ofSeq(cr),bP.Return(bO.T.Empty)),function(ct){return cs(a.id(ct));});};h.op_GreaterGreaterEquals=function(cq,cr){return bP.Bind(cq,cr);};h.sleepThen=function(cq,cr){var cs;cs=null;return bP.Delay(function(){return bP.Bind(bP.Sleep(cr),function(){return bP.Return(cq());});});};h.apply=function(cq,cr){var cs;cs=null;return bP.Delay(function(){return bP.Bind(bP.StartChild(cq,null),function(ct){return bP.Bind(bP.StartChild(cr,null),function(cu){return bP.Bind(ct,function(cv){return bP.Bind(cu,function(cw){return bP.Return(cv(cw));});});});});});};l=k.Builder=bJ.Class({For:function(cq,cr){var cs;cs=this;return this.Using(bQ.Get(cq),function(ct){return cs.While(function(){return ct.MoveNext();},cs.Delay(function(){return cr(ct.Current());}));});},While:function(cq,cr){function cs(ct,cu){return ct()?bR.Bind(function(){return cs(ct,cu);},cu()):k.rtn();}return cs(cq,cr);},Using:function(cq,cr){try{return cr(cq);}finally{cq.Dispose();}},TryFinally:function(cq,cr){try{return cq();}finally{cr();}},TryWith:function(cq,cr){try{return cq();}catch(cs){return cr(cs);}},Run:function(cq){return k.bindP(cq,{$:0,$0:null});},Combine:function(cq,cr){return bR.Bind(cr,cq);},Delay:a.id,Zero:function(){return k.rtn();},Bind:function(cq,cr){return k.bindP(cr,cq);},ReturnFrom:a.id,Return:function(cq){return k.rtn(cq);}},j,l);l.New=bJ.Ctor(function(){j.New.call(this);},l);m.result=function(){bF.$cctor();return bF.result$1;};m.rtn=function(cq){return k.rtn(cq);};m.op_GreaterEqualsGreater=function(cq,cr,cs){return m.op_GreaterGreaterEquals(cq(cs),cr);};m.op_RightShift=function(cq,cr,cs){return m.op_BarGreaterGreater(cq(cs),cr);};m.op_GreaterGreaterEquals=function(cq,cr){return k.bindP(cr,cq);};m.op_BarGreaterGreater=function(cq,cr){return k.mapP(cr,cq);};k.result=function(){bF.$cctor();return bF.result;};k.sequenceSeq=function(cq){return k.traverseSeq(a.id,cq);};k.traverseSeq=function(cq,cr){return bR.Map(a.id,bN.foldBack(function(cs,ct){return k.op_GreaterGreaterEquals(cq(cs),function(cu){return k.op_GreaterGreaterEquals(ct,function(cv){return k.rtn(new bO.T({$:1,$0:cu,$1:cv}));});});},bN.ofSeq(cr),k.rtn(bO.T.Empty)));};k.op_GreaterGreaterEquals=function(cq,cr){return bR.Bind(cr,cq);};k.absorbO=function(cq,cr){return k.bindP(function(cs){return k.ofOption(cq,cs);},cr);};k.insertO=function(cq){var cr;cr=cq==null?null:{$:1,$0:bR.Map(function(cs){return{$:1,$0:cs};},cq.$0)};return cr==null?{$:0,$0:null}:cr.$0;};k.ofOption=function(cq,cr){var cs;cs=cr==null?null:{$:1,$0:{$:0,$0:cr.$0}};return cs==null?function(ct){return c.Error$1(cq(ct));}():cs.$0;};k.get=function(cq){return k.defaultWith(function(cr){return bS.FailWith(a.String(cr));},cq);};k.iter=function(cq,cr,cs){k.defaultWith(cq,k.mapP(cr,cs));};k.mapP=function(cq,cr){return k.bindP(function(cs){return k.rtn(cq(cs));},cr);};k.bindP=function(cq,cr){if(cr.$==1)return c.Error$1(cr.$0);else try{return cq(cr.$0);}catch(cs){return c.Error$1(new d({$:5,$0:cs.message,$1:cs.stack}));}};k.failIfFalse=function(cq,cr){return!cr?c.Error$1(cq):{$:0,$0:null};};k.failIfTrue=function(cq,cr){return cr?c.Error$1(cq):{$:0,$0:null};};k.defaultValue=function(cq,cr){return cr.$==1?cq:cr.$0;};k.defaultWith=function(cq,cr){return cr.$==1?cq(cr.$0):cr.$0;};k.toOption=function(cq){return cq.$==0?{$:1,$0:cq.$0}:null;};k.rtn=function(cq){return{$:0,$0:cq};};k.freeMessage=function(cq){return cq.$==1?c.Error$1(d.freeMessage(cq.$0)):{$:0,$0:cq.$0};};o.rtn=function(cq){return n.rtn(cq);};o.op_GreaterEqualsGreater=function(cq,cr,cs){return o.op_GreaterGreaterEquals(cq(cs),cr);};o.op_RightShift=function(cq,cr,cs){return o.op_BarGreaterGreater(cq(cs),cr);};o.op_GreaterGreaterEquals=function(cq,cr){return n.bind(cr,cq);};o.op_BarGreaterGreater=function(cq,cr){return n.map(cr,cq);};o.op_LessMultiplyGreater=function(cq,cr){return n.apply(cq,cr);};q=p.Builder=bJ.Class({For:function(cq,cr){var cs;cs=this;return this.Using(bQ.Get(cq),function(ct){return cs.While(function(){return ct.MoveNext();},cs.Delay(function(){return cr(ct.Current());}));});},Using:function(cq,cr){return this.TryFinally(function(){return cr(cq);},function(){if(!bT.Equals(cq,null))cq.Dispose();});},TryFinally:function(cq,cr){return n.wrap(function(cs){try{return(n.getFun(cq()))(cs);}finally{cr();}});},TryWith:function(cq,cr){return n.wrap(function(cs){try{return(n.getFun(cq()))(cs);}catch(ct){return cr(ct);}});},While:function(cq,cr){function cs(ct,cu){return ct()?n.bind(function(){return cs(ct,cu);},cu()):n.rtn();}return cs(cq,cr);},Run:function(cq){return n.wrap(function(cr){return(n.getFun(cq()))(cr);});},Combine:function(cq,cr){return n.bind(cr,cq);},Delay:a.id,Zero:function(){return n.rtn();},Bind:function(cq,cr){return n.bind(cr,cq);},ReturnFrom:function(cq){return n.from(cq);},Return:function(cq){return n.rtn(cq);}},j,q);q.New=bJ.Ctor(function(){j.New.call(this);},q);n.fusion=function(){bF.$cctor();return bF.fusion;};n.absorbO=function(cq,cr){return n.absorbR(n.map(function(cs){return k.ofOption(cq,cs);},cr));};n.absorbR=function(cq){return n.bind(n.ofResultRM,cq);};n.insertSnd=function(cq,cr){return n.map(function(cs){return[cs,cr];},cq);};n.insertFst=function(cq,cr){return n.map(function(cs){return[cq,cs];},cr);};n.insertR=function(cq){return cq.$==0?n.map(function(cr){return{$:0,$0:cr};},cq.$0):n.rtn(c.Error$1(cq.$0));};n.insertO=function(cq){var cr;cr=cq==null?null:{$:1,$0:n.map(function(cs){return{$:1,$0:cs};},cq.$0)};return cr==null?n.rtn(null):cr.$0;};n.iterResultPrint=function(cq){function cr(cs){c.print$1(cs);}n.iterReader(function(cs){return cr(d.summarized(cs));},function(cs){c.print$1(cs);},null,cq);};n.iterResult=function(cq,cr,cs){n.iterReader(cq,cr,null,cs);};n.runResult=function(cq){return n.runReader(null,cq);};n.runReader=function(cq,cr){var cs,ct,cu;cs=n.run(cq,cr);ct=cs[2];return k.ofOption(function(){return ct;},(cu=cs[0],cu==null?null:{$:1,$0:[cu.$0,ct]}));};n.mapReader=function(cq,cr){return n.mapState(function(){return cq;},a.id,cr);};n.readerFun=function(cq){return n.map(cq,n.getS());};n.sequenceSeq=function(cq){return n.traverseSeq(a.id,cq);};n.traverseSeq=function(cq,cr){return n.map(a.id,bN.foldBack(function(cs,ct){return n.op_GreaterGreaterEquals(cq(cs),function(cu){return n.op_GreaterGreaterEquals(ct,function(cv){return n.rtn(new bO.T({$:1,$0:cu,$1:cv}));});});},bN.ofSeq(cr),n.rtn(bO.T.Empty)));};n.op_GreaterGreaterEquals=function(cq,cr){return n.bind(cr,cq);};n.apply=function(cq,cr){return n.bind(function(cs){return n.map(cs,cr);},cq);};n.memoizeRm=function(cq,cr,cs){return{$:0,$0:function(ct){var cu,cv,cw,cx,cy;function cz(cA,cB){return(cw(cA))(function(){return cB;});}cu=ct[0];cv=cq(cu);cw=cv[1];return n.run(cu,(cx=(cy=cv[0](cs),cy==null?null:{$:1,$0:n.rtn(cy.$0)}),cx==null?n.map(function(cA){return cz(cs,cA);},cr(cs)):cx.$0));}};};n.iterReader=function(cq,cr,cs,ct){var cu,cv;cu=n.run(cs,n.map(cr,ct));cv=cu[2];(g.iter(a.ignore))(cu[0]);cv.$!==0?cq(cv):void 0;};n.mapState=function(cq,cr,cs){return{$:0,$0:function(ct){var cu,cv;cu=ct[0];cv=(n.getFun(cs))([cq(cu),ct[1]]);return[cv[0],cr(cu,cv[1]),cv[2]];}};};n.freeMessageW=function(cq){var cr;function cs(ct){return new d({$:2,$0:ct});}return n.freeMessageF((cr=function(ct){return function(cu){return ct(a.String(cu));};}(a.id),function(ct){return cs(cr(ct));}),cq);};n.freeMessage=function(cq){var cr;function cs(ct){return new d({$:1,$0:ct});}return n.freeMessageF((cr=function(ct){return function(cu){return ct(a.String(cu));};}(a.id),function(ct){return cs(cr(ct));}),cq);};n.freeMessageF=function(cq,cr){return{$:0,$0:function(cs){var ct,cu,cv;ct=cs[0];cu=cs[1];try{cv=cr.$0([ct,d.freeMessage(cu)]);return[cv[0],cv[1],d.freeMessageF(cq,cv[2])];}catch(cw){return[null,ct,d.freeMessage(d.addMsg(cu,new d({$:5,$0:cw.message,$1:cw.stack})))];}}};};n.ofFusionM=function(cq){return n.from(cq);};n.ofResultMessage=function(cq){return n.OkFMsg(null,cq);};n.ofMessage=function(cq){return n.OkFMsg(null,new d({$:4,$0:cq}));};n.ofOption=function(cq,cr){return cr==null?n.ErrorF(cq()):n.OkF(cr.$0);};n.ofResult=function(cq){return cq.$==1?n.ErrorF(new d({$:1,$0:(function(cr){return function(cs){return cr(bK.prettyPrint(cs));};}(a.id))(cq.$0)})):n.OkF(cq.$0);};n.ofResultS=function(cq){return cq.$==1?n.ErrorF(new d({$:1,$0:cq.$0})):n.OkF(cq.$0);};n.ofResultM=function(cq){return cq.$==1?n.ErrorF(new d({$:4,$0:cq.$0})):n.OkF(cq.$0);};n.ofResultRM=function(cq){return cq.$==1?n.ErrorF(cq.$0):n.OkF(cq.$0);};n.inling=function(cq,cr){return{$:0,$0:function(cs){var ct,cu,cv;ct=cs[0];cu=cs[1];try{cv=cr.$0([ct,cu]);return[{$:1,$0:cv[0]},cv[1],cv[2]];}catch(cw){return[null,ct,d.addMsg(cu,new d({$:5,$0:cw.message,$1:cw.stack}))];}}};};n.check=function(){return{$:0,$0:function(cq){return[d.isFatal(cq[1])?null:{$:1,$0:null},cq[0],d.NoMsg];}};};n.putS=function(cq){return{$:0,$0:function(){return[{$:1,$0:null},cq,d.NoMsg];}};};n.getR=function(){return{$:0,$0:function(cq){return[{$:1,$0:cq[1]},cq[0],d.NoMsg];}};};n.getS=function(){return{$:0,$0:function(cq){var cr;cr=cq[0];return[{$:1,$0:cr},cr,d.NoMsg];}};};n.ErrorF=function(cq){return{$:0,$0:function(cr){return[null,cr[0],cq];}};};n.OkFMsg=function(cq,cr){return{$:0,$0:function(cs){return[{$:1,$0:cq},cs[0],cr];}};};n.OkF=function(cq){return{$:0,$0:function(cr){return[{$:1,$0:cq},cr[0],d.NoMsg];}};};n.run=function(cq,cr){return(n.getFun(cr))([cq,d.NoMsg]);};n.from=a.id;n.getFun=function(cq){return cq.$0;};n.wrap=function(cq){return{$:0,$0:cq};};n.map=function(cq,cr){return n.bind(function(cs){return n.rtn(cq(cs));},cr);};n.bind=function(cq,cr){return{$:0,$0:function(cs){var ct,cu,cv,cw,cx,cy,cz;ct=cs[0];cu=cs[1];try{cv=cr.$0([ct,cu]);cw=cv[0];cx=cv[1];cy=cv[2];return cw!=null&&cw.$==1?(cz=cq(cw.$0).$0([cx,d.addMsg(cu,cy)]),[cz[0],cz[1],d.addMsg(cy,cz[2])]):[null,cx,cy];}catch(cA){return[null,ct,d.addMsg(cu,new d({$:5,$0:cA.message,$1:cA.stack}))];}}};};n.rtn=function(cq){return{$:0,$0:function(cr){return[{$:1,$0:cq},cr[0],d.NoMsg];}};};s.rtn=function(cq){return r.rtn(cq);};s.op_GreaterEqualsGreater=function(cq,cr,cs){return s.op_GreaterGreaterEquals(cq(cs),cr);};s.op_RightShift=function(cq,cr,cs){return s.op_BarGreaterGreater(cq(cs),cr);};s.op_GreaterGreaterEquals=function(cq,cr){return r.bind(cr,cq);};s.op_BarGreaterGreater=function(cq,cr){return r.map(cr,cq);};s.op_LessMultiplyGreater=function(cq,cr){return r.apply(cq,cr);};u=t.Builder=bJ.Class({For:function(cq,cr){var cs;cs=this;return this.Using(bQ.Get(cq),function(ct){return cs.While(function(){return ct.MoveNext();},cs.Delay(function(){return cr(ct.Current());}));});},Using:function(cq,cr){function cs(ct,cu){return bP.Using(cq,function(cv){return(r.getFun(cr(cv)))([ct,cu]);});}return r.wrap(function(ct){return cs(ct[0],ct[1]);});},TryFinally:function(cq,cr){function cs(ct,cu){return bP.TryFinally((r.getFun(cq()))([ct,cu]),cr);}return r.wrap(function(ct){return cs(ct[0],ct[1]);});},TryWith:function(cq,cr){function cs(ct,cu){return bP.TryWith((r.getFun(cq()))([ct,cu]),cr);}return r.wrap(function(ct){return cs(ct[0],ct[1]);});},While:function(cq,cr){function cs(ct,cu){return ct()?r.bind(function(){return cs(ct,cu);},cu()):r.rtn();}return cs(cq,cr);},Run:function(cq){return r.wrap(function(cr){return(r.getFun(cq()))(cr);});},Combine:function(cq,cr){return r.bind(cr,cq);},Delay:a.id,Zero:function(){return r.rtn();},Bind:function(cq,cr){return r.bind(cr,cq);},ReturnFrom:function(cq){return r.from(cq);},Return:function(cq){return r.rtn(cq);}},j,u);u.New=bJ.Ctor(function(){j.New.call(this);},u);r.fusion=function(){bF.$cctor();return bF.fusion$1;};r.iterResultPrintA=function(cq){function cr(cs){c.print$1(cs);}r.iterReaderA(function(cs){return cr(d.summarized(cs));},function(cs){c.print$1(cs);},null,cq);};r.iterResultPrint=function(cq){function cr(cs){c.print$1(cs);}r.iterReader(function(cs){return cr(d.summarized(cs));},function(cs){c.print$1(cs);},null,cq);};r.iterResultA=function(cq,cr,cs){r.iterReaderA(cq,cr,null,cs);};r.iterResult=function(cq,cr,cs){r.iterReader(cq,cr,null,cs);};r.runResult=function(cq){return r.runReader(null,cq);};r.runReader=function(cq,cr){function cs(cu,cv,cw){return k.ofOption(function(){return cw;},cu==null?null:{$:1,$0:[cu.$0,cw]});}function ct(cu){return bP.Return(cu);}return bP.Bind(r.run(cq,cr),function(cu){return ct(cs.apply(null,cu));});};r.mapReader=function(cq,cr){return r.mapState(function(){return cq;},a.id,cr);};r.absorbO=function(cq,cr){return r.absorbR(r.map(function(cs){return k.ofOption(cq,cs);},cr));};r.absorbR=function(cq){return r.bind(r.ofResultRM,cq);};r.insertSnd=function(cq,cr){return r.map(function(cs){return[cs,cr];},cq);};r.insertFst=function(cq,cr){return r.map(function(cs){return[cq,cs];},cr);};r.insertR=function(cq){return cq.$==0?r.map(function(cr){return{$:0,$0:cr};},cq.$0):r.rtn(c.Error$1(cq.$0));};r.insertO=function(cq){var cr;cr=cq==null?null:{$:1,$0:r.map(function(cs){return{$:1,$0:cs};},cq.$0)};return cr==null?r.rtn(null):cr.$0;};r.readerFun=function(cq){return r.map(cq,r.getS());};r.freeMessageW=function(cq){var cr;function cs(ct){return new d({$:2,$0:ct});}return r.freeMessageF((cr=function(ct){return function(cu){return ct(a.String(cu));};}(a.id),function(ct){return cs(cr(ct));}),cq);};r.freeMessage=function(cq){var cr;function cs(ct){return new d({$:1,$0:ct});}return r.freeMessageF((cr=function(ct){return function(cu){return ct(a.String(cu));};}(a.id),function(ct){return cs(cr(ct));}),cq);};r.sequenceSeq=function(cq){return r.traverseSeq(a.id,cq);};r.traverseSeq=function(cq,cr){return r.map(a.id,bN.foldBack(function(cs,ct){return r.op_GreaterGreaterEquals(cq(cs),function(cu){return r.op_GreaterGreaterEquals(ct,function(cv){return r.rtn(new bO.T({$:1,$0:cu,$1:cv}));});});},bN.ofSeq(cr),r.rtn(bO.T.Empty)));};r.op_GreaterGreaterEquals=function(cq,cr){return r.bind(cr,cq);};r.apply=function(cq,cr){return r.bind(function(cs){return r.map(cs,cr);},cq);};r.memoizeRm=function(cq,cr,cs){return{$:0,$0:function(ct){var cu,cv;cu=ct[0];cv=null;return bP.Delay(function(){var cw,cx,cy,cz;function cA(cB,cC){return(cx(cB))(function(){return cC;});}cw=cq(cu);cx=cw[1];return r.run(cu,(cy=(cz=cw[0](cs),cz==null?null:{$:1,$0:r.rtn(cz.$0)}),cy==null?r.map(function(cB){return cA(cs,cB);},cr(cs)):cy.$0));});}};};r.iterReaderA=function(cq,cr,cs,ct){function cu(cw,cx,cy){(g.iter(a.ignore))(cw);cy.$!==0?cq(cy):void 0;}function cv(cw){return bP.Return(cw);}bP.Start(bP.Bind(r.run(cs,r.map(cr,ct)),function(cw){return cv(cu.apply(null,cw));}),null);};r.iterReader=function(cq,cr,cs,ct){var cu;cu=r.run(cs,r.map(cr,ct));throw"iterS cannot be used in JavaScript!";};r.mapState=function(cq,cr,cs){return{$:0,$0:function(ct){var cu,cv,cw;cu=ct[0];cv=ct[1];cw=null;return bP.Delay(function(){return bP.Bind((r.getFun(cs))([cq(cu),cv]),function(cx){return bP.Return([cx[0],cr(cu,cx[1]),cx[2]]);});});}};};r.freeMessageF=function(cq,cr){return{$:0,$0:function(cs){var ct,cu,cv;ct=cs[0];cu=cs[1];cv=null;return bP.Delay(function(){return bP.TryWith(bP.Delay(function(){return bP.Bind(cr.$0([ct,d.freeMessage(cu)]),function(cw){return bP.Return([cw[0],cw[1],d.freeMessageF(cq,cw[2])]);});}),function(cw){return bP.Return([null,ct,d.freeMessage(d.addMsg(cu,new d({$:5,$0:cw.message,$1:cw.stack})))]);});});}};};r.ofAsyncResultRM=function(cq){return r.bind(r.ofResultRM,r.ofAsync(cq));};r.ofAsync=function(cq){return{$:0,$0:function(cr){var cs;function ct(cv){return[{$:1,$0:cv},cs,d.NoMsg];}function cu(cv){return bP.Return(cv);}cs=cr[0];return bP.Bind(cq,function(cv){return cu(ct(cv));});}};};r.ofFusionM=function(cq){var cr;cr=cq.$0;return{$:0,$0:function(cs){return bP.Return(cr([cs[0],cs[1]]));}};};r.ofResultMessage=function(cq){return r.OkFMsg(null,cq);};r.ofMessage=function(cq){return r.OkFMsg(null,new d({$:4,$0:cq}));};r.ofOption=function(cq,cr){var cs;cs=cr==null?null:{$:1,$0:r.OkF(cr.$0)};return cs==null?function(ct){return r.ErrorF(cq(ct));}():cs.$0;};r.ofResult=function(cq){return cq.$==1?r.ErrorF(new d({$:1,$0:(function(cr){return function(cs){return cr(bK.prettyPrint(cs));};}(a.id))(cq.$0)})):r.OkF(cq.$0);};r.ofResultS=function(cq){return cq.$==1?r.ErrorF(new d({$:1,$0:cq.$0})):r.OkF(cq.$0);};r.ofResultM=function(cq){return cq.$==1?r.ErrorF(new d({$:4,$0:cq.$0})):r.OkF(cq.$0);};r.ofResultRM=function(cq){return cq.$==1?r.ErrorF(cq.$0):r.OkF(cq.$0);};r.getOption=function(cq){return{$:0,$0:function(cr){var cs,ct,cu;cs=cr[0];ct=cr[1];cu=null;return bP.Delay(function(){return bP.TryWith(bP.Delay(function(){return bP.Bind(cq.$0([cs,ct]),function(cv){return bP.Return([{$:1,$0:cv[0]},cv[1],cv[2]]);});}),function(cv){return bP.Return([null,cs,d.addMsg(ct,new d({$:5,$0:cv.message,$1:cv.stack}))]);});});}};};r.check=function(){return{$:0,$0:function(cq){return bP.Return([d.isFatal(cq[1])?null:{$:1,$0:null},cq[0],d.NoMsg]);}};};r.putS=function(cq){return{$:0,$0:function(){return bP.Return([{$:1,$0:null},cq,d.NoMsg]);}};};r.getR=function(){return{$:0,$0:function(cq){return bP.Return([{$:1,$0:cq[1]},cq[0],d.NoMsg]);}};};r.getS=function(){return{$:0,$0:function(cq){var cr;cr=cq[0];return bP.Return([{$:1,$0:cr},cr,d.NoMsg]);}};};r.ErrorF=function(cq){return{$:0,$0:function(cr){return bP.Return([null,cr[0],cq]);}};};r.OkFMsg=function(cq,cr){return{$:0,$0:function(cs){return bP.Return([{$:1,$0:cq},cs[0],cr]);}};};r.OkF=function(cq){return{$:0,$0:function(cr){return bP.Return([{$:1,$0:cq},cr[0],d.NoMsg]);}};};r.run=function(cq,cr){return(r.getFun(cr))([cq,d.NoMsg]);};r.from=a.id;r.getFun=function(cq){return cq.$0;};r.wrap=function(cq){return{$:0,$0:cq};};r.map=function(cq,cr){return r.bind(function(cs){return r.rtn(cq(cs));},cr);};r.bind=function(cq,cr){return{$:0,$0:function(cs){var ct,cu,cv;ct=cs[0];cu=cs[1];cv=null;return bP.Delay(function(){return bP.TryWith(bP.Delay(function(){return bP.Bind(cr.$0([ct,cu]),function(cw){var cx,cy,cz;cx=cw[0];cy=cw[1];cz=cw[2];return cx!=null&&cx.$==1?bP.Bind(cq(cx.$0).$0([cy,d.addMsg(cu,cz)]),function(cA){return bP.Return([cA[0],cA[1],d.addMsg(cz,cA[2])]);}):bP.Return([null,cy,cz]);});}),function(cw){return bP.Return([null,ct,d.addMsg(cu,new d({$:5,$0:cw.message,$1:cw.stack}))]);});});}};};r.rtn=function(cq){return{$:0,$0:function(cr){return bP.Return([{$:1,$0:cq},cr[0],d.NoMsg]);}};};v.Guid$1=function(){bF.$cctor();return bF["|Guid|_|"];};v.Double$1=function(){bF.$cctor();return bF["|Double|_|"];};v.Single$1=function(){bF.$cctor();return bF["|Single|_|"];};v.Int$1=function(){bF.$cctor();return bF["|Int|_|"];};v.Date$1=function(){bF.$cctor();return bF["|Date|_|"];};v.parseGuidO$1=function(){bF.$cctor();return bF.parseGuidO;};v.parseDoubleO$1=function(){bF.$cctor();return bF.parseDoubleO;};v.parseSingleO$1=function(){bF.$cctor();return bF.parseSingleO;};v.parseIntO$1=function(){bF.$cctor();return bF.parseIntO;};v.parseDateO$1=function(){bF.$cctor();return bF.parseDateO;};v.tryParseWith$1=function(cq){function cr(cs,ct){return cs?{$:1,$0:ct}:null;}return function(cs){return cr.apply(null,cq(cs));};};w.PostAndAsyncReply=function(cq,cr,cs){return cq.PostAndAsyncReply(function(ct){return[ct,cr];},cs);};y.applyReply=function(cq,cr){return y.applyReplyA(function(cs){var ct;ct=null;return bP.Delay(function(){return bP.Return(cq(cs));});},cr);};y.applyReplyA=function(cq,cr){return cr.PostAndAsyncReply(function(cs){return function(ct){var cu;cu=null;return bP.Delay(function(){return bP.Bind(cq(ct),function(cv){cs(cv[1]);return bP.Return(cv[0]);});});};},null);};y.apply=function(cq,cr){y.applyA(function(cs){var ct;ct=null;return bP.Delay(function(){return bP.Return(cq(cs));});},cr);};y.applyA=function(cq,cr){cr.mailbox.AddLast(function(cs){var ct;ct=null;return bP.Delay(function(){return cq(cs);});});cr.resume();};y.setState=function(cq,cr){cr.mailbox.AddLast(function(){var cs;cs=null;return bP.Delay(function(){return bP.Return(cq);});});cr.resume();};y.getStateA=function(cq){return cq.PostAndAsyncReply(function(cr){return function(cs){var ct;ct=null;return bP.Delay(function(){cr(cs);return bP.Return(cs);});};},null);};x.defHandler=function(cq,cr){c.print$1(cq);return cr;};x.stateFull=function(cq,cr){return bV.Start(function(cs){function ct(cu){var cv;cv=null;return bP.Delay(function(){return bP.TryWith(bP.Delay(function(){return bP.Bind(cs.Receive(null),function(cw){return bP.Bind(cw(cu),function(cx){return ct(cx);});});}),function(cw){return ct(cq(cw,cu));});});}return ct(cr);},null);};x.fold=function(cq,cr,cs){return x.foldA(cq,function(ct,cu){var cv;cv=null;return bP.Delay(function(){return bP.Return(cr(ct,cu));});},cs);};x.foldA=function(cq,cr,cs){return bV.Start(function(ct){function cu(cv){var cw;cw=null;return bP.Delay(function(){return bP.TryWith(bP.Delay(function(){return bP.Bind(ct.Receive(null),function(cx){return bP.Bind(cr(cv,cx),function(cy){return cu(cy);});});}),function(cx){return cu(cq(cx,cv));});});}return cu(cs);},null);};x.call=function(cq,cr){return x.callA(cq,function(cs){var ct;ct=null;return bP.Delay(function(){return bP.Return(cr(cs));});});};x.callA=function(cq,cr){return x.iterA(cq,function(cs){var ct,cu,cv;ct=cs[0];cu=cs[1];cv=null;return bP.Delay(function(){return bP.Bind(cr(cu),function(cw){ct(cw);return bP.Zero();});});});};x.iter=function(cq,cr){return x.iterA(cq,function(cs){var ct;ct=null;return bP.Delay(function(){cr(cs);return bP.Zero();});});};x.iterA=function(cq,cr){return bV.Start(function(cs){var ct;ct=null;return bP.Delay(function(){return bP.While(function(){return true;},bP.Delay(function(){return bP.TryWith(bP.Delay(function(){return bP.Bind(cs.Receive(null),function(cu){return bP.Bind(cr(cu),function(){return bP.Return(null);});});}),function(cu){cq(cu);return bP.Zero();});}));});},null);};c.print$1=function(cq){if(typeof cq=="string")((function(cr){return function(cs){return cr(bK.toSafe(cs));};}(function(cr){bW.log(cr);}))(cq));else((function(cr){return function(cs){return cr(bK.prettyPrint(cs));};}(function(cr){bW.log(cr);}))(cq));};c.Error$1=function(cq){return{$:1,$0:cq};};A.sequenceSeq=function(cq){return A.traverseSeq(a.id,cq);};A.traverseSeq=function(cq,cr){return A.map(a.id,bN.foldBack(function(cs,ct){return A.op_GreaterGreaterEquals(cq(cs),function(cu){return A.op_GreaterGreaterEquals(ct,function(cv){return A.rtn(new bO.T({$:1,$0:cu,$1:cv}));});});},bN.ofSeq(cr),A.rtn(bO.T.Empty)));};A.op_GreaterGreaterEquals=function(cq,cr){return A.bind(cr,cq);};A.rtn=function(cq){return bY.Const(cq);};A.map=function(cq,cr){return bY.Map(cq,cr);};A.bind=function(cq,cr){return bY.Bind(cq,cr);};A.insertWO=function(cq){return cq==null?bY.Const(null):bY.Map(function(cr){return{$:1,$0:cr};},cq.$0);};B.lensView=function(cq,cr,cs,ct){var cu,cv,cw;cu=B.freshId();cv=bY.Map2(function(cx){return cq(cx);},ct.get_View(),cs);cw=new bX.Var({Get:function(){return cq(ct.Get());},Set:function(cx){return ct.Update(function(cy){return cr(cy,cx);});},SetFinal:function(cx){return this.Set(cx);},Update:function(cx){return ct.Update(function(cy){return cr(cy,cx(cq(cy)));});},UpdateMaybe:function(cx){return ct.UpdateMaybe(function(cy){var cz;cz=cx(cq(cy));return cz==null?null:{$:1,$0:cr(cy,cz.$0)};});},get_View:function(){return cv;},get_Id:function(){return cu;}});bZ.New.call(cw);return cw;};B.freshId=function(){B.set_counter(B.counter()+1);return"varuid"+a.String(B.counter());};B.counter=function(){bF.$cctor();return bF.counter;};B.set_counter=function(cq){bF.$cctor();bF.counter=cq;};C.currentLens=function(cq,cr,cs){return C["currentLensUpd'"](cq,cr,function(ct){cs.UpdateBy(function(){return cs.TryFindByKey(cs.key(ct))==null?null:{$:1,$0:ct};},cs.key(ct));},cs);};C["currentLensUpd'"]=function(cq,cr,cs,ct){return new b0.New(bY.Map2(function(cu,cv){var cw;cw=cv==null?null:ct.TryFindByKey(cv.$0);return cw==null?cq:cw.$0;},ct.v,cr),cs);};C.currentLensUpd=function(cq,cr,cs,ct){var cu;function cv(cx){return ct.TryFindByKey(cx);}function cw(cx){return cx==null?cq:cx.$0;}return B.lensView((cu=function(cx){return cx==null?null:cv(cx.$0);},function(cx){return cw(cu(cx));}),function(cx,cy){(g.iter(cs(cy)))(cx);return cx;},ct.v,cr);};C.lensDef=function(cq,cr,cs){function ct(cu){return cu==null?cq:cu.$0;}return C["lensIntoO'"](cs,ct,function(){return a.id;},cr,bY.Map(ct,cs.TryFindByKeyAsView(cr)));};C.docLensMapViewO=function(cq,cr,cs,ct){function cu(cv,cw){return cs(cv,C["lensIntoO'"](ct,function(cx){return cx==null?cq:cx.$0;},function(){return a.id;},cv,cw));}return b1.ConvertSeqBy(ct.key,function(cv){return function(cw){return cu(cv,cw);};},bY.Map(cr,ct.v));};C.docLensMapView=function(cq,cr,cs){function ct(cu,cv){return cr(cu,C["lensInto'"](cs,a.id,function(){return a.id;},cu,cv));}return b1.ConvertSeqBy(cs.key,function(cu){return function(cv){return ct(cu,cv);};},bY.Map(cq,cs.v));};C["lensIntoO'"]=function(cq,cr,cs,ct,cu){var cv,cw;cv=B.freshId();cw=new bZ({Get:function(){return cr(cq.TryFindByKey(ct));},Set:function(cx){return cq.UpdateBy(function(cy){return{$:1,$0:(cs(cy))(cx)};},ct);},Update:function(cx){return cq.UpdateBy(function(cy){var cz;return{$:1,$0:(cz=cx(cr({$:1,$0:cy})),(cs(cy))(cz))};},ct);},UpdateMaybe:function(cx){return cq.UpdateBy(function(cy){var cz,cA;cz=cx(cr({$:1,$0:cy}));cA=cs(cy);return cz==null?null:{$:1,$0:cA(cz.$0)};},ct);},SetFinal:function(cx){return this.Set(cx);},get_View:function(){return cu;},get_Id:function(){return cv;}});bZ.New.call(cw);return cw;};C["lensInto'"]=function(cq,cr,cs,ct,cu){var cv,cw;cv=B.freshId();cw=new bZ({Get:function(){return cr(cq.FindByKey(ct));},Set:function(cx){return cq.UpdateBy(function(cy){return{$:1,$0:(cs(cy))(cx)};},ct);},Update:function(cx){return cq.UpdateBy(function(cy){var cz;return{$:1,$0:(cz=cx(cr(cy)),(cs(cy))(cz))};},ct);},UpdateMaybe:function(cx){return cq.UpdateBy(function(cy){var cz,cA;cz=cx(cr(cy));cA=cs(cy);return cz==null?null:{$:1,$0:cA(cz.$0)};},ct);},SetFinal:function(cx){return this.Set(cx);},get_View:function(){return cu;},get_Id:function(){return cv;}});bZ.New.call(cw);return cw;};F=E.Address=bJ.Class({get_txt:function(){return this.$0;}},null,F);G.BRGetProcessId={$:1};G.BRGetConnections={$:0};H.MsgRequestForEcho={$:5};H.MsgRequestForId={$:4};H.MsgFromBroker={$:3};H.MsgReply={$:2};H.MsgRequest={$:1};H.MsgInformation={$:0};I.BMReceiverCantReply={$:4};I.BMOnlyBrokerShouldUse={$:1};I.BMOk={$:0};J.Receiver={$:2};J.Broker={$:1};J.NoReply={$:0};K.New=function(cq,cr,cs,ct,cu,cv,cw){return{from:cq,destination:cr,msgType:cs,subtype:ct,id:cu,payload:cv,replier:cw};};E.makeReply=function(cq){return E.replier(J.NoReply,E.msgType(H.MsgReply,cq));};E.mapPayload=function(cq,cr){return K.New(cr.from,cr.destination,cr.msgType,cr.subtype,cr.id,cq(cr.payload),cr.replier);};E.msgId=function(cq,cr){return K.New(cr.from,cr.destination,cr.msgType,cr.subtype,cq,cr.payload,cr.replier);};E.replier=function(cq,cr){return K.New(cr.from,cr.destination,cr.msgType,cr.subtype,cr.id,cr.payload,cq);};E.subtype=function(cq,cr){return K.New(cr.from,cr.destination,cr.msgType,cq,cr.id,cr.payload,cr.replier);};E.msgType=function(cq,cr){return K.New(cr.from,cr.destination,cq,cr.subtype,cr.id,cr.payload,cr.replier);};E.destination=function(cq,cr){return K.New(cr.from,cq,cr.msgType,cr.subtype,cr.id,cr.payload,cr.replier);};E.from=function(cq,cr){return K.New(cq,cr.destination,cr.msgType,cr.subtype,cr.id,cr.payload,cr.replier);};E.MessageBrokerAddress=function(){bF.$cctor();return bF.MessageBrokerAddress;};E.MessageBrokerId=function(){bF.$cctor();return bF.MessageBrokerId;};N.DtOther={$:6};N.DtMeasure={$:5};N.DtCalc={$:4};N.DtTCalc={$:3};N.DtVersion={$:2};N.DtTime={$:1};N.DtDataType={$:0};O.CtFreeze={$:2};O.CtCalc={$:1};O.CtOther={$:0};P.AtNumber={$:1};P.AtString={$:0};Q.EtNumber={$:1};Q.EtString={$:0};R=M.ModId=bJ.Class({get_Id:function(){return this.$0;}},null,R);S=M.AttId=bJ.Class({get_Id:function(){return this.$0;}},null,S);T=M.ElmId=bJ.Class({get_Id:function(){return this.$0;}},null,T);U=M.CubId=bJ.Class({get_Id:function(){return this.$0;}},null,U);V=M.DimId=bJ.Class({get_Id:function(){return this.$0;}},null,V);W=M.CalId=bJ.Class({get_Id:function(){return this.$0;}},null,W);X=M.TotId=bJ.Class({get_Id:function(){return this.$0;}},null,X);Y=M.ForId=bJ.Class({get_Id:function(){return this.$0;}},null,Y);Z=M.RulId=bJ.Class({get_Id:function(){return this.$0;}},null,Z);_0.New=function(cq,cr,cs,ct){return{attId:cq,attName:cr,attType:cs,attTableNum:ct};};_1.New=function(cq,cr,cs,ct,cu,cv,cw){return{elmId:cq,elmDim:cr,elmType:cs,elmName:ct,elmDescription:cu,elmAttributes:cv,elmParents:cw};};_2.New=function(cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA){return{dimId:cq,dimName:cr,dimPrefix:cs,dimOrder:ct,dimExclude:cu,dimFreeze:cv,dimType:cw,defaultElm:cx,dimElements:cy,dimAttributes:cz,isCalcDim:cA};};_3.UoPlus={$:1};_3.UoMinus={$:0};_4.OpOr={$:11};_4.OpAnd={$:10};_4.OpLE={$:9};_4.OpLT={$:8};_4.OpGE={$:7};_4.OpGT={$:6};_4.OpNE={$:5};_4.OpEQ={$:4};_4.OpDivide={$:3};_4.OpMultiply={$:2};_4.OpSubtract={$:1};_4.OpAdd={$:0};_5.ExtStet={$:1};_5.ExtNA={$:0};_6.ExnStet={$:1};_6.ExnNA={$:0};_7.ExiStet={$:1};_7.ExiNA={$:0};_8.New=function(cq,cr,cs){return{sliDims:cq,calculation:cr,cube:cs};};_9.ForAll={$:2};_9.ForConsolidated={$:1};_9.ForBase={$:0};_.New=function(cq,cr,cs,ct,cu,cv,cw,cx){return{forId:cq,forDestDecl:cr,forDestination:cs,forDescription:ct,forText:cu,forExpression:cv,forType:cw,forOrder:cx};};$.New=function(cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB){return{calId:cq,calName:cr,calDescription:cs,calOrder:ct,format:cu,isText:cv,isInput:cw,isBalance:cx,calDims:cy,calFormulas:cz,cubIdO:cA,properties:cB};};ba.New=function(cq,cr,cs,ct,cu){return{totId:cq,totName:cr,totOrder:cs,totFormat:ct,children:cu};};bb.ConsolidatedRuleKey={$:6};bb.InputRuleKey={$:5};bb.ActualRuleKey={$:4};bc.New=function(cq,cr,cs,ct,cu,cv,cw){return{cubId:cq,cubName:cr,cubRules:cs,cubRuleXmls:ct,cubDims:cu,measureDim:cv,cubType:cw};};bd.New=function(cq,cr,cs,ct,cu,cv,cw,cx){return{rulId:cq,rulSourceId:cr,rulDescription:cs,rulDestination:ct,rulExpression:cu,rulType:cv,rulOrder:cw,rulXml:cx};};be.GetInitModelStats={$:0};bf.New=function(cq,cr,cs,ct,cu,cv){return{modId:cq,server:cr,actualElem:cs,modDims:ct,modCubes:cu,modCalculations:cv};};bg.HelperTypeN={$:0};bg.op_AmpPercentGreater=function(cq,cr){return cr;};bg.op_AmpPercentGreater$1=function(cq,cr){return{$:2,$0:M.calcSlice(cr)};};bg.op_AmpPercentGreater$2=function(cq,cr){return{$:2,$0:cr};};bg.op_AmpPercentGreater$3=function(cq,cr){return{$:3,$0:cr};};bg.op_AmpPercentGreater$4=function(cq,cr){return{$:3,$0:cr};};bg.op_AmpPercentGreater$5=function(cq,cr){return{$:3,$0:cr?1:0};};bh.HelperTypeT={$:0};bh.op_AmpAmpGreater=function(cq,cr){return cr;};bh.op_AmpAmpGreater$1=function(cq,cr){return{$:2,$0:M.calcSlice(cr)};};bh.op_AmpAmpGreater$2=function(cq,cr){return{$:2,$0:cr};};bh.op_AmpAmpGreater$3=function(cq,cr){return{$:5,$0:cr.dimId};};bh.op_AmpAmpGreater$4=function(cq,cr){return{$:3,$0:cr};};bi.HelperTypeA={$:0};bj.getDimR=function(cq,cr){return k.ofOption(function(){return{$:0,$0:cq};},bj.getDimO(cq,cr));};bj.getDimO=function(cq,cr){return bM.tryFind(function(cs){return bT.Equals(cs.dimId,cq);},cr.modDims);};bj.getCubeO=function(cq,cr){return bM.tryFind(function(cs){return bT.Equals(cs.cubId,cq);},cr.modCubes);};bk.newElement=function(cq){return _1.New(new T({$:0,$0:b3.NewGuid()}),new V({$:0,$0:b3.NewGuid()}),Q.EtString,cq,cq,new b5.New([]),[]);};bl.dimId=function(cq){return cq.$==1?cq.$0:cq.$0;};bm.containsDim=function(cq,cr){return cr.sliDims.ContainsKey(cq);};bm.addRef=function(cq,cr){return _8.New(cr.sliDims.Add(bl.dimId(cq),cq),cr.calculation,cr.cube);};bm.forAll=function(){bF.$cctor();return bF.forAll;};bm.newSlice=function(cq){return _8.New(new b5.New(bM.map(function(cr){return[bl.dimId(cr),cr];},cq)),null,null);};bn.filterSort=function(cq){var cr;cr=bn.filter(cq);return function(cs){return bn.sort(cr(cs));};};bn.sort=function(cq){return bM.sortBy(function(cr){return cr.dimOrder;},cq);};bn.filter=function(cq){function cr(cs){return bM.contains(cs.dimType,cq);}return function(cs){return bM.filter(cr,cs);};};bn.setName=function(cq,cr){return _2.New(cr.dimId,cq,cr.dimPrefix,cr.dimOrder,cr.dimExclude,cr.dimFreeze,cr.dimType,cr.defaultElm,cr.dimElements,cr.dimAttributes,cr.isCalcDim);};bn.dType=function(cq,cr){return _2.New(cr.dimId,cr.dimName,cr.dimPrefix,cr.dimOrder,cr.dimExclude,cr.dimFreeze,cq,cr.defaultElm,cr.dimElements,cr.dimAttributes,cr.isCalcDim);};bn.prefix=function(cq,cr){return _2.New(cr.dimId,cr.dimName,cq,cr.dimOrder,cr.dimExclude,cr.dimFreeze,cr.dimType,cr.defaultElm,cr.dimElements,cr.dimAttributes,cr.isCalcDim);};bn.New=function(cq){return bn.newDimension(new V({$:0,$0:b3.NewGuid()}),cq,false);};bn.newDimensionCalc=function(cq,cr){return bn.newDimension(cq,cr,true);};bn.newDimensionNonCalc=function(cq,cr){return bn.newDimension(cq,cr,false);};bn.newDimension=function(cq,cr,cs){return _2.New(cq,cr,"","",false,false,N.DtOther,null,[],[],cs);};bn.getElementR=function(cq,cr){return k.ofOption(function(){return{$:2,$0:cr.dimName,$1:cq};},bn.getElementO(cq,cr));};bn.getElementO=function(cq,cr){return bM.tryFind(function(cs){return bT.Equals(cs.elmId,cq);},cr.dimElements);};bo.measureDimNameR=function(cq,cr){return bR.Map(function(cs){return cs.dimName;},bo.measureDimR(cq,cr));};bo.measureDimR=function(cq,cr){return bR.Bind(function(cs){return bj.getDimR(cs,cq);},k.ofOption(function(){return{$:4,$0:cr.cubName};},cr.measureDim));};bo.measureDimO=function(cq,cr){var cs;cs=cr.measureDim;return cs==null?null:bj.getDimO(cs.$0,cq);};bo.dims=function(cq,cr){return bN.filter(function(cs){var ct;return bN.exists((ct=cs.dimId,function(cu){return bT.Equals(ct,cu);}),cr.cubDims);},cq.modDims);};bo.forElr=function(cq,cr){var cs;cs=bo.slice(cr);return _8.New(M.Map_adds(bO.map(function(ct){return[bl.dimId(ct),ct];},cq),bo.slice(cr).sliDims),cs.calculation,cs.cube);};bo.addRules=function(cq,cr){return bc.New(cr.cubId,cr.cubName,bM.fold(function(cs,ct){return cs.Add(ct[0],ct[1]);},cr.cubRules,cq),cr.cubRuleXmls,cr.cubDims,cr.measureDim,cr.cubType);};bo.addRule=function(cq,cr,cs){return bc.New(cs.cubId,cs.cubName,cs.cubRules.Add(cq,cr),cs.cubRuleXmls,cs.cubDims,cs.measureDim,cs.cubType);};bo.New=function(){return(((bo.newCube(""))([]))(null))(O.CtOther);};bo.newCubeDims=function(cq,cr,cs){return(((bo.newCube(cq))(bN.ofSeq(bM.map(function(ct){return ct.dimId;},cr))))(cs))(O.CtOther);};bo.newCubeCalc=function(cq,cr,cs){return(((bo.newCube(cq))(cr))(cs))(O.CtCalc);};bo.newCube=function(cq){var cr;cr=new U({$:0,$0:b3.NewGuid()});return bJ.Curried(bo.newCubeId,3,[cr,cq]);};bo.newCubeId=function(cq,cr,cs,ct,cu){return bc.New(cq,cr,new b5.New([]),new b5.New([]),cs,ct,cu);};bo.isCalcCube=function(cq){return cq.cubType.$===1;};bo.containsDim=function(cq,cr){return bM.contains(cq,cr.cubDims);};bo.slice=function(cq){return _8.New(new b5.New([]),null,{$:1,$0:cq.cubId});};bp.sort=function(cq){return bM.sortBy(function(cr){return cr.calOrder;},cq);};bp.cubeR=function(cq){return(M.ofOptF(function(){return(function(cr){return function(cs){return cr("Calculation '"+bK.toSafe(cs)+"' has no cube");};}(a.id))(cq.calName);}))(cq.cubIdO);};bp.withCube=function(cq,cr,cs){var ct,cu;ct=(cu=cr.cube,cu==null?null:bj.getCubeO(cu.$0,cq));return ct==null?null:cs(ct.$0);};bp.addFormulas=function(cq,cr){return bM.isEmpty(cq)?cr:$.New(cr.calId,cr.calName,cr.calDescription,cr.calOrder,cr.format,cr.isText,cr.isInput,cr.isBalance,cr.calDims,cr.calFormulas.concat(bN.ofSeq(cq)),cr.cubIdO,cr.properties);};bp.forSlice=function(cq,cr){var cs;cs=bp.slice(cr);return _8.New(M.Map_adds(bO.map(function(ct){return[bl.dimId(ct),ct];},cq),bp.slice(cr).sliDims),cs.calculation,cs.cube);};bp.addFormula=function(cq,cr){return $.New(cr.calId,cr.calName,cr.calDescription,cr.calOrder,cr.format,cr.isText,cr.isInput,cr.isBalance,cr.calDims,cr.calFormulas.concat([cq]),cr.cubIdO,cr.properties);};bp.setOrder=function(cq,cr){return $.New(cr.calId,cr.calName,cr.calDescription,cq,cr.format,cr.isText,cr.isInput,cr.isBalance,cr.calDims,cr.calFormulas,cr.cubIdO,cr.properties);};bp.setIsText=function(cq,cr){return $.New(cr.calId,cr.calName,cr.calDescription,cr.calOrder,cr.format,cq,cr.isInput,cr.isBalance,cr.calDims,cr.calFormulas,cr.cubIdO,cr.properties);};bp.setName=function(cq,cr){return $.New(cr.calId,cq,cr.calDescription,cr.calOrder,cr.format,cr.isText,cr.isInput,cr.isBalance,cr.calDims,cr.calFormulas,cr.cubIdO,cr.properties);};bp.New=function(){return bp.newInput(new W({$:0,$0:b3.NewGuid()}),"",[]);};bp.newCalc=function(cq,cr,cs){var ct;ct=bp.newInput(cq,cr,cs);return $.New(ct.calId,ct.calName,ct.calDescription,ct.calOrder,ct.format,ct.isText,false,ct.isBalance,ct.calDims,ct.calFormulas,ct.cubIdO,ct.properties);};bp.newInput=function(cq,cr,cs){return $.New(cq,bL.Trim(bL.Replace(cr,"_"," ")),"","","#,##0.00",false,true,false,new b6.New(cs),[],null,new b5.New([]));};bp.calcType=function(cq){return cq.isInput?"INPUT":"CALC";};bp.slice=function(cq){return M.calcSlice(cq);};bq.New=function(){return bq.newTotal("");};bq.newTotal=function(cq){return ba.New(new X({$:0,$0:b3.NewGuid()}),cq,"","",[]);};br.addRules=function(cq,cr){return bM.fold(function(cs,ct){var cu,cv;function cw(cx,cy,cz){return[cy,cz];}cu=(cv=((br.getCubeO())(ct[0]))(cs),cv==null?null:{$:1,$0:br.setCube(bo.addRules(bM.map(function(cx){return cw(cx[0],cx[1],cx[2]);},ct[1]),cv.$0),cs)});return cu==null?cs:cu.$0;},cr,bM.groupBy(function(cs){return a.id(cs[0],cs[1],cs[2]);},cq));};br.prepareModel=function(cq){return br.fixCalcsAndCubes(br.fixForDimensions(cq));};br.fixCalcsAndCubes=function(cq){var cr,cs;function ct(cv){return br.getCalcCube(cv,cq);}function cu(cv){return cv==null;}cr=bN.filter(function(cv){var cw;return(cw=cv.cubIdO,cw==null?null:((br.getCubeO())(cw.$0))(cq))==null;},cq.modCalculations);return bM.isEmpty(cr)?cq:(cs=bM.fold(function(cv,cw){return br.newCalcCube(cw,cv);},cq,bM.filter(function(cv){return cu(ct(cv));},bM.distinct(bM.map(function(cv){return cv.calDims;},cr)))),bf.New(cs.modId,cs.server,cs.actualElem,cs.modDims,cs.modCubes,bN.map(function(cv){var cw,cx,cy,cz;cw=(cx=bM.tryFind(function(cA){return bT.Equals(cA.calId,cv.calId);},cr),cx==null?null:{$:1,$0:(cy=cx.$0,$.New(cy.calId,cy.calName,cy.calDescription,cy.calOrder,cy.format,cy.isText,cy.isInput,cy.isBalance,cy.calDims,cy.calFormulas,(cz=br.getCalcCube(cy.calDims,cs),cz==null?null:{$:1,$0:cz.$0.cubId}),cy.properties))});return cw==null?cv:cw.$0;},cs.modCalculations)));};br.newCalcCube=function(cq,cr){var cs,ct,cu;cs=br.autoName(cq,cr);ct=bn.newDimensionCalc(new V({$:0,$0:b3.NewGuid()}),br.measurePrefix()+cs);cu=bN.ofSeq(bM.map(function(cv){return cv.dimId;},bM.append(br.orderedDims(cq,cr),bO.ofArray([ct]))));return bf.New(cr.modId,cr.server,cr.actualElem,cr.modDims.concat([ct]),cr.modCubes.concat([bo.newCubeCalc(br.cubePrefix()+cs,cu,{$:1,$0:ct.dimId})]),cr.modCalculations);};br.fixForDimensions=function(cq){return bf.New(cq.modId,cq.server,cq.actualElem,cq.modDims,cq.modCubes,bN.map(function(cr){return $.New(cr.calId,cr.calName,cr.calDescription,cr.calOrder,cr.format,cr.isText,cr.isInput,cr.isBalance,b7.Filter(function(cs){return bM.exists(function(ct){return bT.Equals(cs,ct);},br.dimIds(cq));},cr.calDims),cr.calFormulas,cr.cubIdO,cr.properties);},cq.modCalculations));};br.dimIds=function(cq){return bN.map(function(cr){return cr.dimId;},cq.modDims);};br.autoName=function(cq,cr){var cs,ct,cu;cs=bL.concat("",bM.map(function(cv){return cv.dimPrefix;},br.orderedDims(cq,cr)));ct=bM.choose(function(cv){var cw,cx;cw=br.cubePrefix()+cs;return cv.cubName===cw?{$:1,$0:-1}:bL.StartsWith(cv.cubName,cw)?(cx=b8.string(cv.cubName,{$:1,$0:cs.length+1},null),(v.parseIntO$1())(cx)):null;},cr.modCubes);return cs+(bM.isEmpty(ct)?"":(cu=1+bM.max(ct),(function(cv){return function(cw){return cv(a.String(cw));};}(a.id))(cu)));};br.orderedDims=function(cq,cr){return bM.filter(function(cs){var ct;return bM.exists((ct=cs.dimId,function(cu){return bT.Equals(ct,cu);}),cq);},cr.modDims);};br.measurePrefix=function(){bF.$cctor();return bF.measurePrefix;};br.cubePrefix=function(){bF.$cctor();return bF.cubePrefix;};br.dimCombinations=function(cq){return bM.distinct(bM.map(function(cr){return cr.calDims;},cq.modCalculations));};br.withDims=function(cq,cr,cs){return br.withDimsO(cq,cr,bJ.Curried(function(ct,cu,cv,cw){return{$:1,$0:cs(ct,cu,cv,cw)};},4));};br.withDimsO=function(cq,cr,cs){var ct;return g.join(g.apply(g.apply(g.apply(g.apply({$:1,$0:cs},(ct=cr.measureDim,ct==null?null:((br.getDimO())(ct.$0))(cq))),br.dataTypeDimO(cq)),br.versionDimO(cq)),br.timeDimO(cq)));};br.setCube=function(cq,cr){return bf.New(cr.modId,cr.server,cr.actualElem,cr.modDims,bN.map(function(cs){return bT.Equals(cs.cubId,cq.cubId)?cq:cs;},cr.modCubes),cr.modCalculations);};br.getCalcCube=function(cq,cr){return bM.tryFind(function(cs){return bT.Equals(new b6.New(bM.filter(function(ct){return!bT.Equals({$:1,$0:ct},cs.measureDim);},cs.cubDims)),cq);},bM.filter(bo.isCalcCube,cr.modCubes));};br.isActualCalcO=function(cq){return br.pickCalcO("IsActual",cq);};br.versionDimO=function(cq){return br.pickDimO(N.DtVersion,cq);};br.timeDimO=function(cq){return br.pickDimO(N.DtTime,cq);};br.dataTypeDimO=function(cq){return br.pickDimO(N.DtDataType,cq);};br.tCalcDimO=function(cq){return br.pickDimO(N.DtTCalc,cq);};br.freezeCubeO=function(cq){return br.pickCubeO(O.CtFreeze,cq);};br.pickCalcO=function(cq,cr){return bM.tryPick(function(cs){return cs.calName===cq?{$:1,$0:cs}:null;},cr.modCalculations);};br.pickDimO=function(cq,cr){return bM.tryPick(function(cs){return bT.Equals(cs.dimType,cq)?{$:1,$0:cs}:null;},cr.modDims);};br.pickCubeO=function(cq,cr){return bM.tryPick(function(cs){return bT.Equals(cs.cubType,cq)?{$:1,$0:cs}:null;},cr.modCubes);};br.getCubeR=function(cq,cr){return k.ofOption(function(){return{$:3,$0:cq};},((br.getCubeO())(cq))(cr));};br.getCalcR=function(cq,cr){return k.ofOption(function(){return{$:5,$0:cq};},br.getCalcO(cq,cr));};br.getCubeO=function(){bF.$cctor();return bF.getCubeO;};br.getCalcO=function(cq,cr){return bM.tryFind(function(cs){return bT.Equals(cs.calId,cq);},cr.modCalculations);};br.getDimR=function(){bF.$cctor();return bF.getDimR;};br.getDimO=function(){bF.$cctor();return bF.getDimO;};br.addForm=function(cq,cr,cs){return bf.New(cs.modId,cs.server,cs.actualElem,cs.modDims,cs.modCubes,bN.map(function(ct){return bT.Equals(ct.calId,cq)?bp.addFormula(cr,ct):ct;},cs.modCalculations));};br.addCube=function(cq,cr){return bf.New(cr.modId,cr.server,cr.actualElem,cr.modDims,cr.modCubes.concat([cq]),cr.modCalculations);};br.addDim=function(cq,cr){return bf.New(cr.modId,cr.server,cr.actualElem,cr.modDims.concat([cq]),cr.modCubes,cr.modCalculations);};br.addCalc=function(cq,cr){return bf.New(cr.modId,cr.server,cr.actualElem,cr.modDims,cr.modCubes,cr.modCalculations.concat([cq]));};br.addForms=function(cq,cr){return bf.New(cr.modId,cr.server,cr.actualElem,cr.modDims,cr.modCubes,bN.map(function(cs){var ct,cu;function cv(cw){return cw[0];}return bp.addFormulas(bM.map(function(cw){return cw[1];},bM.filter((ct=(cu=cs.calId,function(cw){return bT.Equals(cu,cw);}),function(cw){return ct(cv(cw));}),cq)),cs);},cr.modCalculations));};br.addCubes=function(cq,cr){return bf.New(cr.modId,cr.server,cr.actualElem,cr.modDims,br.mergeBy(function(cs){return cs.cubId;},cq,cr.modCubes),cr.modCalculations);};br.addDims=function(cq,cr){return bf.New(cr.modId,cr.server,cr.actualElem,br.mergeBy(function(cs){return cs.dimId;},cq,cr.modDims),cr.modCubes,cr.modCalculations);};br.addCalcs=function(cq,cr){return bf.New(cr.modId,cr.server,cr.actualElem,cr.modDims,cr.modCubes,br.mergeBy(function(cs){return cs.calId;},cq,cr.modCalculations));};br.mergeBy=function(cq,cr,cs){return bN.ofSeq(cr).concat(bN.filter(function(ct){return!bM.contains(cq(ct),bM.map(cq,cr));},cs));};bs.getDimDest=function(cq,cr){return bM.tryPick(function(cs){return bT.Equals(bl.dimId(cs),cq.dimId)?{$:1,$0:cs}:null;},cr.forDestination);};bs.setOrder=function(cq,cr){return _.New(cr.forId,cr.forDestDecl,cr.forDestination,cr.forDescription,cr.forText,cr.forExpression,cr.forType,cq);};bs.setText=function(cq,cr){return _.New(cr.forId,cr.forDestDecl,cr.forDestination,cr.forDescription,cq,cr.forExpression,cr.forType,cr.forOrder);};bs.conso=function(cq){return _.New(cq.forId,cq.forDestDecl,cq.forDestination,cq.forDescription,cq.forText,cq.forExpression,_9.ForConsolidated,cq.forOrder);};bt.conso=function(cq){return bd.New(cq.rulId,cq.rulSourceId,cq.rulDescription,cq.rulDestination,cq.rulExpression,_9.ForConsolidated,cq.rulOrder,cq.rulXml);};bt.New=function(){return bd.New(new Z({$:0,$0:b3.NewGuid()}),null,"",bO.T.Empty,_7.ExiStet,_9.ForBase,"","");};bu.New=function(){return _0.New(new S({$:0,$0:b3.NewGuid()}),"",P.AtString,1);};M.ofOptS=function(cq){function cr(){return new d({$:4,$0:cq});}return function(cs){return k.ofOption(cr,cs);};};M.ofOptF=function(cq){function cr(){return new d({$:4,$0:cq()});}return function(cs){return k.ofOption(cr,cs);};};M.calcSlice=function(cq){return _8.New(new b5.New([]),{$:1,$0:cq.calId},null);};M.Map_adds=function(cq,cr){return new b5.New(bM.append(b9.ToSeq(cr),cq));};M.Xmodel=function(){bF.$cctor();return bF.Xmodel;};bw.TemplatesFileName=function(){bF.$cctor();return bF.TemplatesFileName;};bw.rootdir=function(){bF.$cctor();return bF.rootdir;};bx.New=function(cq,cr,cs,ct){return{major:cq,minor:cr,majorDate:cs,minorDate:ct};};by.incrementMajor=function(cq){return bx.New(cq.major+1,0,function(cr){return cr.getFullYear()+"-"+("0"+(cr.getMonth()+1)).slice(-2)+"-"+("0"+cr.getDay()).slice(-2)+" "+("0"+cr.getHours()).slice(-2)+":"+("0"+cr.getMinutes()).slice(-2)+":"+("0"+cr.getSeconds()).slice(-2)+":"+("00"+cr.getMilliseconds()).slice(-3);}(new a.Date(b_.now())),function(cr){return cr.getFullYear()+"-"+("0"+(cr.getMonth()+1)).slice(-2)+"-"+("0"+cr.getDay()).slice(-2)+" "+("0"+cr.getHours()).slice(-2)+":"+("0"+cr.getMinutes()).slice(-2)+":"+("0"+cr.getSeconds()).slice(-2)+":"+("00"+cr.getMilliseconds()).slice(-3);}(new b_(b_.now())));};by.incrementMinor=function(cq){return bx.New(cq.major,cq.minor+1,cq.majorDate,function(cr){return cr.getFullYear()+"-"+("0"+(cr.getMonth()+1)).slice(-2)+"-"+("0"+cr.getDay()).slice(-2)+" "+("0"+cr.getHours()).slice(-2)+":"+("0"+cr.getMinutes()).slice(-2)+":"+("0"+cr.getSeconds()).slice(-2)+":"+("00"+cr.getMilliseconds()).slice(-3);}(new b_(b_.now())));};by.New=function(){return bx.New(0,0,"","");};bz.New=function(cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF){return{calculations:cq,totals:cr,dimensions:cs,cubes:ct,globalDefs:cu,server:cv,selectedDim:cw,selectedCube:cx,collapsed:cy,cubePrefix:cz,measurePrefix:cA,outputMsgs:cB,codeFS:cC,parserMsgs:cD,fileName:cE,version:cF};};bA.NoOp={$:21};bA.AddDimension={$:12};bA.AddCalculation={$:3};bA.AddTotal={$:0};bB.getDimsCubeO=a.id;bB.refreshNow=function(){bF.$cctor();return bF.refreshNow;};bB.refreshView=function(){bF.$cctor();return bF.refreshView;};bB.nonFormulaV=function(){bF.$cctor();return bF.nonFormulaV;};bB.nonCalculationV=function(){bF.$cctor();return bF.nonCalculationV;};bB.nonTotalV=function(){bF.$cctor();return bF.nonTotalV;};bB.nonFormula=function(){bF.$cctor();return bF.nonFormula;};bB.nonCalculation=function(){bF.$cctor();return bF.nonCalculation;};bB.nonTotal=function(){bF.$cctor();return bF.nonTotal;};bB.selectedString=function(cq,cr){return bY.Map(function(cs){return cs?cq:"";},cr);};bC.appendParser=function(cq){bC.appendText(bC.model().parserMsgs,cq);};bC.appendMsgs=function(cq){bC.appendText(bC.model().outputMsgs,cq);};bC.appendText=function(cq,cr){var cs;cq.Set((cs=cq.Get(),cs===""?cr:cr===""?cs:cs+"\n"+cr));};bC.processor=function(){bF.$cctor();return bF.processor;};bC.set_processor=function(cq){bF.$cctor();bF.processor=cq;};bC.model=function(){bF.$cctor();return bF.model;};bD.tableDimensions$1990$48=function(cq){return function(){(bC.processor())({$:14,$0:cq});};};bD.tableDimensions$1989$48=function(cq){return function(){(bC.processor())({$:13,$0:cq});};};bD.tableDimensions=function(){var cq,cr,cs,ct,cu;return(cq=(cr=(cs=bC.model().dimensions,C.docLensMapView(bn.filterSort(bD.dtypes()),function(cv,cw){var cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI;function cJ(cK){return b8.string(cK,{$:1,$0:2},null);}return(cx=(cy=(cz=(cA=b$.Lens(cw,function(cK){return cK.dimFreeze;},function(cK,cL){return _2.New(cK.dimId,cK.dimName,cK.dimPrefix,cK.dimOrder,cK.dimExclude,cL,cK.dimType,cK.defaultElm,cK.dimElements,cK.dimAttributes,cK.isCalcDim);}),(cB=b$.Lens(cw,function(cK){return cK.dimExclude;},function(cK,cL){return _2.New(cK.dimId,cK.dimName,cK.dimPrefix,cK.dimOrder,cL,cK.dimFreeze,cK.dimType,cK.defaultElm,cK.dimElements,cK.dimAttributes,cK.isCalcDim);}),(cC=b$.Lens(b$.Lens(cw,function(cK){return cK.dimType;},function(cK,cL){return _2.New(cK.dimId,cK.dimName,cK.dimPrefix,cK.dimOrder,cK.dimExclude,cK.dimFreeze,cL,cK.defaultElm,cK.dimElements,cK.dimAttributes,cK.isCalcDim);}),(cD=function(cK){return function(cL){return cK(bH.p(cL));};}(a.id),function(cK){return cJ(cD(cK));}),function(cK,cL){return cL==="DataType"?N.DtDataType:cL==="Time"?N.DtTime:cL==="Version"?N.DtVersion:N.DtOther;}),(cE=b$.Lens(cw,function(cK){return cK.dimOrder;},function(cK,cL){return _2.New(cK.dimId,cK.dimName,cK.dimPrefix,cL,cK.dimExclude,cK.dimFreeze,cK.dimType,cK.defaultElm,cK.dimElements,cK.dimAttributes,cK.isCalcDim);}),(cF=b$.Lens(cw,function(cK){return cK.dimPrefix;},function(cK,cL){return _2.New(cK.dimId,cK.dimName,cL,cK.dimOrder,cK.dimExclude,cK.dimFreeze,cK.dimType,cK.defaultElm,cK.dimElements,cK.dimAttributes,cK.isCalcDim);}),(cG=b$.Lens(cw,function(cK){return cK.dimName;},function(cK,cL){return _2.New(cK.dimId,cL,cK.dimPrefix,cK.dimOrder,cK.dimExclude,cK.dimFreeze,cK.dimType,cK.defaultElm,cK.dimElements,cK.dimAttributes,cK.isCalcDim);}),cd.Make().WithHole({$:8,$0:"name",$1:cG})).WithHole({$:8,$0:"abbreviation",$1:cF})).WithHole({$:8,$0:"order",$1:cE})).WithHole({$:8,$0:"type",$1:cC})).WithHole({$:9,$0:"excludename",$1:cB})).WithHole({$:9,$0:"includefreeze",$1:cA})),cz.WithHole(ce.EventQ2(cz.k,"remove",function(){return cz.i;},function(){(bC.processor())({$:13,$0:cv});}))),cy.WithHole(ce.EventQ2(cy.k,"select",function(){return cy.i;},function(){(bC.processor())({$:14,$0:cv});}))),(cH=ce.CompleteHoles(cx.k,cx.h,[["name",0],["abbreviation",0],["order",0],["type",0],["excludename",2],["includefreeze",2]]),(cI=new cf.New(cH[1],bG.dimensionrow(cH[0])),(cx.i=cI,cI)))).get_Doc();},cs)),cd.Make().WithHole({$:0,$0:"tbody",$1:cr})),(ct=ce.CompleteHoles(cq.k,cq.h,[]),(cu=new cf.New(ct[1],bG.dimensiontable(ct[0])),(cq.i=cu,cu)))).get_Doc();};bD.dtypes=function(){bF.$cctor();return bF.dtypes;};bE.mainProgram=function(){var cq,cr,cs,ct,cu;cg.addPlugIn(ch.New("RuleEditor",[],[],[cg.newDoc("Dimensions",ci.Create(bD.tableDimensions))],[cg.newAct("AddDimension",function(){(bC.processor())(bA.AddDimension);})],[]));cj.addLayout((cq=(ck.unindentStr())("\r\n                    menuEditor       horizontal  65       menuLogo                  editorMessages\r\n                    double           horizontal  0-50-100 AppFramework.AppFwkClient menuEditor\r\n                    menuLogo         vertical    350      logo                      menu\r\n                    logo             span       \"margin:0; color:gray; font-size: 55px; font-weight:530\" \"F# Station\"\r\n                    editorMessages   horizontal 10-83-100 editorButtons             messages\r\n                    messages         vertical   0-50-100  messagesLeft              messagesRight\r\n                    editorButtons    vertical -200 snippetsSnippet buttons\r\n                    buttons div      \"overflow: hidden; display: grid; grid-template-columns: 100%; grid-template-rows: repeat(15, calc(100% / 15)); bxackground-color: #eee; box-sizing: border-box; padding : 5px; grid-gap: 5px; margin-right: 21px\" btnSaveAs none x btnAddSnippet btnDeleteSnippet btnIndentIn btnIndentOut none x btnRunFS none x btnAbortFsi\r\n                    snippetsSnippet  vertical   0-20-100  snippets                  editorProperties\r\n                    snippets         horizontal 20        \"${FSharpStation.CurrentPath}\" FSharpStation.Snippets\r\n                    editorProperties vertical   0-100-100 snippet                   properties\r\n                    properties       div        \"\"        FSharpStation.Properties\r\n                    snippet          horizontal 35        Name                      FSharpStation.editor\r\n                    menu             span  \"\" btnLoad btnImport\r\n        \r\n                    btnSaveAs        button FSharpStation.SaveAs         \"class=btn ${FSharpStation.SaveNeeded}\" \"Save as...    \"\r\n                    btnAddDimension  button RuleEditor.AddDimension      \"\"                  \"Add Dimension \"\r\n                    btnDeleteSnippet button FSharpStation.RemoveSnippet  \"\"                  \"Delete Snippet\"\r\n                    btnIndentIn      button FSharpStation.IndentIn       \"\"                  \"Indent In  >> \"\r\n                    btnIndentOut     button FSharpStation.IndentOut      \"\"                  \"Indent Out << \"\r\n                    btnRunFS         button FSharpStation.RunFS          \"\"                  \"Run F#        \"\r\n                    btnAbortFsi      button FSharpStation.AbortFsi       \"\"                  \"Abort Fsi     \"\r\n        \r\n                    messagesLeft     wcomp-tabstrip                      \"\"                  Output FsCode\r\n                    messagesRight    wcomp-tabstrip                      \"\"                  Parser\r\n        \r\n                    Output           textarea  FSharpStation.Output      \"tabname=Output ; placeholder=Output messages ; spellcheck=false\" \r\n                    FsCode           textarea  FSharpStation.FsCode      \"tabname=F# Code; placeholder=F# Code         ; spellcheck=false\" \r\n                    Parser           textarea  FSharpStation.Parser      \"tabname=Parser ; placeholder=Parser messages; dblclick=${FSharpStation.JumpTo} ; spellcheck=false\" \r\n                    Name             Doc       InputLabel                \"\"     \"Name:\"        FSharpStation.SnippetName\r\n                    btnLoad          Doc       InputFile                 \"\"     \"Load File...\" FSharpStation.LoadFile  FileName\r\n                    btnImport        Doc       InputFile                 \"\"     \"Import...\"    FSharpStation.Import    \"\"\r\n                    FileName         div                                 \"class=form-control\"  FSharpStation.fileName\r\n                "),cj.newLyt(bE.RuleEditorLyt(),cq)));cr=(cs=null,(ct=bE.RuleEditorLyt(),cs==null?ct:cs.$0));cg.mainDocV().Set(cr);return b1.Async((cu=null,bP.Delay(function(){return bP.Return(cg.getMainDoc().f());})));};bE.scrollToBottom=function(cq,cr){var cs;bP.Start((cs=null,bP.Delay(function(){return bP.Bind(bP.Sleep(100),function(){cq.scrollTop=cq.scrollHeight;return bP.Zero();});})),null);};bE.RuleEditorLyt=function(){bF.$cctor();return bF.RuleEditorLyt;};bF.$cctor=function(){var cq,cr,cs,ct,cu;bF.$cctor=a.ignore;bF.rtn=function(cv){return[cv];};bF.result=new l.New();bF.result$1=k.result();bF.fusion=new q.New();bF.fusion$1=new u.New();bF.parseDateO=v.tryParseWith$1(function(cv){var cw,cx;cw=0;return[(cx=cl.TryParse(cv),cx!=null&&cx.$==1&&(cw=cx.$0,true)),cw];});bF.parseIntO=v.tryParseWith$1(function(cv){var cw;cw=0;return[cm.TryParseInt32(cv,{get:function(){return cw;},set:function(cx){cw=cx;}}),cw];});bF.parseSingleO=v.tryParseWith$1(function(cv){var cw,cx;cw=0;return[(cx=a.Number(cv),a.isNaN(cx)?false:(cw=cx,true)),cw];});bF.parseDoubleO=v.tryParseWith$1(function(cv){var cw,cx;cw=0;return[(cx=a.Number(cv),a.isNaN(cx)?false:(cw=cx,true)),cw];});bF.parseGuidO=v.tryParseWith$1(function(cv){var cw;cw=null;return[b3.TryParse(cv,{get:function(){return cw;},set:function(cx){cw=cx;}}),cw];});bF["|Date|_|"]=v.parseDateO$1();bF["|Int|_|"]=v.parseIntO$1();bF["|Single|_|"]=v.parseSingleO$1();bF["|Double|_|"]=v.parseDoubleO$1();bF["|Guid|_|"]=v.parseGuidO$1();bF.counter=1;bF.MessageBrokerId="<MessageBroker>";bF.MessageBrokerAddress=new F({$:0,$0:E.MessageBrokerId()});bF.Xmodel=bf.New(new R({$:0,$0:b3.NewGuid()}),"local\\Budget","Actual",[],[],[]);bF.forAll=_8.New(new b5.New([]),null,null);bF.getDimO=function(cv){return function(cw){return bj.getDimO(cv,cw);};};bF.getDimR=function(cv){return function(cw){return bj.getDimR(cv,cw);};};bF.getCubeO=function(cv){return function(cw){return bj.getCubeO(cv,cw);};};bF.cubePrefix="Z";bF.measurePrefix="M";bF.rootdir="..\\website";bF.TemplatesFileName="..\\website"+"\\Templates.html";((function(cv){return function(cw){return cv(bK.toSafe(cw));};}(function(cv){bW.log(cv);}))("..\\website\\Templates.html"));bF.nonTotal=(cq=bq.New(),ba.New(new X({$:0,$0:"00000000-0000-0000-0000-000000000000"}),cq.totName,cq.totOrder,cq.totFormat,cq.children));bF.nonCalculation=(cr=bp.New(),$.New(new W({$:0,$0:"00000000-0000-0000-0000-000000000000"}),cr.calName,cr.calDescription,cr.calOrder,cr.format,cr.isText,cr.isInput,cr.isBalance,cr.calDims,cr.calFormulas,cr.cubIdO,cr.properties));bF.nonFormula=(cs=_.New(new Y({$:0,$0:b3.NewGuid()}),new b5.New([]),bO.T.Empty,"","",_7.ExiStet,_9.ForBase,""),_.New(new Y({$:0,$0:"00000000-0000-0000-0000-000000000000"}),cs.forDestDecl,cs.forDestination,cs.forDescription,cs.forText,cs.forExpression,cs.forType,cs.forOrder));bF.nonTotalV=b$.Lens(b$.Create$1(bB.nonFormula()),a.id,a.id);bF.nonCalculationV=b$.Lens(b$.Create$1(bB.nonCalculation()),a.id,a.id);bF.nonFormulaV=b$.Lens(b$.Create$1(bB.nonFormula()),a.id,a.id);cu=(ct=b$.Create$1(),[ct.get_View(),function(){ct.Set(null);}]);bF.refreshView=cu[0];bF.refreshNow=cu[1];bF.model=bz.New(cn.Create(function(cv){return cv.calId;},[]),cn.Create(function(cv){return cv.totId;},[]),cn.Create(function(cv){return cv.dimId;},[]),cn.Create(function(cv){return cv.cubId;},[]),b$.Create$1(""),b$.Create$1(""),b$.Create$1(null),b$.Create$1(null),cn.Create(a.id,[]),b$.Create$1("Z"),b$.Create$1("M"),b$.Create$1(""),b$.Create$1(""),b$.Create$1(""),b$.Create$1("NewFile.json"),b$.Create$1(by.New()));bF.processor=a.ignore;bF.dtypes=bO.ofArray([N.DtDataType,N.DtTime,N.DtVersion,N.DtOther]);bF.RuleEditorLyt="RuleEditorLyt";};bG.dimensiontable=function(cq){cp.LoadLocalTemplates("templates");return cq?cp.NamedTemplate("templates",{$:1,$0:"dimensiontable"},cq):void 0;};bG.dimensionrow=function(cq){cp.LoadLocalTemplates("templates");return cq?cp.NamedTemplate("templates",{$:1,$0:"dimensionrow"},cq):void 0;};bH.p=function(cq){return cq.$==6?"DtOther":cq.$==5?"DtMeasure":cq.$==4?"DtCalc":cq.$==3?"DtTCalc":cq.$==2?"DtVersion":cq.$==1?"DtTime":"DtDataType";};}());

//# sourceMappingURL=RuleEditor.min.map