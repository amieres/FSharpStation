(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs;a=self;b=a.FsRoot=a.FsRoot||{};c=b.Library=b.Library||{};d=c.ResultMessage=c.ResultMessage||{};e=c.ResultMessageHelpers=c.ResultMessageHelpers||{};f=c.Monads=c.Monads||{};g=f.Seq=f.Seq||{};h=f.Option=f.Option||{};i=f.Async=f.Async||{};j=a.WebSharper;k=j&&j.Obj;l=f.Result=f.Result||{};m=l.Builder=l.Builder||{};n=l.Operators=l.Operators||{};o=f.FusionM=f.FusionM||{};p=o.Operators=o.Operators||{};q=o.Builder=o.Builder||{};r=q.Builder=q.Builder||{};s=f.FusionAsyncM=f.FusionAsyncM||{};t=s.Operators=s.Operators||{};u=s.Builder=s.Builder||{};v=u.Builder=u.Builder||{};w=c.ParseO=c.ParseO||{};x=c.MailboxProcessorExt=c.MailboxProcessorExt||{};y=c.Mailbox=c.Mailbox||{};z=y.StateFull=y.StateFull||{};A=b.LibraryJS=b.LibraryJS||{};B=A.View=A.View||{};C=A.Var=A.Var||{};D=A.ListModel=A.ListModel||{};E=b.Library2=b.Library2||{};F=E.WebSockets=E.WebSockets||{};G=F.Address=F.Address||{};H=F.BrokerRequest=F.BrokerRequest||{};I=F.MessageType=F.MessageType||{};J=F.BrokerMessage=F.BrokerMessage||{};K=F.Replier=F.Replier||{};L=F.MessageGeneric=F.MessageGeneric||{};M=b.CalculationModel=b.CalculationModel||{};N=M.CalculationModel=M.CalculationModel||{};O=N.DimType=N.DimType||{};P=N.CubeType=N.CubeType||{};Q=N.AttType=N.AttType||{};R=N.ElmType=N.ElmType||{};S=N.ModId=N.ModId||{};T=N.AttId=N.AttId||{};U=N.ElmId=N.ElmId||{};V=N.CubId=N.CubId||{};W=N.DimId=N.DimId||{};X=N.CalId=N.CalId||{};Y=N.TotId=N.TotId||{};Z=N.ForId=N.ForId||{};_0=N.RulId=N.RulId||{};_1=N.Attribute=N.Attribute||{};_2=N.Element=N.Element||{};_3=N.Dimension=N.Dimension||{};_4=N.UnaryOp=N.UnaryOp||{};_5=N.Operator=N.Operator||{};_6=N.ExpressionText=N.ExpressionText||{};_7=N.ExpressionNumber=N.ExpressionNumber||{};_8=N.ExpressionAny=N.ExpressionAny||{};_9=N.Slice=N.Slice||{};_=N.ForType=N.ForType||{};$=N.Formula=N.Formula||{};ba=N.Calculation=N.Calculation||{};bb=N.Total=N.Total||{};bc=N.RuleKey=N.RuleKey||{};bd=N.Cube=N.Cube||{};be=N.Rule=N.Rule||{};bf=N.RuleMsg=N.RuleMsg||{};bg=N.Model=N.Model||{};bh=N.HelperTypeN=N.HelperTypeN||{};bi=N.HelperTypeT=N.HelperTypeT||{};bj=N.HelperTypeA=N.HelperTypeA||{};bk=N.Model0=N.Model0||{};bl=N.ElementModule=N.ElementModule||{};bm=N.ElmReferenceModule=N.ElmReferenceModule||{};bn=N.SliceModule=N.SliceModule||{};bo=N.DimensionModule=N.DimensionModule||{};bp=N.CubeModule=N.CubeModule||{};bq=N.CalculationModule=N.CalculationModule||{};br=N.TotalModule=N.TotalModule||{};bs=N.ModelModule=N.ModelModule||{};bt=N.FormulaModule=N.FormulaModule||{};bu=N.RuleModule=N.RuleModule||{};bv=N.AttributeModule=N.AttributeModule||{};bw=b.RuleEditor=b.RuleEditor||{};bx=bw.Templating=bw.Templating||{};by=bw.TreeNodeId=bw.TreeNodeId||{};bz=bw.Version=bw.Version||{};bA=bw.VersionModule=bw.VersionModule||{};bB=bw.ModelUI=bw.ModelUI||{};bC=bw.MsgModel=bw.MsgModel||{};bD=bw.ModelUIModule=bw.ModelUIModule||{};bE=bw.Global=bw.Global||{};bF=bw.TableDimensions=bw.TableDimensions||{};bG=bw.MainProgram=bw.MainProgram||{};bH=bw.UpdateModelUI=bw.UpdateModelUI||{};bI=a.StartupCode$RuleEditor$RuleEditor=a.StartupCode$RuleEditor$RuleEditor||{};bJ=a.RuleEditor_Templates=a.RuleEditor_Templates||{};bK=a.RuleEditor_GeneratedPrintf=a.RuleEditor_GeneratedPrintf||{};bL=a.IntelliFactory;bM=bL&&bL.Runtime;bN=j&&j.Utils;bO=j&&j.Strings;bP=j&&j.Seq;bQ=j&&j.List;bR=j&&j.Arrays;bS=j&&j.Concurrency;bT=j&&j.Enumerator;bU=j&&j.Result;bV=j&&j.Operators;bW=j&&j.Unchecked;bX=j&&j.Control;bY=bX&&bX.MailboxProcessor;bZ=a.console;b0=j&&j.UI;b1=b0&&b0.View;b2=b0&&b0.Var;b3=b0&&b0.FromView;b4=b0&&b0.Doc;b5=a.System;b6=b5&&b5.Guid;b7=j&&j.Collections;b8=b7&&b7.FSharpMap;b9=b7&&b7.FSharpSet;b_=b7&&b7.Set;b$=j&&j.Slice;ca=b7&&b7.Map;cb=a.Date;cc=b0&&b0.Var$1;cd=b0&&b0.Templating;ce=cd&&cd.Runtime;cf=ce&&ce.Server;cg=cf&&cf.ProviderBuilder;ch=cf&&cf.Handler;ci=cf&&cf.TemplateInstance;cj=A&&A.AppFramework;ck=cj&&cj.PlugIn;cl=j&&j.Lazy;cm=A&&A.LayoutEngineModule;cn=j&&j.MatchFailureException;co=j&&j.DateUtil;cp=j&&j.Numeric;cq=b0&&b0.ListModel;cr=b0&&b0.Client;cs=cr&&cr.Templates;d=c.ResultMessage=bM.Class({toString:function(){return this.$==1?(function(ct){return function(cu){return ct("Error    : "+bN.toSafe(cu));};}(a.id))(this.$0):this.$==2?(function(ct){return function(cu){return ct("Warning  : "+bN.toSafe(cu));};}(a.id))(this.$0):this.$==3?this.$0:this.$==4?(function(ct){return function(cu){return ct(a.String(cu));};}(a.id))(this.$0):this.$==5?(((bM.Curried3(function(ct,cu,cv){return ct("Exception: "+bN.toSafe(cu)+", "+bN.toSafe(cv));}))(a.id))(this.$0))(this.$1):this.$==6?bO.concat("\n",bP.map(a.String,bP.filter(function(ct){return ct.$!=0;},this.$0))):"";}},null,d);d.NoMsg=new d({$:0});e.infof=function(ct){return ct(function(cu){return new d({$:3,$0:cu});});};e.warningf=function(ct){return ct(function(cu){return new d({$:2,$0:cu});});};e.errorMsgf=function(ct){return ct(function(cu){return new d({$:1,$0:cu});});};d.summarizedI=function(ct){return d.summarizedF(function(){return[0,0,1];},ct);};d.summarizedW=function(ct){return d.summarizedF(function(){return[0,1,0];},ct);};d.summarized=function(ct){return d.summarizedF(function(){return[1,0,0];},ct);};d.summarizedF=function(ct,cu){return bO.concat("\n",bP.filter(function(cv){return""!==cv;},bQ.ofArray([a.String(cu),d.summaryF(ct,cu)])));};d.summaryF=function(ct,cu){var cv,cw;cw=d.countF(ct,cu);switch(cw[0]===0?cw[1]===0?0:cw[1]===1?cw[2]===0?0:(cv=cw[1],2):(cv=cw[1],2):cw[0]===1?cw[1]===0?cw[2]===0?0:(cv=cw[0],1):(cv=[cw[0],cw[1]],3):cw[1]===0?(cv=cw[0],1):(cv=[cw[0],cw[1]],3)){case 0:return"";case 1:return(function(cx){return function(cy){return cx("Errors   : "+a.String(cy)+"\n");};}(a.id))(cv);case 2:return(function(cx){return function(cy){return cx("Warnings : "+a.String(cy)+"\n");};}(a.id))(cv);case 3:return(((bM.Curried3(function(cx,cy,cz){return cx("Errors   : "+a.String(cy)+", Warnings: "+a.String(cz)+"\n");}))(a.id))(cv[0]))(cv[1]);}};d.reduceMsgs=function(ct){return bP.fold(d.addMsg,d.NoMsg,ct);};d.addMsg=function(ct,cu){return ct.$==0?cu:ct.$==6?cu.$==0?ct:cu.$==6?new d({$:6,$0:ct.$0.concat(cu.$0)}):new d({$:6,$0:ct.$0.concat([cu])}):cu.$==0?ct:cu.$==6?new d({$:6,$0:[ct].concat(cu.$0)}):new d({$:6,$0:[ct,cu]});};d.countI=function(ct){return d.countF(function(){return[0,0,1];},ct);};d.countW=function(ct){return d.countF(function(){return[0,1,0];},ct);};d.count=function(ct){return d.countF(function(){return[1,0,0];},ct);};d.countF=function(ct,cu){function cv(cw,cx,cy){return function(cz){return[cw+cz[0],cx+cz[1],cy+cz[2]];};}return cu.$==0?[0,0,0]:cu.$==3?[0,0,1]:cu.$==2?[0,1,0]:cu.$==4?ct(cu.$0):cu.$==6?bP.fold(function(cw,cx){return(function(cy){return cv(cy[0],cy[1],cy[2]);}(cw))(cx);},[0,0,0],bP.map(function(cw){return d.countF(ct,cw);},d.exclnoMsg(cu.$0))):[1,0,0];};d.isFatalW=function(ct){return d.isFatalF(function(){return false;},ct);};d.isFatal=function(ct){return d.isFatalF(function(){return true;},ct);};d.isFatalF=function(ct,cu){return cu.$==0?false:cu.$==3?false:cu.$==2?false:cu.$==4?ct(cu.$0):cu.$==6?bP.exists(function(cv){return d.isFatalF(ct,cv);},cu.$0):true;};d.isWarningOrInfoW=function(ct){return d.isWarningOrInfoF(function(){return true;},ct);};d.isWarningOrInfo=function(ct){return d.isWarningOrInfoF(function(){return false;},ct);};d.isWarningOrInfoF=function(ct,cu){return cu.$==2||(cu.$==4?ct(cu.$0):cu.$==6&&bP.forall(function(cv){return d.isWarningOrInfoF(ct,cv)||d.isInfoF(ct,cv);},d.exclnoMsg(cu.$0)));};d.isInfoI=function(ct){return d.isInfoF(function(){return true;},ct);};d.isInfo=function(ct){return d.isInfoF(function(){return false;},ct);};d.isInfoF=function(ct,cu){return cu.$==3||(cu.$==4?ct(cu.$0):cu.$==6&&bP.forall(function(cv){return d.isInfoF(ct,cv);},d.exclnoMsg(cu.$0)));};d.freeMessageI=function(ct){var cu;function cv(cw){return new d({$:3,$0:cw});}return d.freeMessageF((cu=function(cw){return function(cx){return cw(a.String(cx));};}(a.id),function(cw){return cv(cu(cw));}),ct);};d.freeMessageW=function(ct){var cu;function cv(cw){return new d({$:2,$0:cw});}return d.freeMessageF((cu=function(cw){return function(cx){return cw(a.String(cx));};}(a.id),function(cw){return cv(cu(cw));}),ct);};d.freeMessage=function(ct){var cu;function cv(cw){return new d({$:1,$0:cw});}return d.freeMessageF((cu=function(cw){return function(cx){return cw(a.String(cx));};}(a.id),function(cw){return cv(cu(cw));}),ct);};d.freeMessageF=function(ct,cu){return d.bindMessage(ct,cu);};d.bindMessage=function(ct,cu){return cu.$==4?ct(cu.$0):cu.$==1?new d({$:1,$0:cu.$0}):cu.$==3?new d({$:3,$0:cu.$0}):cu.$==2?new d({$:2,$0:cu.$0}):cu.$==5?new d({$:5,$0:cu.$0,$1:cu.$1}):cu.$==6?new d({$:6,$0:bR.map(function(cv){return d.bindMessage(ct,cv);},cu.$0)}):d.NoMsg;};d.exclnoMsg=function(ct){function cu(cv){return!cv;}return bP.filter(function(cv){return cu(d.noMsg(cv));},ct);};d.noMsg=function(ct){return ct.$==0;};g.absorbR=function(ct){return bP.choose(function(cu){return cu.$==0?{$:1,$0:cu.$0}:null;},ct);};g.absorbO=function(ct){return bP.choose(a.id,ct);};g.insertR=function(ct){return ct.$==0?bP.map(function(cu){return{$:0,$0:cu};},ct.$0):(g.rtn())(c.Error$1(ct.$0));};g.insertO=function(ct){var cu;cu=ct==null?null:{$:1,$0:bP.map(function(cv){return{$:1,$0:cv};},ct.$0)};return cu==null?(g.rtn())(null):cu.$0;};g.rtn=function(){bI.$cctor();return bI.rtn;};h.absorbR=function(ct){var cu,cv;return ct!=null&&ct.$==1&&(cv=ct.$0,cv.$==0&&(cu=cv.$0,true))?{$:1,$0:cu}:null;};h.insertR=function(ct){var cu;return ct.$==0?(cu=ct.$0,cu==null?null:{$:1,$0:{$:0,$0:cu.$0}}):h.rtn(c.Error$1(ct.$0));};h.sequenceSeq=function(ct){return h.traverseSeq(a.id,ct);};h.traverseSeq=function(ct,cu){var cv;cv=bR.foldBack(function(cw,cx){return h.op_GreaterGreaterEquals(ct(cw),function(cy){return h.op_GreaterGreaterEquals(cx,function(cz){return h.rtn(new bQ.T({$:1,$0:cy,$1:cz}));});});},bR.ofSeq(cu),h.rtn(bQ.T.Empty));return cv==null?null:{$:1,$0:cv.$0};};h.op_GreaterGreaterEquals=function(ct,cu){return ct==null?null:cu(ct.$0);};h.bindNone=function(ct,cu){return cu!=null&&cu.$==1?{$:1,$0:cu.$0}:ct();};h.mapNone=function(ct,cu){return cu==null?ct():cu.$0;};h.apply=function(ct,cu){var cv;return ct!=null&&ct.$==1&&(cu!=null&&cu.$==1&&(cv=[ct.$0,cu.$0],true))?{$:1,$0:cv[0](cv[1])}:null;};h.join=function(ct){return ct==null?null:ct.$0;};h.iter=function(ct){function cu(cw){return cw==null?null:{$:1,$0:ct(cw.$0)};}function cv(cw){if(cw==null);}return function(cw){return cv(cu(cw));};};h.rtn=function(ct){return{$:1,$0:ct};};i.insertR=function(ct){function cu(cw){return{$:0,$0:cw};}function cv(cw){return bS.Return(cw);}return ct.$==0?bS.Bind(ct.$0,function(cw){return cv(cu(cw));}):bS.Return(c.Error$1(ct.$0));};i.insertO=function(ct){var cu;function cv(cx){return{$:1,$0:cx};}function cw(cx){return bS.Return(cx);}cu=ct==null?null:{$:1,$0:bS.Bind(ct.$0,function(cx){return cw(cv(cx));})};return cu==null?bS.Return(null):cu.$0;};i.sequenceSeq=function(ct){return i.traverseSeq(a.id,ct);};i.traverseSeq=function(ct,cu){function cv(cw){return bS.Return(cw);}return bS.Bind(bR.foldBack(function(cw,cx){return i.op_GreaterGreaterEquals(ct(cw),function(cy){return i.op_GreaterGreaterEquals(cx,function(cz){return bS.Return(new bQ.T({$:1,$0:cy,$1:cz}));});});},bR.ofSeq(cu),bS.Return(bQ.T.Empty)),function(cw){return cv(a.id(cw));});};i.op_GreaterGreaterEquals=function(ct,cu){return bS.Bind(ct,cu);};i.sleepThen=function(ct,cu){var cv;cv=null;return bS.Delay(function(){return bS.Bind(bS.Sleep(cu),function(){return bS.Return(ct());});});};i.apply=function(ct,cu){var cv;cv=null;return bS.Delay(function(){return bS.Bind(bS.StartChild(ct,null),function(cw){return bS.Bind(bS.StartChild(cu,null),function(cx){return bS.Bind(cw,function(cy){return bS.Bind(cx,function(cz){return bS.Return(cy(cz));});});});});});};m=l.Builder=bM.Class({For:function(ct,cu){var cv;cv=this;return this.Using(bT.Get(ct),function(cw){return cv.While(function(){return cw.MoveNext();},cv.Delay(function(){return cu(cw.Current());}));});},While:function(ct,cu){function cv(cw,cx){return cw()?bU.Bind(function(){return cv(cw,cx);},cx()):l.rtn();}return cv(ct,cu);},Using:function(ct,cu){try{return cu(ct);}finally{ct.Dispose();}},TryFinally:function(ct,cu){try{return ct();}finally{cu();}},TryWith:function(ct,cu){try{return ct();}catch(cv){return cu(cv);}},Run:function(ct){return l.bindP(ct,{$:0,$0:null});},Combine:function(ct,cu){return bU.Bind(cu,ct);},Delay:a.id,Zero:function(){return l.rtn();},Bind:function(ct,cu){return bU.Bind(cu,ct);},ReturnFrom:a.id,Return:function(ct){return l.rtn(ct);}},k,m);m.New=bM.Ctor(function(){k.New.call(this);},m);n.result=function(){bI.$cctor();return bI.result$1;};n.rtn=function(ct){return l.rtn(ct);};n.op_GreaterEqualsGreater=function(ct,cu,cv){return n.op_GreaterGreaterEquals(ct(cv),cu);};n.op_RightShift=function(ct,cu,cv){return n.op_BarGreaterGreater(ct(cv),cu);};n.op_GreaterGreaterEquals=function(ct,cu){return l.bindP(cu,ct);};n.op_BarGreaterGreater=function(ct,cu){return l.mapP(cu,ct);};l.result=function(){bI.$cctor();return bI.result;};l.sequenceSeq=function(ct){return l.traverseSeq(a.id,ct);};l.traverseSeq=function(ct,cu){return bU.Map(a.id,bR.foldBack(function(cv,cw){return l.op_GreaterGreaterEquals(ct(cv),function(cx){return l.op_GreaterGreaterEquals(cw,function(cy){return l.rtn(new bQ.T({$:1,$0:cx,$1:cy}));});});},bR.ofSeq(cu),l.rtn(bQ.T.Empty)));};l.op_GreaterGreaterEquals=function(ct,cu){return bU.Bind(cu,ct);};l.absorbO=function(ct,cu){return l.bindP(function(cv){return l.ofOption(ct,cv);},cu);};l.insertO=function(ct){var cu;cu=ct==null?null:{$:1,$0:bU.Map(function(cv){return{$:1,$0:cv};},ct.$0)};return cu==null?{$:0,$0:null}:cu.$0;};l.ofOption=function(ct,cu){var cv;cv=cu==null?null:{$:1,$0:{$:0,$0:cu.$0}};return cv==null?function(cw){return c.Error$1(ct(cw));}():cv.$0;};l.get=function(ct){return l.defaultWith(function(cu){return bV.FailWith(a.String(cu));},ct);};l.iter=function(ct,cu,cv){l.defaultWith(ct,l.mapP(cu,cv));};l.mapP=function(ct,cu){return l.bindP(function(cv){return l.rtn(ct(cv));},cu);};l.bindP=function(ct,cu){if(cu.$==1)return c.Error$1(cu.$0);else try{return ct(cu.$0);}catch(cv){return c.Error$1(new d({$:5,$0:cv.message,$1:cv.stack}));}};l.failIfFalse=function(ct,cu){return!cu?c.Error$1(ct):{$:0,$0:null};};l.failIfTrue=function(ct,cu){return cu?c.Error$1(ct):{$:0,$0:null};};l.defaultValue=function(ct,cu){return cu.$==1?ct:cu.$0;};l.defaultWith=function(ct,cu){return cu.$==1?ct(cu.$0):cu.$0;};l.toOption=function(ct){return ct.$==0?{$:1,$0:ct.$0}:null;};l.rtn=function(ct){return{$:0,$0:ct};};l.freeMessage=function(ct){return ct.$==1?c.Error$1(d.freeMessage(ct.$0)):{$:0,$0:ct.$0};};p.rtn=function(ct){return o.rtn(ct);};p.op_GreaterEqualsGreater=function(ct,cu,cv){return p.op_GreaterGreaterEquals(ct(cv),cu);};p.op_RightShift=function(ct,cu,cv){return p.op_BarGreaterGreater(ct(cv),cu);};p.op_GreaterGreaterEquals=function(ct,cu){return o.bind(cu,ct);};p.op_BarGreaterGreater=function(ct,cu){return o.map(cu,ct);};p.op_LessMultiplyGreater=function(ct,cu){return o.apply(ct,cu);};r=q.Builder=bM.Class({For:function(ct,cu){var cv;cv=this;return this.Using(bT.Get(ct),function(cw){return cv.While(function(){return cw.MoveNext();},cv.Delay(function(){return cu(cw.Current());}));});},Using:function(ct,cu){return this.TryFinally(function(){return cu(ct);},function(){if(!bW.Equals(ct,null))ct.Dispose();});},TryFinally:function(ct,cu){return o.wrap(function(cv){try{return(o.getFun(ct()))(cv);}finally{cu();}});},TryWith:function(ct,cu){return o.wrap(function(cv){try{return(o.getFun(ct()))(cv);}catch(cw){return cu(cw);}});},While:function(ct,cu){function cv(cw,cx){return cw()?o.bind(function(){return cv(cw,cx);},cx()):o.rtn();}return cv(ct,cu);},Run:function(ct){return o.wrap(function(cu){return(o.getFun(ct()))(cu);});},Combine:function(ct,cu){return o.bind(cu,ct);},Delay:a.id,Zero:function(){return o.rtn();},Bind:function(ct,cu){return o.bind(cu,ct);},ReturnFrom:function(ct){return o.from(ct);},Return:function(ct){return o.rtn(ct);}},k,r);r.New=bM.Ctor(function(){k.New.call(this);},r);o.fusion=function(){bI.$cctor();return bI.fusion;};o.absorbO=function(ct,cu){return o.absorbR(o.map(function(cv){return l.ofOption(ct,cv);},cu));};o.absorbR=function(ct){return o.bind(o.ofResultRM,ct);};o.insertSnd=function(ct,cu){return o.map(function(cv){return[cv,cu];},ct);};o.insertFst=function(ct,cu){return o.map(function(cv){return[ct,cv];},cu);};o.insertR=function(ct){return ct.$==0?o.map(function(cu){return{$:0,$0:cu};},ct.$0):o.rtn(c.Error$1(ct.$0));};o.insertO=function(ct){var cu;cu=ct==null?null:{$:1,$0:o.map(function(cv){return{$:1,$0:cv};},ct.$0)};return cu==null?o.rtn(null):cu.$0;};o.iterResultPrint=function(ct){function cu(cv){c.print$1(cv);}o.iterReader(function(cv){return cu(d.summarized(cv));},function(cv){c.print$1(cv);},null,ct);};o.iterResult=function(ct,cu,cv){o.iterReader(ct,cu,null,cv);};o.runResult=function(ct){return o.runReader(null,ct);};o.runReader=function(ct,cu){var cv,cw,cx;cv=o.run(ct,cu);cw=cv[2];return l.ofOption(function(){return cw;},(cx=cv[0],cx==null?null:{$:1,$0:[cx.$0,cw]}));};o.mapReader=function(ct,cu){return o.mapState(function(){return ct;},a.id,cu);};o.readerFun=function(ct){return o.map(ct,o.getS());};o.sequenceSeq=function(ct){return o.traverseSeq(a.id,ct);};o.traverseSeq=function(ct,cu){return o.map(a.id,bR.foldBack(function(cv,cw){return o.op_GreaterGreaterEquals(ct(cv),function(cx){return o.op_GreaterGreaterEquals(cw,function(cy){return o.rtn(new bQ.T({$:1,$0:cx,$1:cy}));});});},bR.ofSeq(cu),o.rtn(bQ.T.Empty)));};o.op_GreaterGreaterEquals=function(ct,cu){return o.bind(cu,ct);};o.apply=function(ct,cu){return o.bind(function(cv){return o.map(cv,cu);},ct);};o.memoizeRm=function(ct,cu,cv){return{$:0,$0:function(cw){var cx,cy,cz,cA,cB;function cC(cD,cE){return(cz(cD))(function(){return cE;});}cx=cw[0];cy=ct(cx);cz=cy[1];return o.run(cx,(cA=(cB=cy[0](cv),cB==null?null:{$:1,$0:o.rtn(cB.$0)}),cA==null?o.map(function(cD){return cC(cv,cD);},cu(cv)):cA.$0));}};};o.iterReader=function(ct,cu,cv,cw){var cx,cy;cx=o.run(cv,o.map(cu,cw));cy=cx[2];(h.iter(a.ignore))(cx[0]);cy.$!==0?ct(cy):void 0;};o.mapState=function(ct,cu,cv){return{$:0,$0:function(cw){var cx,cy;cx=cw[0];cy=(o.getFun(cv))([ct(cx),cw[1]]);return[cy[0],cu(cx,cy[1]),cy[2]];}};};o.freeMessageW=function(ct){var cu;function cv(cw){return new d({$:2,$0:cw});}return o.freeMessageF((cu=function(cw){return function(cx){return cw(a.String(cx));};}(a.id),function(cw){return cv(cu(cw));}),ct);};o.freeMessage=function(ct){var cu;function cv(cw){return new d({$:1,$0:cw});}return o.freeMessageF((cu=function(cw){return function(cx){return cw(a.String(cx));};}(a.id),function(cw){return cv(cu(cw));}),ct);};o.freeMessageF=function(ct,cu){return{$:0,$0:function(cv){var cw,cx,cy;cw=cv[0];cx=cv[1];try{cy=cu.$0([cw,d.freeMessage(cx)]);return[cy[0],cy[1],d.freeMessageF(ct,cy[2])];}catch(cz){return[null,cw,d.freeMessage(d.addMsg(cx,new d({$:5,$0:cz.message,$1:cz.stack})))];}}};};o.ofFusionM=function(ct){return o.from(ct);};o.ofResultMessage=function(ct){return o.OkFMsg(null,ct);};o.ofMessage=function(ct){return o.OkFMsg(null,new d({$:4,$0:ct}));};o.ofOption=function(ct,cu){return cu==null?o.ErrorF(ct()):o.OkF(cu.$0);};o.ofResult=function(ct){return ct.$==1?o.ErrorF(new d({$:1,$0:(function(cu){return function(cv){return cu(bN.prettyPrint(cv));};}(a.id))(ct.$0)})):o.OkF(ct.$0);};o.ofResultS=function(ct){return ct.$==1?o.ErrorF(new d({$:1,$0:ct.$0})):o.OkF(ct.$0);};o.ofResultM=function(ct){return ct.$==1?o.ErrorF(new d({$:4,$0:ct.$0})):o.OkF(ct.$0);};o.ofResultRM=function(ct){return ct.$==1?o.ErrorF(ct.$0):o.OkF(ct.$0);};o.inling=function(ct,cu){return{$:0,$0:function(cv){var cw,cx,cy;cw=cv[0];cx=cv[1];try{cy=cu.$0([cw,cx]);return[{$:1,$0:cy[0]},cy[1],cy[2]];}catch(cz){return[null,cw,d.addMsg(cx,new d({$:5,$0:cz.message,$1:cz.stack}))];}}};};o.check=function(){return{$:0,$0:function(ct){return[d.isFatal(ct[1])?null:{$:1,$0:null},ct[0],d.NoMsg];}};};o.putS=function(ct){return{$:0,$0:function(){return[{$:1,$0:null},ct,d.NoMsg];}};};o.getR=function(){return{$:0,$0:function(ct){return[{$:1,$0:ct[1]},ct[0],d.NoMsg];}};};o.getS=function(){return{$:0,$0:function(ct){var cu;cu=ct[0];return[{$:1,$0:cu},cu,d.NoMsg];}};};o.ErrorF=function(ct){return{$:0,$0:function(cu){return[null,cu[0],ct];}};};o.OkFMsg=function(ct,cu){return{$:0,$0:function(cv){return[{$:1,$0:ct},cv[0],cu];}};};o.OkF=function(ct){return{$:0,$0:function(cu){return[{$:1,$0:ct},cu[0],d.NoMsg];}};};o.run=function(ct,cu){return(o.getFun(cu))([ct,d.NoMsg]);};o.from=a.id;o.getFun=function(ct){return ct.$0;};o.wrap=function(ct){return{$:0,$0:ct};};o.map=function(ct,cu){return o.bind(function(cv){return o.rtn(ct(cv));},cu);};o.bind=function(ct,cu){return{$:0,$0:function(cv){var cw,cx,cy,cz,cA,cB,cC;cw=cv[0];cx=cv[1];try{cy=cu.$0([cw,cx]);cz=cy[0];cA=cy[1];cB=cy[2];return cz!=null&&cz.$==1?(cC=ct(cz.$0).$0([cA,d.addMsg(cx,cB)]),[cC[0],cC[1],d.addMsg(cB,cC[2])]):[null,cA,cB];}catch(cD){return[null,cw,d.addMsg(cx,new d({$:5,$0:cD.message,$1:cD.stack}))];}}};};o.rtn=function(ct){return{$:0,$0:function(cu){return[{$:1,$0:ct},cu[0],d.NoMsg];}};};t.rtn=function(ct){return s.rtn(ct);};t.op_GreaterEqualsGreater=function(ct,cu,cv){return t.op_GreaterGreaterEquals(ct(cv),cu);};t.op_RightShift=function(ct,cu,cv){return t.op_BarGreaterGreater(ct(cv),cu);};t.op_GreaterGreaterEquals=function(ct,cu){return s.bind(cu,ct);};t.op_BarGreaterGreater=function(ct,cu){return s.map(cu,ct);};t.op_LessMultiplyGreater=function(ct,cu){return s.apply(ct,cu);};v=u.Builder=bM.Class({For:function(ct,cu){var cv;cv=this;return this.Using(bT.Get(ct),function(cw){return cv.While(function(){return cw.MoveNext();},cv.Delay(function(){return cu(cw.Current());}));});},Using:function(ct,cu){function cv(cw,cx){return bS.Using(ct,function(cy){return(s.getFun(cu(cy)))([cw,cx]);});}return s.wrap(function(cw){return cv(cw[0],cw[1]);});},TryFinally:function(ct,cu){function cv(cw,cx){return bS.TryFinally((s.getFun(ct()))([cw,cx]),cu);}return s.wrap(function(cw){return cv(cw[0],cw[1]);});},TryWith:function(ct,cu){function cv(cw,cx){return bS.TryWith((s.getFun(ct()))([cw,cx]),cu);}return s.wrap(function(cw){return cv(cw[0],cw[1]);});},While:function(ct,cu){function cv(cw,cx){return cw()?s.bind(function(){return cv(cw,cx);},cx()):s.rtn();}return cv(ct,cu);},Run:function(ct){return s.wrap(function(cu){return(s.getFun(ct()))(cu);});},Combine:function(ct,cu){return s.bind(cu,ct);},Delay:a.id,Zero:function(){return s.rtn();},Bind:function(ct,cu){return s.bind(cu,ct);},ReturnFrom:function(ct){return s.from(ct);},Return:function(ct){return s.rtn(ct);}},k,v);v.New=bM.Ctor(function(){k.New.call(this);},v);s.fusion=function(){bI.$cctor();return bI.fusion$1;};s.iterResultPrintA=function(ct){function cu(cv){c.print$1(cv);}s.iterReaderA(function(cv){return cu(d.summarized(cv));},function(cv){c.print$1(cv);},null,ct);};s.iterResultPrint=function(ct){function cu(cv){c.print$1(cv);}s.iterReader(function(cv){return cu(d.summarized(cv));},function(cv){c.print$1(cv);},null,ct);};s.iterResultA=function(ct,cu,cv){s.iterReaderA(ct,cu,null,cv);};s.iterResult=function(ct,cu,cv){s.iterReader(ct,cu,null,cv);};s.runResult=function(ct){return s.runReader(null,ct);};s.runReader=function(ct,cu){function cv(cx,cy,cz){return l.ofOption(function(){return cz;},cx==null?null:{$:1,$0:[cx.$0,cz]});}function cw(cx){return bS.Return(cx);}return bS.Bind(s.run(ct,cu),function(cx){return cw(cv.apply(null,cx));});};s.mapReader=function(ct,cu){return s.mapState(function(){return ct;},a.id,cu);};s.absorbO=function(ct,cu){return s.absorbR(s.map(function(cv){return l.ofOption(ct,cv);},cu));};s.absorbR=function(ct){return s.bind(s.ofResultRM,ct);};s.insertSnd=function(ct,cu){return s.map(function(cv){return[cv,cu];},ct);};s.insertFst=function(ct,cu){return s.map(function(cv){return[ct,cv];},cu);};s.insertR=function(ct){return ct.$==0?s.map(function(cu){return{$:0,$0:cu};},ct.$0):s.rtn(c.Error$1(ct.$0));};s.insertO=function(ct){var cu;cu=ct==null?null:{$:1,$0:s.map(function(cv){return{$:1,$0:cv};},ct.$0)};return cu==null?s.rtn(null):cu.$0;};s.readerFun=function(ct){return s.map(ct,s.getS());};s.freeMessageW=function(ct){var cu;function cv(cw){return new d({$:2,$0:cw});}return s.freeMessageF((cu=function(cw){return function(cx){return cw(a.String(cx));};}(a.id),function(cw){return cv(cu(cw));}),ct);};s.freeMessage=function(ct){var cu;function cv(cw){return new d({$:1,$0:cw});}return s.freeMessageF((cu=function(cw){return function(cx){return cw(a.String(cx));};}(a.id),function(cw){return cv(cu(cw));}),ct);};s.sequenceSeq=function(ct){return s.traverseSeq(a.id,ct);};s.traverseSeq=function(ct,cu){return s.map(a.id,bR.foldBack(function(cv,cw){return s.op_GreaterGreaterEquals(ct(cv),function(cx){return s.op_GreaterGreaterEquals(cw,function(cy){return s.rtn(new bQ.T({$:1,$0:cx,$1:cy}));});});},bR.ofSeq(cu),s.rtn(bQ.T.Empty)));};s.op_GreaterGreaterEquals=function(ct,cu){return s.bind(cu,ct);};s.apply=function(ct,cu){return s.bind(function(cv){return s.map(cv,cu);},ct);};s.memoizeRm=function(ct,cu,cv){return{$:0,$0:function(cw){var cx,cy;cx=cw[0];cy=null;return bS.Delay(function(){var cz,cA,cB,cC;function cD(cE,cF){return(cA(cE))(function(){return cF;});}cz=ct(cx);cA=cz[1];return s.run(cx,(cB=(cC=cz[0](cv),cC==null?null:{$:1,$0:s.rtn(cC.$0)}),cB==null?s.map(function(cE){return cD(cv,cE);},cu(cv)):cB.$0));});}};};s.iterReaderA=function(ct,cu,cv,cw){function cx(cz,cA,cB){(h.iter(a.ignore))(cz);cB.$!==0?ct(cB):void 0;}function cy(cz){return bS.Return(cz);}bS.Start(bS.Bind(s.run(cv,s.map(cu,cw)),function(cz){return cy(cx.apply(null,cz));}),null);};s.iterReader=function(ct,cu,cv,cw){var cx;cx=s.run(cv,s.map(cu,cw));throw"iterS cannot be used in JavaScript!";};s.mapState=function(ct,cu,cv){return{$:0,$0:function(cw){var cx,cy,cz;cx=cw[0];cy=cw[1];cz=null;return bS.Delay(function(){return bS.Bind((s.getFun(cv))([ct(cx),cy]),function(cA){return bS.Return([cA[0],cu(cx,cA[1]),cA[2]]);});});}};};s.freeMessageF=function(ct,cu){return{$:0,$0:function(cv){var cw,cx,cy;cw=cv[0];cx=cv[1];cy=null;return bS.Delay(function(){return bS.TryWith(bS.Delay(function(){return bS.Bind(cu.$0([cw,d.freeMessage(cx)]),function(cz){return bS.Return([cz[0],cz[1],d.freeMessageF(ct,cz[2])]);});}),function(cz){return bS.Return([null,cw,d.freeMessage(d.addMsg(cx,new d({$:5,$0:cz.message,$1:cz.stack})))]);});});}};};s.ofFusionM=function(ct){var cu;cu=ct.$0;return{$:0,$0:function(cv){return bS.Return(cu([cv[0],cv[1]]));}};};s.ofAsyncResultRM=function(ct){return s.bind(s.ofResultRM,s.ofAsync(ct));};s.ofAsync=function(ct){return{$:0,$0:function(cu){var cv;function cw(cy){return[{$:1,$0:cy},cv,d.NoMsg];}function cx(cy){return bS.Return(cy);}cv=cu[0];return bS.Bind(ct,function(cy){return cx(cw(cy));});}};};s.ofResultMessage=function(ct){return s.OkFMsg(null,ct);};s.ofMessage=function(ct){return s.OkFMsg(null,new d({$:4,$0:ct}));};s.ofOption=function(ct,cu){var cv;cv=cu==null?null:{$:1,$0:s.OkF(cu.$0)};return cv==null?function(cw){return s.ErrorF(ct(cw));}():cv.$0;};s.ofResult=function(ct){return ct.$==1?s.ErrorF(new d({$:1,$0:(function(cu){return function(cv){return cu(bN.prettyPrint(cv));};}(a.id))(ct.$0)})):s.OkF(ct.$0);};s.ofResultS=function(ct){return ct.$==1?s.ErrorF(new d({$:1,$0:ct.$0})):s.OkF(ct.$0);};s.ofResultM=function(ct){return ct.$==1?s.ErrorF(new d({$:4,$0:ct.$0})):s.OkF(ct.$0);};s.ofResultRM=function(ct){return ct.$==1?s.ErrorF(ct.$0):s.OkF(ct.$0);};s.getOption=function(ct){return{$:0,$0:function(cu){var cv,cw,cx;cv=cu[0];cw=cu[1];cx=null;return bS.Delay(function(){return bS.TryWith(bS.Delay(function(){return bS.Bind(ct.$0([cv,cw]),function(cy){return bS.Return([{$:1,$0:cy[0]},cy[1],cy[2]]);});}),function(cy){return bS.Return([null,cv,d.addMsg(cw,new d({$:5,$0:cy.message,$1:cy.stack}))]);});});}};};s.check=function(){return{$:0,$0:function(ct){return bS.Return([d.isFatal(ct[1])?null:{$:1,$0:null},ct[0],d.NoMsg]);}};};s.putS=function(ct){return{$:0,$0:function(){return bS.Return([{$:1,$0:null},ct,d.NoMsg]);}};};s.getR=function(){return{$:0,$0:function(ct){return bS.Return([{$:1,$0:ct[1]},ct[0],d.NoMsg]);}};};s.getS=function(){return{$:0,$0:function(ct){var cu;cu=ct[0];return bS.Return([{$:1,$0:cu},cu,d.NoMsg]);}};};s.ErrorF=function(ct){return{$:0,$0:function(cu){return bS.Return([null,cu[0],ct]);}};};s.OkFMsg=function(ct,cu){return{$:0,$0:function(cv){return bS.Return([{$:1,$0:ct},cv[0],cu]);}};};s.OkF=function(ct){return{$:0,$0:function(cu){return bS.Return([{$:1,$0:ct},cu[0],d.NoMsg]);}};};s.run=function(ct,cu){return(s.getFun(cu))([ct,d.NoMsg]);};s.from=a.id;s.getFun=function(ct){return ct.$0;};s.wrap=function(ct){return{$:0,$0:ct};};s.map=function(ct,cu){return s.bind(function(cv){return s.rtn(ct(cv));},cu);};s.bind=function(ct,cu){return{$:0,$0:function(cv){var cw,cx,cy;cw=cv[0];cx=cv[1];cy=null;return bS.Delay(function(){return bS.TryWith(bS.Delay(function(){return bS.Bind(cu.$0([cw,cx]),function(cz){var cA,cB,cC;cA=cz[0];cB=cz[1];cC=cz[2];return cA!=null&&cA.$==1?bS.Bind(ct(cA.$0).$0([cB,d.addMsg(cx,cC)]),function(cD){return bS.Return([cD[0],cD[1],d.addMsg(cC,cD[2])]);}):bS.Return([null,cB,cC]);});}),function(cz){return bS.Return([null,cw,d.addMsg(cx,new d({$:5,$0:cz.message,$1:cz.stack}))]);});});}};};s.rtn=function(ct){return{$:0,$0:function(cu){return bS.Return([{$:1,$0:ct},cu[0],d.NoMsg]);}};};w.Guid$1=function(){bI.$cctor();return bI["|Guid|_|"];};w.Double$1=function(){bI.$cctor();return bI["|Double|_|"];};w.Single$1=function(){bI.$cctor();return bI["|Single|_|"];};w.Int$1=function(){bI.$cctor();return bI["|Int|_|"];};w.Date$1=function(){bI.$cctor();return bI["|Date|_|"];};w.parseGuidO$1=function(){bI.$cctor();return bI.parseGuidO;};w.parseDoubleO$1=function(){bI.$cctor();return bI.parseDoubleO;};w.parseSingleO$1=function(){bI.$cctor();return bI.parseSingleO;};w.parseIntO$1=function(){bI.$cctor();return bI.parseIntO;};w.parseDateO$1=function(){bI.$cctor();return bI.parseDateO;};w.tryParseWith$1=function(ct){function cu(cv,cw){return cv?{$:1,$0:cw}:null;}return function(cv){return cu.apply(null,ct(cv));};};x.PostAndAsyncReply=function(ct,cu,cv){return ct.PostAndAsyncReply(function(cw){return[cw,cu];},cv);};z.applyReply=function(ct,cu){return z.applyReplyA(function(cv){var cw;cw=null;return bS.Delay(function(){return bS.Return(ct(cv));});},cu);};z.applyReplyA=function(ct,cu){return cu.PostAndAsyncReply(function(cv){return function(cw){var cx;cx=null;return bS.Delay(function(){return bS.Bind(ct(cw),function(cy){cv(cy[1]);return bS.Return(cy[0]);});});};},null);};z.apply=function(ct,cu){z.applyA(function(cv){var cw;cw=null;return bS.Delay(function(){return bS.Return(ct(cv));});},cu);};z.applyA=function(ct,cu){cu.mailbox.AddLast(function(cv){var cw;cw=null;return bS.Delay(function(){return ct(cv);});});cu.resume();};z.setState=function(ct,cu){cu.mailbox.AddLast(function(){var cv;cv=null;return bS.Delay(function(){return bS.Return(ct);});});cu.resume();};z.getStateA=function(ct){return ct.PostAndAsyncReply(function(cu){return function(cv){var cw;cw=null;return bS.Delay(function(){cu(cv);return bS.Return(cv);});};},null);};y.defHandler=function(ct,cu){c.print$1(ct);return cu;};y.stateFull=function(ct,cu){return bY.Start(function(cv){function cw(cx){var cy;cy=null;return bS.Delay(function(){return bS.TryWith(bS.Delay(function(){return bS.Bind(cv.Receive(null),function(cz){return bS.Bind(cz(cx),function(cA){return cw(cA);});});}),function(cz){return cw(ct(cz,cx));});});}return cw(cu);},null);};y.fold=function(ct,cu,cv){return y.foldA(ct,function(cw,cx){var cy;cy=null;return bS.Delay(function(){return bS.Return(cu(cw,cx));});},cv);};y.foldA=function(ct,cu,cv){return bY.Start(function(cw){function cx(cy){var cz;cz=null;return bS.Delay(function(){return bS.TryWith(bS.Delay(function(){return bS.Bind(cw.Receive(null),function(cA){return bS.Bind(cu(cy,cA),function(cB){return cx(cB);});});}),function(cA){return cx(ct(cA,cy));});});}return cx(cv);},null);};y.call=function(ct,cu){return y.callA(ct,function(cv){var cw;cw=null;return bS.Delay(function(){return bS.Return(cu(cv));});});};y.callA=function(ct,cu){return y.iterA(ct,function(cv){var cw,cx,cy;cw=cv[0];cx=cv[1];cy=null;return bS.Delay(function(){return bS.Bind(cu(cx),function(cz){cw(cz);return bS.Zero();});});});};y.iter=function(ct,cu){return y.iterA(ct,function(cv){var cw;cw=null;return bS.Delay(function(){cu(cv);return bS.Zero();});});};y.iterA=function(ct,cu){return bY.Start(function(cv){var cw;cw=null;return bS.Delay(function(){return bS.While(function(){return true;},bS.Delay(function(){return bS.TryWith(bS.Delay(function(){return bS.Bind(cv.Receive(null),function(cx){return bS.Bind(cu(cx),function(){return bS.Return(null);});});}),function(cx){ct(cx);return bS.Zero();});}));});},null);};c.print$1=function(ct){if(typeof ct=="string")((function(cu){return function(cv){return cu(bN.toSafe(cv));};}(function(cu){bZ.log(cu);}))(ct));else((function(cu){return function(cv){return cu(bN.prettyPrint(cv));};}(function(cu){bZ.log(cu);}))(ct));};c.Error$1=function(ct){return{$:1,$0:ct};};B.sequenceSeq=function(ct){return B.traverseSeq(a.id,ct);};B.traverseSeq=function(ct,cu){return B.map(a.id,bR.foldBack(function(cv,cw){return B.op_GreaterGreaterEquals(ct(cv),function(cx){return B.op_GreaterGreaterEquals(cw,function(cy){return B.rtn(new bQ.T({$:1,$0:cx,$1:cy}));});});},bR.ofSeq(cu),B.rtn(bQ.T.Empty)));};B.op_GreaterGreaterEquals=function(ct,cu){return B.bind(cu,ct);};B.rtn=function(ct){return b1.Const(ct);};B.map=function(ct,cu){return b1.Map(ct,cu);};B.bind=function(ct,cu){return b1.Bind(ct,cu);};B.insertWO=function(ct){return ct==null?b1.Const(null):b1.Map(function(cu){return{$:1,$0:cu};},ct.$0);};C.lensView=function(ct,cu,cv,cw){var cx,cy,cz;cx=C.freshId();cy=b1.Map2(function(cA){return ct(cA);},cw.get_View(),cv);cz=new b0.Var({Get:function(){return ct(cw.Get());},Set:function(cA){return cw.Update(function(cB){return cu(cB,cA);});},SetFinal:function(cA){return this.Set(cA);},Update:function(cA){return cw.Update(function(cB){return cu(cB,cA(ct(cB)));});},UpdateMaybe:function(cA){return cw.UpdateMaybe(function(cB){var cC;cC=cA(ct(cB));return cC==null?null:{$:1,$0:cu(cB,cC.$0)};});},get_View:function(){return cy;},get_Id:function(){return cx;}});b2.New.call(cz);return cz;};C.freshId=function(){C.set_counter(C.counter()+1);return"varuid"+a.String(C.counter());};C.counter=function(){bI.$cctor();return bI.counter;};C.set_counter=function(ct){bI.$cctor();bI.counter=ct;};D.currentLens=function(ct,cu,cv){return D["currentLensUpd'"](ct,cu,function(cw){cv.UpdateBy(function(){return cv.TryFindByKey(cv.key(cw))==null?null:{$:1,$0:cw};},cv.key(cw));},cv);};D["currentLensUpd'"]=function(ct,cu,cv,cw){return new b3.New(b1.Map2(function(cx,cy){var cz;cz=cy==null?null:cw.TryFindByKey(cy.$0);return cz==null?ct:cz.$0;},cw.v,cu),cv);};D.currentLensUpd=function(ct,cu,cv,cw){var cx;function cy(cA){return cw.TryFindByKey(cA);}function cz(cA){return cA==null?ct:cA.$0;}return C.lensView((cx=function(cA){return cA==null?null:cy(cA.$0);},function(cA){return cz(cx(cA));}),function(cA,cB){(h.iter(cv(cB)))(cA);return cA;},cw.v,cu);};D.lensDef=function(ct,cu,cv){function cw(cx){return cx==null?ct:cx.$0;}return D["lensIntoO'"](cv,cw,function(){return a.id;},cu,b1.Map(cw,cv.TryFindByKeyAsView(cu)));};D.docLensMapViewO=function(ct,cu,cv,cw){function cx(cy,cz){return cv(cy,D["lensIntoO'"](cw,function(cA){return cA==null?ct:cA.$0;},function(){return a.id;},cy,cz));}return b4.ConvertSeqBy(cw.key,function(cy){return function(cz){return cx(cy,cz);};},b1.Map(cu,cw.v));};D.docLensMapView=function(ct,cu,cv){function cw(cx,cy){return cu(cx,D["lensInto'"](cv,a.id,function(){return a.id;},cx,cy));}return b4.ConvertSeqBy(cv.key,function(cx){return function(cy){return cw(cx,cy);};},b1.Map(ct,cv.v));};D["lensIntoO'"]=function(ct,cu,cv,cw,cx){var cy,cz;cy=C.freshId();cz=new b2({Get:function(){return cu(ct.TryFindByKey(cw));},Set:function(cA){return ct.UpdateBy(function(cB){return{$:1,$0:(cv(cB))(cA)};},cw);},Update:function(cA){return ct.UpdateBy(function(cB){var cC;return{$:1,$0:(cC=cA(cu({$:1,$0:cB})),(cv(cB))(cC))};},cw);},UpdateMaybe:function(cA){return ct.UpdateBy(function(cB){var cC,cD;cC=cA(cu({$:1,$0:cB}));cD=cv(cB);return cC==null?null:{$:1,$0:cD(cC.$0)};},cw);},SetFinal:function(cA){return this.Set(cA);},get_View:function(){return cx;},get_Id:function(){return cy;}});b2.New.call(cz);return cz;};D["lensInto'"]=function(ct,cu,cv,cw,cx){var cy,cz;cy=C.freshId();cz=new b2({Get:function(){return cu(ct.FindByKey(cw));},Set:function(cA){return ct.UpdateBy(function(cB){return{$:1,$0:(cv(cB))(cA)};},cw);},Update:function(cA){return ct.UpdateBy(function(cB){var cC;return{$:1,$0:(cC=cA(cu(cB)),(cv(cB))(cC))};},cw);},UpdateMaybe:function(cA){return ct.UpdateBy(function(cB){var cC,cD;cC=cA(cu(cB));cD=cv(cB);return cC==null?null:{$:1,$0:cD(cC.$0)};},cw);},SetFinal:function(cA){return this.Set(cA);},get_View:function(){return cx;},get_Id:function(){return cy;}});b2.New.call(cz);return cz;};G=F.Address=bM.Class({get_txt:function(){return this.$0;}},null,G);H.BRGetProcessId={$:1};H.BRGetConnections={$:0};I.MsgRequestForEcho={$:5};I.MsgRequestForId={$:4};I.MsgFromBroker={$:3};I.MsgReply={$:2};I.MsgRequest={$:1};I.MsgInformation={$:0};J.BMReceiverCantReply={$:4};J.BMOnlyBrokerShouldUse={$:1};J.BMOk={$:0};K.Receiver={$:2};K.Broker={$:1};K.NoReply={$:0};L.New=function(ct,cu,cv,cw,cx,cy,cz){return{from:ct,destination:cu,msgType:cv,subtype:cw,id:cx,payload:cy,replier:cz};};F.makeReply=function(ct){return F.replier(K.NoReply,F.msgType(I.MsgReply,ct));};F.mapPayload=function(ct,cu){return L.New(cu.from,cu.destination,cu.msgType,cu.subtype,cu.id,ct(cu.payload),cu.replier);};F.msgId=function(ct,cu){return L.New(cu.from,cu.destination,cu.msgType,cu.subtype,ct,cu.payload,cu.replier);};F.replier=function(ct,cu){return L.New(cu.from,cu.destination,cu.msgType,cu.subtype,cu.id,cu.payload,ct);};F.subtype=function(ct,cu){return L.New(cu.from,cu.destination,cu.msgType,ct,cu.id,cu.payload,cu.replier);};F.msgType=function(ct,cu){return L.New(cu.from,cu.destination,ct,cu.subtype,cu.id,cu.payload,cu.replier);};F.destination=function(ct,cu){return L.New(cu.from,ct,cu.msgType,cu.subtype,cu.id,cu.payload,cu.replier);};F.from=function(ct,cu){return L.New(ct,cu.destination,cu.msgType,cu.subtype,cu.id,cu.payload,cu.replier);};F.MessageBrokerAddress=function(){bI.$cctor();return bI.MessageBrokerAddress;};F.MessageBrokerId=function(){bI.$cctor();return bI.MessageBrokerId;};O.DtOther={$:6};O.DtMeasure={$:5};O.DtCalc={$:4};O.DtTCalc={$:3};O.DtVersion={$:2};O.DtTime={$:1};O.DtDataType={$:0};P.CtFreeze={$:2};P.CtCalc={$:1};P.CtOther={$:0};Q.AtNumber={$:1};Q.AtString={$:0};R.EtNumber={$:1};R.EtString={$:0};S=N.ModId=bM.Class({get_Id:function(){return this.$0;}},null,S);T=N.AttId=bM.Class({get_Id:function(){return this.$0;}},null,T);U=N.ElmId=bM.Class({get_Id:function(){return this.$0;}},null,U);V=N.CubId=bM.Class({get_Id:function(){return this.$0;}},null,V);W=N.DimId=bM.Class({get_Id:function(){return this.$0;}},null,W);X=N.CalId=bM.Class({get_Id:function(){return this.$0;}},null,X);Y=N.TotId=bM.Class({get_Id:function(){return this.$0;}},null,Y);Z=N.ForId=bM.Class({get_Id:function(){return this.$0;}},null,Z);_0=N.RulId=bM.Class({get_Id:function(){return this.$0;}},null,_0);_1.New=function(ct,cu,cv,cw){return{attId:ct,attName:cu,attType:cv,attTableNum:cw};};_2.New=function(ct,cu,cv,cw,cx,cy,cz){return{elmId:ct,elmDim:cu,elmType:cv,elmName:cw,elmDescription:cx,elmAttributes:cy,elmParents:cz};};_3.New=function(ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD){return{dimId:ct,dimName:cu,dimPrefix:cv,dimOrder:cw,dimExclude:cx,dimFreeze:cy,dimType:cz,defaultElm:cA,dimElements:cB,dimAttributes:cC,isCalcDim:cD};};_4.UoPlus={$:1};_4.UoMinus={$:0};_5.OpOr={$:11};_5.OpAnd={$:10};_5.OpLE={$:9};_5.OpLT={$:8};_5.OpGE={$:7};_5.OpGT={$:6};_5.OpNE={$:5};_5.OpEQ={$:4};_5.OpDivide={$:3};_5.OpMultiply={$:2};_5.OpSubtract={$:1};_5.OpAdd={$:0};_6.ExtStet={$:1};_6.ExtNA={$:0};_7.ExnStet={$:1};_7.ExnNA={$:0};_8.ExiStet={$:1};_8.ExiNA={$:0};_9.New=function(ct,cu,cv){return{sliDims:ct,calculation:cu,cube:cv};};_.ForAll={$:2};_.ForConsolidated={$:1};_.ForBase={$:0};$.New=function(ct,cu,cv,cw,cx,cy,cz,cA){return{forId:ct,forDestDecl:cu,forDestination:cv,forDescription:cw,forText:cx,forExpression:cy,forType:cz,forOrder:cA};};ba.New=function(ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE){return{calId:ct,calName:cu,calDescription:cv,calOrder:cw,format:cx,isText:cy,isInput:cz,isBalance:cA,calDims:cB,calFormulas:cC,cubIdO:cD,properties:cE};};bb.New=function(ct,cu,cv,cw,cx){return{totId:ct,totName:cu,totOrder:cv,totFormat:cw,children:cx};};bc.ConsolidatedRuleKey={$:6};bc.InputRuleKey={$:5};bc.ActualRuleKey={$:4};bd.New=function(ct,cu,cv,cw,cx,cy,cz){return{cubId:ct,cubName:cu,cubRules:cv,cubRuleXmls:cw,cubDims:cx,measureDim:cy,cubType:cz};};be.New=function(ct,cu,cv,cw,cx,cy,cz,cA){return{rulId:ct,rulSourceId:cu,rulDescription:cv,rulDestination:cw,rulExpression:cx,rulType:cy,rulOrder:cz,rulXml:cA};};bf.GetInitModelStats={$:0};bg.New=function(ct,cu,cv,cw,cx,cy){return{modId:ct,server:cu,actualElem:cv,modDims:cw,modCubes:cx,modCalculations:cy};};bh.HelperTypeN={$:0};bh.op_AmpPercentGreater=function(ct,cu){return cu;};bh.op_AmpPercentGreater$1=function(ct,cu){return{$:2,$0:N.calcSlice(cu)};};bh.op_AmpPercentGreater$2=function(ct,cu){return{$:2,$0:cu};};bh.op_AmpPercentGreater$3=function(ct,cu){return{$:3,$0:cu};};bh.op_AmpPercentGreater$4=function(ct,cu){return{$:3,$0:cu};};bh.op_AmpPercentGreater$5=function(ct,cu){return{$:3,$0:cu?1:0};};bi.HelperTypeT={$:0};bi.op_AmpAmpGreater=function(ct,cu){return cu;};bi.op_AmpAmpGreater$1=function(ct,cu){return{$:2,$0:N.calcSlice(cu)};};bi.op_AmpAmpGreater$2=function(ct,cu){return{$:2,$0:cu};};bi.op_AmpAmpGreater$3=function(ct,cu){return{$:5,$0:cu.dimId};};bi.op_AmpAmpGreater$4=function(ct,cu){return{$:3,$0:cu};};bj.HelperTypeA={$:0};bk.getDimR=function(ct,cu){return l.ofOption(function(){return{$:0,$0:ct};},bk.getDimO(ct,cu));};bk.getDimO=function(ct,cu){return bP.tryFind(function(cv){return bW.Equals(cv.dimId,ct);},cu.modDims);};bk.getCubeO=function(ct,cu){return bP.tryFind(function(cv){return bW.Equals(cv.cubId,ct);},cu.modCubes);};bl.newElement=function(ct){return _2.New(new U({$:0,$0:b6.NewGuid()}),new W({$:0,$0:b6.NewGuid()}),R.EtString,ct,ct,new b8.New([]),[]);};bm.dimId=function(ct){return ct.$==1?ct.$0:ct.$0;};bn.containsDim=function(ct,cu){return cu.sliDims.ContainsKey(ct);};bn.addRef=function(ct,cu){return _9.New(cu.sliDims.Add(bm.dimId(ct),ct),cu.calculation,cu.cube);};bn.forAll=function(){bI.$cctor();return bI.forAll;};bn.newSlice=function(ct){return _9.New(new b8.New(bP.map(function(cu){return[bm.dimId(cu),cu];},ct)),null,null);};bo.filterSort=function(ct){var cu;cu=bo.filter(ct);return function(cv){return bo.sort(cu(cv));};};bo.sort=function(ct){return bP.sortBy(function(cu){return cu.dimOrder;},ct);};bo.filter=function(ct){function cu(cv){return bP.contains(cv.dimType,ct);}return function(cv){return bP.filter(cu,cv);};};bo.setName=function(ct,cu){return _3.New(cu.dimId,ct,cu.dimPrefix,cu.dimOrder,cu.dimExclude,cu.dimFreeze,cu.dimType,cu.defaultElm,cu.dimElements,cu.dimAttributes,cu.isCalcDim);};bo.dType=function(ct,cu){return _3.New(cu.dimId,cu.dimName,cu.dimPrefix,cu.dimOrder,cu.dimExclude,cu.dimFreeze,ct,cu.defaultElm,cu.dimElements,cu.dimAttributes,cu.isCalcDim);};bo.prefix=function(ct,cu){return _3.New(cu.dimId,cu.dimName,ct,cu.dimOrder,cu.dimExclude,cu.dimFreeze,cu.dimType,cu.defaultElm,cu.dimElements,cu.dimAttributes,cu.isCalcDim);};bo.New=function(ct){return bo.newDimension(new W({$:0,$0:b6.NewGuid()}),ct,false);};bo.newDimensionCalc=function(ct,cu){return bo.newDimension(ct,cu,true);};bo.newDimensionNonCalc=function(ct,cu){return bo.newDimension(ct,cu,false);};bo.newDimension=function(ct,cu,cv){return _3.New(ct,cu,"","",false,false,O.DtOther,null,[],[],cv);};bo.getElementR=function(ct,cu){return l.ofOption(function(){return{$:2,$0:cu.dimName,$1:ct};},bo.getElementO(ct,cu));};bo.getElementO=function(ct,cu){return bP.tryFind(function(cv){return bW.Equals(cv.elmId,ct);},cu.dimElements);};bp.measureDimNameR=function(ct,cu){return bU.Map(function(cv){return cv.dimName;},bp.measureDimR(ct,cu));};bp.measureDimR=function(ct,cu){return bU.Bind(function(cv){return bk.getDimR(cv,ct);},l.ofOption(function(){return{$:4,$0:cu.cubName};},cu.measureDim));};bp.measureDimO=function(ct,cu){var cv;cv=cu.measureDim;return cv==null?null:bk.getDimO(cv.$0,ct);};bp.dims=function(ct,cu){return bR.filter(function(cv){var cw;return bR.exists((cw=cv.dimId,function(cx){return bW.Equals(cw,cx);}),cu.cubDims);},ct.modDims);};bp.forElr=function(ct,cu){var cv;cv=bp.slice(cu);return _9.New(N.Map_adds(bQ.map(function(cw){return[bm.dimId(cw),cw];},ct),bp.slice(cu).sliDims),cv.calculation,cv.cube);};bp.addRules=function(ct,cu){return bd.New(cu.cubId,cu.cubName,bP.fold(function(cv,cw){return cv.Add(cw[0],cw[1]);},cu.cubRules,ct),cu.cubRuleXmls,cu.cubDims,cu.measureDim,cu.cubType);};bp.addRule=function(ct,cu,cv){return bd.New(cv.cubId,cv.cubName,cv.cubRules.Add(ct,cu),cv.cubRuleXmls,cv.cubDims,cv.measureDim,cv.cubType);};bp.New=function(){return(((bp.newCube(""))([]))(null))(P.CtOther);};bp.newCubeDims=function(ct,cu,cv){return(((bp.newCube(ct))(bR.ofSeq(bP.map(function(cw){return cw.dimId;},cu))))(cv))(P.CtOther);};bp.newCubeCalc=function(ct,cu,cv){return(((bp.newCube(ct))(cu))(cv))(P.CtCalc);};bp.newCube=function(ct){var cu;cu=new V({$:0,$0:b6.NewGuid()});return bM.Curried(bp.newCubeId,3,[cu,ct]);};bp.newCubeId=function(ct,cu,cv,cw,cx){return bd.New(ct,cu,new b8.New([]),new b8.New([]),cv,cw,cx);};bp.isCalcCube=function(ct){return ct.cubType.$===1;};bp.containsDim=function(ct,cu){return bP.contains(ct,cu.cubDims);};bp.slice=function(ct){return _9.New(new b8.New([]),null,{$:1,$0:ct.cubId});};bq.sort=function(ct){return bP.sortBy(function(cu){return cu.calOrder;},ct);};bq.cubeR=function(ct){return(N.ofOptF(function(){return(function(cu){return function(cv){return cu("Calculation '"+bN.toSafe(cv)+"' has no cube");};}(a.id))(ct.calName);}))(ct.cubIdO);};bq.withCube=function(ct,cu,cv){var cw,cx;cw=(cx=cu.cube,cx==null?null:bk.getCubeO(cx.$0,ct));return cw==null?null:cv(cw.$0);};bq.addFormulas=function(ct,cu){return bP.isEmpty(ct)?cu:ba.New(cu.calId,cu.calName,cu.calDescription,cu.calOrder,cu.format,cu.isText,cu.isInput,cu.isBalance,cu.calDims,cu.calFormulas.concat(bR.ofSeq(ct)),cu.cubIdO,cu.properties);};bq.forSlice=function(ct,cu){var cv;cv=bq.slice(cu);return _9.New(N.Map_adds(bQ.map(function(cw){return[bm.dimId(cw),cw];},ct),bq.slice(cu).sliDims),cv.calculation,cv.cube);};bq.addFormula=function(ct,cu){return ba.New(cu.calId,cu.calName,cu.calDescription,cu.calOrder,cu.format,cu.isText,cu.isInput,cu.isBalance,cu.calDims,cu.calFormulas.concat([ct]),cu.cubIdO,cu.properties);};bq.setOrder=function(ct,cu){return ba.New(cu.calId,cu.calName,cu.calDescription,ct,cu.format,cu.isText,cu.isInput,cu.isBalance,cu.calDims,cu.calFormulas,cu.cubIdO,cu.properties);};bq.setIsText=function(ct,cu){return ba.New(cu.calId,cu.calName,cu.calDescription,cu.calOrder,cu.format,ct,cu.isInput,cu.isBalance,cu.calDims,cu.calFormulas,cu.cubIdO,cu.properties);};bq.setName=function(ct,cu){return ba.New(cu.calId,ct,cu.calDescription,cu.calOrder,cu.format,cu.isText,cu.isInput,cu.isBalance,cu.calDims,cu.calFormulas,cu.cubIdO,cu.properties);};bq.New=function(){return bq.newInput(new X({$:0,$0:b6.NewGuid()}),"",[]);};bq.newCalc=function(ct,cu,cv){var cw;cw=bq.newInput(ct,cu,cv);return ba.New(cw.calId,cw.calName,cw.calDescription,cw.calOrder,cw.format,cw.isText,false,cw.isBalance,cw.calDims,cw.calFormulas,cw.cubIdO,cw.properties);};bq.newInput=function(ct,cu,cv){return ba.New(ct,bO.Trim(bO.Replace(cu,"_"," ")),"","","#,##0.00",false,true,false,new b9.New(cv),[],null,new b8.New([]));};bq.calcType=function(ct){return ct.isInput?"INPUT":"CALC";};bq.slice=function(ct){return N.calcSlice(ct);};br.New=function(){return br.newTotal("");};br.newTotal=function(ct){return bb.New(new Y({$:0,$0:b6.NewGuid()}),ct,"","",[]);};bs.addRules=function(ct,cu){return bP.fold(function(cv,cw){var cx,cy;function cz(cA,cB,cC){return[cB,cC];}cx=(cy=((bs.getCubeO())(cw[0]))(cv),cy==null?null:{$:1,$0:bs.setCube(bp.addRules(bP.map(function(cA){return cz(cA[0],cA[1],cA[2]);},cw[1]),cy.$0),cv)});return cx==null?cv:cx.$0;},cu,bP.groupBy(function(cv){return a.id(cv[0],cv[1],cv[2]);},ct));};bs.prepareModel=function(ct){return bs.fixCalcsAndCubes(bs.fixForDimensions(ct));};bs.fixCalcsAndCubes=function(ct){var cu,cv;function cw(cy){return bs.getCalcCube(cy,ct);}function cx(cy){return cy==null;}cu=bR.filter(function(cy){var cz;return(cz=cy.cubIdO,cz==null?null:((bs.getCubeO())(cz.$0))(ct))==null;},ct.modCalculations);return bP.isEmpty(cu)?ct:(cv=bP.fold(function(cy,cz){return bs.newCalcCube(cz,cy);},ct,bP.filter(function(cy){return cx(cw(cy));},bP.distinct(bP.map(function(cy){return cy.calDims;},cu)))),bg.New(cv.modId,cv.server,cv.actualElem,cv.modDims,cv.modCubes,bR.map(function(cy){var cz,cA,cB,cC;cz=(cA=bP.tryFind(function(cD){return bW.Equals(cD.calId,cy.calId);},cu),cA==null?null:{$:1,$0:(cB=cA.$0,ba.New(cB.calId,cB.calName,cB.calDescription,cB.calOrder,cB.format,cB.isText,cB.isInput,cB.isBalance,cB.calDims,cB.calFormulas,(cC=bs.getCalcCube(cB.calDims,cv),cC==null?null:{$:1,$0:cC.$0.cubId}),cB.properties))});return cz==null?cy:cz.$0;},cv.modCalculations)));};bs.newCalcCube=function(ct,cu){var cv,cw,cx;cv=bs.autoName(ct,cu);cw=bo.newDimensionCalc(new W({$:0,$0:b6.NewGuid()}),bs.measurePrefix()+cv);cx=bR.ofSeq(bP.map(function(cy){return cy.dimId;},bP.append(bs.orderedDims(ct,cu),bQ.ofArray([cw]))));return bg.New(cu.modId,cu.server,cu.actualElem,cu.modDims.concat([cw]),cu.modCubes.concat([bp.newCubeCalc(bs.cubePrefix()+cv,cx,{$:1,$0:cw.dimId})]),cu.modCalculations);};bs.fixForDimensions=function(ct){return bg.New(ct.modId,ct.server,ct.actualElem,ct.modDims,ct.modCubes,bR.map(function(cu){return ba.New(cu.calId,cu.calName,cu.calDescription,cu.calOrder,cu.format,cu.isText,cu.isInput,cu.isBalance,b_.Filter(function(cv){return bP.exists(function(cw){return bW.Equals(cv,cw);},bs.dimIds(ct));},cu.calDims),cu.calFormulas,cu.cubIdO,cu.properties);},ct.modCalculations));};bs.dimIds=function(ct){return bR.map(function(cu){return cu.dimId;},ct.modDims);};bs.autoName=function(ct,cu){var cv,cw,cx;cv=bO.concat("",bP.map(function(cy){return cy.dimPrefix;},bs.orderedDims(ct,cu)));cw=bP.choose(function(cy){var cz,cA;cz=bs.cubePrefix()+cv;return cy.cubName===cz?{$:1,$0:-1}:bO.StartsWith(cy.cubName,cz)?(cA=b$.string(cy.cubName,{$:1,$0:cv.length+1},null),(w.parseIntO$1())(cA)):null;},cu.modCubes);return cv+(bP.isEmpty(cw)?"":(cx=1+bP.max(cw),(function(cy){return function(cz){return cy(a.String(cz));};}(a.id))(cx)));};bs.orderedDims=function(ct,cu){return bP.filter(function(cv){var cw;return bP.exists((cw=cv.dimId,function(cx){return bW.Equals(cw,cx);}),ct);},cu.modDims);};bs.measurePrefix=function(){bI.$cctor();return bI.measurePrefix;};bs.cubePrefix=function(){bI.$cctor();return bI.cubePrefix;};bs.dimCombinations=function(ct){return bP.distinct(bP.map(function(cu){return cu.calDims;},ct.modCalculations));};bs.withDims=function(ct,cu,cv){return bs.withDimsO(ct,cu,bM.Curried(function(cw,cx,cy,cz){return{$:1,$0:cv(cw,cx,cy,cz)};},4));};bs.withDimsO=function(ct,cu,cv){var cw;return h.join(h.apply(h.apply(h.apply(h.apply({$:1,$0:cv},(cw=cu.measureDim,cw==null?null:((bs.getDimO())(cw.$0))(ct))),bs.dataTypeDimO(ct)),bs.versionDimO(ct)),bs.timeDimO(ct)));};bs.setCube=function(ct,cu){return bg.New(cu.modId,cu.server,cu.actualElem,cu.modDims,bR.map(function(cv){return bW.Equals(cv.cubId,ct.cubId)?ct:cv;},cu.modCubes),cu.modCalculations);};bs.getCalcCube=function(ct,cu){return bP.tryFind(function(cv){return bW.Equals(new b9.New(bP.filter(function(cw){return!bW.Equals({$:1,$0:cw},cv.measureDim);},cv.cubDims)),ct);},bP.filter(bp.isCalcCube,cu.modCubes));};bs.isActualCalcO=function(ct){return bs.pickCalcO("IsActual",ct);};bs.versionDimO=function(ct){return bs.pickDimO(O.DtVersion,ct);};bs.timeDimO=function(ct){return bs.pickDimO(O.DtTime,ct);};bs.dataTypeDimO=function(ct){return bs.pickDimO(O.DtDataType,ct);};bs.tCalcDimO=function(ct){return bs.pickDimO(O.DtTCalc,ct);};bs.freezeCubeO=function(ct){return bs.pickCubeO(P.CtFreeze,ct);};bs.pickCalcO=function(ct,cu){return bP.tryPick(function(cv){return cv.calName===ct?{$:1,$0:cv}:null;},cu.modCalculations);};bs.pickDimO=function(ct,cu){return bP.tryPick(function(cv){return bW.Equals(cv.dimType,ct)?{$:1,$0:cv}:null;},cu.modDims);};bs.pickCubeO=function(ct,cu){return bP.tryPick(function(cv){return bW.Equals(cv.cubType,ct)?{$:1,$0:cv}:null;},cu.modCubes);};bs.getCubeR=function(ct,cu){return l.ofOption(function(){return{$:3,$0:ct};},((bs.getCubeO())(ct))(cu));};bs.getCalcR=function(ct,cu){return l.ofOption(function(){return{$:5,$0:ct};},bs.getCalcO(ct,cu));};bs.getCubeO=function(){bI.$cctor();return bI.getCubeO;};bs.getCalcO=function(ct,cu){return bP.tryFind(function(cv){return bW.Equals(cv.calId,ct);},cu.modCalculations);};bs.getDimR=function(){bI.$cctor();return bI.getDimR;};bs.getDimO=function(){bI.$cctor();return bI.getDimO;};bs.addForm=function(ct,cu,cv){return bg.New(cv.modId,cv.server,cv.actualElem,cv.modDims,cv.modCubes,bR.map(function(cw){return bW.Equals(cw.calId,ct)?bq.addFormula(cu,cw):cw;},cv.modCalculations));};bs.addCube=function(ct,cu){return bg.New(cu.modId,cu.server,cu.actualElem,cu.modDims,cu.modCubes.concat([ct]),cu.modCalculations);};bs.addDim=function(ct,cu){return bg.New(cu.modId,cu.server,cu.actualElem,cu.modDims.concat([ct]),cu.modCubes,cu.modCalculations);};bs.addCalc=function(ct,cu){return bg.New(cu.modId,cu.server,cu.actualElem,cu.modDims,cu.modCubes,cu.modCalculations.concat([ct]));};bs.addForms=function(ct,cu){return bg.New(cu.modId,cu.server,cu.actualElem,cu.modDims,cu.modCubes,bR.map(function(cv){var cw,cx;function cy(cz){return cz[0];}return bq.addFormulas(bP.map(function(cz){return cz[1];},bP.filter((cw=(cx=cv.calId,function(cz){return bW.Equals(cx,cz);}),function(cz){return cw(cy(cz));}),ct)),cv);},cu.modCalculations));};bs.addCubes=function(ct,cu){return bg.New(cu.modId,cu.server,cu.actualElem,cu.modDims,bs.mergeBy(function(cv){return cv.cubId;},ct,cu.modCubes),cu.modCalculations);};bs.addDims=function(ct,cu){return bg.New(cu.modId,cu.server,cu.actualElem,bs.mergeBy(function(cv){return cv.dimId;},ct,cu.modDims),cu.modCubes,cu.modCalculations);};bs.addCalcs=function(ct,cu){return bg.New(cu.modId,cu.server,cu.actualElem,cu.modDims,cu.modCubes,bs.mergeBy(function(cv){return cv.calId;},ct,cu.modCalculations));};bs.mergeBy=function(ct,cu,cv){return bR.ofSeq(cu).concat(bR.filter(function(cw){return!bP.contains(ct(cw),bP.map(ct,cu));},cv));};bt.getDimDest=function(ct,cu){return bP.tryPick(function(cv){return bW.Equals(bm.dimId(cv),ct.dimId)?{$:1,$0:cv}:null;},cu.forDestination);};bt.setOrder=function(ct,cu){return $.New(cu.forId,cu.forDestDecl,cu.forDestination,cu.forDescription,cu.forText,cu.forExpression,cu.forType,ct);};bt.setText=function(ct,cu){return $.New(cu.forId,cu.forDestDecl,cu.forDestination,cu.forDescription,ct,cu.forExpression,cu.forType,cu.forOrder);};bt.conso=function(ct){return $.New(ct.forId,ct.forDestDecl,ct.forDestination,ct.forDescription,ct.forText,ct.forExpression,_.ForConsolidated,ct.forOrder);};bu.conso=function(ct){return be.New(ct.rulId,ct.rulSourceId,ct.rulDescription,ct.rulDestination,ct.rulExpression,_.ForConsolidated,ct.rulOrder,ct.rulXml);};bu.New=function(){return be.New(new _0({$:0,$0:b6.NewGuid()}),null,"",bQ.T.Empty,_8.ExiStet,_.ForBase,"","");};bv.New=function(){return _1.New(new T({$:0,$0:b6.NewGuid()}),"",Q.AtString,1);};N.ofOptS=function(ct){function cu(){return new d({$:4,$0:ct});}return function(cv){return l.ofOption(cu,cv);};};N.ofOptF=function(ct){function cu(){return new d({$:4,$0:ct()});}return function(cv){return l.ofOption(cu,cv);};};N.calcSlice=function(ct){return _9.New(new b8.New([]),{$:1,$0:ct.calId},null);};N.Map_adds=function(ct,cu){return new b8.New(bP.append(ca.ToSeq(cu),ct));};N.Xmodel=function(){bI.$cctor();return bI.Xmodel;};bx.TemplatesFileName=function(){bI.$cctor();return bI.TemplatesFileName;};bx.rootdir=function(){bI.$cctor();return bI.rootdir;};by.TreeNodeId={$:0};bz.New=function(ct,cu,cv,cw){return{major:ct,minor:cu,majorDate:cv,minorDate:cw};};bA.incrementMajor=function(ct){return bz.New(ct.major+1,0,function(cu){return cu.getFullYear()+"-"+("0"+(cu.getMonth()+1)).slice(-2)+"-"+("0"+cu.getDay()).slice(-2)+" "+("0"+cu.getHours()).slice(-2)+":"+("0"+cu.getMinutes()).slice(-2)+":"+("0"+cu.getSeconds()).slice(-2)+":"+("00"+cu.getMilliseconds()).slice(-3);}(new a.Date(cb.now())),function(cu){return cu.getFullYear()+"-"+("0"+(cu.getMonth()+1)).slice(-2)+"-"+("0"+cu.getDay()).slice(-2)+" "+("0"+cu.getHours()).slice(-2)+":"+("0"+cu.getMinutes()).slice(-2)+":"+("0"+cu.getSeconds()).slice(-2)+":"+("00"+cu.getMilliseconds()).slice(-3);}(new cb(cb.now())));};bA.incrementMinor=function(ct){return bz.New(ct.major,ct.minor+1,ct.majorDate,function(cu){return cu.getFullYear()+"-"+("0"+(cu.getMonth()+1)).slice(-2)+"-"+("0"+cu.getDay()).slice(-2)+" "+("0"+cu.getHours()).slice(-2)+":"+("0"+cu.getMinutes()).slice(-2)+":"+("0"+cu.getSeconds()).slice(-2)+":"+("00"+cu.getMilliseconds()).slice(-3);}(new cb(cb.now())));};bA.New=function(){return bz.New(0,0,"","");};bB.New=function(ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ){return{calculations:ct,totals:cu,dimensions:cv,cubes:cw,globalDefs:cx,server:cy,selection:cz,selectedDim:cA,selectedCube:cB,collapsed:cC,cubePrefix:cD,measurePrefix:cE,outputMsgs:cF,codeFS:cG,parserMsgs:cH,fileName:cI,version:cJ};};bC.NoOp={$:24};bC.AddDimension={$:13};bC.AddCalculation={$:3};bC.AddTotal={$:0};bD.getDimsCubeO=a.id;bD.refreshNow=function(){bI.$cctor();return bI.refreshNow;};bD.refreshView=function(){bI.$cctor();return bI.refreshView;};bD.nonFormulaV=function(){bI.$cctor();return bI.nonFormulaV;};bD.nonCalculationV=function(){bI.$cctor();return bI.nonCalculationV;};bD.nonTotalV=function(){bI.$cctor();return bI.nonTotalV;};bD.nonFormula=function(){bI.$cctor();return bI.nonFormula;};bD.nonCalculation=function(){bI.$cctor();return bI.nonCalculation;};bD.nonTotal=function(){bI.$cctor();return bI.nonTotal;};bD.selectedString=function(ct,cu){return b1.Map(function(cv){return cv?ct:"";},cu);};bE.appendParser=function(ct){bE.appendText(bE.model().parserMsgs,ct);};bE.appendMsgs=function(ct){bE.appendText(bE.model().outputMsgs,ct);};bE.appendText=function(ct,cu){var cv;ct.Set((cv=ct.Get(),cv===""?cu:cu===""?cv:cv+"\n"+cu));};bE.processor=function(){bI.$cctor();return bI.processor;};bE.set_processor=function(ct){bI.$cctor();bI.processor=ct;};bE.model=function(){bI.$cctor();return bI.model;};bF.tableDimensions$2008$48=function(ct){return function(){(bE.processor())({$:15,$0:ct});};};bF.tableDimensions$2007$48=function(ct){return function(){(bE.processor())({$:14,$0:ct});};};bF.tableDimensions=function(){var ct,cu,cv,cw,cx;return(ct=(cu=(cv=bE.model().dimensions,D.docLensMapView(bo.filterSort(bF.dtypes()),function(cy,cz){var cA,cB,cC,cD,cE,cF,cG,cH,cI,cJ,cK,cL;function cM(cN){return b$.string(cN,{$:1,$0:2},null);}return(cA=(cB=(cC=(cD=cc.Lens(cz,function(cN){return cN.dimFreeze;},function(cN,cO){return _3.New(cN.dimId,cN.dimName,cN.dimPrefix,cN.dimOrder,cN.dimExclude,cO,cN.dimType,cN.defaultElm,cN.dimElements,cN.dimAttributes,cN.isCalcDim);}),(cE=cc.Lens(cz,function(cN){return cN.dimExclude;},function(cN,cO){return _3.New(cN.dimId,cN.dimName,cN.dimPrefix,cN.dimOrder,cO,cN.dimFreeze,cN.dimType,cN.defaultElm,cN.dimElements,cN.dimAttributes,cN.isCalcDim);}),(cF=cc.Lens(cc.Lens(cz,function(cN){return cN.dimType;},function(cN,cO){return _3.New(cN.dimId,cN.dimName,cN.dimPrefix,cN.dimOrder,cN.dimExclude,cN.dimFreeze,cO,cN.defaultElm,cN.dimElements,cN.dimAttributes,cN.isCalcDim);}),(cG=function(cN){return function(cO){return cN(bK.p(cO));};}(a.id),function(cN){return cM(cG(cN));}),function(cN,cO){return cO==="DataType"?O.DtDataType:cO==="Time"?O.DtTime:cO==="Version"?O.DtVersion:O.DtOther;}),(cH=cc.Lens(cz,function(cN){return cN.dimOrder;},function(cN,cO){return _3.New(cN.dimId,cN.dimName,cN.dimPrefix,cO,cN.dimExclude,cN.dimFreeze,cN.dimType,cN.defaultElm,cN.dimElements,cN.dimAttributes,cN.isCalcDim);}),(cI=cc.Lens(cz,function(cN){return cN.dimPrefix;},function(cN,cO){return _3.New(cN.dimId,cN.dimName,cO,cN.dimOrder,cN.dimExclude,cN.dimFreeze,cN.dimType,cN.defaultElm,cN.dimElements,cN.dimAttributes,cN.isCalcDim);}),(cJ=cc.Lens(cz,function(cN){return cN.dimName;},function(cN,cO){return _3.New(cN.dimId,cO,cN.dimPrefix,cN.dimOrder,cN.dimExclude,cN.dimFreeze,cN.dimType,cN.defaultElm,cN.dimElements,cN.dimAttributes,cN.isCalcDim);}),cg.Make().WithHole({$:8,$0:"name",$1:cJ})).WithHole({$:8,$0:"abbreviation",$1:cI})).WithHole({$:8,$0:"order",$1:cH})).WithHole({$:8,$0:"type",$1:cF})).WithHole({$:9,$0:"excludename",$1:cE})).WithHole({$:9,$0:"includefreeze",$1:cD})),cC.WithHole(ch.EventQ2(cC.k,"remove",function(){return cC.i;},function(){(bE.processor())({$:14,$0:cy});}))),cB.WithHole(ch.EventQ2(cB.k,"select",function(){return cB.i;},function(){(bE.processor())({$:15,$0:cy});}))),(cK=ch.CompleteHoles(cA.k,cA.h,[["name",0],["abbreviation",0],["order",0],["type",0],["excludename",2],["includefreeze",2]]),(cL=new ci.New(cK[1],bJ.dimensionrow(cK[0])),(cA.i=cL,cL)))).get_Doc();},cv)),cg.Make().WithHole({$:0,$0:"tbody",$1:cu})),(cw=ch.CompleteHoles(ct.k,ct.h,[]),(cx=new ci.New(cw[1],bJ.dimensiontable(cw[0])),(ct.i=cx,cx)))).get_Doc();};bF.dtypes=function(){bI.$cctor();return bI.dtypes;};bG.mainProgram=function(){var ct,cu,cv,cw,cx,cy;cj.addPlugIn(ck.New("RuleEditor",[cj.newVar("fileName",bE.model().fileName),cj.newVar("Server",bE.model().server)],[],[cj.newDoc("Dimensions",cl.Create(bF.tableDimensions))],[cj.newActF("LoadFile",{$:1,$0:function(cz){(bE.processor())({$:23,$0:cz});},$1:"FileElement"}),cj.newActF("SaveAs",{$:1,$0:function(cz){(bE.processor())({$:22,$0:cz});},$1:"FileElement"}),cj.newAct("AddDimension",function(){(bE.processor())(bC.AddDimension);})],[]));cm.addLayout((ct=(cu=self.document.getElementById("GlobalLayout"),bW.Equals(cu,null)?"\r\n                    menuEditor       horizontal  65       menuLogo                  editorMessages\r\n                    double           horizontal  0-50-100 AppFramework.AppFwkClient menuEditor\r\n                    menuLogo         vertical    350      logo                      menu\r\n                    logo             span       \"margin:0; color:gray; font-size: 55px; font-weight:530\" \"F# Station\"\r\n                    editorMessages   horizontal 10-83-100 editorButtons             messages\r\n                    messages         vertical   0-50-100  messagesLeft              messagesRight\r\n                    editorButtons    vertical -200 snippetsSnippet buttons\r\n                    buttons div      \"overflow: hidden; display: grid; grid-template-columns: 100%; grid-template-rows: repeat(15, calc(100% / 15)); bxackground-color: #eee; box-sizing: border-box; padding : 5px; grid-gap: 5px; margin-right: 21px\" btnSaveAs none x btnAddSnippet btnDeleteSnippet btnIndentIn btnIndentOut none x btnRunFS none x btnAbortFsi\r\n                    snippetsSnippet  vertical   0-20-100  snippets                  editorProperties\r\n                    snippets         horizontal 20        \"${FSharpStation.CurrentPath}\" FSharpStation.Snippets\r\n                    editorProperties vertical   0-100-100 snippet                   properties\r\n                    properties       div        \"\"        FSharpStation.Properties\r\n                    snippet          horizontal 35        Name                      FSharpStation.editor\r\n                    menu             span  \"\" btnLoad btnImport\r\n        \r\n                    btnSaveAs        button FSharpStation.SaveAs         \"class=btn ${FSharpStation.SaveNeeded}\" \"Save as...    \"\r\n                    btnAddDimension  button RuleEditor.AddDimension      \"\"                  \"Add Dimension \"\r\n                    btnDeleteSnippet button FSharpStation.RemoveSnippet  \"\"                  \"Delete Snippet\"\r\n                    btnIndentIn      button FSharpStation.IndentIn       \"\"                  \"Indent In  >> \"\r\n                    btnIndentOut     button FSharpStation.IndentOut      \"\"                  \"Indent Out << \"\r\n                    btnRunFS         button FSharpStation.RunFS          \"\"                  \"Run F#        \"\r\n                    btnAbortFsi      button FSharpStation.AbortFsi       \"\"                  \"Abort Fsi     \"\r\n        \r\n                    messagesLeft     wcomp-tabstrip                      \"\"                  Output FsCode\r\n                    messagesRight    wcomp-tabstrip                      \"\"                  Parser\r\n        \r\n                    Output           textarea  FSharpStation.Output      \"tabname=Output ; placeholder=Output messages ; spellcheck=false\" \r\n                    FsCode           textarea  FSharpStation.FsCode      \"tabname=F# Code; placeholder=F# Code         ; spellcheck=false\" \r\n                    Parser           textarea  FSharpStation.Parser      \"tabname=Parser ; placeholder=Parser messages; dblclick=${FSharpStation.JumpTo} ; spellcheck=false\" \r\n                    Name             Doc       InputLabel                \"\"     \"Name:\"        FSharpStation.SnippetName\r\n                    btnLoad          Doc       InputFile                 \"\"     \"Load File...\" FSharpStation.LoadFile  FileName\r\n                    btnImport        Doc       InputFile                 \"\"     \"Import...\"    FSharpStation.Import    \"\"\r\n                    FileName         div                                 \"class=form-control\"  FSharpStation.fileName\r\n                   ":cu.textContent),cm.newLyt(bG.RuleEditorLyt(),ct)));cv=(cw=null,(cx=bG.RuleEditorLyt(),cw==null?cx:cw.$0));cj.mainDocV().Set(cv);return b4.Async((cy=null,bS.Delay(function(){return bS.Return(cj.getMainDoc().f());})));};bG.scrollToBottom=function(ct,cu){var cv;bS.Start((cv=null,bS.Delay(function(){return bS.Bind(bS.Sleep(100),function(){ct.scrollTop=ct.scrollHeight;return bS.Zero();});})),null);};bG.RuleEditorLyt=function(){bI.$cctor();return bI.RuleEditorLyt;};bH.updateModel=function(ct,cu){if(bH.updateModelR(ct,cu))(bD.refreshNow())();};bH.updateModelR=function(ct,cu){var cv;if(cu.$==13){cv=bo.New("");ct.dimensions.Append(cv);return bH.updateModelR(ct,{$:15,$0:cv.dimId});}else throw new cn.New("D:\\Abe\\CIPHERWorkspace\\FSharpStation\\projects\\RuleEditor\\src\\RuleEditor.fs",2158,22);};bI.$cctor=function(){var ct,cu,cv,cw,cx;bI.$cctor=a.ignore;bI.rtn=function(cy){return[cy];};bI.result=new m.New();bI.result$1=l.result();bI.fusion=new r.New();bI.fusion$1=new v.New();bI.parseDateO=w.tryParseWith$1(function(cy){var cz,cA;cz=0;return[(cA=co.TryParse(cy),cA!=null&&cA.$==1&&(cz=cA.$0,true)),cz];});bI.parseIntO=w.tryParseWith$1(function(cy){var cz;cz=0;return[cp.TryParseInt32(cy,{get:function(){return cz;},set:function(cA){cz=cA;}}),cz];});bI.parseSingleO=w.tryParseWith$1(function(cy){var cz,cA;cz=0;return[(cA=a.Number(cy),a.isNaN(cA)?false:(cz=cA,true)),cz];});bI.parseDoubleO=w.tryParseWith$1(function(cy){var cz,cA;cz=0;return[(cA=a.Number(cy),a.isNaN(cA)?false:(cz=cA,true)),cz];});bI.parseGuidO=w.tryParseWith$1(function(cy){var cz;cz=null;return[b6.TryParse(cy,{get:function(){return cz;},set:function(cA){cz=cA;}}),cz];});bI["|Date|_|"]=w.parseDateO$1();bI["|Int|_|"]=w.parseIntO$1();bI["|Single|_|"]=w.parseSingleO$1();bI["|Double|_|"]=w.parseDoubleO$1();bI["|Guid|_|"]=w.parseGuidO$1();bI.counter=1;bI.MessageBrokerId="<MessageBroker>";bI.MessageBrokerAddress=new G({$:0,$0:F.MessageBrokerId()});bI.Xmodel=bg.New(new S({$:0,$0:b6.NewGuid()}),"local\\Budget","Actual",[],[],[]);bI.forAll=_9.New(new b8.New([]),null,null);bI.getDimO=function(cy){return function(cz){return bk.getDimO(cy,cz);};};bI.getDimR=function(cy){return function(cz){return bk.getDimR(cy,cz);};};bI.getCubeO=function(cy){return function(cz){return bk.getCubeO(cy,cz);};};bI.cubePrefix="Z";bI.measurePrefix="M";bI.rootdir="..\\website";bI.TemplatesFileName="..\\website"+"\\Templates.html";((function(cy){return function(cz){return cy(bN.toSafe(cz));};}(function(cy){bZ.log(cy);}))("..\\website\\Templates.html"));bI.nonTotal=(ct=br.New(),bb.New(new Y({$:0,$0:"00000000-0000-0000-0000-000000000000"}),ct.totName,ct.totOrder,ct.totFormat,ct.children));bI.nonCalculation=(cu=bq.New(),ba.New(new X({$:0,$0:"00000000-0000-0000-0000-000000000000"}),cu.calName,cu.calDescription,cu.calOrder,cu.format,cu.isText,cu.isInput,cu.isBalance,cu.calDims,cu.calFormulas,cu.cubIdO,cu.properties));bI.nonFormula=(cv=$.New(new Z({$:0,$0:b6.NewGuid()}),new b8.New([]),bQ.T.Empty,"","",_8.ExiStet,_.ForBase,""),$.New(new Z({$:0,$0:"00000000-0000-0000-0000-000000000000"}),cv.forDestDecl,cv.forDestination,cv.forDescription,cv.forText,cv.forExpression,cv.forType,cv.forOrder));bI.nonTotalV=cc.Lens(cc.Create$1(bD.nonFormula()),a.id,a.id);bI.nonCalculationV=cc.Lens(cc.Create$1(bD.nonCalculation()),a.id,a.id);bI.nonFormulaV=cc.Lens(cc.Create$1(bD.nonFormula()),a.id,a.id);cx=(cw=cc.Create$1(),[cw.get_View(),function(){cw.Set(null);}]);bI.refreshView=cx[0];bI.refreshNow=cx[1];bI.model=bB.New(cq.Create(function(cy){return cy.calId;},[]),cq.Create(function(cy){return cy.totId;},[]),cq.Create(function(cy){return cy.dimId;},[]),cq.Create(function(cy){return cy.cubId;},[]),cc.Create$1(""),cc.Create$1(""),cc.Create$1(null),cc.Create$1(null),cc.Create$1(null),cq.Create(a.id,[]),cc.Create$1("Z"),cc.Create$1("M"),cc.Create$1(""),cc.Create$1(""),cc.Create$1(""),cc.Create$1("NewFile.json"),cc.Create$1(bA.New()));bI.processor=a.ignore;bI.dtypes=bQ.ofArray([O.DtDataType,O.DtTime,O.DtVersion,O.DtOther]);bI.RuleEditorLyt="RuleEditorLyt";bE.set_processor(function(cy){bH.updateModel(bE.model(),cy);});};bJ.dimensiontable=function(ct){cs.LoadLocalTemplates("templates");return ct?cs.NamedTemplate("templates",{$:1,$0:"dimensiontable"},ct):void 0;};bJ.dimensionrow=function(ct){cs.LoadLocalTemplates("templates");return ct?cs.NamedTemplate("templates",{$:1,$0:"dimensionrow"},ct):void 0;};bK.p=function(ct){return ct.$==6?"DtOther":ct.$==5?"DtMeasure":ct.$==4?"DtCalc":ct.$==3?"DtTCalc":ct.$==2?"DtVersion":ct.$==1?"DtTime":"DtDataType";};}());

//# sourceMappingURL=RuleEditor.min.map