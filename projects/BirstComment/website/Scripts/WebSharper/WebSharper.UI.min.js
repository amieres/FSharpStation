(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3;a=self;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Array=c.Array||{};e=c.String=c.String||{};f=c.List=c.List||{};g=c.Abbrev=c.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=b&&b.Obj;l=g.Slot=g.Slot||{};m=g.Async=g.Async||{};n=g.Mailbox=g.Mailbox||{};o=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};p=c.AppendList=c.AppendList||{};q=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};r=c.DomUtility=c.DomUtility||{};s=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};t=c.Trie=c.Trie||{};u=t.LookupResult=t.LookupResult||{};v=a.StartupCode$WebSharper_UI$Trie=a.StartupCode$WebSharper_UI$Trie||{};w=c.Snap=c.Snap||{};x=c.Var=c.Var||{};y=c.View=c.View||{};z=c.ConcreteVar=c.ConcreteVar||{};A=c.Var$1=c.Var$1||{};B=c.Updates=c.Updates||{};C=c.FromView=c.FromView||{};D=c.ViewBuilder=c.ViewBuilder||{};E=c.Submitter=c.Submitter||{};F=c.Key=c.Key||{};G=c.Model=c.Model||{};H=c.Serializer=c.Serializer||{};I=c.Storage=c.Storage||{};J=I.ArrayStorage=I.ArrayStorage||{};K=I.LocalStorageBackend=I.LocalStorageBackend||{};L=c.ListModel=c.ListModel||{};M=c.ListModels=c.ListModels||{};N=a.StartupCode$WebSharper_UI$Models=a.StartupCode$WebSharper_UI$Models||{};O=c.ReactiveExtensions=c.ReactiveExtensions||{};P=c.DoubleInterpolation=c.DoubleInterpolation||{};Q=c.Interpolation=c.Interpolation||{};R=c.Easing=c.Easing||{};S=c.Easings=c.Easings||{};T=c.An=c.An||{};U=c.Anims=c.Anims||{};V=c.Trans=c.Trans||{};W=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};X=b&&b.Web;Y=X&&X.Control;Z=c.OnAfterRenderControl=c.OnAfterRenderControl||{};_0=c.AnimatedAttrNode=c.AnimatedAttrNode||{};_1=c.DynamicAttrNode=c.DynamicAttrNode||{};_2=c.AttrProxy=c.AttrProxy||{};_3=c.Client=c.Client||{};_4=_3.Attrs=_3.Attrs||{};_5=_4.Dyn=_4.Dyn||{};_6=c.Attrs=c.Attrs||{};_7=c.CheckedInput=c.CheckedInput||{};_8=c.AttrModule=c.AttrModule||{};_9=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};_=_3.Settings=_3.Settings||{};$=c.DocElemNode=c.DocElemNode||{};ba=_3.Docs=_3.Docs||{};bb=ba.DomNodes=ba.DomNodes||{};bc=ba.NodeSet=ba.NodeSet||{};bd=ba.RunState=ba.RunState||{};be=c.Docs=c.Docs||{};bf=c.Doc=c.Doc||{};bg=c.Elt=c.Elt||{};bh=_3.EltUpdater=_3.EltUpdater||{};bi=a.StartupCode$WebSharper_UI$Doc_Proxy=a.StartupCode$WebSharper_UI$Doc_Proxy||{};bj=_3.Templates=_3.Templates||{};bk=bj.Prepare=bj.Prepare||{};bl=a.StartupCode$WebSharper_UI$Templates=a.StartupCode$WebSharper_UI$Templates||{};bm=c.Flow=c.Flow||{};bn=c.FlowBuilder=c.FlowBuilder||{};bo=c.HtmlModule=c.HtmlModule||{};bp=bo.attr=bo.attr||{};bq=c.Router=c.Router||{};br=c.Route=c.Route||{};bs=c.Routing=c.Routing||{};bt=c.RouteMap=c.RouteMap||{};bu=c.Input=c.Input||{};bv=bu.MousePosSt=bu.MousePosSt||{};bw=bu.MouseBtnSt=bu.MouseBtnSt||{};bx=bu.Mouse=bu.Mouse||{};by=bu.KeyListenerSt=bu.KeyListenerSt||{};bz=bu.Keyboard=bu.Keyboard||{};bA=a.StartupCode$WebSharper_UI$Input=a.StartupCode$WebSharper_UI$Input||{};bB=b&&b.List;bC=b&&b.Arrays;bD=b&&b.Enumerator;bE=b&&b.Strings;bF=b&&b.Char;bG=b&&b.Collections;bH=bG&&bG.HashSet;bI=b&&b.Seq;bJ=a.IntelliFactory;bK=bJ&&bJ.Runtime;bL=b&&b.Unchecked;bM=a.console;bN=b&&b.Concurrency;bO=bG&&bG.Map;bP=bG&&bG.FSharpMap;bQ=b&&b.Operators;bR=b&&b.Queue;bS=b&&b.Lazy;bT=bG&&bG.Dictionary;bU=a.JSON;bV=b&&b.Numeric;bW=a.Node;bX=a.jQuery;bY=b&&b.Slice;bZ=b&&b.Sitelets;b0=bZ&&bZ.RouterModule;b1=bZ&&bZ.Route;b2=b&&b.Utils;b3=b&&b.Option;d.mapInPlace=function(b4,b5){var b6,b7;for(b6=0,b7=b5.length-1;b6<=b7;b6++)b5[b6]=b4(b5[b6]);return b5;};d.ofSeqNonCopying=function(b4){var b5,b6;if(b4 instanceof a.Array)return b4;else if(b4 instanceof bB.T)return bC.ofList(b4);else if(b4===null)return[];else{b5=[];b6=bD.Get(b4);try{while(b6.MoveNext())b5.push(b6.Current());return b5;}finally{if(typeof b6=="object"&&"Dispose"in b6)b6.Dispose();}}};d.MapTreeReduce=function(b4,b5,b6,b7){var b8;function b9(b_,b$){var ca,cb;return b$<=0?b5:b$===1&&(b_>=0&&b_<b8)?b4(bC.get(b7,b_)):(cb=b$/2>>0,b6(b9(b_,cb),b9(b_+cb,b$-cb)));}b8=bC.length(b7);return b9(0,b8);};d.TreeReduce=function(b4,b5,b6){var b7;function b8(b9,b_){var b$,ca;return b_<=0?b4:b_===1&&(b9>=0&&b9<b7)?bC.get(b6,b9):(ca=b_/2>>0,b5(b8(b9,ca),b8(b9+ca,b_-ca)));}b7=bC.length(b6);return b8(0,b7);};e.isBlank=function(b4){return bE.forall(bF.IsWhiteSpace,b4);};f.maybeReplaceFirst=function(b4,b5,b6){var b7;b7=[false];return bB.map(function(b8){var b9;return!b7[0]&&b4(b8)?(b9=b5(b8),b9==null?b8:b9.$0):b8;},b6);};f.replaceFirst=function(b4,b5,b6){var b7;b7=[false];return bB.map(function(b8){return!b7[0]&&b4(b8)?b5(b8):b8;},b6);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){o.$cctor();return o.counter;};h.set_counter=function(b4){o.$cctor();o.counter=b4;};i.Filter=function(b4,b5){return new bH.New$2(bC.filter(b4,i.ToArray(b5)));};i.Intersect=function(b4,b5){var b6;b6=new bH.New$2(i.ToArray(b4));b6.IntersectWith(i.ToArray(b5));return b6;};i.Except=function(b4,b5){var b6;b6=new bH.New$2(i.ToArray(b5));b6.ExceptWith(i.ToArray(b4));return b6;};i.ToArray=function(b4){var b5;b5=bC.create(b4.get_Count(),void 0);b4.CopyTo(b5);return b5;};j.ToValueArray=function(b4){var b5;b5=bC.create(b4.count,void 0);bI.iteri(function(b6,b7){return bC.set(b5,b6,b7.V);},b4);return b5;};j.ToKeyArray=function(b4){var b5;b5=bC.create(b4.count,void 0);bI.iteri(function(b6,b7){return bC.set(b5,b6,b7.K);},b4);return b5;};l=g.Slot=bK.Class({GetHashCode:function(){return bL.Hash(this.key(this.value));},Equals:function(b4){return bL.Equals(this.key(this.value),this.key(b4.get_Value()));},get_Value:function(){return this.value;}},k,l);l.New=bK.Ctor(function(b4,b5){k.New.call(this);this.key=b4;this.value=b5;},l);l.Create=function(b4,b5){return new l.New(b4,b5);};m.OnError=function(b4){return bM.log("WebSharper UI: Uncaught asynchronous exception",b4);};m.StartTo=function(b4,b5){bN.StartWithContinuations(b4,b5,function(b6){m.OnError(b6);},a.ignore,null);};n.StartProcessor=function(b4){var b5;function b6(){var b7;b7=null;return bN.Delay(function(){return bN.Bind(b4,function(){var b8;b8=b5[0];return b8===1?(b5[0]=0,bN.Zero()):b8===2?(b5[0]=1,b6()):bN.Zero();});});}b5=[0];return function(){var b7;b7=b5[0];b7===0?(b5[0]=1,bN.Start(b6(),null)):b7===1?b5[0]=2:void 0;};};o.$cctor=function(){o.$cctor=a.ignore;o.counter=0;};p.FromArray=function(b4){var b5;b5=b4.length;return b5===0?{$:0}:b5===1?{$:1,$0:bC.get(b4,0)}:{$:3,$0:b4.slice()};};p.ToArray=function(b4){var b5;function b6(b7){if(b7.$==1)b5.push(b7.$0);else if(b7.$==2){b6(b7.$0);b6(b7.$1);}else if(b7.$==3)bC.iter(function(b8){b5.push(b8);},b7.$0);}b5=[];b6(b4);return b5.slice(0);};p.Single=function(b4){return{$:1,$0:b4};};p.Concat=function(b4){var b5;b5=d.ofSeqNonCopying(b4);return d.TreeReduce(p.Empty(),p.Append,b5);};p.Append=function(b4,b5){return b4.$==0?b5:b5.$==0?b4:{$:2,$0:b4,$1:b5};};p.Empty=function(){q.$cctor();return q.Empty;};q.$cctor=function(){q.$cctor=a.ignore;q.Empty={$:0};};r.SetProperty=function(b4,b5,b6){return b4.setProperty(b5,b6);};r.IterSelector=function(b4,b5,b6){var b7,b8,b9;b7=b4.querySelectorAll(b5);for(b8=0,b9=b7.length-1;b8<=b9;b8++)b6(b7[b8]);};r.ChildrenArray=function(b4){var b5,b6,b7;b5=[];for(b6=0,b7=b4.childNodes.length-1;b6<=b7;b6++)b5.push(b4.childNodes[b6]);return b5;};r.RemoveClass=function(b4,b5){var b6;r.setClass(b4,(b6=r.clsRE(b5),r.getClass(b4).replace(b6,function(b7,b8,b9){return b8===""||b9===""?"":" ";})));};r.AddClass=function(b4,b5){var b6;b6=r.getClass(b4);b6===""?r.setClass(b4,b5):!r.clsRE(b5).test(b6)?r.setClass(b4,b6+" "+b5):void 0;};r.setClass=function(b4,b5){if(b4 instanceof a.SVGElement)b4.setAttribute("class",b5);else b4.className=b5;};r.getClass=function(b4){return b4 instanceof a.SVGElement?b4.getAttribute("class"):b4.className;};r.clsRE=function(b4){return new a.RegExp("(\\s+|^)"+b4+"(?:\\s+"+b4+")*(\\s+|$)","g");};r.InsertAt=function(b4,b5,b6){var b7;if(!(b6.parentNode===b4&&b5===(b7=b6.nextSibling,bL.Equals(b7,null)?null:b7)))b4.insertBefore(b6,b5);};r.RemoveNode=function(b4,b5){if(b5.parentNode===b4)b4.removeChild(b5);};r.SetStyle=function(b4,b5,b6){r.SetProperty(b4.style,b5,b6);};r.SetAttr=function(b4,b5,b6){b4.setAttribute(b5,b6);};r.RemoveAttr=function(b4,b5){b4.removeAttribute(b5);};r.CreateAttr=function(b4,b5){var b6;b6=r.Doc().createAttribute(b4);b6.value=b5;return b6;};r.CreateText=function(b4){return r.Doc().createTextNode(b4);};r.CreateSvgElement=function(b4){return r.Doc().createElementNS("http://www.w3.org/2000/svg",b4);};r.CreateElement=function(b4){return r.Doc().createElement(b4);};r.Clear=function(b4){while(b4.hasChildNodes())b4.removeChild(b4.firstChild);};r.ClearAttrs=function(b4){while(b4.hasAttributes())b4.removeAttributeNode(b4.attributes.item(0));};r.AppendTo=function(b4,b5){b4.appendChild(b5);};r.Doc=function(){s.$cctor();return s.Doc;};s.$cctor=function(){s.$cctor=a.ignore;s.Doc=self.document;};u.NotFound={$:1};t.Empty=function(){v.$cctor();return v.Empty;};t.Lookup=function(b4,b5){return t.Look(bB.ofSeq(b5),b4);};t.Look=function(b4,b5){var b6,b7;switch(b5.$==2?(b6=b5.$0,0):b5.$==0?b4.$==1?(b6=[b4.$0,b4.$1,b5.$0],1):2:2){case 0:return{$:0,$0:b6,$1:b4};case 1:b7=bO.TryFind(b6[0],b6[2]);return b7==null?u.NotFound:t.Look(b6[1],b7.$0);case 2:return u.NotFound;}};t.ToArray=function(b4){var b5;b5=[];t.Map(function(){return function(b6){return b5.push(b6);};},b4);return b5.slice(0);};t.Mapi=function(b4,b5){var b6;function b7(){var b8;b8=b6[0];b6[0]=b8+1;return b8;}b6=[0];return t.Map(function(b8){return b4(b7(),b8);},b5);};t.Map=function(b4,b5){return t.MapLoop(bB.T.Empty,b4,b5);};t.MapLoop=function(b4,b5,b6){return b6.$==1?{$:1}:b6.$==2?{$:2,$0:(b5(b4))(b6.$0)}:t.TrieBranch(bO.Map(function(b7,b8){return t.MapLoop(bB.append(b4,bB.ofArray([b7])),b5,b8);},b6.$0));};t.Merge=function(b4){var b5,b6,b7;b5=d.ofSeqNonCopying(b4);b6=bC.length(b5);return b6===0?{$:1,$0:{$:1}}:b6===1?{$:1,$0:bC.get(b5,0)}:bC.exists(t.IsLeaf,b5)?null:(b7=t.MergeMaps(t.Merge,bI.choose(function(b8){return b8.$==0?{$:1,$0:b8.$0}:null;},b5)),b7==null?null:{$:1,$0:t.TrieBranch(b7.$0)});};t.IsLeaf=function(b4){return b4.$==2;};t.MergeMaps=function(b4,b5){var b6,b7;function b8(b9,b_){var b$;b$=b4(b_);return b$==null?null:{$:1,$0:[b9,b$.$0]};}b6=t.AllSome(bI.map(function(b9){return b8(b9[0],b9[1]);},bO.ToSeq((b7=bI.collect(bO.ToSeq,b5),bI.fold(function(b9,b_){return t.MultiAdd(b_[0],b_[1],b9);},new bP.New([]),b7)))));return b6==null?null:{$:1,$0:bO.OfArray(bC.ofSeq(b6.$0))};};t.AllSome=function(b4){var b5,b6,b7,b8;b6=bD.Get(b4);b7=[];b5=true;while(b5&&b6.MoveNext()){b8=b6.Current();b8!=null&&b8.$==1?b7.push(b8.$0):b5=false;}return b5?{$:1,$0:b7.slice()}:null;};t.MultiAdd=function(b4,b5,b6){return b6.Add(b4,new bB.T({$:1,$0:b5,$1:t.MultiFind(b4,b6)}));};t.MultiFind=function(b4,b5){var b6;b6=bO.TryFind(b4,b5);return b6==null?bB.T.Empty:b6.$0;};t.Prefix=function(b4,b5){return t.TrieBranch(new bP.New(bB.ofArray([[b4,b5]])));};t.Leaf=function(b4){return{$:2,$0:b4};};t.TrieBranch=function(b4){return b4.get_IsEmpty()?{$:1}:{$:0,$0:b4};};v.$cctor=function(){v.$cctor=a.ignore;v.Empty={$:1};};w.Obsolete=function(b4){var b5,b6,b7,b8,b9;b6=b4.s;if(b6==null||(b6!=null&&b6.$==2?(b5=b6.$1,false):b6!=null&&b6.$==3?(b5=b6.$1,false):true))void 0;else{b4.s=null;for(b7=0,b8=bC.length(b5)-1;b7<=b8;b7++){b9=bC.get(b5,b7);typeof b9=="object"?function(b_){w.Obsolete(b_);}(b9):b9();}}};w.New=function(b4){return{s:b4};};w.MapAsync=function(b4,b5){var b6;b6=w.New({$:3,$0:[],$1:[]});w.When(b5,function(b7){m.StartTo(b4(b7),function(b8){w.MarkDone(b6,b5,b8);});},b6);return b6;};w.SnapshotOn=function(b4,b5){var b6;function b7(b8){var b9,b_,b$;if(!(b9=b6.s,b9!=null&&b9.$==0||b9!=null&&b9.$==2)){b_=w.ValueAndForever(b4);b$=w.ValueAndForever(b5);b_!=null&&b_.$==1?b$!=null&&b$.$==1?b_.$0[1]||b$.$0[1]?w.MarkForever(b6,b$.$0[0]):w.MarkReady(b6,b$.$0[0]):void 0:void 0;}}b6=w.New({$:3,$0:[],$1:[]});w.When(b4,b7,b6);w.WhenReady(b5,b7);return b6;};w.Map3=function(b4,b5,b6,b7){var b8,b9,b_,b$;function ca(cb){var cc,cd,ce,cf;if(!(cc=b$.s,cc!=null&&cc.$==0||cc!=null&&cc.$==2)){cd=w.ValueAndForever(b5);ce=w.ValueAndForever(b6);cf=w.ValueAndForever(b7);cd!=null&&cd.$==1?ce!=null&&ce.$==1?cf!=null&&cf.$==1?cd.$0[1]&&ce.$0[1]&&cf.$0[1]?w.MarkForever(b$,b4(cd.$0[0],ce.$0[0],cf.$0[0])):w.MarkReady(b$,b4(cd.$0[0],ce.$0[0],cf.$0[0])):void 0:void 0:void 0;}}b8=b5.s;b9=b6.s;b_=b7.s;return b8!=null&&b8.$==0?b9!=null&&b9.$==0?b_!=null&&b_.$==0?w.New({$:0,$0:b4(b8.$0,b9.$0,b_.$0)}):w.Map3Opt1(b4,b8.$0,b9.$0,b7):b_!=null&&b_.$==0?w.Map3Opt2(b4,b8.$0,b_.$0,b6):w.Map3Opt3(b4,b8.$0,b6,b7):b9!=null&&b9.$==0?b_!=null&&b_.$==0?w.Map3Opt4(b4,b9.$0,b_.$0,b5):w.Map3Opt5(b4,b9.$0,b5,b7):b_!=null&&b_.$==0?w.Map3Opt6(b4,b_.$0,b5,b6):(b$=w.New({$:3,$0:[],$1:[]}),(w.When(b5,ca,b$),w.When(b6,ca,b$),w.When(b7,ca,b$),b$));};w.Map3Opt6=function(b4,b5,b6,b7){return w.Map2(function(b8,b9){return b4(b8,b9,b5);},b6,b7);};w.Map3Opt5=function(b4,b5,b6,b7){return w.Map2(function(b8,b9){return b4(b8,b5,b9);},b6,b7);};w.Map3Opt4=function(b4,b5,b6,b7){return w.Map(function(b8){return b4(b8,b5,b6);},b7);};w.Map3Opt3=function(b4,b5,b6,b7){return w.Map2(function(b8,b9){return b4(b5,b8,b9);},b6,b7);};w.Map3Opt2=function(b4,b5,b6,b7){return w.Map(function(b8){return b4(b5,b8,b6);},b7);};w.Map3Opt1=function(b4,b5,b6,b7){return w.Map(function(b8){return b4(b5,b6,b8);},b7);};w.Map2Unit=function(b4,b5){var b6,b7,b8;function b9(){var b_,b$,ca;if(!(b_=b8.s,b_!=null&&b_.$==0||b_!=null&&b_.$==2)){b$=w.ValueAndForever(b4);ca=w.ValueAndForever(b5);b$!=null&&b$.$==1?ca!=null&&ca.$==1?b$.$0[1]&&ca.$0[1]?w.MarkForever(b8,null):w.MarkReady(b8,null):void 0:void 0;}}b6=b4.s;b7=b5.s;return b6!=null&&b6.$==0?b7!=null&&b7.$==0?w.New({$:0,$0:null}):b5:b7!=null&&b7.$==0?b4:(b8=w.New({$:3,$0:[],$1:[]}),(w.When(b4,b9,b8),w.When(b5,b9,b8),b8));};w.Map2=function(b4,b5,b6){var b7,b8,b9;function b_(b$){var ca,cb,cc;if(!(ca=b9.s,ca!=null&&ca.$==0||ca!=null&&ca.$==2)){cb=w.ValueAndForever(b5);cc=w.ValueAndForever(b6);cb!=null&&cb.$==1?cc!=null&&cc.$==1?cb.$0[1]&&cc.$0[1]?w.MarkForever(b9,b4(cb.$0[0],cc.$0[0])):w.MarkReady(b9,b4(cb.$0[0],cc.$0[0])):void 0:void 0;}}b7=b5.s;b8=b6.s;return b7!=null&&b7.$==0?b8!=null&&b8.$==0?w.New({$:0,$0:b4(b7.$0,b8.$0)}):w.Map2Opt1(b4,b7.$0,b6):b8!=null&&b8.$==0?w.Map2Opt2(b4,b8.$0,b5):(b9=w.New({$:3,$0:[],$1:[]}),(w.When(b5,b_,b9),w.When(b6,b_,b9),b9));};w.Map2Opt2=function(b4,b5,b6){return w.Map(function(b7){return b4(b7,b5);},b6);};w.Map2Opt1=function(b4,b5,b6){return w.Map(function(b7){return b4(b5,b7);},b6);};w.MapCachedBy=function(b4,b5,b6,b7){return w.Map(function(b8){var b9,b_,b$;b9=b5[0];return b9!=null&&b9.$==1&&(b4(b8,b9.$0[0])&&(b_=[b9.$0[0],b9.$0[1]],true))?b_[1]:(b$=b6(b8),(b5[0]={$:1,$0:[b8,b$]},b$));},b7);};w.Copy=function(b4){var b5,b6,b7;b5=b4.s;return b5==null?b4:b5!=null&&b5.$==2?(b6=w.New({$:2,$0:b5.$0,$1:[]}),(w.WhenObsolete(b4,b6),b6)):b5!=null&&b5.$==3?(b7=w.New({$:3,$0:[],$1:[]}),(w.When(b4,function(b8){w.MarkDone(b7,b4,b8);},b7),b7)):b4;};w.WithInitOption=function(b4){var b5,b6,b7;b5=b4.s;return b5==null?w.New(null):b5!=null&&b5.$==2?(b6=w.New({$:2,$0:{$:1,$0:b5.$0},$1:[]}),(w.WhenObsolete(b4,b6),b6)):b5!=null&&b5.$==3?(b7=w.New({$:2,$0:null,$1:[]}),(w.When(b4,function(){w.Obsolete(b7);},b7),b7)):w.New({$:0,$0:{$:1,$0:b5.$0}});};w.WithInit=function(b4,b5){var b6,b7,b8;b6=b5.s;return b6==null?b5:b6!=null&&b6.$==2?(b7=w.New({$:2,$0:b6.$0,$1:[]}),(w.WhenObsolete(b5,b7),b7)):b6!=null&&b6.$==3?(b8=w.New({$:2,$0:b4,$1:[]}),(w.When(b5,function(){w.Obsolete(b8);},b8),b8)):b5;};w.Map=function(b4,b5){var b6,b7;b6=b5.s;return b6!=null&&b6.$==0?w.New({$:0,$0:b4(b6.$0)}):(b7=w.New({$:3,$0:[],$1:[]}),(w.When(b5,function(b8){w.MarkDone(b7,b5,b4(b8));},b7),b7));};w.Sequence=function(b4){var b5,b6,b7;function b8(b9){var b_;if(b7[0]===0){b_=bC.map(function(b$){var ca;ca=b$.s;return ca!=null&&ca.$==0?ca.$0:ca!=null&&ca.$==2?ca.$0:bQ.FailWith("value not found by View.Sequence");},b5);bC.forall(function(b$){var ca;ca=b$.s;return ca!=null&&ca.$==0;},b5)?w.MarkForever(b6,b_):w.MarkReady(b6,b_);}else b7[0]--;}b5=bC.ofSeq(b4);return b5.length==0?w.New({$:0,$0:[]}):(b6=w.New({$:3,$0:[],$1:[]}),(b7=[bC.length(b5)-1],(bC.iter(function(b9){w.When(b9,b8,b6);},b5),b6)));};w.CreateForeverAsync=function(b4){var b5;b5=w.New({$:3,$0:[],$1:[]});m.StartTo(b4,function(b6){w.MarkForever(b5,b6);});return b5;};w.JoinInner=function(b4){var b5;b5=w.New({$:3,$0:[],$1:[]});w.When(b4,function(b6){var b7;b7=b6();w.When(b7,function(b8){var b9,b_;if((b9=b7.s,b9!=null&&b9.$==0)&&(b_=b4.s,b_!=null&&b_.$==0))w.MarkForever(b5,b8);else w.MarkReady(b5,b8);},b5);w.WhenObsolete(b4,b7);},b5);return b5;};w.Join=function(b4){var b5;b5=w.New({$:3,$0:[],$1:[]});w.When(b4,function(b6){var b7;b7=b6();w.When(b7,function(b8){var b9,b_;if((b9=b7.s,b9!=null&&b9.$==0)&&(b_=b4.s,b_!=null&&b_.$==0))w.MarkForever(b5,b8);else w.MarkReady(b5,b8);},b5);},b5);return b5;};w.ValueAndForever=function(b4){var b5;b5=b4.s;return b5!=null&&b5.$==0?{$:1,$0:[b5.$0,true]}:b5!=null&&b5.$==2?{$:1,$0:[b5.$0,false]}:null;};w.WhenObsoleteRun=function(b4,b5){var b6;b6=b4.s;b6==null?b5():b6!=null&&b6.$==2?b6.$1.push(b5):b6!=null&&b6.$==3?b6.$1.push(b5):void 0;};w.WhenObsolete=function(b4,b5){var b6;b6=b4.s;b6==null?w.Obsolete(b5):b6!=null&&b6.$==2?w.EnqueueSafe(b6.$1,b5):b6!=null&&b6.$==3?w.EnqueueSafe(b6.$1,b5):void 0;};w.WhenReady=function(b4,b5){var b6,b7;b7=b4.s;switch(b7!=null&&b7.$==2?(b6=b7.$0,0):b7==null?1:b7!=null&&b7.$==3?2:(b6=b7.$0,0)){case 0:b5(b6);break;case 1:null;break;case 2:b7.$0.push(b5);break;}};w.WhenRun=function(b4,b5,b6){var b7;b7=b4.s;b7==null?b6():b7!=null&&b7.$==2?(b7.$1.push(b6),b5(b7.$0)):b7!=null&&b7.$==3?(b7.$0.push(b5),b7.$1.push(b6)):b5(b7.$0);};w.When=function(b4,b5,b6){var b7;b7=b4.s;b7==null?w.Obsolete(b6):b7!=null&&b7.$==2?(w.EnqueueSafe(b7.$1,b6),b5(b7.$0)):b7!=null&&b7.$==3?(b7.$0.push(b5),w.EnqueueSafe(b7.$1,b6)):b5(b7.$0);};w.EnqueueSafe=function(b4,b5){var b6,b7,b8,b9;b4.push(b5);if(b4.length%20===0){b6=b4.slice(0);bR.Clear(b4);for(b7=0,b8=bC.length(b6)-1;b7<=b8;b7++){b9=bC.get(b6,b7);typeof b9=="object"?function(b_){if(b_.s)b4.push(b_);}(b9):function(b_){b4.push(b_);}(b9);}}else void 0;};w.MarkDone=function(b4,b5,b6){var b7;if(b7=b5.s,b7!=null&&b7.$==0)w.MarkForever(b4,b6);else w.MarkReady(b4,b6);};w.MarkReady=function(b4,b5){var b6,b7,b8,b9;b6=b4.s;if(b6!=null&&b6.$==3){b4.s={$:2,$0:b5,$1:b6.$1};b7=b6.$0;for(b8=0,b9=bC.length(b7)-1;b8<=b9;b8++)(bC.get(b7,b8))(b5);}else void 0;};w.MarkForever=function(b4,b5){var b6,b7,b8,b9;b6=b4.s;if(b6!=null&&b6.$==3){b4.s={$:0,$0:b5};b7=b6.$0;for(b8=0,b9=bC.length(b7)-1;b8<=b9;b8++)(bC.get(b7,b8))(b5);}else void 0;};w.TryGet=function(b4){var b5,b6;b5=b4.s;return(b5!=null&&b5.$==0?(b6=b5.$0,true):b5!=null&&b5.$==2&&(b6=b5.$0,true))?{$:1,$0:b6}:null;};x=c.Var=bK.Class({},k,x);x.New=bK.Ctor(function(){k.New.call(this);},x);y=c.View=bK.Class({get_V:function(){return bQ.FailWith("View<'T>.V can only be called in an argument to a V-enabled function or if 'T = Doc.");}},null,y);z=c.ConcreteVar=bK.Class({get_Id:function(){return"uinref"+a.String(this.id);},get_View:function(){return this.view;},UpdateMaybe:function(b4){var b5;b5=b4(this.Get());b5!=null&&b5.$==1?this.Set(b5.$0):void 0;},Update:function(b4){this.Set(b4(this.Get()));},SetFinal:function(b4){if(this.isConst)(function(b5){return b5("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(b5){bM.log(b5);}));else{w.Obsolete(this.snap);this.isConst=true;this.current=b4;this.snap=w.New({$:0,$0:b4});}},Set:function(b4){if(this.isConst)(function(b5){return b5("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(b5){bM.log(b5);}));else{w.Obsolete(this.snap);this.current=b4;this.snap=w.New({$:2,$0:b4,$1:[]});}},Get:function(){return this.current;}},x,z);z.New=bK.Ctor(function(b4,b5,b6){var b7;b7=this;x.New.call(this);this.isConst=b4;this.current=b6;this.snap=b5;this.view=function(){return b7.snap;};this.id=h.Int();},z);A=c.Var$1=bK.Class({},k,A);A.MapLens=function(b4,b5,b6){return y.MapSeqCachedViewBy(b4,function(b7,b8){var b9,b_;function b$(ca){return bL.Equals(b4(ca),b7);}b9=h.Id();return b5((b_=new x({Get:function(){return bI.find(b$,b6.Get());},Set:function(ca){function cb(cc){return ca;}return b6.Update(function(cc){return f.replaceFirst(b$,cb,cc);});},SetFinal:function(ca){return this.Set(ca);},Update:function(ca){return b6.Update(function(cb){return f.replaceFirst(b$,ca,cb);});},UpdateMaybe:function(ca){return b6.Update(function(cb){return f.maybeReplaceFirst(b$,ca,cb);});},get_View:function(){return b8;},get_Id:function(){return b9;}}),(x.New.call(b_),b_)));},b6.get_View());};A.Lens=function(b4,b5,b6){var b7,b8,b9;b7=h.Id();b8=y.Map(b5,b4.get_View());b9=new x({Get:function(){return b5(b4.Get());},Set:function(b_){return b4.Update(function(b$){return b6(b$,b_);});},SetFinal:function(b_){return this.Set(b_);},Update:function(b_){return b4.Update(function(b$){return b6(b$,b_(b5(b$)));});},UpdateMaybe:function(b_){return b4.UpdateMaybe(function(b$){var ca;ca=b_(b5(b$));return ca==null?null:{$:1,$0:b6(b$,ca.$0)};});},get_View:function(){return b8;},get_Id:function(){return b7;}});x.New.call(b9);return b9;};A.Update=function(b4,b5){A.Set(b4,b5(b4.Get()));};A.SetFinal=function(b4,b5){b4.SetFinal(b5);};A.Set=function(b4,b5){b4.Set(b5);};A.CreateWaiting=function(){return new z.New(false,w.New({$:3,$0:[],$1:[]}),null);};A.Create=function(){return new z.New(false,w.New({$:2,$0:null,$1:[]}),null);};A.CreateLogged=function(b4,b5){var b6;!self.UINVars?self.UINVars=[]:void 0;b6=A.Create$1(b5);self.UINVars.push([b4,b6]);return b6;};A.Create$1=function(b4){return new z.New(false,w.New({$:2,$0:b4,$1:[]}),b4);};A.New=bK.Ctor(function(){k.New.call(this);},A);B=c.Updates=bK.Class({set_Value:function(b4){var b5;b5=this.s;!(b5===null)?w.Obsolete(b5):void 0;this.c=b4;}},null,B);B.Create=function(b4){var b5;b5=null;b5=B.New(b4,null,function(){var b6;b6=b5.s;return b6===null?(b6=w.Copy(b5.c()),b5.s=b6,w.WhenObsoleteRun(b6,function(){b5.s=null;}),b6):b6;});return b5;};B.New=function(b4,b5,b6){return new B({c:b4,s:b5,v:b6});};y.get_Do=function(){return D.B;};y.Apply=function(b4,b5){return y.Map2(function(b6,b7){return b6(b7);},b4,b5);};y.AsyncAwait=function(b4,b5){function b6(b7){var b8,b9;function b_(){return y.RemovableSink(function(b$){if(b4(b$)){(bS.Force(b8))();b7(b$);}},b5);}b8=bS.Create(b_);b9=bS.Force(b8);}return bN.FromContinuations(function(b7,b8,b9){return b6.apply(null,[b7,b8,b9]);});};y.RemovableSink=function(b4,b5){var b6;function b7(){w.WhenRun(b5(),function(b8){if(b6[0])b4(b8);},function(){if(b6[0])bN.scheduler().Fork(b7);});}b6=[true];bN.scheduler().Fork(b7);return function(){b6[0]=false;};};y.Sink=function(b4,b5){function b6(){w.WhenRun(b5(),b4,function(){bN.scheduler().Fork(b6);});}bN.scheduler().Fork(b6);};y.TryFinally=function(b4,b5){return y.CreateLazy(function(){try{return b5();}finally{b4();}});};y.TryWith=function(b4,b5){return y.CreateLazy(function(){try{return b5();}catch(b6){return(b4(b6))();}});};y.ConstAsync=function(b4){var b5;b5=w.CreateForeverAsync(b4);return function(){return b5;};};y.Const=function(b4){var b5;b5=w.New({$:0,$0:b4});return function(){return b5;};};y.Sequence=function(b4){return y.CreateLazy(function(){return w.Sequence(bI.map(function(b5){return b5();},b4));});};y.UpdateWhile=function(b4,b5,b6){var b7;b7=[b4];return y.BindInner(function(b8){return b8?y.Map(function(b9){b7[0]=b9;return b9;},b6):y.Const(b7[0]);},b5);};y.BindInner=function(b4,b5){return y.JoinInner(y.Map(b4,b5));};y.JoinInner=function(b4){return y.CreateLazy(function(){return w.JoinInner(b4());});};y.Bind=function(b4,b5){return y.Join(y.Map(b4,b5));};y.Join=function(b4){return y.CreateLazy(function(){return w.Join(b4());});};y.MapSeqCachedView=function(b4,b5){function b6(b7){return b4;}return y.MapSeqCachedViewBy(a.id,function(b7,b8){return(b6(b7))(b8);},b5);};y.MapSeqCachedViewBy=function(b4,b5,b6){var b7;b7=[new bT.New$5()];return y.Map(function(b8){var b9,b_,b$;b9=b7[0];b_=new bT.New$5();b$=d.mapInPlace(function(ca){var cb,cc,cd;cb=b4(ca);cc=b9.ContainsKey(cb)?(cd=b9.get_Item(cb),(A.Set(cd.r,ca),cd)):y.ConvertSeqNode(function(ce){return b5(cb,ce);},ca);b_.set_Item(cb,cc);return cc.e;},bC.ofSeq(b8));b7[0]=b_;return b$;},b6);};y.ConvertSeqNode=function(b4,b5){var b6,b7;b6=A.Create$1(b5);b7=b6.get_View();return{e:b4(b7),r:b6,w:b7};};y.MapSeqCached=function(b4,b5){return y.MapSeqCachedBy(a.id,b4,b5);};y.MapSeqCachedBy=function(b4,b5,b6){var b7;b7=[new bT.New$5()];return y.Map(function(b8){var b9,b_,b$;b9=b7[0];b_=new bT.New$5();b$=d.mapInPlace(function(ca){var cb,cc;cb=b4(ca);cc=b9.ContainsKey(cb)?b9.get_Item(cb):b5(ca);b_.set_Item(cb,cc);return cc;},bC.ofSeq(b8));b7[0]=b_;return b$;},b6);};y.SnapshotOn=function(b4,b5,b6){var b7;b7=w.New({$:2,$0:b4,$1:[]});return y.CreateLazy(function(){return b7.s==null?w.SnapshotOn(b5(),b6()):(w.WhenObsolete(b5(),b7),b7);});};y.GetAsync=function(b4){return bN.FromContinuations(function(b5){return y.Get(b5,b4);});};y.WithInitOption=function(b4){return y.CreateLazy(function(){return w.WithInitOption(b4());});};y.WithInit=function(b4,b5){return y.CreateLazy(function(){return w.WithInit(b4,b5());});};y.Get=function(b4,b5){var b6;function b7(){w.WhenRun(b5(),function(b8){if(!b6[0]){b6[0]=true;b4(b8);}},function(){if(!b6[0])b7();});}b6=[false];b7();};y.TryGet=function(b4){return w.TryGet(b4());};y.MapAsync2=function(b4,b5,b6){return y.MapAsync(a.id,y.Map2(b4,b5,b6));};y.MapAsync=function(b4,b5){return y.CreateLazy(function(){return w.MapAsync(b4,b5());});};y.Map3=function(b4,b5,b6,b7){return y.CreateLazy(function(){return w.Map3(b4,b5(),b6(),b7());});};y.Map2Unit=function(b4,b5){return y.CreateLazy(function(){return w.Map2Unit(b4(),b5());});};y.Map2=function(b4,b5,b6){return y.CreateLazy(function(){return w.Map2(b4,b5(),b6());});};y.MapCached=function(b4,b5){return y.MapCachedBy(bL.Equals,b4,b5);};y.MapCachedBy=function(b4,b5,b6){var b7;b7=[null];return y.CreateLazy(function(){return w.MapCachedBy(b4,b7,b5,b6());});};y.Map=function(b4,b5){return y.CreateLazy(function(){return w.Map(b4,b5());});};y.CreateLazy=function(b4){var b5;b5={c:null,o:b4};return function(){var b6,b7;b6=b5.c;return b6===null?(b6=b5.o(),b5.c=b6,(b7=b6.s,b7!=null&&b7.$==0)?b5.o=null:w.WhenObsoleteRun(b6,function(){b5.c=null;}),b6):b6;};};C=c.FromView=bK.Class({get_Id:function(){return"uinref"+a.String(this.id);},SetFinal:function(b4){this.set(b4);},Update:function(b4){var b5;y.Get((b5=this.set,function(b6){return b5(b4(b6));}),this.view);},UpdateMaybe:function(b4){var b5;b5=this;y.Get(function(b6){var b7;b7=b4(b6);b7!=null&&b7.$==1?b5.set(b7.$0):void 0;},this.view);},Set:function(b4){this.set(b4);},Get:function(){return this.current;},get_View:function(){return this.view;}},x,C);C.New=bK.Ctor(function(b4,b5){var b6,b7;b6=this;x.New.call(this);this.set=b5;this.id=h.Int();this.current=(b7=y.TryGet(b4),b7==null?null:b7.$0);this.view=y.Map(function(b8){b6.current=b8;return b8;},b4);},C);D.B={$:0};E=c.Submitter=bK.Class({Trigger:function(){this["var"].Set(null);}},k,E);E.New=bK.Ctor(function(b4,b5){k.New.call(this);this.input=b4;this["var"]=A.Create();this.view=y.SnapshotOn(b5,this["var"].get_View(),this.input);},E);E.CreateOption=function(b4){return new E.New(y.Map(function(b5){return{$:1,$0:b5};},b4),null);};F.Fresh=function(){return{$:0,$0:h.Int()};};G=c.Model=bK.Class({},k,G);G.New=bK.Ctor(function(b4,b5){var b6;b6=A.Create$1(b5);G.New$1.call(this,b6,y.Map(b4,b6.get_View()));},G);G.New$1=bK.Ctor(function(b4,b5){k.New.call(this);this["var"]=b4;this.view=b5;},G);G.Update=function(b4,b5){A.Update(b5["var"],function(b6){b4(b6);return b6;});};G.Create=function(b4,b5){return new G.New(b4,b5);};H.Default=function(){N.$cctor();return N.Default;};J=I.ArrayStorage=bK.Class({SSet:function(b4){return bC.ofSeq(b4);},SSetAt:function(b4,b5,b6){bC.set(b6,b4,b5);return b6;},SRemoveIf:function(b4,b5){return bC.filter(function(b6){return!b4(b6);},b5);},SInit:function(){return this.init;},SPrependMany:function(b4,b5){var b6;b6=d.ofSeqNonCopying(b4);b5.unshift.apply(b5,b6);return b5;},SPrepend:function(b4,b5){b5.unshift(b4);return b5;},SAppendMany:function(b4,b5){var b6;b6=d.ofSeqNonCopying(b4);b5.push.apply(b5,b6);return b5;},SAppend:function(b4,b5){b5.push(b4);return b5;}},k,J);J.New=bK.Ctor(function(b4){k.New.call(this);this.init=b4;},J);K=I.LocalStorageBackend=bK.Class({clear:function(){this.storage.removeItem(this.id);},set:function(b4){this.storage.setItem(this.id,bU.stringify(bC.map(this.serializer.Encode,b4)));return b4;},SSet:function(b4){return this.set(bC.ofSeq(b4));},SSetAt:function(b4,b5,b6){bC.set(b6,b4,b5);return this.set(b6);},SRemoveIf:function(b4,b5){return this.set(bC.filter(function(b6){return!b4(b6);},b5));},SInit:function(){var b4;b4=this.storage.getItem(this.id);if(b4===null)return[];else try{return bC.map(this.serializer.Decode,bU.parse(b4));}catch(b5){return[];}},SPrependMany:function(b4,b5){var b6;b6=d.ofSeqNonCopying(b4);b5.unshift.apply(b5,b6);return this.set(b5);},SPrepend:function(b4,b5){b5.unshift(b4);return this.set(b5);},SAppendMany:function(b4,b5){var b6;b6=d.ofSeqNonCopying(b4);b5.push.apply(b5,b6);return this.set(b5);},SAppend:function(b4,b5){b5.push(b4);return this.set(b5);}},k,K);K.New=bK.Ctor(function(b4,b5){k.New.call(this);this.id=b4;this.serializer=b5;this.storage=self.localStorage;},K);I.LocalStorage=function(b4,b5){return new K.New(b4,b5);};I.InMemory=function(b4){return new J.New(b4);};L=c.ListModel=bK.Class({Wrap:function(b4,b5,b6){return L.Wrap(this,b4,b5,b6);},MapLens:function(b4){var b5;b5=this;return y.MapSeqCachedViewBy(b5.key,function(b6,b7){return b4(b6,b5["LensInto'"](a.id,function(b8,b9){return b9;},b6,b7));},this["var"].get_View());},Lens:function(b4){return this.LensInto(a.id,function(b5,b6){return b6;},b4);},LensInto:function(b4,b5,b6){return this["LensInto'"](b4,b5,b6,y.Map(b4,this.FindByKeyAsView(b6)));},"LensInto'":function(b4,b5,b6,b7){var b8,b9,b_;b8=this;b9=h.Id();b_=new x({Get:function(){return b4(b8.FindByKey(b6));},Set:function(b$){return b8.UpdateBy(function(ca){return{$:1,$0:b5(ca,b$)};},b6);},SetFinal:function(b$){return this.Set(b$);},Update:function(b$){return b8.UpdateBy(function(ca){return{$:1,$0:b5(ca,b$(b4(ca)))};},b6);},UpdateMaybe:function(b$){return b8.UpdateBy(function(ca){var cb;cb=b$(b4(ca));return cb==null?null:{$:1,$0:b5(ca,cb.$0)};},b6);},get_View:function(){return b7;},get_Id:function(){return b9;}});x.New.call(b_);return b_;},get_LengthAsView:function(){return y.Map(bC.length,this["var"].get_View());},get_Length:function(){return bC.length(this["var"].Get());},Clear:function(){this["var"].Set(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(b4,b5){var b6,b7,b8,b9,b_;b6=this;b7=this["var"].Get();b8=bC.tryFindIndex(function(b$){return bL.Equals(b6.key(b$),b5);},b7);b8!=null&&b8.$==1?(b9=b8.$0,b_=b4(bC.get(b7,b9)),b_!=null&&b_.$==1?(this["var"].Set(this.storage.SSetAt(b9,b_.$0,b7)),this.ObsoleteKey(b5)):void 0):void 0;},UpdateAll:function(b4){var b5;b5=this;this["var"].Update(function(b6){bC.iteri(function(b7,b8){var b9;b9=b4(b8);return b9==null?null:bC.set(b6,b7,b9.$0);},b6);return b5.storage.SSet(b6);});this.ObsoleteAll();},FindByKeyAsView:function(b4){return y.Map(function(b5){return b5.$0;},this.TryFindByKeyAsView(b4));},TryFindByKeyAsView:function(b4){var b5;b5=this;return function(){var b6,b7,b8;b6=(b7=null,[b5.it.TryGetValue(b4,{get:function(){return b7;},set:function(b9){b7=b9;}}),b7]);return b6[0]?b6[1]:(b8=w.New({$:2,$0:b5.TryFindByKey(b4),$1:[]}),(b5.it.Add(b4,b8),b8));};},TryFindByKey:function(b4){var b5;b5=this;return bC.tryFind(function(b6){return bL.Equals(b5.key(b6),b4);},this["var"].Get());},FindByKey:function(b4){var b5;b5=this;return bC.find(function(b6){return bL.Equals(b5.key(b6),b4);},this["var"].Get());},TryFindAsView:function(b4){return y.Map(function(b5){return bC.tryFind(b4,b5);},this["var"].get_View());},FindAsView:function(b4){return y.Map(function(b5){return bC.find(b4,b5);},this["var"].get_View());},TryFind:function(b4){return bC.tryFind(b4,this["var"].Get());},Find:function(b4){return bC.find(b4,this["var"].Get());},ContainsKeyAsView:function(b4){var b5;function b6(b7){return bL.Equals(b5.key(b7),b4);}b5=this;return y.Map(function(b7){return bC.exists(b6,b7);},this["var"].get_View());},ContainsKey:function(b4){var b5;b5=this;return bC.exists(function(b6){return bL.Equals(b5.key(b6),b4);},this["var"].Get());},Set:function(b4){this["var"].Set(this.storage.SSet(b4));this.ObsoleteAll();},Iter:function(b4){bC.iter(b4,this["var"].Get());},RemoveByKey:function(b4){var b5;b5=this;this["var"].Set(this.storage.SRemoveIf(function(b6){return bL.Equals(b5.key(b6),b4);},this["var"].Get()));this.ObsoleteKey(b4);},RemoveBy:function(b4){var b5,b6,b7,b8;b5=this["var"].Get();for(b6=0,b7=b5.length-1;b6<=b7;b6++){b8=bC.get(b5,b6);b4(b8)?this.ObsoleteKey(this.key(b8)):void 0;}this["var"].Set(this.storage.SRemoveIf(b4,this["var"].Get()));},Remove:function(b4){var b5,b6,b7,b8;b5=this;b6=this["var"].Get();M.Contains(b5.key,b4,b6)?(b7=b5.key,b8=b7(b4),this["var"].Set(this.storage.SRemoveIf(function(b9){return bL.Equals(b7(b9),b8);},b6)),this.ObsoleteKey(b8)):void 0;},PrependMany:function(b4){var b5,b6;function b7(b8,b9){var b_,b$;b_=b5.key(b9);b5.ObsoleteKey(b_);b$=bC.tryFindIndex(function(ca){return bL.Equals(b5.key(ca),b_);},b8);return b$==null?(b6.push(b9),b8):b5.storage.SSetAt(b$.$0,b9,b8);}b5=this;b6=[];this["var"].Set(this.storage.SPrependMany(b6,(((bK.Curried3(bI.fold))(b7))(this["var"].Get()))(b4)));},Prepend:function(b4){var b5,b6,b7,b8;b5=this;b6=this["var"].Get();b7=this.key(b4);b8=bC.tryFindIndex(function(b9){return bL.Equals(b5.key(b9),b7);},b6);b8!=null&&b8.$==1?this["var"].Set(this.storage.SSetAt(b8.$0,b4,b6)):this["var"].Set(this.storage.SPrepend(b4,b6));this.ObsoleteKey(b7);},AppendMany:function(b4){var b5,b6;function b7(b8,b9){var b_,b$;b_=b5.key(b9);b5.ObsoleteKey(b_);b$=bC.tryFindIndex(function(ca){return bL.Equals(b5.key(ca),b_);},b8);return b$==null?(b6.push(b9),b8):b5.storage.SSetAt(b$.$0,b9,b8);}b5=this;b6=[];this["var"].Set(this.storage.SAppendMany(b6,(((bK.Curried3(bI.fold))(b7))(this["var"].Get()))(b4)));},Append:function(b4){var b5,b6,b7,b8;b5=this;b6=this["var"].Get();b7=this.key(b4);b8=bC.tryFindIndex(function(b9){return bL.Equals(b5.key(b9),b7);},b6);b8!=null&&b8.$==1?this["var"].Set(this.storage.SSetAt(b8.$0,b4,b6)):this["var"].Set(this.storage.SAppend(b4,b6));this.ObsoleteKey(b7);},ObsoleteAll:function(){bI.iter(function(b4){w.Obsolete(b4.V);},this.it);this.it.Clear();},ObsoleteKey:function(b4){var b5,b6;b5=(b6=null,[this.it.TryGetValue(b4,{get:function(){return b6;},set:function(b7){b6=b7;}}),b6]);b5[0]?(w.Obsolete(b5[1]),this.it.Remove(b4)):void 0;},GetEnumerator0:function(){return bD.Get0(this["var"].Get());},GetEnumerator:function(){return bD.Get(this["var"].Get());}},k,L);L.New=bK.Ctor(function(b4,b5){L.New$3.call(this,b4,A.Create$1(bC.ofSeq(bI.distinctBy(b4,b5.SInit()))),b5);},L);L.New$1=bK.Ctor(function(b4){L.New$2.call(this,b4,[]);},L);L.New$2=bK.Ctor(function(b4,b5){var b6;b6=bC.ofSeq(b5);L.New$3.call(this,b4,A.Create$1(b6),I.InMemory(b6));},L);L.New$3=bK.Ctor(function(b4,b5,b6){k.New.call(this);this.key=b4;this["var"]=b5;this.storage=b6;this.v=y.Map(function(b7){return b7.slice();},this["var"].get_View());this.it=new bT.New$5();},L);M.Contains=function(b4,b5,b6){var b7;b7=b4(b5);return bC.exists(function(b8){return bL.Equals(b4(b8),b7);},b6);};L.Wrap=function(b4,b5,b6,b7){var b8,b9;b8=[new bT.New$5()];b9=bC.map(function(b_){var b$;b$=b6(b_);b8[0].set_Item(b4.key(b_),b$);return b$;},b4["var"].Get());return new L.New$3(function(b_){return b4.key(b5(b_));},A.Lens(b4["var"],function(b_){var b$,ca;b$=new bT.New$5();ca=bC.map(function(cb){var cc,cd;cc=b4.key(cb);cd=b8[0].ContainsKey(cc)?b7(b8[0].get_Item(cc),cb):b6(cb);b$.set_Item(cc,cd);return cd;},b_);b8[0]=b$;return ca;},function(b_,b$){var ca,cb;ca=new bT.New$5();cb=bC.map(function(cc){var cd;cd=b5(cc);ca.set_Item(b4.key(cd),cc);return cd;},b$);b8[0]=ca;return cb;}),I.InMemory(b9));};L.FromSeq=function(b4){return L.Create(a.id,b4);};L.Create=function(b4,b5){return L.CreateWithStorage(b4,I.InMemory(bC.ofSeq(b5)));};L.CreateWithStorage=function(b4,b5){return new L.New(b4,b5);};N.$cctor=function(){N.$cctor=a.ignore;N.Default={Encode:a.id,Decode:a.id};};O=c.ReactiveExtensions=bK.Class({},k,O);O.New=bK.Ctor(function(){k.New.call(this);},O);P=c.DoubleInterpolation=bK.Class({Interpolate:function(b4,b5,b6){return b5+b4*(b6-b5);}},null,P);P.DoubleInterpolation=new P({$:0});Q.get_Double=function(){return P.DoubleInterpolation;};R=c.Easing=bK.Class({TransformTime:function(b4){return this.transformTime(b4);}},k,R);R.get_CubicInOut=function(){return S.CubicInOut();};R.Custom=function(b4){return new R.New(b4);};R.New=bK.Ctor(function(b4){k.New.call(this);this.transformTime=b4;},R);S.CubicInOut=function(){W.$cctor();return W.CubicInOut;};T.get_Empty=function(){return{$:0,$0:p.Empty()};};T.WhenDone=function(b4,b5){return T.Append({$:0,$0:p.Single({$:0,$0:b4})},b5);};T.Run=function(b4,b5){var b6;function b7(b8){function b9(b_,b$){var ca;ca=b$-b_;b5.Compute(ca);b4();return ca<=b6?void a.requestAnimationFrame(function(cb){b9(b_,cb);}):b8();}a.requestAnimationFrame(function(b_){b9(b_,b_);});}b6=b5.Duration;return b6===0?bN.Zero():bN.FromContinuations(function(b8,b9,b_){return b7.apply(null,[b8,b9,b_]);});};T.Play=function(b4){var b5;b5=null;return bN.Delay(function(){return bN.Bind(T.Run(a.ignore,U.Actions(b4)),function(){U.Finalize(b4);return bN.Return(null);});});};T.Pack=function(b4){return{$:0,$0:p.Single({$:1,$0:b4})};};T.Map=function(b4,b5){var b6;return U.Def(b5.Duration,(b6=b5.Compute,function(b7){return b4(b6(b7));}));};T.Delayed=function(b4,b5,b6,b7,b8,b9){return{Compute:function(b_){return b_<=b7?b8:b4.Interpolate(b5.TransformTime((b_-b7)/b6),b8,b9);},Duration:b6+b7};};T.Simple=function(b4,b5,b6,b7,b8){return{Compute:function(b9){return b4.Interpolate(b5.TransformTime(b9/b6),b7,b8);},Duration:b6};};T.Const=function(b4){return U.Const(b4);};T.Concat=function(b4){return{$:0,$0:p.Concat(bI.map(U.List,b4))};};T.Append=function(b4,b5){return{$:0,$0:p.Append(b4.$0,b5.$0)};};T.set_UseAnimations=function(b4){U.set_UseAnimations(b4);};T.get_UseAnimations=function(){return U.UseAnimations();};U.UseAnimations=function(){W.$cctor();return W.UseAnimations;};U.set_UseAnimations=function(b4){W.$cctor();W.UseAnimations=b4;};U.Actions=function(b4){return U.ConcatActions(bC.choose(function(b5){return b5.$==1?{$:1,$0:b5.$0}:null;},p.ToArray(b4.$0)));};U.ConcatActions=function(b4){var b5,b6,b7,b8;b5=d.ofSeqNonCopying(b4);b6=bC.length(b5);return b6===0?U.Const():b6===1?bC.get(b5,0):(b7=bI.max(bI.map(function(b9){return b9.Duration;},b5)),(b8=bC.map(function(b9){return U.Prolong(b7,b9);},b5),U.Def(b7,function(b9){bC.iter(function(b_){b_.Compute(b9);},b8);})));};U.Prolong=function(b4,b5){var b6,b7,b8;b6=b5.Compute;b7=b5.Duration;b8=bS.Create(function(){return b5.Compute(b5.Duration);});return{Compute:function(b9){return b9>=b7?b8.f():b6(b9);},Duration:b4};};U.Const=function(b4){return U.Def(0,function(){return b4;});};U.Def=function(b4,b5){return{Compute:b5,Duration:b4};};U.Finalize=function(b4){bC.iter(function(b5){if(b5.$==0)b5.$0();},p.ToArray(b4.$0));};U.List=function(b4){return b4.$0;};V=c.Trans=bK.Class({Copy:function(b4,b5,b6,b7){var b8,b9,b_,b$,ca;function cb(cc,cd){return b8.TChange(cc,cd);}b8=this;b9=b4==null?function(cc){return function(cd){return cb(cc,cd);};}:b4.$0;return new V.New$3(function(cc,cd){return(b9(cc))(cd);},(b_=this.get_TEnter(),b5==null?b_:b5.$0),(b$=this.get_TExit(),b6==null?b$:b6.$0),(ca=this.get_TFlags(),b7==null?ca:b7.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(b4,b5){return this.change(b4,b5);}},k,V);V.New=bK.Ctor(function(b4,b5,b6){V.New$3.call(this,b4,bL.Equals(b5,null)?T.Const:b5,bL.Equals(b6,null)?T.Const:b6,1|(bL.Equals(b5,null)?0:2)|(bL.Equals(b6,null)?0:4));},V);V.New$1=bK.Ctor(function(b4){V.New$3.call(this,b4,T.Const,T.Const,1);},V);V.New$2=bK.Ctor(function(){V.New$3.call(this,function(b4,b5){return T.Const(b5);},T.Const,T.Const,0);},V);V.New$3=bK.Ctor(function(b4,b5,b6,b7){k.New.call(this);this.change=b4;this.enter=b5;this.exit=b6;this.flags=b7;},V);V.Exit=function(b4,b5){return b5.Copy(null,null,{$:1,$0:b4},{$:1,$0:b5.get_TFlags()|4});};V.Enter=function(b4,b5){return b5.Copy(null,{$:1,$0:b4},null,{$:1,$0:b5.get_TFlags()|2});};V.Change=function(b4,b5){return b5.Copy({$:1,$0:b4},null,null,{$:1,$0:b5.get_TFlags()|1});};V.Create=function(b4){return new V.New$1(b4);};V.Trivial=function(){return new V.New$2();};V.CanAnimateExit=function(b4){var b5,b6;b5=b4.get_TFlags();b6=4;return(b5&b6)===b6;};V.CanAnimateEnter=function(b4){var b5,b6;b5=b4.get_TFlags();b6=2;return(b5&b6)===b6;};V.CanAnimateChange=function(b4){var b5,b6;b5=b4.get_TFlags();b6=1;return(b5&b6)===b6;};V.AnimateExit=function(b4,b5){return(b4.get_TExit())(b5);};V.AnimateEnter=function(b4,b5){return(b4.get_TEnter())(b5);};V.AnimateChange=function(b4,b5,b6){return b4.TChange(b5,b6);};W.$cctor=function(){W.$cctor=a.ignore;W.CubicInOut=R.Custom(function(b4){var b5;b5=b4*b4;return 3*b5-2*(b5*b4);});W.UseAnimations=true;};Z=c.OnAfterRenderControl=bK.Class({get_Body:function(){var b4,b5,b6,b7,b8,b9;b5=self.document.querySelectorAll("[ws-runafterrender]");for(b6=0,b7=b5.length-1;b6<=b7;b6++){b8=b5[b6];b9=a["eval"](b8.getAttribute("ws-runafterrender"));b8.removeAttribute("ws-runafterrender");b9(b8);}b4={ReplaceInDom:function(){return null;}};k.New.call(b4);return b4;}},Y,Z);_0=c.AnimatedAttrNode=bK.Class({sync:function(b4){var b5;if(this.dirty){b5=this.logical;b5==null?void 0:(this.push(b4))(b5.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(b4,b5){this.visible={$:1,$0:b5};this.dirty=true;(this.push(b4))(b5);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(b4){var b5,b6;b5=this;return T.WhenDone(function(){b5.dirty=true;b5.visible=null;},(b6=this.visible,b6!=null&&b6.$==1?T.Pack(T.Map(function(b7){b5.pushVisible(b4,b7);},V.AnimateExit(this.tr,b6.$0))):T.get_Empty()));},NGetEnterAnim:function(b4){var b5,b6,b7,b8,b9;b5=this;return T.WhenDone(function(){b5.sync(b4);},(b6=this.visible,(b7=this.logical,b6!=null&&b6.$==1&&(b7!=null&&b7.$==1&&(this.dirty&&(b8=[b7.$0,b6.$0],true)))?T.Pack(T.Map(function(b_){b5.pushVisible(b4,b_);},V.AnimateChange(this.tr,b8[1],b8[0]))):b6==null&&(b7!=null&&b7.$==1)?T.Pack(T.Map(function(b_){b5.pushVisible(b4,b_);},V.AnimateEnter(this.tr,b7.$0))):T.get_Empty())));},NGetChangeAnim:function(b4){var b5,b6,b7,b8;b5=this;return T.WhenDone(function(){b5.sync(b4);},(b6=this.visible,(b7=this.logical,b6!=null&&b6.$==1&&(b7!=null&&b7.$==1&&(this.dirty&&(b8=[b7.$0,b6.$0],true)))?T.Pack(T.Map(function(b9){b5.pushVisible(b4,b9);},V.AnimateChange(this.tr,b8[1],b8[0]))):T.get_Empty())));}},k,_0);_0.New=bK.Ctor(function(b4,b5,b6){var b7;b7=this;k.New.call(this);this.tr=b4;this.push=b6;this.logical=null;this.visible=null;this.dirty=true;this.updates=y.Map(function(b8){b7.logical={$:1,$0:b8};b7.dirty=true;},b5);},_0);_1=c.DynamicAttrNode=bK.Class({NChanged:function(){return this.updates;},NSync:function(b4){if(this.dirty){(this.push(b4))(this.value);this.dirty=false;}},NGetExitAnim:function(b4){return T.get_Empty();},NGetEnterAnim:function(b4){return T.get_Empty();},NGetChangeAnim:function(b4){return T.get_Empty();}},k,_1);_1.New=bK.Ctor(function(b4,b5){var b6;b6=this;k.New.call(this);this.push=b5;this.value=void 0;this.dirty=false;this.updates=y.Map(function(b7){b6.value=b7;b6.dirty=true;},b4);},_1);_2=c.AttrProxy=bK.Class({},null,_2);_2.Handler=function(b4,b5){return _2.HandlerImpl(b4,b5);};_2.HandlerImpl=function(b4,b5){return _6.Static(function(b6){b6.addEventListener(b4,function(b7){return(b5(b6))(b7);},false);});};_2.OnAfterRenderImpl=function(b4){return new _2({$:4,$0:b4});};_2.Concat=function(b4){var b5;b5=d.ofSeqNonCopying(b4);return d.TreeReduce(_6.EmptyAttr(),_2.Append,b5);};_2.Append=function(b4,b5){return _6.AppendTree(b4,b5);};_2.Create=function(b4,b5){return _6.Static(function(b6){r.SetAttr(b6,b4,b5);});};_5.New=function(b4,b5,b6,b7){var b8;b8={DynElem:b4,DynFlags:b5,DynNodes:b6};bK.SetOptional(b8,"OnAfterRender",b7);return b8;};_6.Static=function(b4){return new _2({$:3,$0:b4});};_6.Dynamic=function(b4,b5){return new _2({$:1,$0:new _1.New(b4,b5)});};_6.Animated=function(b4,b5,b6){var b7,b8,b9;b7=new _0.New(b4,b5,b6);b8=4;V.CanAnimateEnter(b4)?b8=b8|1:void 0;V.CanAnimateExit(b4)?b8=b8|2:void 0;b9=new _2({$:1,$0:b7});_6.SetFlags(b9,b8);return b9;};_6.EmptyAttr=function(){_9.$cctor();return _9.EmptyAttr;};_6.AppendTree=function(b4,b5){var b6;return b4===null?b5:b5===null?b4:(b6=new _2({$:2,$0:b4,$1:b5}),(_6.SetFlags(b6,_6.Flags(b4)|_6.Flags(b5)),b6));};_6.GetChangeAnim=function(b4){return _6.GetAnim(b4,function(b5,b6){return b5.NGetChangeAnim(b6);});};_6.GetExitAnim=function(b4){return _6.GetAnim(b4,function(b5,b6){return b5.NGetExitAnim(b6);});};_6.GetEnterAnim=function(b4){return _6.GetAnim(b4,function(b5,b6){return b5.NGetEnterAnim(b6);});};_6.GetAnim=function(b4,b5){return T.Concat(bC.map(function(b6){return b5(b6,b4.DynElem);},b4.DynNodes));};_6.Updates=function(b4){return d.MapTreeReduce(function(b5){return b5.NChanged();},y.Const(),y.Map2Unit,b4.DynNodes);};_6.Empty=function(b4){return _5.New(b4,0,[],null);};_6.Insert=function(b4,b5){var b6,b7,b8;function b9(b_){if(!(b_===null))if(b_!=null&&b_.$==1)b6.push(b_.$0);else if(b_!=null&&b_.$==2){b9(b_.$0);b9(b_.$1);}else if(b_!=null&&b_.$==3)b_.$0(b4);else if(b_!=null&&b_.$==4)b7.push(b_.$0);}b6=[];b7=[];b9(b5);b8=b6.slice(0);return _5.New(b4,_6.Flags(b5),b8,b7.length===0?null:{$:1,$0:function(b_){bI.iter(function(b$){b$(b_);},b7);}});};_6.Sync=function(b4,b5){bC.iter(function(b6){b6.NSync(b4);},b5.DynNodes);};_6.SetFlags=function(b4,b5){b4.flags=b5;};_6.Flags=function(b4){return b4!==null&&b4.hasOwnProperty("flags")?b4.flags:0;};_6.HasExitAnim=function(b4){var b5;b5=2;return(b4.DynFlags&b5)===b5;};_6.HasEnterAnim=function(b4){var b5;b5=1;return(b4.DynFlags&b5)===b5;};_6.HasChangeAnim=function(b4){var b5;b5=4;return(b4.DynFlags&b5)===b5;};_7=c.CheckedInput=bK.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_7);_7.Make=function(b4){return new _7({$:0,$0:b4,$1:a.String(b4)});};_8.ValidateForm=function(){return _8.OnAfterRender(function(b4){if(self.H5F)self.H5F.setup(b4);});};_8.Checked=function(b4){function b5(b6,b7){return!bL.Equals(b4.Get(),b6.checked)?b4.Set(b6.checked):null;}return _2.Concat([_8.DynamicProp("checked",b4.get_View()),_8.Handler("change",function(b6){return function(b7){return b5(b6,b7);};})]);};_8.FloatValue=function(b4){return _8.CustomVar(b4,function(b5,b6){var b7;b7=b6.get_Input();return b5.value!==b7?void(b5.value=b7):null;},function(b5){var b6,b7;b6=b5.value;return{$:1,$0:e.isBlank(b6)?(b5.checkValidity?b5.checkValidity():true)?new _7({$:2,$0:b6}):new _7({$:1,$0:b6}):(b7=+b6,a.isNaN(b7)?new _7({$:1,$0:b6}):new _7({$:0,$0:b7,$1:b6}))};});};_8.FloatValueUnchecked=function(b4){return _8.CustomValue(b4,a.String,function(b5){var b6;return e.isBlank(b5)?{$:1,$0:0}:(b6=+b5,a.isNaN(b6)?null:{$:1,$0:b6});});};_8.IntValue=function(b4){return _8.CustomVar(b4,function(b5,b6){var b7;b7=b6.get_Input();return b5.value!==b7?void(b5.value=b7):null;},function(b5){var b6,b7,b8;b6=b5.value;return{$:1,$0:e.isBlank(b6)?(b5.checkValidity?b5.checkValidity():true)?new _7({$:2,$0:b6}):new _7({$:1,$0:b6}):(b7=(b8=0,[bV.TryParseInt32(b6,{get:function(){return b8;},set:function(b9){b8=b9;}}),b8]),b7[0]?new _7({$:0,$0:b7[1],$1:b6}):new _7({$:1,$0:b6}))};});};_8.IntValueUnchecked=function(b4){return _8.CustomValue(b4,a.String,function(b5){var b6;return e.isBlank(b5)?{$:1,$0:0}:(b6=+b5,b6!==b6>>0?null:{$:1,$0:b6});});};_8.Value=function(b4){function b5(b6){return{$:1,$0:b6};}return _8.CustomValue(b4,a.id,function(b6){return b5(a.id(b6));});};_8.ContentEditableHtml=function(b4){var b5;b5=_8.CustomVar(b4,function(b6,b7){b6.innerHTML=b7;},function(b6){return{$:1,$0:b6.innerHTML};});return _2.Append(_2.Create("contenteditable","true"),b5);};_8.ContentEditableText=function(b4){var b5;b5=_8.CustomVar(b4,function(b6,b7){b6.textContent=b7;},function(b6){return{$:1,$0:b6.textContent};});return _2.Append(_2.Create("contenteditable","true"),b5);};_8.CustomValue=function(b4,b5,b6){return _8.CustomVar(b4,function(b7,b8){b7.value=b5(b8);},function(b7){return b6(b7.value);});};_8.CustomVar=function(b4,b5,b6){function b7(b9,b_){return b4.UpdateMaybe(function(b$){var ca,cb;ca=b6(b9);return ca!=null&&ca.$==1&&(!bL.Equals(ca.$0,b$)&&(cb=[ca,ca.$0],true))?cb[0]:null;});}function b8(b9,b_){var b$,ca;b$=b6(b9);return b$!=null&&b$.$==1&&(bL.Equals(b$.$0,b_)&&(ca=b$.$0,true))?null:b5(b9,b_);}return _2.Concat([_8.Handler("change",function(b9){return function(b_){return b7(b9,b_);};}),_8.Handler("input",function(b9){return function(b_){return b7(b9,b_);};}),_8.Handler("keypress",function(b9){return function(b_){return b7(b9,b_);};}),_8.DynamicCustom(function(b9){return function(b_){return b8(b9,b_);};},b4.get_View())]);};_8.DynamicProp=function(b4,b5){return _6.Dynamic(b5,function(b6){return function(b7){b6[b4]=b7;};});};_8.DynamicPred=function(b4,b5,b6){function b7(b8,b9){return b9[0]?r.SetAttr(b8,b4,b9[1]):r.RemoveAttr(b8,b4);}return _6.Dynamic(y.Map2(function(b8,b9){return[b8,b9];},b5,b6),function(b8){return function(b9){return b7(b8,b9);};});};_8.DynamicClass=function(b4,b5,b6){return _8.DynamicClassPred(b4,y.Map(b6,b5));};_8.Class=function(b4){return _8.ClassPred(b4,true);};_8.ClassPred=function(b4,b5){return _6.Static(function(b6){if(b5)r.AddClass(b6,b4);else r.RemoveClass(b6,b4);});};_8.DynamicClassPred=function(b4,b5){return _6.Dynamic(b5,function(b6){return function(b7){return b7?r.AddClass(b6,b4):r.RemoveClass(b6,b4);};});};_8.OnAfterRenderView=function(b4,b5){var b6;b6=h.Id();return _2.Append(_8.OnAfterRender(function(b7){b5(b7,b7[b6]);}),_8.DynamicCustom(function(b7){return function(b8){b7[b6]=b8;};},b4));};_8.OnAfterRender=function(b4){return new _2({$:4,$0:b4});};_8.HandlerView=function(b4,b5,b6){return _6.Static(function(b7){var b8;b8=b6(b7);b7.addEventListener(b4,function(b9){return y.Get(b8(b9),b5);},false);});};_8.Handler=function(b4,b5){return _6.Static(function(b6){b6.addEventListener(b4,function(b7){return(b5(b6))(b7);},false);});};_8.DynamicStyle=function(b4,b5){return _6.Dynamic(b5,function(b6){return function(b7){return r.SetStyle(b6,b4,b7);};});};_8.DynamicCustom=function(b4,b5){return _6.Dynamic(b5,b4);};_8.Dynamic=function(b4,b5){return _6.Dynamic(b5,function(b6){return function(b7){return r.SetAttr(b6,b4,b7);};});};_8.AnimatedStyle=function(b4,b5,b6,b7){return _6.Animated(b5,b6,function(b8){return function(b9){return r.SetStyle(b8,b4,b7(b9));};});};_8.Animated=function(b4,b5,b6,b7){return _6.Animated(b5,b6,function(b8){return function(b9){return r.SetAttr(b8,b4,b7(b9));};});};_8.Style=function(b4,b5){return _6.Static(function(b6){r.SetStyle(b6,b4,b5);});};_9.$cctor=function(){_9.$cctor=a.ignore;_9.EmptyAttr=null;};_.BatchUpdatesEnabled=function(){bi.$cctor();return bi.BatchUpdatesEnabled;};_.set_BatchUpdatesEnabled=function(b4){bi.$cctor();bi.BatchUpdatesEnabled=b4;};$=c.DocElemNode=bK.Class({GetHashCode:function(){return this.ElKey;},Equals:function(b4){return this.ElKey===b4.ElKey;}},null,$);$.New=function(b4,b5,b6,b7,b8,b9){var b_;return new $((b_={Attr:b4,Children:b5,El:b7,ElKey:b8},(bK.SetOptional(b_,"Delimiters",b6),bK.SetOptional(b_,"Render",b9),b_)));};bb.FoldBack=function(b4,b5,b6){return bC.foldBack(b4,b5.$0,b6);};bb.Iter=function(b4,b5){bC.iter(b4,b5.$0);};bb.Except=function(b4,b5){var b6;b6=b4.$0;return{$:0,$0:bC.filter(function(b7){return bC.forall(function(b8){return!(b7===b8);},b6);},b5.$0)};};bb.DocChildren=function(b4){var b5;function b6(b7){if(b7!=null&&b7.$==2)b6(b7.$0.Current);else if(b7!=null&&b7.$==1)b5.push(b7.$0.El);else if(b7==null);else if(b7!=null&&b7.$==5)b5.push(b7.$0);else if(b7!=null&&b7.$==4)b5.push(b7.$0.Text);else if(b7!=null&&b7.$==6)bC.iter(function(b8){if(b8==null||b8.constructor===a.Object)b6(b8);else b5.push(b8);},b7.$0.Els);else{b6(b7.$0);b6(b7.$1);}}b5=[];b6(b4.Children);return{$:0,$0:d.ofSeqNonCopying(b5)};};bb.Children=function(b4,b5){var b6,b7,b8;if(b5!=null&&b5.$==1){b8=[];b6=b5.$0[0].nextSibling;while(b6!==b5.$0[1]){b8.push(b6);b6=b6.nextSibling;}return{$:0,$0:b8};}else return{$:0,$0:bC.init(b4.childNodes.length,(b7=b4.childNodes,function(b9){return b7[b9];}))};};bc.ToArray=function(b4){return i.ToArray(b4.$0);};bc.get_Empty=function(){return{$:0,$0:new bH.New$3()};};bc.IsEmpty=function(b4){return b4.$0.get_Count()===0;};bc.Intersect=function(b4,b5){return{$:0,$0:i.Intersect(b4.$0,b5.$0)};};bc.Except=function(b4,b5){return{$:0,$0:i.Except(b4.$0,b5.$0)};};bc.FindAll=function(b4){var b5;function b6(b8){if(b8!=null&&b8.$==0){b6(b8.$0);b6(b8.$1);}else if(b8!=null&&b8.$==1)b7(b8.$0);else if(b8!=null&&b8.$==2)b6(b8.$0.Current);else if(b8!=null&&b8.$==6)bC.iter(b7,b8.$0.Holes);}function b7(b8){b5.push(b8);b6(b8.Children);}b5=[];b6(b4);return{$:0,$0:new bH.New$2(b5)};};bc.Filter=function(b4,b5){return{$:0,$0:i.Filter(b4,b5.$0)};};bd.New=function(b4,b5){return{PreviousNodes:b4,Top:b5};};be.UpdateTextNode=function(b4,b5){b4.Value=b5;b4.Dirty=true;};be.CreateTextNode=function(){return{Text:r.CreateText(""),Dirty:false,Value:""};};be.UpdateEmbedNode=function(b4,b5){b4.Current=b5;b4.Dirty=true;};be.CreateEmbedNode=function(){return{Current:null,Dirty:false};};be.PerformSyncUpdate=function(b4,b5,b6){var b7;b7=bc.FindAll(b6);be.SyncElemNode(b4,b5.Top);b5.PreviousNodes=b7;};be.PerformAnimatedUpdate=function(b4,b5,b6){var b7;return T.get_UseAnimations()?(b7=null,bN.Delay(function(){var b8,b9,b_;b8=bc.FindAll(b6);b9=be.ComputeChangeAnim(b5,b8);b_=be.ComputeEnterAnim(b5,b8);return bN.Bind(T.Play(T.Append(b9,be.ComputeExitAnim(b5,b8))),function(){return bN.Bind(be.SyncElemNodesNextFrame(b4,b5),function(){return bN.Bind(T.Play(b_),function(){b5.PreviousNodes=b8;return bN.Return(null);});});});})):be.SyncElemNodesNextFrame(b4,b5);};be.SyncElemNodesNextFrame=function(b4,b5){function b6(b7){a.requestAnimationFrame(function(){be.SyncElemNode(b4,b5.Top);b7();});}return _.BatchUpdatesEnabled()?bN.FromContinuations(function(b7,b8,b9){return b6.apply(null,[b7,b8,b9]);}):(be.SyncElemNode(b4,b5.Top),bN.Return(null));};be.ComputeEnterAnim=function(b4,b5){return T.Concat(bC.map(function(b6){return _6.GetEnterAnim(b6.Attr);},bc.ToArray(bc.Except(b4.PreviousNodes,bc.Filter(function(b6){return _6.HasEnterAnim(b6.Attr);},b5)))));};be.ComputeChangeAnim=function(b4,b5){var b6;function b7(b8){return _6.HasChangeAnim(b8.Attr);}b6=function(b8){return bc.Filter(b7,b8);};return T.Concat(bC.map(function(b8){return _6.GetChangeAnim(b8.Attr);},bc.ToArray(bc.Intersect(b6(b4.PreviousNodes),b6(b5)))));};be.ComputeExitAnim=function(b4,b5){return T.Concat(bC.map(function(b6){return _6.GetExitAnim(b6.Attr);},bc.ToArray(bc.Except(b5,bc.Filter(function(b6){return _6.HasExitAnim(b6.Attr);},b4.PreviousNodes)))));};be.CreateDelimitedRunState=function(b4,b5,b6){return bd.New(bc.get_Empty(),be.CreateDelimitedElemNode(b4,b5,_6.EmptyAttr(),b6));};be.CreateRunState=function(b4,b5){return bd.New(bc.get_Empty(),be.CreateElemNode(b4,_6.EmptyAttr(),b5));};be.CreateDelimitedElemNode=function(b4,b5,b6,b7){var b8,b9;b8=b4.parentNode;be.LinkPrevElement(b5,b7);b9=_6.Insert(b8,b6);return $.New(b9,b7,{$:1,$0:[b4,b5]},b8,h.Int(),bK.GetOptional(b9.OnAfterRender));};be.CreateElemNode=function(b4,b5,b6){var b7;be.LinkElement(b4,b6);b7=_6.Insert(b4,b5);return $.New(b7,b6,null,b4,h.Int(),bK.GetOptional(b7.OnAfterRender));};be.SyncElemNode=function(b4,b5){!b4?be.SyncElement(b5):void 0;be.Sync(b5.Children);be.AfterRender(b5);};be.Sync=function(b4){var b5,b6;if(b4!=null&&b4.$==1)be.SyncElemNode(false,b4.$0);else if(b4!=null&&b4.$==2)be.Sync(b4.$0.Current);else if(b4==null);else if(b4!=null&&b4.$==5);else if(b4!=null&&b4.$==4){b5=b4.$0;b5.Dirty?(b5.Text.nodeValue=b5.Value,b5.Dirty=false):void 0;}else if(b4!=null&&b4.$==6){b6=b4.$0;bC.iter(function(b7){be.SyncElemNode(false,b7);},b6.Holes);bC.iter(function(b7){_6.Sync(b7[0],b7[1]);},b6.Attrs);be.AfterRender(b6);}else{be.Sync(b4.$0);be.Sync(b4.$1);}};be.AfterRender=function(b4){var b5;b5=bK.GetOptional(b4.Render);b5!=null&&b5.$==1?(b5.$0(b4.El),bK.SetOptional(b4,"Render",null)):void 0;};be.InsertBeforeDelim=function(b4,b5){var b6,b7;b6=b4.parentNode;b7=self.document.createTextNode("");b6.insertBefore(b7,b4);be.LinkPrevElement(b4,b5);return b7;};be.LinkPrevElement=function(b4,b5){be.InsertDoc(b4.parentNode,b5,b4);};be.LinkElement=function(b4,b5){be.InsertDoc(b4,b5,null);};be.SyncElement=function(b4){function b5(b6){function b7(b8){var b9,b_;return b8!=null&&b8.$==0?b7(b8.$0)||b7(b8.$1):b8!=null&&b8.$==2?(b9=b8.$0,b9.Dirty||b7(b9.Current)):b8!=null&&b8.$==6&&(b_=b8.$0,b_.Dirty||bC.exists(b5,b_.Holes));}return b7(b6.Children);}_6.Sync(b4.El,b4.Attr);b5(b4)?be.DoSyncElement(b4):void 0;};be.DoSyncElement=function(b4){var b5,b6,b7;function b8(b9,b_){var b$,ca;return b9!=null&&b9.$==1?b9.$0.El:b9!=null&&b9.$==2?(b$=b9.$0,b$.Dirty?(b$.Dirty=false,be.InsertDoc(b5,b$.Current,b_)):b8(b$.Current,b_)):b9==null?b_:b9!=null&&b9.$==4?b9.$0.Text:b9!=null&&b9.$==5?b9.$0:b9!=null&&b9.$==6?(ca=b9.$0,(ca.Dirty?ca.Dirty=false:void 0,bC.foldBack(function(cb,cc){return cb==null||cb.constructor===a.Object?b8(cb,cc):cb;},ca.Els,b_))):b8(b9.$0,b8(b9.$1,b_));}b5=b4.El;bb.Iter((b6=b4.El,function(b9){r.RemoveNode(b6,b9);}),bb.Except(bb.DocChildren(b4),bb.Children(b4.El,bK.GetOptional(b4.Delimiters))));b8(b4.Children,(b7=bK.GetOptional(b4.Delimiters),b7!=null&&b7.$==1?b7.$0[1]:null));};be.InsertDoc=function(b4,b5,b6){var b7;return b5!=null&&b5.$==1?be.InsertNode(b4,b5.$0.El,b6):b5!=null&&b5.$==2?(b7=b5.$0,(b7.Dirty=false,be.InsertDoc(b4,b7.Current,b6))):b5==null?b6:b5!=null&&b5.$==4?be.InsertNode(b4,b5.$0.Text,b6):b5!=null&&b5.$==5?be.InsertNode(b4,b5.$0,b6):b5!=null&&b5.$==6?bC.foldBack(function(b8,b9){return b8==null||b8.constructor===a.Object?be.InsertDoc(b4,b8,b9):be.InsertNode(b4,b8,b9);},b5.$0.Els,b6):be.InsertDoc(b4,b5.$0,be.InsertDoc(b4,b5.$1,b6));};be.InsertNode=function(b4,b5,b6){r.InsertAt(b4,b6,b5);return b5;};bf=c.Doc=bK.Class({ReplaceInDom:function(b4){var b5;b5=self.document.createTextNode("");b4.parentNode.replaceChild(b5,b4);bf.RunBefore(b5,this);}},k,bf);bf.SvgElementMixed=function(b4,b5){var b6;b6=bf.MixedNodes(b5);return bf.SvgElement(b4,b6[0],b6[1]);};bf.SvgElement=function(b4,b5,b6){var b7,b8;b7=_2.Concat(b5);b8=bf.Concat(b6);return bg.New(r.CreateSvgElement(b4),b7,b8);};bf.ElementMixed=function(b4,b5){var b6;b6=bf.MixedNodes(b5);return bf.Element(b4,b6[0],b6[1]);};bf.ConcatMixed=function(b4){return bf.Concat(bI.map(bf.ToMixedDoc,b4));};bf.MixedNodes=function(b4){var b5,b6,b7,b8;b5=[];b6=[];b7=bD.Get(b4);try{while(b7.MoveNext()){b8=b7.Current();b8 instanceof _2?b5.push(b8):b6.push(bf.ToMixedDoc(b8));}}finally{if(typeof b7=="object"&&"Dispose"in b7)b7.Dispose();}return[b5,b6];};bf.ToMixedDoc=function(b4){return b4 instanceof bf?b4:typeof b4=="string"?bf.TextNode(b4):b4 instanceof a.Element?bf.StaticProxy(b4):typeof b4=="function"?bf.EmbedView(y.Map(bf.ToMixedDoc,b4)):b4 instanceof x?bf.EmbedView(y.Map(bf.ToMixedDoc,b4.get_View())):bL.Equals(b4,null)?bf.get_Empty():bf.TextNode(a.String(b4));};bf.Element=function(b4,b5,b6){var b7,b8;b7=_2.Concat(b5);b8=bf.Concat(b6);return bg.New(r.CreateElement(b4),b7,b8);};bf.Radio=function(b4,b5,b6){var b7,b8;b7=r.CreateElement("input");b7.addEventListener("click",function(){return b6.Set(b5);},false);b8=_8.DynamicProp("checked",y.Map(function(b9){return bL.Equals(b9,b5);},b6.get_View()));return bg.New(b7,_2.Concat(bB.append(bB.ofArray([_2.Create("type","radio"),_2.Create("name",b6.get_Id()),b8]),bB.ofSeq(b4))),bf.get_Empty());};bf.LinkView=function(b4,b5,b6,b7){var b8;b8=_2.Concat(bI.append([_8.HandlerView("click",b6,function(){return function(){return b7;};}),_2.Create("href","#")],b5));return bg.New(r.CreateElement("a"),b8,bf.TextNode(b4));};bf.Link=function(b4,b5,b6){var b7,b8;b7=(b8=_2.Concat(b5),_2.Append(_2.Create("href","#"),b8));return bg.New(bf.Clickable("a",b6),b7,bf.TextNode(b4));};bf.ButtonView=function(b4,b5,b6,b7){var b8;b8=_2.Concat(bI.append([_8.HandlerView("click",b6,function(){return function(){return b7;};})],b5));return bg.New(r.CreateElement("button"),b8,bf.TextNode(b4));};bf.Button=function(b4,b5,b6){var b7;b7=_2.Concat(b5);return bg.New(bf.Clickable("button",b6),b7,bf.TextNode(b4));};bf.Clickable=function(b4,b5){var b6;b6=r.CreateElement(b4);b6.addEventListener("click",function(b7){b7.preventDefault();return b5();},false);return b6;};bf.CheckBoxGroup=function(b4,b5,b6){function b7(b8){return bL.Equals(b5,b8);}return bf.CheckBox(b4,A.Lens(b6,function(b8){return bB.exists(b7,b8);},function(b8,b9){return b9?bB.exists(function(b_){return bL.Equals(b5,b_);},b8)?b8:new bB.T({$:1,$0:b5,$1:b8}):bB.filter(function(b_){return!bL.Equals(b5,b_);},b8);}));};bf.CheckBox=function(b4,b5){return bf.InputInternal("input",function(){return bI.append(b4,[_2.Create("type","checkbox"),_8.Checked(b5)]);});};bf.SelectDynOptional=function(b4,b5,b6,b7,b8){return bf.SelectDyn(b4,function(b9){return b9!=null&&b9.$==1?b6(b9.$0):b5;},y.Map(function(b9){return new bB.T({$:1,$0:null,$1:bB.map(function(b_){return{$:1,$0:b_};},b9)});},b7),b8);};bf.SelectOptional=function(b4,b5,b6,b7,b8){return bf.Select(b4,function(b9){return b9!=null&&b9.$==1?b6(b9.$0):b5;},new bB.T({$:1,$0:null,$1:bB.map(function(b9){return{$:1,$0:b9};},b7)}),b8);};bf.Select=function(b4,b5,b6,b7){return bf.SelectImpl(b4,b5,function(b8){b8[0]=b6;return bf.Concat(bB.mapi(function(b9,b_){return bf.Element("option",bB.ofArray([_2.Create("value",a.String(b9))]),bB.ofArray([bf.TextNode(b5(b_))]));},b6));},b7);};bf.SelectDyn=function(b4,b5,b6,b7){return bf.SelectImpl(b4,b5,function(b8){function b9(b_,b$){return bf.Element("option",bB.ofArray([_2.Create("value",a.String(b_))]),bB.ofArray([bf.TextNode(b5(b$))]));}return bf.Convert(function(b_){return b9(b_[0],b_[1]);},y.Map(function(b_){b8[0]=b_;return bI.mapi(function(b$,ca){return[b$,ca];},b_);},b6));},b7);};bf.SelectImpl=function(b4,b5,b6,b7){var b8,b9,b_,b$;function ca(cf){return cf.selectedIndex;}function cb(cf,cg){cf.selectedIndex=cg;}function cc(cf){var cg;cg=ca(cf);return b8[0].get_Item(cg);}function cd(cf){return bI.findIndex(function(cg){return bL.Equals(cf,cg);},b8[0]);}function ce(cf,cg){return cb(cf,cd(cg));}b8=[bB.T.Empty];b9=r.CreateElement("select");b_=_8.DynamicCustom(function(cf){return function(cg){return ce(cf,cg);};},b7.get_View());b9.addEventListener("change",function(){b7.UpdateMaybe(function(cf){var cg;cg=cc(b9);return bL.Equals(cf,cg)?null:{$:1,$0:cg};});},false);return bg.New(b9,(b$=_2.Append(b_,_2.Concat(b4)),_2.Append(_8.OnAfterRender(function(cf){ce(cf,b7.Get());}),b$)),b6(b8));};bf.InputArea=function(b4,b5){return bf.InputInternal("textarea",function(){return bI.append(b4,[_8.Value(b5)]);});};bf.FloatInput=function(b4,b5){return bf.InputInternal("input",function(){return bI.append(b4,[_8.FloatValue(b5),_2.Create("type","number")]);});};bf.FloatInputUnchecked=function(b4,b5){return bf.InputInternal("input",function(){return bI.append(b4,[b5.Get()===0?_2.Create("value","0"):_6.EmptyAttr(),_8.FloatValueUnchecked(b5),_2.Create("type","number")]);});};bf.IntInput=function(b4,b5){return bf.InputInternal("input",function(){return bI.append(b4,[_8.IntValue(b5),_2.Create("type","number")]);});};bf.IntInputUnchecked=function(b4,b5){return bf.InputInternal("input",function(){return bI.append(b4,[b5.Get()===0?_2.Create("value","0"):_6.EmptyAttr(),_8.IntValueUnchecked(b5),_2.Create("type","number")]);});};bf.PasswordBox=function(b4,b5){return bf.InputInternal("input",function(){return bI.append(b4,[_8.Value(b5),_2.Create("type","password")]);});};bf.Input=function(b4,b5){return bf.InputInternal("input",function(){return bI.append(b4,[_8.Value(b5)]);});};bf.InputInternal=function(b4,b5){var b6;b6=r.CreateElement(b4);return bg.New(b6,_2.Concat(b5(b6)),bf.get_Empty());};bf.ConvertSeqVarBy=function(b4,b5,b6){return bf.Flatten(A.MapLens(b4,b5,b6));};bf.ConvertSeqBy=function(b4,b5,b6){return bf.Flatten(y.MapSeqCachedViewBy(b4,function(b7,b8){return(b5(b7))(b8);},b6));};bf.ConvertSeq=function(b4,b5){return bf.Flatten(y.MapSeqCachedView(b4,b5));};bf.ConvertBy=function(b4,b5,b6){return bf.Flatten(y.MapSeqCachedBy(b4,b5,b6));};bf.Convert=function(b4,b5){return bf.Flatten(y.MapSeqCached(b4,b5));};bf.Flatten=function(b4){return bf.EmbedView(y.Map(bf.Concat,b4));};bf.TextView=function(b4){var b5;b5=be.CreateTextNode();return bf.Mk({$:4,$0:b5},y.Map(function(b6){be.UpdateTextNode(b5,b6);},b4));};bf.RunReplaceById=function(b4,b5){var b6;b6=r.Doc().getElementById(b4);bL.Equals(b6,null)?bQ.FailWith("invalid id: "+b4):b5.ReplaceInDom(b6);};bf.RunById=function(b4,b5){var b6;b6=r.Doc().getElementById(b4);bL.Equals(b6,null)?bQ.FailWith("invalid id: "+b4):bf.Run(b6,b5);};bf.Run=function(b4,b5){be.LinkElement(b4,b5.docNode);bf.RunInPlace(false,b4,b5);};bf.RunInPlace=function(b4,b5,b6){var b7;b7=be.CreateRunState(b5,b6.docNode);y.Sink(T.get_UseAnimations()||_.BatchUpdatesEnabled()?n.StartProcessor(be.PerformAnimatedUpdate(b4,b7,b6.docNode)):function(){be.PerformSyncUpdate(b4,b7,b6.docNode);},b6.updates);};bf.RunPrependById=function(b4,b5){var b6;b6=r.Doc().getElementById(b4);bL.Equals(b6,null)?bQ.FailWith("invalid id: "+b4):bf.RunPrepend(b6,b5);};bf.RunPrepend=function(b4,b5){var b6;b6=self.document.createTextNode("");b4.insertBefore(b6,b4.firstChild);bf.RunBefore(b6,b5);};bf.RunAppendById=function(b4,b5){var b6;b6=r.Doc().getElementById(b4);bL.Equals(b6,null)?bQ.FailWith("invalid id: "+b4):bf.RunAppend(b6,b5);};bf.RunAppend=function(b4,b5){var b6;b6=self.document.createTextNode("");b4.appendChild(b6);bf.RunBefore(b6,b5);};bf.RunAfterById=function(b4,b5){var b6;b6=r.Doc().getElementById(b4);bL.Equals(b6,null)?bQ.FailWith("invalid id: "+b4):bf.RunAfter(b6,b5);};bf.RunAfter=function(b4,b5){var b6;b6=self.document.createTextNode("");b4.parentNode.insertBefore(b6,b4.nextSibling);bf.RunBetween(b4,b6,b5);};bf.RunBeforeById=function(b4,b5){var b6;b6=r.Doc().getElementById(b4);bL.Equals(b6,null)?bQ.FailWith("invalid id: "+b4):bf.RunBefore(b6,b5);};bf.RunBefore=function(b4,b5){var b6;b6=self.document.createTextNode("");b4.parentNode.insertBefore(b6,b4);bf.RunBetween(b6,b4,b5);};bf.RunBetween=function(b4,b5,b6){var b7;be.LinkPrevElement(b5,b6.docNode);b7=be.CreateDelimitedRunState(b4,b5,b6.docNode);y.Sink(T.get_UseAnimations()||_.BatchUpdatesEnabled()?n.StartProcessor(be.PerformAnimatedUpdate(false,b7,b6.docNode)):function(){be.PerformSyncUpdate(false,b7,b6.docNode);},b6.updates);};bf.Async=function(b4){return bf.EmbedView(y.MapAsync(a.id,y.Const(b4)));};bf.BindView=function(b4,b5){return bf.EmbedView(y.Map(b4,b5));};bf.EmbedView=function(b4){var b5;b5=be.CreateEmbedNode();return bf.Mk({$:2,$0:b5},y.Map(a.ignore,y.Bind(function(b6){be.UpdateEmbedNode(b5,b6.docNode);return b6.updates;},b4)));};bf.Verbatim=function(b4){var b5;return bf.Mk(d.MapTreeReduce(function(b6){return bL.Equals(b6.nodeType,bW.TEXT_NODE)?{$:5,$0:b6}:{$:1,$0:be.CreateElemNode(b6,_6.EmptyAttr(),null)};},null,function(b6,b7){return{$:0,$0:b6,$1:b7};},(b5=bX.parseHTML(b4),bL.Equals(b5,null)?[]:b5)),y.Const());};bf.StaticProxy=function(b4){return bg.New(b4,_6.EmptyAttr(),bf.get_Empty());};bf.TextNode=function(b4){return bf.Mk({$:5,$0:r.CreateText(b4)},y.Const());};bf.get_Empty=function(){return bf.Mk(null,y.Const());};bf.Concat=function(b4){var b5;b5=d.ofSeqNonCopying(b4);return d.TreeReduce(bf.get_Empty(),bf.Append,b5);};bf.Append=function(b4,b5){return bf.Mk({$:0,$0:b4.docNode,$1:b5.docNode},y.Map2Unit(b4.updates,b5.updates));};bf.Mk=function(b4,b5){return new bf.New(b4,b5);};bf.New=bK.Ctor(function(b4,b5){k.New.call(this);this.docNode=b4;this.updates=b5;},bf);bg=c.Elt=bK.Class({SetStyle:function(b4,b5){this.elt.style[b4]=b5;},HasClass:function(b4){return(new a.RegExp("(\\s|^)"+b4+"(\\s|$)")).test(this.elt.className);},GetProperty:function(b4){return this.elt[b4];},SetProperty:function(b4,b5){this.elt[b4]=b5;},RemoveAttribute:function(b4){this.elt.removeAttribute(b4);},HasAttribute:function(b4){return this.elt.hasAttribute(b4);},GetAttribute:function(b4){return this.elt.getAttribute(b4);},SetAttribute:function(b4,b5){this.elt.setAttribute(b4,b5);},SetText:function(b4){var b5;b5=this.docNode$1;b5!=null&&b5.$==1?b5.$0.Children=null:b5!=null&&b5.$==6?(b5.$0.Els=[],this.ClearHoles()):bQ.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());this.elt.textContent=b4;},GetText:function(){return this.elt.textContent;},SetValue:function(b4){this.elt.value=b4;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var b4;b4=this.docNode$1;b4!=null&&b4.$==1?b4.$0.Children=null:b4!=null&&b4.$==6?(b4.$0.Els=[],this.ClearHoles()):bQ.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(b4){var b5,b6,b7,b8,b9;b5=this.docNode$1;b5!=null&&b5.$==1?(b6=b5.$0,b6.Children={$:0,$0:b4.docNode,$1:b6.Children},be.InsertDoc(this.elt,b4.docNode,(b7=this.elt.firstChild,bL.Equals(b7,null)?null:b7))):b5!=null&&b5.$==6?(b8=this.elt.insertBefore(self.document.createTextNode(""),this.elt.firstChild),b9=be.InsertBeforeDelim(b8,b4.docNode),this.AddHole($.New(_6.Empty(this.elt),b4.docNode,{$:1,$0:[b9,b8]},this.elt,h.Int(),null))):bQ.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,b4.updates));},Append:function(b4){var b5,b6,b7,b8;b5=this.docNode$1;b5!=null&&b5.$==1?(b6=b5.$0,b6.Children={$:0,$0:b6.Children,$1:b4.docNode},be.InsertDoc(this.elt,b4.docNode,null)):b5!=null&&b5.$==6?(b7=this.elt.appendChild(self.document.createTextNode("")),b8=be.InsertBeforeDelim(b7,b4.docNode),this.AddHole($.New(_6.Empty(this.elt),b4.docNode,{$:1,$0:[b8,b7]},this.elt,h.Int(),null))):bQ.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,b4.updates));},ToUpdater:function(){var b4,b5,b6;return new bh.New((b4=this.docNode$1,b4!=null&&b4.$==1?bK.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,b4.$0.Attr]],Render:(b5=null,b5?b5.$0:void 0),El:(b6={$:1,$0:this.elt},b6?b6.$0:void 0)},["Render","El"]):b4!=null&&b4.$==6?b4.$0:bQ.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,A.Create$1([]));},OnAfterRenderView:function(b4,b5){var b6,b7;b6=this;b7=h.Id();this.Append(bf.BindView(function(b8){b6.elt[b7]=b8;return bf.get_Empty();},b4));return this["OnAfterRender'"](function(b8){b5(b8,b8[b7]);});},OnAfterRender:function(b4){return this["OnAfterRender'"](b4);},"OnAfterRender'":function(b4){var b5,b6,b7,b8,b9,b_,b$;b5=this.docNode$1;b5!=null&&b5.$==1?(b6=b5.$0,bK.SetOptional(b6,"Render",(b7=bK.GetOptional(b6.Render),b7!=null&&b7.$==1?(b8=b7.$0,{$:1,$0:function(ca){b8(ca);b4(ca);}}):{$:1,$0:b4}))):b5!=null&&b5.$==6?(b9=b5.$0,bK.SetOptional(b9,"Render",(b_=bK.GetOptional(b9.Render),b_!=null&&b_.$==1?(b$=b_.$0,{$:1,$0:function(ca){b$(ca);b4(ca);}}):{$:1,$0:b4}))):bQ.FailWith("Invalid docNode in Elt");return this;},onView:function(b4,b5,b6){var b7;b7=b6(this.elt);this.elt.addEventListener(b4,function(b8){return y.Get(b7(b8),b5);},false);return this;},on:function(b4,b5){var b6;b6=this;this.elt.addEventListener(b4,function(b7){return b5(b6.elt,b7);},false);return this;},ClearHoles:function(){var b4;b4=this.docNode$1;b4!=null&&b4.$==6?b4.$0.Holes=[]:void 0;},AddHole:function(b4){var b5;b5=this.docNode$1;b5!=null&&b5.$==6?b5.$0.Holes.push(b4):void 0;}},bf,bg);bg.TreeNode=function(b4,b5){var b6,b7;function b8(b9){return b9[1];}b6=B.Create(b5);return new bg.New$1({$:6,$0:b4},y.Map2Unit((b7=bC.map(function(b9){return _6.Updates(b8(b9));},b4.Attrs),d.TreeReduce(y.Const(),y.Map2Unit,b7)),b6.v),bC.get(b4.Els,0),b6);};bg.New=function(b4,b5,b6){var b7,b8;b7=be.CreateElemNode(b4,b5,b6.docNode);b8=B.Create(b6.updates);return new bg.New$1({$:1,$0:b7},y.Map2Unit(_6.Updates(b7.Attr),b8.v),b4,b8);};bg.New$1=bK.Ctor(function(b4,b5,b6,b7){bf.New.call(this,b4,b5);this.docNode$1=b4;this.updates$1=b5;this.elt=b6;this.rvUpdates=b7;},bg);bh=_3.EltUpdater=bK.Class({ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];this.holeUpdates.Set([]);},AddHole:function(b4){this.origHoles.push(b4);this.treeNode.Holes=this.treeNode.Holes.concat([b4]);},RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;this.holeUpdates.Set([]);},RemoveUpdated:function(b4){var b5,b6;function b7(b8){return b8!==b6;}b5=b4.docNode;b5!=null&&b5.$==1?(b6=b5.$0.ElKey,this.treeNode.Holes=bC.filter(function(b8){return b8.ElKey!==b6;},this.treeNode.Holes),this.holeUpdates.Set(bC.filter(function(b8){return b7(b8[0]);},this.holeUpdates.Get()))):bQ.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(b4){var b5,b6,b7;b5=b4.docNode;b5!=null&&b5.$==1?(b6=b5.$0,this.treeNode.Holes=this.treeNode.Holes.concat([b6]),b7=this.holeUpdates.Get(),b7.push([b6.ElKey,b4.updates]),this.holeUpdates.Set(b7)):bQ.FailWith("DocUpdater.AddUpdated expects a single element node");}},bg,bh);bh.New=bK.Ctor(function(b4,b5,b6,b7,b8){var b9,b_,b$,ca;function cb(cc){return cc[1];}bg.New$1.call(this,{$:6,$0:b4},y.Map2Unit(b5,(b9=b8.get_View(),y.BindInner((b_=function(cc){return bC.map(cb,cc);},(b$=(ca=y.Const(),function(cc){return d.TreeReduce(ca,y.Map2Unit,cc);}),function(cc){return b$(b_(cc));})),b9))),b6,b7);this.treeNode=b4;this.holeUpdates=b8;this.origHoles=this.treeNode.Holes;},bh);bi.$cctor=function(){bi.$cctor=a.ignore;bi.BatchUpdatesEnabled=true;};bk.failNotLoaded=function(b4){bM.warn("Instantiating non-loaded template",b4);};bk.fill=function(b4,b5,b6){while(true)if(b4.hasChildNodes())b6=b5.insertBefore(b4.lastChild,b6);else return null;};bk.fillTextHole=function(b4,b5,b6){var b7;b7=b4.querySelector("[ws-replace]");return bL.Equals(b7,null)?(bM.warn("Filling non-existent text hole",b6),null):(b7.parentNode.replaceChild(new a.Text(b5),b7),{$:1,$0:b7.getAttribute("ws-replace")});};bk.removeHolesExcept=function(b4,b5){function b6(b7){r.IterSelector(b4,"["+b7+"]",function(b8){if(!b5.Contains(b8.getAttribute(b7)))b8.removeAttribute(b7);});}b6("ws-attr");b6("ws-onafterrender");b6("ws-var");r.IterSelector(b4,"[ws-hole]",function(b7){if(!b5.Contains(b7.getAttribute("ws-hole"))){b7.removeAttribute("ws-hole");while(b7.hasChildNodes())b7.removeChild(b7.lastChild);}});r.IterSelector(b4,"[ws-replace]",function(b7){if(!b5.Contains(b7.getAttribute("ws-replace")))b7.parentNode.removeChild(b7);});r.IterSelector(b4,"[ws-on]",function(b7){b7.setAttribute("ws-on",bE.concat(" ",bC.filter(function(b8){return b5.Contains(bC.get(bE.SplitChars(b8,[":"],1),1));},bE.SplitChars(b7.getAttribute("ws-on"),[" "],1))));});r.IterSelector(b4,"[ws-attr-holes]",function(b7){var b8,b9,b_,b$,ca;b8=bE.SplitChars(b7.getAttribute("ws-attr-holes"),[" "],1);for(b9=0,b_=b8.length-1;b9<=b_;b9++){b$=bC.get(b8,b9);b7.setAttribute(b$,(ca=new a.RegExp(bj.TextHoleRE(),"g"),b7.getAttribute(b$).replace(ca,function(cb,cc){return b5.Contains(cc)?cb:"";})));}});};bk.fillInstanceAttrs=function(b4,b5){var b6,b7,b8,b9,b_;bk.convertAttrs(b5);b6=b5.nodeName.toLowerCase();b7=b4.querySelector("[ws-attr="+b6+"]");if(bL.Equals(b7,null))bM.warn("Filling non-existent attr hole",b6);else{b7.removeAttribute("ws-attr");for(b8=0,b9=b5.attributes.length-1;b8<=b9;b8++){b_=b5.attributes.item(b8);b_.name==="class"&&b7.hasAttribute("class")?b7.setAttribute("class",b7.getAttribute("class")+" "+b_.nodeValue):b7.setAttribute(b_.name,b_.nodeValue);}}};bk.mapHoles=function(b4,b5){function b6(b7){r.IterSelector(b4,"["+b7+"]",function(b8){var b9,b_;b9=(b_=null,[b5.TryGetValue(b8.getAttribute(b7).toLowerCase(),{get:function(){return b_;},set:function(b$){b_=b$;}}),b_]);b9[0]?b8.setAttribute(b7,b9[1]):void 0;});}b6("ws-hole");b6("ws-replace");b6("ws-attr");b6("ws-onafterrender");b6("ws-var");r.IterSelector(b4,"[ws-on]",function(b7){b7.setAttribute("ws-on",bE.concat(" ",bC.map(function(b8){var b9,b_,b$;b9=bE.SplitChars(b8,[":"],1);b_=(b$=null,[b5.TryGetValue(bC.get(b9,1),{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);return b_[0]?bC.get(b9,0)+":"+b_[1]:b8;},bE.SplitChars(b7.getAttribute("ws-on"),[" "],1))));});r.IterSelector(b4,"[ws-attr-holes]",function(b7){var b8,b9,b_;b8=bE.SplitChars(b7.getAttribute("ws-attr-holes"),[" "],1);for(b9=0,b_=b8.length-1;b9<=b_;b9++)(function(){var b$;function ca(cb,cc){var cd;cd=bQ.KeyValue(cc);return cb.replace(new a.RegExp("\\${"+cd[0]+"}","ig"),"${"+cd[1]+"}");}b$=bC.get(b8,b9);return b7.setAttribute(b$,(((bK.Curried3(bI.fold))(ca))(b7.getAttribute(b$)))(b5));}());});};bk.convertTextNode=function(b4){var b5,b6,b7,b8,b9,b_;b5=null;b6=0;b8=b4.textContent;b9=new a.RegExp(bj.TextHoleRE(),"g");while(b5=b9.exec(b8),b5!==null){b4.parentNode.insertBefore(self.document.createTextNode(bY.string(b8,{$:1,$0:b6},{$:1,$0:b9.lastIndex-bC.get(b5,0).length-1})),b4);b6=b9.lastIndex;b_=self.document.createElement("span");b_.setAttribute("ws-replace",bC.get(b5,1).toLowerCase());b4.parentNode.insertBefore(b_,b4);}b9.lastIndex=0;b4.textContent=bY.string(b8,{$:1,$0:b6},null);};bk.convertAttrs=function(b4){var b6,b7,b8,b9,b_,b$,ca,cb;function b5(cc){var cd;cd=b4.getAttribute(cc);cd===null?void 0:b4.setAttribute(cc,cd.toLowerCase());}b6=b4.attributes;b7=[];b8=[];b9=[];for(b_=0,b$=b6.length-1;b_<=b$;b_++){ca=b6.item(b_);bE.StartsWith(ca.nodeName,"ws-on")&&ca.nodeName!=="ws-onafterrender"&&ca.nodeName!=="ws-on"?(b7.push(ca.nodeName),b8.push(bY.string(ca.nodeName,{$:1,$0:"ws-on".length},null)+":"+ca.nodeValue.toLowerCase())):!bE.StartsWith(ca.nodeName,"ws-")&&(new a.RegExp(bj.TextHoleRE())).test(ca.nodeValue)?(ca.nodeValue=(cb=new a.RegExp(bj.TextHoleRE(),"g"),ca.nodeValue.replace(cb,function(cc,cd){return"${"+cd.toLowerCase()+"}";})),b9.push(ca.nodeName)):void 0;}!(b8.length==0)?b4.setAttribute("ws-on",bE.concat(" ",b8)):void 0;!(b9.length==0)?b4.setAttribute("ws-attr-holes",bE.concat(" ",b9)):void 0;b5("ws-hole");b5("ws-replace");b5("ws-attr");b5("ws-onafterrender");b5("ws-var");bC.iter(function(cc){b4.removeAttribute(cc);},b7);};bj.GetOrLoadTemplate=function(b4,b5,b6,b7){bj.LoadLocalTemplates("");bj.PrepareTemplate(b4,b5,b6);return bj.NamedTemplate(b4,b5,b7);};bj.NamedTemplate=function(b4,b5,b6){var b7,b8;b7=(b8=null,[bj.LoadedTemplateFile(b4).TryGetValue(b5==null?"":b5.$0,{get:function(){return b8;},set:function(b9){b8=b9;}}),b8]);return b7[0]?bj.ChildrenTemplate(b7[1].cloneNode(true),b6):(bM.warn("Local template doesn't exist",b5),bf.get_Empty());};bj.Template=function(b4,b5){return bj.ChildrenTemplate(bj.FakeRoot(b4),b5);};bj.RunFullDocTemplate=function(b4){var b5,b6;bj.LoadLocalTemplates("");bj.PrepareTemplateStrict("",null,r.ChildrenArray(self.document.body),{$:1,$0:self.document.body},null);b5=bj.ChildrenTemplate(self.document.body,b4);b6=self.document.body;(function(b7){bf.RunInPlace(true,b6,b7);}(b5));return b5;};bj.LoadLocalTemplates=function(b4){!bj.LocalTemplatesLoaded()?(bj.set_LocalTemplatesLoaded(true),bj.LoadNestedTemplates(self.document.body,"")):void 0;bj.LoadedTemplates().set_Item(b4,bj.LoadedTemplateFile(""));};bj.LoadNestedTemplates=function(b4,b5){var b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci;function b6(cj){var ck,cl;if(!b7.ContainsKey(cj)){ck=(cl=null,[b8.TryGetValue(cj,{get:function(){return cl;},set:function(cm){cl=cm;}}),cl]);ck[0]?(ci.Add(cj),b8.Remove(cj),bj.PrepareTemplateStrict(b5,{$:1,$0:cj},ck[1][0],{$:1,$0:ck[1][1]},{$:1,$0:b6})):bM.warn(ci.Contains(cj)?"Encountered loop when instantiating "+cj:"Local template does not exist: "+cj);}}b7=bj.LoadedTemplateFile(b5);b8=new bT.New$5();b9=b4.querySelectorAll("[ws-template]");for(b_=0,b$=b9.length-1;b_<=b$;b_++){ca=b9[b_];cb=ca.getAttribute("ws-template").toLowerCase();ca.removeAttribute("ws-template");b8.set_Item(cb,[[ca],bj.FakeRootSingle(ca)]);}cc=b4.querySelectorAll("[ws-children-template]");for(cd=0,ce=cc.length-1;cd<=ce;cd++){cf=cc[cd];cg=cf.getAttribute("ws-children-template").toLowerCase();cf.removeAttribute("ws-children-template");b8.set_Item(cg,(ch=r.ChildrenArray(cf),[ch,bj.FakeRoot(ch)]));}ci=new bH.New$3();while(b8.count>0)b6(bI.head(b8.get_Keys()));};bj.PrepareTemplate=function(b4,b5,b6){var b7,b8,b9,b_,b$;if(!bj.LoadedTemplateFile(b4).ContainsKey(b5==null?"":b5.$0)){b7=b6();for(b8=0,b9=b7.length-1;b8<=b9;b8++){b_=bC.get(b7,b8);b$=b_.parentNode;bL.Equals(b$,null)?void 0:b$.removeChild(b_);}bj.PrepareTemplateStrict(b4,b5,b7,null,null);}};bj.PrepareSingleTemplate=function(b4,b5,b6){var b7,b8,b9;b7=bj.FakeRootSingle(b6);b8=[b6];b9={$:1,$0:b7};return function(b_){bj.PrepareTemplateStrict(b4,b5,b8,b9,b_);};};bj.PrepareTemplateStrict=function(b4,b5,b6,b7,b8){var b9,b_;function b$(ce,cf){var cg,ch,ci,cj,ck,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG;function cl(cH){}while(true)switch(ce){case 0:if(cf!==null){cg=cf.nextSibling;if(bL.Equals(cf.nodeType,bW.TEXT_NODE))bk.convertTextNode(cf);else if(bL.Equals(cf.nodeType,bW.ELEMENT_NODE))cb(cf);cf=cg;}else return null;break;case 1:cm=bY.string(cf.nodeName,{$:1,$0:3},null).toLowerCase();cn=(ch=cm.indexOf("."),ch===-1?[b4,cm]:[bY.string(cm,null,{$:1,$0:ch-1}),bY.string(cm,{$:1,$0:ch+1},null)]);co=cn[1];cp=cn[0];if(cp!==""&&!bj.LoadedTemplates().ContainsKey(cp))return bk.failNotLoaded(co);else{if(cp===""&&b8!=null)b8.$0(co);cq=bj.LoadedTemplates().get_Item(cp);if(!cq.ContainsKey(co))return bk.failNotLoaded(co);else{cr=cq.get_Item(co);cs=cr.cloneNode(true);ct=new bH.New$3();cu=new bT.New$5();cv=cf.attributes;for(cw=0,cx=cv.length-1;cw<=cx;cw++){cy=cv.item(cw).name.toLowerCase();cu.set_Item(cy,(cz=cv.item(cw).nodeValue,cz===""?cy:cz.toLowerCase()));!ct.Add(cy)?bM.warn("Hole mapped twice",cy):void 0;}for(cA=0,cB=cf.childNodes.length-1;cA<=cB;cA++){cC=cf.childNodes[cA];bL.Equals(cC.nodeType,bW.ELEMENT_NODE)?!ct.Add(cC.nodeName.toLowerCase())?bM.warn("Hole filled twice",co):void 0:void 0;}cD=cf.childNodes.length===1&&bL.Equals(cf.firstChild.nodeType,bW.TEXT_NODE);if(cD){cj=bk.fillTextHole(cs,cf.firstChild.textContent,co);((function(cH){return function(cI){if(cI!=null)cH(cI.$0);};}((ck=function(cH){return function(cI){return cH.Add(cI);};}(ct),function(cH){return cl(ck(cH));})))(cj));}bk.removeHolesExcept(cs,ct);if(!cD){for(cE=0,cF=cf.childNodes.length-1;cE<=cF;cE++){cG=cf.childNodes[cE];bL.Equals(cG.nodeType,bW.ELEMENT_NODE)?cG.hasAttributes()?bk.fillInstanceAttrs(cs,cG):ca(cs,cG):void 0;}}bk.mapHoles(cs,cu);bk.fill(cs,cf.parentNode,cf);cf.parentNode.removeChild(cf);return;}}break;}}function ca(ce,cf){var cg,ci,cj;function ch(ck,cl){var cm,cn,co;if(ci==="title"&&cf.hasChildNodes()){cm=bX.parseHTML(cf.textContent);cf.removeChild(cf.firstChild);for(cn=0,co=cm.length-1;cn<=co;cn++)cf.appendChild(bC.get(cm,cn));}else null;cb(cf);return bk.fill(cf,ck,cl);}ci=cf.nodeName.toLowerCase();r.IterSelector(ce,"[ws-attr-holes]",function(ck){var cl,cm,cn,co,cp;cl=bE.SplitChars(ck.getAttribute("ws-attr-holes"),[" "],1);for(cm=0,cn=cl.length-1;cm<=cn;cm++){co=bC.get(cl,cm);ck.setAttribute(co,(cp=new a.RegExp("\\${"+ci+"}","ig"),ck.getAttribute(co).replace(cp,cf.textContent)));}});cj=ce.querySelector("[ws-hole="+ci+"]");if(bL.Equals(cj,null)){cg=ce.querySelector("[ws-replace="+ci+"]");return bL.Equals(cg,null)?null:(ch(cg.parentNode,cg),void cg.parentNode.removeChild(cg));}else{while(cj.hasChildNodes())cj.removeChild(cj.lastChild);cj.removeAttribute("ws-hole");return ch(cj,null);}}function cb(ce){if(bE.StartsWith(ce.nodeName.toLowerCase(),"ws-"))cd(ce);else{bk.convertAttrs(ce);cc(ce.firstChild);}}function cc(ce){return b$(0,ce);}function cd(ce){return b$(1,ce);}b9=b7==null?bj.FakeRoot(b6):b7.$0;b_=(b5==null?"":b5.$0).toLowerCase();bj.LoadedTemplateFile(b4).set_Item(b_,b9);bC.length(b6)>0?(function(ce){var cf,cg,ch,ci;while(true){cf=ce.querySelector("[ws-template]");if(bL.Equals(cf,null)){cg=ce.querySelector("[ws-children-template]");if(bL.Equals(cg,null))return null;else{ch=cg.getAttribute("ws-children-template");cg.removeAttribute("ws-children-template");bj.PrepareTemplateStrict(b4,{$:1,$0:ch},r.ChildrenArray(cg),null,null);ce=ce;}}else{ci=cf.getAttribute("ws-template");(bj.PrepareSingleTemplate(b4,{$:1,$0:ci},cf))(null);ce=ce;}}}(b9),cc(bC.get(b6,0))):void 0;};bj.FakeRootSingle=function(b4){var b5,b6,b7;b4.removeAttribute("ws-template");b5=b4.getAttribute("ws-replace");b5===null?void 0:(b4.removeAttribute("ws-replace"),b6=b4.parentNode,bL.Equals(b6,null)?void 0:(b7=self.document.createElement(b4.tagName),b7.setAttribute("ws-replace",b5),b6.replaceChild(b7,b4)));return bj.FakeRoot([b4]);};bj.FakeRoot=function(b4){var b5,b6,b7;b5=self.document.createElement("div");for(b6=0,b7=b4.length-1;b6<=b7;b6++)b5.appendChild(bC.get(b4,b6));return b5;};bj.ChildrenTemplate=function(b4,b5){var b6,b7,b8,b9,b_;b6=bj.InlineTemplate(b4,b5);b7=b6[1];b8=b6[0];b9=b8.Els;return!bL.Equals(b9,null)&&b9.length===1&&(bC.get(b9,0)instanceof bW&&(bL.Equals(bC.get(b9,0).nodeType,bW.ELEMENT_NODE)&&(b_=bC.get(b9,0),true)))?bg.TreeNode(b8,b7):bf.Mk({$:6,$0:b8},b7);};bj.InlineTemplate=function(b4,b5){var b6,b7,b8,b9,ca,cb,cc,cd,ce,cf,cg;function b_(ch,ci){var cj,ck,cl;cj=_6.Insert(ch,ci);cb.push(_6.Updates(cj));cc.push([ch,cj]);ck=bK.GetOptional(cj.OnAfterRender);return ck==null?null:(cl=ck.$0,void cd.push(function(){cl(ch);}));}function b$(ch){var ci,cj;ci=(cj=null,[ce.TryGetValue(ch,{get:function(){return cj;},set:function(ck){cj=ck;}}),cj]);return ci[0]?ci[1].$==0?{$:1,$0:ci[1].$1}:ci[1].$==1?{$:1,$0:bf.TextNode(ci[1].$1)}:ci[1].$==2?{$:1,$0:bf.TextView(ci[1].$1)}:ci[1].$==8?{$:1,$0:bf.TextView(ci[1].$1.get_View())}:ci[1].$==9?{$:1,$0:bf.TextView(y.Map(a.String,ci[1].$1.get_View()))}:ci[1].$==10?{$:1,$0:bf.TextView(y.Map(function(ck){return ck.get_Input();},ci[1].$1.get_View()))}:ci[1].$==11?{$:1,$0:bf.TextView(y.Map(a.String,ci[1].$1.get_View()))}:ci[1].$==12?{$:1,$0:bf.TextView(y.Map(function(ck){return ck.get_Input();},ci[1].$1.get_View()))}:ci[1].$==13?{$:1,$0:bf.TextView(y.Map(a.String,ci[1].$1.get_View()))}:(bM.warn("Content hole filled with attribute data",ch),null):null;}ca=[];cb=[];cc=[];cd=[];ce=new bT.New$5();cf=bD.Get(b5);try{while(cf.MoveNext()){cg=cf.Current();ce.set_Item(cg.$0,cg);}}finally{if(typeof cf=="object"&&"Dispose"in cf)cf.Dispose();}b6=r.ChildrenArray(b4);r.IterSelector(b4,"[ws-hole]",function(ch){var ci,cj,ck;ck=ch.getAttribute("ws-hole");ch.removeAttribute("ws-hole");while(ch.hasChildNodes())ch.removeChild(ch.lastChild);ci=b$(ck);ci!=null&&ci.$==1?(cj=ci.$0,be.LinkElement(ch,cj.docNode),ca.push($.New(_6.Empty(ch),cj.docNode,null,ch,h.Int(),null)),cb.push(cj.updates)):void 0;});r.IterSelector(b4,"[ws-replace]",function(ch){var ci,cj,ck,cl,cm,cn;ci=b$(ch.getAttribute("ws-replace"));ci!=null&&ci.$==1?(cj=ci.$0,ck=ch.parentNode,cl=self.document.createTextNode(""),ck.replaceChild(cl,ch),cm=be.InsertBeforeDelim(cl,cj.docNode),cn=bC.tryFindIndex(function(co){return ch===co;},b6),cn==null?void 0:bC.set(b6,cn.$0,cj.docNode),ca.push($.New(_6.Empty(ck),cj.docNode,{$:1,$0:[cm,cl]},ck,h.Int(),null)),cb.push(cj.updates)):void 0;});r.IterSelector(b4,"[ws-attr]",function(ch){var ci,cj,ck;ci=ch.getAttribute("ws-attr");ch.removeAttribute("ws-attr");cj=(ck=null,[ce.TryGetValue(ci,{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);cj[0]?cj[1].$==3?b_(ch,cj[1].$1):bM.warn("Attribute hole filled with non-attribute data",ci):void 0;});r.IterSelector(b4,"[ws-on]",function(ch){b_(ch,_2.Concat(bC.choose(function(ci){var cj,ck,cl;cj=bE.SplitChars(ci,[":"],1);ck=(cl=null,[ce.TryGetValue(bC.get(cj,1),{get:function(){return cl;},set:function(cm){cl=cm;}}),cl]);return ck[0]?ck[1].$==4?{$:1,$0:_8.Handler(bC.get(cj,0),ck[1].$1)}:ck[1].$==5?{$:1,$0:_2.Handler(bC.get(cj,0),ck[1].$2)}:(bM.warn("Event hole on"+bC.get(cj,0)+" filled with non-event data",bC.get(cj,1)),null):null;},bE.SplitChars(ch.getAttribute("ws-on"),[" "],1))));ch.removeAttribute("ws-on");});r.IterSelector(b4,"[ws-onafterrender]",function(ch){var ci,cj,ck;ci=ch.getAttribute("ws-onafterrender");cj=(ck=null,[ce.TryGetValue(ci,{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);cj[0]?cj[1].$==6?(ch.removeAttribute("ws-onafterrender"),b_(ch,_8.OnAfterRender(cj[1].$1))):cj[1].$==7?(ch.removeAttribute("ws-onafterrender"),b_(ch,_8.OnAfterRender(cj[1].$1))):bM.warn("onafterrender hole filled with non-onafterrender data",ci):void 0;});r.IterSelector(b4,"[ws-var]",function(ch){var ci,cj,ck;ci=ch.getAttribute("ws-var");ch.removeAttribute("ws-var");cj=(ck=null,[ce.TryGetValue(ci,{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);cj[0]?cj[1].$==8?b_(ch,_8.Value(cj[1].$1)):cj[1].$==9?b_(ch,_8.Checked(cj[1].$1)):cj[1].$==10?b_(ch,_8.IntValue(cj[1].$1)):cj[1].$==11?b_(ch,_8.IntValueUnchecked(cj[1].$1)):cj[1].$==12?b_(ch,_8.FloatValue(cj[1].$1)):cj[1].$==13?b_(ch,_8.FloatValueUnchecked(cj[1].$1)):bM.warn("Var hole filled with non-Var data",ci):void 0;});r.IterSelector(b4,"[ws-attr-holes]",function(ch){var ci,cj,ck,cl;ci=new a.RegExp(bj.TextHoleRE(),"g");cj=bE.SplitChars(ch.getAttribute("ws-attr-holes"),[" "],1);ch.removeAttribute("ws-attr-holes");for(ck=0,cl=cj.length-1;ck<=cl;ck++)(function(){var cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy;cv=bC.get(cj,ck);cw=ch.getAttribute(cv);cm=null;cn=0;cx=[];while(cm=ci.exec(cw),cm!==null){cy=bY.string(cw,{$:1,$0:cn},{$:1,$0:ci.lastIndex-bC.get(cm,0).length-1});cn=ci.lastIndex;cx.push([cy,bC.get(cm,1)]);}cp=bY.string(cw,{$:1,$0:cn},null);ci.lastIndex=0;cq=bC.foldBack(function(cz,cA){return(function(cB){var cC,cD;cC=cB[0];cD=cB[1];return function(cE){var cF,cG,cH,cI,cJ;cF=cE[0];cG=cE[1];cH=(cI=(cJ=null,[ce.TryGetValue(cD,{get:function(){return cJ;},set:function(cK){cJ=cK;}}),cJ]),cI[0]?cI[1].$==1?{$:0,$0:cI[1].$1}:cI[1].$==2?{$:1,$0:cI[1].$1}:cI[1].$==8?{$:1,$0:cI[1].$1.get_View()}:cI[1].$==9?{$:1,$0:y.Map(a.String,cI[1].$1.get_View())}:cI[1].$==10?{$:1,$0:y.Map(function(cK){return cK.get_Input();},cI[1].$1.get_View())}:cI[1].$==11?{$:1,$0:y.Map(a.String,cI[1].$1.get_View())}:cI[1].$==12?{$:1,$0:y.Map(function(cK){return cK.get_Input();},cI[1].$1.get_View())}:cI[1].$==13?{$:1,$0:y.Map(a.String,cI[1].$1.get_View())}:(bM.warn("Attribute value hole filled with non-text data",cD),{$:0,$0:""}):{$:0,$0:""});return cH.$==1?[cC,new bB.T({$:1,$0:cF===""?cH.$0:y.Map(function(cK){return cK+cF;},cH.$0),$1:cG})]:[cC+cH.$0+cF,cG];};}(cz))(cA);},cx,[cp,bB.T.Empty]);return b_(ch,cq[1].$==1?cq[1].$1.$==1?cq[1].$1.$1.$==1?cq[1].$1.$1.$1.$==0?(cr=cq[0],_8.Dynamic(cv,y.Map3(function(cz,cA,cB){return cr+cz+cA+cB;},cq[1].$0,cq[1].$1.$0,cq[1].$1.$1.$0))):(cs=cq[0],_8.Dynamic(cv,y.Map(function(cz){return cs+bE.concat("",cz);},y.Sequence(cq[1])))):(ct=cq[0],_8.Dynamic(cv,y.Map2(function(cz,cA){return ct+cz+cA;},cq[1].$0,cq[1].$1.$0))):cq[0]===""?_8.Dynamic(cv,cq[1].$0):(cu=cq[0],_8.Dynamic(cv,y.Map(function(cz){return cu+cz;},cq[1].$0))):_2.Create(cv,cq[0]));}());});return[bK.DeleteEmptyFields({Els:b6,Dirty:true,Holes:ca,Attrs:cc,Render:(b7=cd.length==0?null:{$:1,$0:function(ch){bC.iter(function(ci){ci(ch);},cd);}},b7?b7.$0:void 0),El:(b8=!bL.Equals(b6,null)&&b6.length===1&&(bC.get(b6,0)instanceof bW&&(bC.get(b6,0)instanceof a.Element&&(b9=bC.get(b6,0),true)))?{$:1,$0:b9}:null,b8?b8.$0:void 0)},["Render","El"]),d.TreeReduce(y.Const(),y.Map2Unit,cb)];};bj.TextHoleRE=function(){bl.$cctor();return bl.TextHoleRE;};bj.LocalTemplatesLoaded=function(){bl.$cctor();return bl.LocalTemplatesLoaded;};bj.set_LocalTemplatesLoaded=function(b4){bl.$cctor();bl.LocalTemplatesLoaded=b4;};bj.LoadedTemplateFile=function(b4){var b5,b6,b7;b5=(b6=null,[bj.LoadedTemplates().TryGetValue(b4,{get:function(){return b6;},set:function(b8){b6=b8;}}),b6]);return b5[0]?b5[1]:(b7=new bT.New$5(),(bj.LoadedTemplates().set_Item(b4,b7),b7));};bj.LoadedTemplates=function(){bl.$cctor();return bl.LoadedTemplates;};bl.$cctor=function(){bl.$cctor=a.ignore;bl.LoadedTemplates=new bT.New$5();bl.LocalTemplatesLoaded=false;bl.TextHoleRE="\\${([^}]+)}";};bm=c.Flow=bK.Class({get_Render:function(){return this.render;}},k,bm);bm.New=bK.Ctor(function(b4){bm.New$1.call(this,function(b5){return function(b6){return A.Set(b5,b4(b6));};});},bm);bm.New$1=bK.Ctor(function(b4){k.New.call(this);this.render=b4;},bm);bm.get_Do=function(){return new bn.New();};bm.Static=function(b4){return new bm.New$1(function(b5){return function(b6){A.Set(b5,b4);return b6();};});};bm.Define=function(b4){return new bm.New(function(b5){return b4(function(b6){b5(b6);});});};bm.Embed=function(b4){var b5;b5=A.Create$1(bf.get_Empty());((b4.get_Render())(b5))(a.ignore);return bf.EmbedView(b5.get_View());};bm.Return=function(b4){return new bm.New$1(function(){return function(b5){return b5(b4);};});};bm.Bind=function(b4,b5){return new bm.New$1(function(b6){return function(b7){return((b4.get_Render())(b6))(function(b8){((b5(b8).get_Render())(b6))(b7);});};});};bm.Map=function(b4,b5){return new bm.New$1(function(b6){return function(b7){return((b5.get_Render())(b6))(function(b8){b7(b4(b8));});};});};bn=c.FlowBuilder=bK.Class({ReturnFrom:a.id,Return:function(b4){return bm.Return(b4);},Bind:function(b4,b5){return bm.Bind(b4,b5);}},k,bn);bn.New=bK.Ctor(function(){k.New.call(this);},bn);bp=bo.attr=bK.Class({},k,bp);bp.New=bK.Ctor(function(){k.New.call(this);},bp);bq.InstallHash=function(b4,b5){var b6;b6=A.Create$1(bq.getCurrentHash(function(b7){return b0.Parse(b5,b1.FromHash(b7,{$:1,$0:true}));},b4));bq.InstallHashInto(b6,b4,b5);return b6;};bq.InstallHashInto=function(b4,b5,b6){function b7(b_){return b0.Parse(b6,b1.FromHash(b_,{$:1,$0:true}));}function b8(){return bq.getCurrentHash(b7,b5);}function b9(b_){if(!bL.Equals(b4.Get(),b_))b4.Set(b_);}self.addEventListener("popstate",function(){return b9(b8());},false);self.addEventListener("hashchange",function(){return b9(b8());},false);self.document.body.addEventListener("click",function(b_){var b$,ca,cb;b$=(ca=bq.findLinkHref(b_.target),ca==null?null:(cb=ca.$0,bE.StartsWith(cb,"#")?b7(cb):null));return b$==null?null:(b9(b$.$0),b_.preventDefault());},false);y.Sink(function(b_){var b$;if(!bL.Equals(b_,b8())){b$=b0.HashLink(b6,b_);self.history.pushState(null,null,b$);}},b4.get_View());};bq.getCurrentHash=function(b4,b5){var b6,b7;b6=self.location.hash;b7=b4(b6);return b7==null?((function(b8){return function(b9){return b8("Failed to parse route: "+b2.toSafe(b9));};}(function(b8){bM.log(b8);}))(b6),b5):b7.$0;};bq.Install=function(b4,b5){var b6;b6=A.Create$1(bq.getCurrent(function(b7){return b0.Parse(b5,b7);},b4));bq.InstallInto(b6,b4,b5);return b6;};bq.InstallInto=function(b4,b5,b6){function b7(b_){return b0.Parse(b6,b_);}function b8(){return bq.getCurrent(b7,b5);}function b9(b_){if(!bL.Equals(b4.Get(),b_))b4.Set(b_);}self.addEventListener("popstate",function(){return b9(b8());},false);self.document.body.addEventListener("click",function(b_){var b$,ca,cb;b$=(ca=(cb=bq.findLinkHref(b_.target),cb==null?null:bq.hrefToAbsolute(cb.$0)),ca==null?null:b7(b1.FromUrl(ca.$0,null)));return b$==null?null:(b9(b$.$0),b_.preventDefault());},false);y.Sink(function(b_){var b$;if(!bL.Equals(b_,b8())){b$=b0.Link(b6,b_);self.history.pushState(null,null,b$);}},b4.get_View());};bq.findLinkHref=function(b4){while(true)if(b4.tagName==="A")return b3.ofObj(b4.getAttribute("href"));else if(b4===self.document.body)return null;else b4=b4.parentNode;};bq.hrefToAbsolute=function(b4){var b5;return bE.StartsWith(b4,"?")?{$:1,$0:bq.trimFragment(self.location.pathname+b4)}:bE.StartsWith(b4,"#")?null:bE.StartsWith(b4,"/")?{$:1,$0:bq.trimFragment(b4)}:(new a.RegExp("^[a-zA-Z0-9]:")).test(b4)?null:(b5=self.location.pathname,{$:1,$0:bq.trimFragment(bY.string(b5,null,{$:1,$0:b5.lastIndexOf("/")})+b4)});};bq.trimFragment=function(b4){var b5;b5=b4.indexOf("#");return b5===-1?b4:bY.string(b4,null,{$:1,$0:b5-1});};bq.getCurrent=function(b4,b5){var b6,b7,b8;b6=self.location;b7=b1.FromUrl(b6.pathname+b6.search,null);b8=b4(b7);return b8==null?((function(b9){return function(b_){return b9("Failed to parse route: "+b2.toSafe(b_));};}(function(b9){bM.log(b9);}))(b7.ToLink()),b5):b8.$0;};br.Append=function(b4,b5){return{$:0,$0:p.Append(b4.$0,b5.$0),$1:bO.FoldBack(function(b6,b7,b8){return b8.Add(b6,b7);},b4.$1,b5.$1)};};br.FromList=function(b4,b5){return{$:0,$0:p.FromArray(bC.ofList(b4)),$1:b5};};br.ToList=function(b4){return[bB.ofArray(p.ToArray(b4.$0)),b4.$1];};br.SameHash=function(b4,b5){return br.NoHash(b4)===br.NoHash(b5);};br.MakeHash=function(b4){var b5,b6;b5=b4.$1;b6=bE.concat("/",bC.map(function(b7){return a.encodeURIComponent(b7);},p.ToArray(b4.$0)));return b5.get_IsEmpty()?b6:b6+"?"+bE.concat("&",bI.map(function(b7){var b8;b8=bQ.KeyValue(b7);return a.encodeURIComponent(b8[0])+"="+a.encodeURIComponent(b8[1]);},b5));};br.ParseHash=function(b4){var b5,b6,b7,b8;b5=br.NoHash(b4);b6=(b7=b5.indexOf("?"),b7===-1?[b5,""]:[bY.string(b5,null,{$:1,$0:b7-1}),bY.string(b5,{$:1,$0:b7+1},null)]);b8=b6[0];return{$:0,$0:p.FromArray(b8===""?[]:bC.map(function(b9){return a.decodeURIComponent(b9);},bE.SplitChars(b8,["/"],0))),$1:bO.OfArray(bC.map(function(b9){var b_;b_=b9.indexOf("=");return b_===-1?[a.decodeURIComponent(b9),""]:[a.decodeURIComponent(bY.string(b9,null,{$:1,$0:b_-1})),a.decodeURIComponent(bY.string(b9,{$:1,$0:b_+1},null))];},bE.SplitChars(b6[1],["&"],0)))};};br.NoHash=function(b4){return bE.StartsWith(b4,"#")?b4.substring(1):b4;};bs.DoLink=function(b4,b5){var b6;b6=b4.Ser(b5);return br.FromList(b6[0],b6[1]);};bs.DoRoute=function(b4,b5){return b4.Des(br.ToList(b5));};bs.InstallMap=function(b4){var b5;function b6(b_,b$){return bL.Equals(b4.Ser(b_),b4.Ser(b$));}function b7(){return b4.Des(br.ToList(br.ParseHash(self.location.hash)));}function b8(b_){if(!b6(b5.Get(),b_))b5.Set(b_);}function b9(b_){return b8(b7());}b5=A.Create$1(b7());self.onpopstate=b9;self.onhashchange=b9;y.Sink(function(b_){var b$,ca;b$=br.MakeHash((ca=b4.Ser(b_),br.FromList(ca[0],ca[1])));!br.SameHash(self.location.hash,b$)?self.location.replace("#"+b$):void 0;},b5.get_View());return b5;};bt.Install=function(b4){return bs.InstallMap(b4);};bt.Create=function(b4,b5){function b6(b7){return b7[0];}return{Des:function(b7){return b5(b6(b7));},Ser:function(b7){return[b4(b7),new bP.New([])];}};};bt.CreateWithQuery=function(b4,b5){return{Des:b5,Ser:b4};};bv.New=function(b4,b5){return{Active:b4,PosV:b5};};bw.New=function(b4,b5,b6,b7){return{Active:b4,Left:b5,Middle:b6,Right:b7};};bx.get_MousePressed=function(){bu.ActivateButtonListener();return y.Apply(y.Apply(y.Apply(y.Const(bK.Curried3(function(b4,b5,b6){return b4||b5||b6;})),bu.MouseBtnSt$1().Left.get_View()),bu.MouseBtnSt$1().Middle.get_View()),bu.MouseBtnSt$1().Right.get_View());};bx.get_RightPressed=function(){bu.ActivateButtonListener();return bu.MouseBtnSt$1().Right.get_View();};bx.get_MiddlePressed=function(){bu.ActivateButtonListener();return bu.MouseBtnSt$1().Middle.get_View();};bx.get_LeftPressed=function(){bu.ActivateButtonListener();return bu.MouseBtnSt$1().Left.get_View();};bx.get_Position=function(){!bu.MousePosSt$1().Active?(self.document.addEventListener("mousemove",function(b4){A.Set(bu.MousePosSt$1().PosV,[b4.clientX,b4.clientY]);},false),bu.MousePosSt$1().Active=true):void 0;return bu.MousePosSt$1().PosV.get_View();};by.New=function(b4,b5,b6){return{KeysPressed:b4,KeyListenerActive:b5,LastPressed:b6};};bz.IsPressed=function(b4){function b5(b6){return b6===b4;}bu.ActivateKeyListener();return y.Map(function(b6){return bB.exists(b5,b6);},bu.KeyListenerState().KeysPressed.get_View());};bz.get_LastPressed=function(){bu.ActivateKeyListener();return bu.KeyListenerState().LastPressed.get_View();};bz.get_KeysPressed=function(){bu.ActivateKeyListener();return bu.KeyListenerState().KeysPressed.get_View();};bu.ActivateKeyListener=function(){bA.$cctor();return bA.ActivateKeyListener;};bu.KeyListenerState=function(){bA.$cctor();return bA.KeyListenerState;};bu.ActivateButtonListener=function(){bA.$cctor();return bA.ActivateButtonListener;};bu.MouseBtnSt$1=function(){bA.$cctor();return bA.MouseBtnSt;};bu.MousePosSt$1=function(){bA.$cctor();return bA.MousePosSt;};bA.$cctor=function(){bA.$cctor=a.ignore;function b4(b5,b6){var b7;b7=b5.button;return b7===0?A.Set(bu.MouseBtnSt$1().Left,b6):b7===1?A.Set(bu.MouseBtnSt$1().Middle,b6):b7===2?A.Set(bu.MouseBtnSt$1().Right,b6):null;}bA.MousePosSt=bv.New(false,A.Create$1([0,0]));bA.MouseBtnSt=bw.New(false,A.Create$1(false),A.Create$1(false),A.Create$1(false));bA.ActivateButtonListener=!bu.MouseBtnSt$1().Active?(bu.MouseBtnSt$1().Active=true,self.document.addEventListener("mousedown",function(b5){return b4(b5,true);},false),self.document.addEventListener("mouseup",function(b5){return b4(b5,false);},false)):null;bA.KeyListenerState=by.New(A.Create$1(bB.T.Empty),false,A.Create$1(-1));bA.ActivateKeyListener=!bu.KeyListenerState().KeyListenerActive?(bX(self.document).keydown(function(b5){var b6,b7;b6=b5.which;A.Set(bu.KeyListenerState().LastPressed,b6);b7=bu.KeyListenerState().KeysPressed.Get();return!bB.exists(function(b8){return b8===b6;},b7)?bu.KeyListenerState().KeysPressed.Set(bB.append(b7,bB.ofArray([b6]))):null;}),void bX(self.document).keyup(function(b5){var b6;function b7(b8){return b8!==b6;}b6=b5.which;return A.Update(bu.KeyListenerState().KeysPressed,function(b8){return bB.filter(b7,b8);});})):null;};}());

//# sourceMappingURL=WebSharper.UI.min.map