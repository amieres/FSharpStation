(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT;a=window;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Array=c.Array||{};e=c.String=c.String||{};f=c.List=c.List||{};g=c.Abbrev=c.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=b&&b.Obj;l=g.Slot=g.Slot||{};m=g.Async=g.Async||{};n=g.Mailbox=g.Mailbox||{};o=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};p=c.AppendList=c.AppendList||{};q=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};r=c.DomUtility=c.DomUtility||{};s=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};t=c.Trie=c.Trie||{};u=t.LookupResult=t.LookupResult||{};v=a.StartupCode$WebSharper_UI$Trie=a.StartupCode$WebSharper_UI$Trie||{};w=c.Snap=c.Snap||{};x=c.Var=c.Var||{};y=c.View=c.View||{};z=c.ConcreteVar=c.ConcreteVar||{};A=c.Updates=c.Updates||{};B=c.ViewBuilder=c.ViewBuilder||{};C=c.Submitter=c.Submitter||{};D=c.Key=c.Key||{};E=c.Model=c.Model||{};F=c.Serializer=c.Serializer||{};G=c.Storage=c.Storage||{};H=G.ArrayStorage=G.ArrayStorage||{};I=G.LocalStorageBackend=G.LocalStorageBackend||{};J=c.ListModel=c.ListModel||{};K=c.ListModels=c.ListModels||{};L=a.StartupCode$WebSharper_UI$Models=a.StartupCode$WebSharper_UI$Models||{};M=c.ReactiveExtensions=c.ReactiveExtensions||{};N=c.DoubleInterpolation=c.DoubleInterpolation||{};O=c.Interpolation=c.Interpolation||{};P=c.Easing=c.Easing||{};Q=c.Easings=c.Easings||{};R=c.An=c.An||{};S=c.Anims=c.Anims||{};T=c.Trans=c.Trans||{};U=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};V=c.AnimatedAttrNode=c.AnimatedAttrNode||{};W=c.DynamicAttrNode=c.DynamicAttrNode||{};X=c.AttrProxy=c.AttrProxy||{};Y=c.Client=c.Client||{};Z=Y.Attrs=Y.Attrs||{};_0=Z.Dyn=Z.Dyn||{};_1=c.Attrs=c.Attrs||{};_2=c.CheckedInput=c.CheckedInput||{};_3=c.AttrModule=c.AttrModule||{};_4=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};_5=c.DocElemNode=c.DocElemNode||{};_6=Y.Docs=Y.Docs||{};_7=_6.DomNodes=_6.DomNodes||{};_8=_6.NodeSet=_6.NodeSet||{};_9=_6.RunState=_6.RunState||{};_=c.Docs=c.Docs||{};$=c.Doc=c.Doc||{};ba=c.Elt=c.Elt||{};bb=Y.EltUpdater=Y.EltUpdater||{};bc=a.StartupCode$WebSharper_UI$Doc_Client=a.StartupCode$WebSharper_UI$Doc_Client||{};bd=c.Flow=c.Flow||{};be=c.FlowBuilder=c.FlowBuilder||{};bf=c.HtmlModule=c.HtmlModule||{};bg=bf.attr=bf.attr||{};bh=c.Router=c.Router||{};bi=c.Route=c.Route||{};bj=c.Routing=c.Routing||{};bk=c.RouteMap=c.RouteMap||{};bl=c.Input=c.Input||{};bm=bl.MousePosSt=bl.MousePosSt||{};bn=bl.MouseBtnSt=bl.MouseBtnSt||{};bo=bl.Mouse=bl.Mouse||{};bp=bl.KeyListenerSt=bl.KeyListenerSt||{};bq=bl.Keyboard=bl.Keyboard||{};br=a.StartupCode$WebSharper_UI$Input=a.StartupCode$WebSharper_UI$Input||{};bs=b&&b.List;bt=b&&b.Arrays;bu=b&&b.Enumerator;bv=b&&b.Strings;bw=b&&b.Char;bx=b&&b.Collections;by=bx&&bx.HashSet;bz=b&&b.Seq;bA=a.IntelliFactory;bB=bA&&bA.Runtime;bC=b&&b.Unchecked;bD=a.console;bE=b&&b.Concurrency;bF=bx&&bx.Map;bG=bx&&bx.FSharpMap;bH=b&&b.Operators;bI=b&&b.Queue;bJ=b&&b.Lazy;bK=bx&&bx.Dictionary;bL=a.JSON;bM=b&&b.Numeric;bN=a.Node;bO=a.jQuery;bP=b&&b.Slice;bQ=b&&b.Sitelets;bR=bQ&&bQ.RouterModule;bS=bQ&&bQ.Route;bT=b&&b.Utils;d.mapInPlace=function(bU,bV){var bW,bX;for(bW=0,bX=bV.length-1;bW<=bX;bW++)bV[bW]=bU(bV[bW]);return bV;};d.ofSeqNonCopying=function(bU){var bV,bW;if(bU instanceof a.Array)return bU;else if(bU instanceof bs.T)return bt.ofList(bU);else if(bU===null)return[];else{bV=[];bW=bu.Get(bU);try{while(bW.MoveNext())bV.push(bW.Current());return bV;}finally{if("Dispose"in bW)bW.Dispose();}}};d.MapTreeReduce=function(bU,bV,bW,bX){var bY;function bZ(b0,b1){var b2,b3;return b1<=0?bV:b1===1&&(b0>=0&&b0<bY)?bU(bt.get(bX,b0)):(b3=b1/2>>0,bW(bZ(b0,b3),bZ(b0+b3,b1-b3)));}bY=bt.length(bX);return bZ(0,bY);};d.TreeReduce=function(bU,bV,bW){var bX;function bY(bZ,b0){var b1,b2;return b0<=0?bU:b0===1&&(bZ>=0&&bZ<bX)?bt.get(bW,bZ):(b2=b0/2>>0,bV(bY(bZ,b2),bY(bZ+b2,b0-b2)));}bX=bt.length(bW);return bY(0,bX);};e.isBlank=function(bU){return bv.forall(bw.IsWhiteSpace,bU);};f.maybeReplaceFirst=function(bU,bV,bW){var bX;bX=[false];return bs.map(function(bY){var bZ;return!bX[0]&&bU(bY)?(bZ=bV(bY),bZ==null?bY:bZ.$0):bY;},bW);};f.replaceFirst=function(bU,bV,bW){var bX;bX=[false];return bs.map(function(bY){return!bX[0]&&bU(bY)?bV(bY):bY;},bW);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){o.$cctor();return o.counter;};h.set_counter=function(bU){o.$cctor();o.counter=bU;};i.Filter=function(bU,bV){return new by.New$2(bt.filter(bU,i.ToArray(bV)));};i.Intersect=function(bU,bV){var bW;bW=new by.New$2(i.ToArray(bU));bW.IntersectWith(i.ToArray(bV));return bW;};i.Except=function(bU,bV){var bW;bW=new by.New$2(i.ToArray(bV));bW.ExceptWith(i.ToArray(bU));return bW;};i.ToArray=function(bU){var bV;bV=bt.create(bU.get_Count(),void 0);bU.CopyTo(bV);return bV;};j.ToValueArray=function(bU){var bV;bV=bt.create(bU.count,void 0);bz.iteri(function(bW,bX){return bt.set(bV,bW,bX.V);},bU);return bV;};j.ToKeyArray=function(bU){var bV;bV=bt.create(bU.count,void 0);bz.iteri(function(bW,bX){return bt.set(bV,bW,bX.K);},bU);return bV;};l=g.Slot=bB.Class({GetHashCode:function(){return bC.Hash(this.key(this.value));},Equals:function(bU){return bC.Equals(this.key(this.value),this.key(bU.get_Value()));},get_Value:function(){return this.value;}},k,l);l.New=bB.Ctor(function(bU,bV){this.key=bU;this.value=bV;},l);l.Create=function(bU,bV){return new l.New(bU,bV);};m.OnError=function(bU){return bD.log("WebSharper UI: Uncaught asynchronous exception",bU);};m.StartTo=function(bU,bV){bE.StartWithContinuations(bU,bV,function(bW){m.OnError(bW);},a.ignore,null);};n.StartProcessor=function(bU){var bV;function bW(){var bX;bX=null;return bE.Delay(function(){return bE.Bind(bU,function(){var bY;bY=bV[0];return bY===1?(bV[0]=0,bE.Zero()):bY===2?(bV[0]=1,bW()):bE.Zero();});});}bV=[0];return function(){var bX;bX=bV[0];bX===0?(bV[0]=1,bE.Start(bW(),null)):bX===1?bV[0]=2:void 0;};};o.$cctor=function(){o.$cctor=a.ignore;o.counter=0;};p.FromArray=function(bU){var bV;bV=bU.length;return bV===0?{$:0}:bV===1?{$:1,$0:bt.get(bU,0)}:{$:3,$0:bU.slice()};};p.ToArray=function(bU){var bV;function bW(bX){if(bX.$==1)bV.push(bX.$0);else if(bX.$==2){bW(bX.$0);bW(bX.$1);}else if(bX.$==3)bt.iter(function(bY){bV.push(bY);},bX.$0);}bV=[];bW(bU);return bV.slice(0);};p.Single=function(bU){return{$:1,$0:bU};};p.Concat=function(bU){var bV;bV=d.ofSeqNonCopying(bU);return d.TreeReduce(p.Empty(),p.Append,bV);};p.Append=function(bU,bV){return bU.$==0?bV:bV.$==0?bU:{$:2,$0:bU,$1:bV};};p.Empty=function(){q.$cctor();return q.Empty;};q.$cctor=function(){q.$cctor=a.ignore;q.Empty={$:0};};r.SetProperty=function(bU,bV,bW){return bU.setProperty(bV,bW);};r.IterSelector=function(bU,bV,bW){var bX,bY,bZ;bX=bU.querySelectorAll(bV);for(bY=0,bZ=bX.length-1;bY<=bZ;bY++)bW(bX[bY]);};r.ChildrenArray=function(bU){var bV,bW,bX;bV=[];for(bW=0,bX=bU.childNodes.length-1;bW<=bX;bW++)bV.push(bU.childNodes[bW]);return bV;};r.RemoveClass=function(bU,bV){a.jQuery(bU).removeClass(bV);};r.AddClass=function(bU,bV){a.jQuery(bU).addClass(bV);};r.InsertAt=function(bU,bV,bW){var bX;if(!(bW.parentNode===bU&&bV===(bX=bW.nextSibling,bC.Equals(bX,null)?null:bX)))bU.insertBefore(bW,bV);};r.RemoveNode=function(bU,bV){if(bV.parentNode===bU)bU.removeChild(bV);};r.SetStyle=function(bU,bV,bW){r.SetProperty(bU.style,bV,bW);};r.SetAttr=function(bU,bV,bW){bU.setAttribute(bV,bW);};r.RemoveAttr=function(bU,bV){bU.removeAttribute(bV);};r.CreateAttr=function(bU,bV){var bW;bW=r.Doc().createAttribute(bU);bW.value=bV;return bW;};r.CreateText=function(bU){return r.Doc().createTextNode(bU);};r.CreateSvgElement=function(bU){return r.Doc().createElementNS("http://www.w3.org/2000/svg",bU);};r.CreateElement=function(bU){return r.Doc().createElement(bU);};r.Clear=function(bU){while(bU.hasChildNodes())bU.removeChild(bU.firstChild);};r.ClearAttrs=function(bU){while(bU.hasAttributes())bU.removeAttributeNode(bU.attributes.item(0));};r.AppendTo=function(bU,bV){bU.appendChild(bV);};r.Doc=function(){s.$cctor();return s.Doc;};s.$cctor=function(){s.$cctor=a.ignore;s.Doc=a.document;};u.NotFound={$:1};t.Empty=function(){v.$cctor();return v.Empty;};t.Lookup=function(bU,bV){return t.Look(bs.ofSeq(bV),bU);};t.Look=function(bU,bV){var bW,bX;switch(bV.$==2?(bW=bV.$0,0):bV.$==0?bU.$==1?(bW=[bU.$0,bU.$1,bV.$0],1):2:2){case 0:return{$:0,$0:bW,$1:bU};break;case 1:bX=bF.TryFind(bW[0],bW[2]);return bX==null?u.NotFound:t.Look(bW[1],bX.$0);break;case 2:return u.NotFound;break;}};t.ToArray=function(bU){var bV;bV=[];t.Map(function(){return function(bW){return bV.push(bW);};},bU);return bV.slice(0);};t.Mapi=function(bU,bV){var bW;function bX(){var bY;bY=bW[0];bW[0]=bY+1;return bY;}bW=[0];return t.Map(function(bY){return bU(bX(),bY);},bV);};t.Map=function(bU,bV){return t.MapLoop(bs.T.Empty,bU,bV);};t.MapLoop=function(bU,bV,bW){return bW.$==1?{$:1}:bW.$==2?{$:2,$0:(bV(bU))(bW.$0)}:t.TrieBranch(bF.Map(function(bX,bY){return t.MapLoop(bs.append(bU,bs.ofArray([bX])),bV,bY);},bW.$0));};t.Merge=function(bU){var bV,bW,bX;bV=d.ofSeqNonCopying(bU);bW=bt.length(bV);return bW===0?{$:1,$0:{$:1}}:bW===1?{$:1,$0:bt.get(bV,0)}:bt.exists(t.IsLeaf,bV)?null:(bX=t.MergeMaps(t.Merge,bz.choose(function(bY){return bY.$==0?{$:1,$0:bY.$0}:null;},bV)),bX==null?null:{$:1,$0:t.TrieBranch(bX.$0)});};t.IsLeaf=function(bU){return bU.$==2;};t.MergeMaps=function(bU,bV){var bW,bX;function bY(bZ,b0){var b1;b1=bU(b0);return b1==null?null:{$:1,$0:[bZ,b1.$0]};}bW=t.AllSome(bz.map(function(bZ){return bY(bZ[0],bZ[1]);},bF.ToSeq((bX=bz.collect(bF.ToSeq,bV),bz.fold(function(bZ,b0){return t.MultiAdd(b0[0],b0[1],bZ);},new bG.New([]),bX)))));return bW==null?null:{$:1,$0:bF.OfArray(bt.ofSeq(bW.$0))};};t.AllSome=function(bU){var bV,bW,bX,bY;bW=bu.Get(bU);bX=[];bV=true;while(bV&&bW.MoveNext()){bY=bW.Current();bY!=null&&bY.$==1?bX.push(bY.$0):bV=false;}return bV?{$:1,$0:bX.slice()}:null;};t.MultiAdd=function(bU,bV,bW){return bW.Add(bU,new bs.T({$:1,$0:bV,$1:t.MultiFind(bU,bW)}));};t.MultiFind=function(bU,bV){var bW;bW=bF.TryFind(bU,bV);return bW==null?bs.T.Empty:bW.$0;};t.Prefix=function(bU,bV){return t.TrieBranch(new bG.New(bs.ofArray([[bU,bV]])));};t.Leaf=function(bU){return{$:2,$0:bU};};t.TrieBranch=function(bU){return bU.get_IsEmpty()?{$:1}:{$:0,$0:bU};};v.$cctor=function(){v.$cctor=a.ignore;v.Empty={$:1};};w.Obsolete=function(bU){var bV,bW,bX,bY,bZ;bW=bU.s;if(bW==null||(bW!=null&&bW.$==2?(bV=bW.$1,false):bW!=null&&bW.$==3?(bV=bW.$1,false):true))void 0;else{bU.s=null;for(bX=0,bY=bt.length(bV)-1;bX<=bY;bX++){bZ=bt.get(bV,bX);typeof bZ=="object"?function(b0){w.Obsolete(b0);}(bZ):bZ();}}};w.New=function(bU){return{s:bU};};w.MapAsync=function(bU,bV){var bW;bW=w.New({$:3,$0:[],$1:[]});w.When(bV,function(bX){m.StartTo(bU(bX),function(bY){w.MarkDone(bW,bV,bY);});},bW);return bW;};w.SnapshotOn=function(bU,bV){var bW;function bX(bY){var bZ,b0,b1;if(!(bZ=bW.s,bZ!=null&&bZ.$==0||bZ!=null&&bZ.$==2)){b0=w.ValueAndForever(bU);b1=w.ValueAndForever(bV);b0!=null&&b0.$==1?b1!=null&&b1.$==1?b0.$0[1]||b1.$0[1]?w.MarkForever(bW,b1.$0[0]):w.MarkReady(bW,b1.$0[0]):void 0:void 0;}}bW=w.New({$:3,$0:[],$1:[]});w.When(bU,bX,bW);w.WhenReady(bV,bX);return bW;};w.Map3=function(bU,bV,bW,bX){var bY,bZ,b0,b1;function b2(b3){var b4,b5,b6,b7;if(!(b4=b1.s,b4!=null&&b4.$==0||b4!=null&&b4.$==2)){b5=w.ValueAndForever(bV);b6=w.ValueAndForever(bW);b7=w.ValueAndForever(bX);b5!=null&&b5.$==1?b6!=null&&b6.$==1?b7!=null&&b7.$==1?b5.$0[1]&&b6.$0[1]&&b7.$0[1]?w.MarkForever(b1,bU(b5.$0[0],b6.$0[0],b7.$0[0])):w.MarkReady(b1,bU(b5.$0[0],b6.$0[0],b7.$0[0])):void 0:void 0:void 0;}}bY=bV.s;bZ=bW.s;b0=bX.s;return bY!=null&&bY.$==0?bZ!=null&&bZ.$==0?b0!=null&&b0.$==0?w.New({$:0,$0:bU(bY.$0,bZ.$0,b0.$0)}):w.Map3Opt1(bU,bY.$0,bZ.$0,bX):b0!=null&&b0.$==0?w.Map3Opt2(bU,bY.$0,b0.$0,bW):w.Map3Opt3(bU,bY.$0,bW,bX):bZ!=null&&bZ.$==0?b0!=null&&b0.$==0?w.Map3Opt4(bU,bZ.$0,b0.$0,bV):w.Map3Opt5(bU,bZ.$0,bV,bX):b0!=null&&b0.$==0?w.Map3Opt6(bU,b0.$0,bV,bW):(b1=w.New({$:3,$0:[],$1:[]}),(w.When(bV,b2,b1),w.When(bW,b2,b1),w.When(bX,b2,b1),b1));};w.Map3Opt6=function(bU,bV,bW,bX){return w.Map2(function(bY,bZ){return bU(bY,bZ,bV);},bW,bX);};w.Map3Opt5=function(bU,bV,bW,bX){return w.Map2(function(bY,bZ){return bU(bY,bV,bZ);},bW,bX);};w.Map3Opt4=function(bU,bV,bW,bX){return w.Map(function(bY){return bU(bY,bV,bW);},bX);};w.Map3Opt3=function(bU,bV,bW,bX){return w.Map2(function(bY,bZ){return bU(bV,bY,bZ);},bW,bX);};w.Map3Opt2=function(bU,bV,bW,bX){return w.Map(function(bY){return bU(bV,bY,bW);},bX);};w.Map3Opt1=function(bU,bV,bW,bX){return w.Map(function(bY){return bU(bV,bW,bY);},bX);};w.Map2Unit=function(bU,bV){var bW,bX,bY;function bZ(){var b0,b1,b2;if(!(b0=bY.s,b0!=null&&b0.$==0||b0!=null&&b0.$==2)){b1=w.ValueAndForever(bU);b2=w.ValueAndForever(bV);b1!=null&&b1.$==1?b2!=null&&b2.$==1?b1.$0[1]&&b2.$0[1]?w.MarkForever(bY,null):w.MarkReady(bY,null):void 0:void 0;}}bW=bU.s;bX=bV.s;return bW!=null&&bW.$==0?bX!=null&&bX.$==0?w.New({$:0,$0:null}):bV:bX!=null&&bX.$==0?bU:(bY=w.New({$:3,$0:[],$1:[]}),(w.When(bU,bZ,bY),w.When(bV,bZ,bY),bY));};w.Map2=function(bU,bV,bW){var bX,bY,bZ;function b0(b1){var b2,b3,b4;if(!(b2=bZ.s,b2!=null&&b2.$==0||b2!=null&&b2.$==2)){b3=w.ValueAndForever(bV);b4=w.ValueAndForever(bW);b3!=null&&b3.$==1?b4!=null&&b4.$==1?b3.$0[1]&&b4.$0[1]?w.MarkForever(bZ,bU(b3.$0[0],b4.$0[0])):w.MarkReady(bZ,bU(b3.$0[0],b4.$0[0])):void 0:void 0;}}bX=bV.s;bY=bW.s;return bX!=null&&bX.$==0?bY!=null&&bY.$==0?w.New({$:0,$0:bU(bX.$0,bY.$0)}):w.Map2Opt1(bU,bX.$0,bW):bY!=null&&bY.$==0?w.Map2Opt2(bU,bY.$0,bV):(bZ=w.New({$:3,$0:[],$1:[]}),(w.When(bV,b0,bZ),w.When(bW,b0,bZ),bZ));};w.Map2Opt2=function(bU,bV,bW){return w.Map(function(bX){return bU(bX,bV);},bW);};w.Map2Opt1=function(bU,bV,bW){return w.Map(function(bX){return bU(bV,bX);},bW);};w.MapCachedBy=function(bU,bV,bW,bX){return w.Map(function(bY){var bZ,b0,b1;bZ=bV[0];return bZ!=null&&bZ.$==1&&(bU(bY,bZ.$0[0])&&(b0=[bZ.$0[0],bZ.$0[1]],true))?b0[1]:(b1=bW(bY),(bV[0]={$:1,$0:[bY,b1]},b1));},bX);};w.Copy=function(bU){var bV,bW,bX;bV=bU.s;return bV==null?bU:bV!=null&&bV.$==2?(bW=w.New({$:2,$0:bV.$0,$1:[]}),(w.WhenObsolete(bU,bW),bW)):bV!=null&&bV.$==3?(bX=w.New({$:3,$0:[],$1:[]}),(w.When(bU,function(bY){w.MarkDone(bX,bU,bY);},bX),bX)):bU;};w.WithInitOption=function(bU){var bV,bW,bX;bV=bU.s;return bV==null?w.New(null):bV!=null&&bV.$==2?(bW=w.New({$:2,$0:{$:1,$0:bV.$0},$1:[]}),(w.WhenObsolete(bU,bW),bW)):bV!=null&&bV.$==3?(bX=w.New({$:2,$0:null,$1:[]}),(w.When(bU,function(){w.Obsolete(bX);},bX),bX)):w.New({$:0,$0:{$:1,$0:bV.$0}});};w.WithInit=function(bU,bV){var bW,bX,bY;bW=bV.s;return bW==null?bV:bW!=null&&bW.$==2?(bX=w.New({$:2,$0:bW.$0,$1:[]}),(w.WhenObsolete(bV,bX),bX)):bW!=null&&bW.$==3?(bY=w.New({$:2,$0:bU,$1:[]}),(w.When(bV,function(){w.Obsolete(bY);},bY),bY)):bV;};w.Map=function(bU,bV){var bW,bX;bW=bV.s;return bW!=null&&bW.$==0?w.New({$:0,$0:bU(bW.$0)}):(bX=w.New({$:3,$0:[],$1:[]}),(w.When(bV,function(bY){w.MarkDone(bX,bV,bU(bY));},bX),bX));};w.Sequence=function(bU){var bV,bW,bX;function bY(bZ){var b0;if(bX[0]===0){b0=bt.map(function(b1){var b2;b2=b1.s;return b2!=null&&b2.$==0?b2.$0:b2!=null&&b2.$==2?b2.$0:bH.FailWith("value not found by View.Sequence");},bV);bt.forall(function(b1){var b2;b2=b1.s;return b2!=null&&b2.$==0;},bV)?w.MarkForever(bW,b0):w.MarkReady(bW,b0);}else bX[0]--;}bV=bt.ofSeq(bU);return bV.length==0?w.New({$:0,$0:[]}):(bW=w.New({$:3,$0:[],$1:[]}),(bX=[bt.length(bV)-1],(bt.iter(function(bZ){w.When(bZ,bY,bW);},bV),bW)));};w.CreateForeverAsync=function(bU){var bV;bV=w.New({$:3,$0:[],$1:[]});m.StartTo(bU,function(bW){w.MarkForever(bV,bW);});return bV;};w.JoinInner=function(bU){var bV;bV=w.New({$:3,$0:[],$1:[]});w.When(bU,function(bW){var bX;bX=bW();w.When(bX,function(bY){var bZ,b0;if((bZ=bX.s,bZ!=null&&bZ.$==0)&&(b0=bU.s,b0!=null&&b0.$==0))w.MarkForever(bV,bY);else w.MarkReady(bV,bY);},bV);w.WhenObsolete(bU,bX);},bV);return bV;};w.Join=function(bU){var bV;bV=w.New({$:3,$0:[],$1:[]});w.When(bU,function(bW){var bX;bX=bW();w.When(bX,function(bY){var bZ,b0;if((bZ=bX.s,bZ!=null&&bZ.$==0)&&(b0=bU.s,b0!=null&&b0.$==0))w.MarkForever(bV,bY);else w.MarkReady(bV,bY);},bV);},bV);return bV;};w.ValueAndForever=function(bU){var bV;bV=bU.s;return bV!=null&&bV.$==0?{$:1,$0:[bV.$0,true]}:bV!=null&&bV.$==2?{$:1,$0:[bV.$0,false]}:null;};w.WhenObsoleteRun=function(bU,bV){var bW;bW=bU.s;bW==null?bV():bW!=null&&bW.$==2?bW.$1.push(bV):bW!=null&&bW.$==3?bW.$1.push(bV):void 0;};w.WhenObsolete=function(bU,bV){var bW;bW=bU.s;bW==null?w.Obsolete(bV):bW!=null&&bW.$==2?w.EnqueueSafe(bW.$1,bV):bW!=null&&bW.$==3?w.EnqueueSafe(bW.$1,bV):void 0;};w.WhenReady=function(bU,bV){var bW,bX;bX=bU.s;switch(bX!=null&&bX.$==2?(bW=bX.$0,0):bX==null?1:bX!=null&&bX.$==3?2:(bW=bX.$0,0)){case 0:bV(bW);break;case 1:null;break;case 2:bX.$0.push(bV);break;}};w.WhenRun=function(bU,bV,bW){var bX;bX=bU.s;bX==null?bW():bX!=null&&bX.$==2?(bX.$1.push(bW),bV(bX.$0)):bX!=null&&bX.$==3?(bX.$0.push(bV),bX.$1.push(bW)):bV(bX.$0);};w.When=function(bU,bV,bW){var bX;bX=bU.s;bX==null?w.Obsolete(bW):bX!=null&&bX.$==2?(w.EnqueueSafe(bX.$1,bW),bV(bX.$0)):bX!=null&&bX.$==3?(bX.$0.push(bV),w.EnqueueSafe(bX.$1,bW)):bV(bX.$0);};w.EnqueueSafe=function(bU,bV){var bW,bX,bY,bZ;bU.push(bV);if(bU.length%20===0){bW=bU.slice(0);bI.Clear(bU);for(bX=0,bY=bt.length(bW)-1;bX<=bY;bX++){bZ=bt.get(bW,bX);typeof bZ=="object"?function(b0){if(b0.s)bU.push(b0);}(bZ):function(b0){bU.push(b0);}(bZ);}}else void 0;};w.MarkDone=function(bU,bV,bW){var bX;if(bX=bV.s,bX!=null&&bX.$==0)w.MarkForever(bU,bW);else w.MarkReady(bU,bW);};w.MarkReady=function(bU,bV){var bW,bX,bY,bZ;bW=bU.s;if(bW!=null&&bW.$==3){bU.s={$:2,$0:bV,$1:bW.$1};bX=bW.$0;for(bY=0,bZ=bt.length(bX)-1;bY<=bZ;bY++)(bt.get(bX,bY))(bV);}else void 0;};w.MarkForever=function(bU,bV){var bW,bX,bY,bZ;bW=bU.s;if(bW!=null&&bW.$==3){bU.s={$:0,$0:bV};bX=bW.$0;for(bY=0,bZ=bt.length(bX)-1;bY<=bZ;bY++)(bt.get(bX,bY))(bV);}else void 0;};x=c.Var=bB.Class({},k,x);x.New=bB.Ctor(function(){},x);y=c.View=bB.Class({get_V:function(){return bH.FailWith("View<'T>.V can only be called in an argument to a V-enabled function or if 'T = Doc.");}},null,y);z=c.ConcreteVar=bB.Class({get_Id:function(){return"uinref"+a.String(this.id);},get_View:function(){return this.view;},UpdateMaybe:function(bU){var bV;bV=bU(this.Get());bV!=null&&bV.$==1?this.Set(bV.$0):void 0;},Update:function(bU){this.Set(bU(this.Get()));},SetFinal:function(bU){if(this.isConst)(function(bV){return bV("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(bV){bD.log(bV);}));else{w.Obsolete(this.snap);this.isConst=true;this.current=bU;this.snap=w.New({$:0,$0:bU});}},Set:function(bU){if(this.isConst)(function(bV){return bV("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(bV){bD.log(bV);}));else{w.Obsolete(this.snap);this.current=bU;this.snap=w.New({$:2,$0:bU,$1:[]});}},Get:function(){return this.current;}},x,z);z.New=bB.Ctor(function(bU,bV,bW){var bX;bX=this;x.New.call(this);this.isConst=bU;this.current=bW;this.snap=bV;this.view=function(){return bX.snap;};this.id=h.Int();},z);x.MapLens=function(bU,bV,bW){return y.MapSeqCachedViewBy(bU,function(bX,bY){var bZ,b0;function b1(b2){return bC.Equals(bU(b2),bX);}bZ=h.Id();return bV((b0=new x({Get:function(){return bz.find(b1,bW.Get());},Set:function(b2){function b3(b4){return b2;}return bW.Update(function(b4){return f.replaceFirst(b1,b3,b4);});},SetFinal:function(b2){return this.Set(b2);},Update:function(b2){return bW.Update(function(b3){return f.replaceFirst(b1,b2,b3);});},UpdateMaybe:function(b2){return bW.Update(function(b3){return f.maybeReplaceFirst(b1,b2,b3);});},get_View:function(){return bY;},get_Id:function(){return bZ;}}),(x.New.call(b0),b0)));},bW.get_View());};x.Lens=function(bU,bV,bW){var bX,bY,bZ;bX=h.Id();bY=y.Map(bV,bU.get_View());bZ=new x({Get:function(){return bV(bU.Get());},Set:function(b0){return bU.Update(function(b1){return bW(b1,b0);});},SetFinal:function(b0){return this.Set(b0);},Update:function(b0){return bU.Update(function(b1){return bW(b1,b0(bV(b1)));});},UpdateMaybe:function(b0){return bU.UpdateMaybe(function(b1){var b2;b2=b0(bV(b1));return b2==null?null:{$:1,$0:bW(b1,b2.$0)};});},get_View:function(){return bY;},get_Id:function(){return bX;}});x.New.call(bZ);return bZ;};x.Update=function(bU,bV){x.Set(bU,bV(bU.Get()));};x.SetFinal=function(bU,bV){bU.SetFinal(bV);};x.Set=function(bU,bV){bU.Set(bV);};x.CreateWaiting=function(){return new z.New(false,w.New({$:3,$0:[],$1:[]}),null);};x.Create=function(){return new z.New(false,w.New({$:2,$0:null,$1:[]}),null);};x.CreateLogged=function(bU,bV){var bW;!window.UINVars?window.UINVars=[]:void 0;bW=x.Create$1(bV);window.UINVars.push([bU,bW]);return bW;};x.Create$1=function(bU){return new z.New(false,w.New({$:2,$0:bU,$1:[]}),bU);};A=c.Updates=bB.Class({set_Value:function(bU){var bV;bV=this.s;!(bV===null)?w.Obsolete(bV):void 0;this.c=bU;}},null,A);A.Create=function(bU){var bV;bV=null;bV=A.New(bU,null,function(){var bW;bW=bV.s;return bW===null?(bW=w.Copy(bV.c()),bV.s=bW,w.WhenObsoleteRun(bW,function(){bV.s=null;}),bW):bW;});return bV;};A.New=function(bU,bV,bW){return new A({c:bU,s:bV,v:bW});};y.get_Do=function(){return B.B;};y.Apply=function(bU,bV){return y.Map2(function(bW,bX){return bW(bX);},bU,bV);};y.AsyncAwait=function(bU,bV){function bW(bX){var bY,bZ;function b0(){return y.RemovableSink(function(b1){if(bU(b1)){(bJ.Force(bY))();bX(b1);}},bV);}bY=bJ.Create(b0);bZ=bJ.Force(bY);}return bE.FromContinuations(function(bX,bY,bZ){return bW.apply(null,[bX,bY,bZ]);});};y.RemovableSink=function(bU,bV){var bW;function bX(){w.WhenRun(bV(),function(bY){if(bW[0])bU(bY);},function(){if(bW[0])bE.scheduler().Fork(bX);});}bW=[true];bE.scheduler().Fork(bX);return function(){bW[0]=false;};};y.Sink=function(bU,bV){function bW(){w.WhenRun(bV(),bU,function(){bE.scheduler().Fork(bW);});}bE.scheduler().Fork(bW);};y.TryFinally=function(bU,bV){return y.CreateLazy(function(){try{return bV();}finally{bU();}});};y.TryWith=function(bU,bV){return y.CreateLazy(function(){try{return bV();}catch(bW){return(bU(bW))();}});};y.ConstAsync=function(bU){var bV;bV=w.CreateForeverAsync(bU);return function(){return bV;};};y.Const=function(bU){var bV;bV=w.New({$:0,$0:bU});return function(){return bV;};};y.Sequence=function(bU){return y.CreateLazy(function(){return w.Sequence(bz.map(function(bV){return bV();},bU));});};y.UpdateWhile=function(bU,bV,bW){var bX;bX=[bU];return y.BindInner(function(bY){return bY?y.Map(function(bZ){bX[0]=bZ;return bZ;},bW):y.Const(bX[0]);},bV);};y.BindInner=function(bU,bV){return y.JoinInner(y.Map(bU,bV));};y.JoinInner=function(bU){return y.CreateLazy(function(){return w.JoinInner(bU());});};y.Bind=function(bU,bV){return y.Join(y.Map(bU,bV));};y.Join=function(bU){return y.CreateLazy(function(){return w.Join(bU());});};y.MapSeqCachedView=function(bU,bV){function bW(bX){return bU;}return y.MapSeqCachedViewBy(a.id,function(bX,bY){return(bW(bX))(bY);},bV);};y.MapSeqCachedViewBy=function(bU,bV,bW){var bX;bX=[new bK.New$5()];return y.Map(function(bY){var bZ,b0,b1;bZ=bX[0];b0=new bK.New$5();b1=d.mapInPlace(function(b2){var b3,b4,b5;b3=bU(b2);b4=bZ.ContainsKey(b3)?(b5=bZ.get_Item(b3),(x.Set(b5.r,b2),b5)):y.ConvertSeqNode(function(b6){return bV(b3,b6);},b2);b0.set_Item(b3,b4);return b4.e;},bt.ofSeq(bY));bX[0]=b0;return b1;},bW);};y.ConvertSeqNode=function(bU,bV){var bW,bX;bW=x.Create$1(bV);bX=bW.get_View();return{e:bU(bX),r:bW,w:bX};};y.MapSeqCached=function(bU,bV){return y.MapSeqCachedBy(a.id,bU,bV);};y.MapSeqCachedBy=function(bU,bV,bW){var bX;bX=[new bK.New$5()];return y.Map(function(bY){var bZ,b0,b1;bZ=bX[0];b0=new bK.New$5();b1=d.mapInPlace(function(b2){var b3,b4;b3=bU(b2);b4=bZ.ContainsKey(b3)?bZ.get_Item(b3):bV(b2);b0.set_Item(b3,b4);return b4;},bt.ofSeq(bY));bX[0]=b0;return b1;},bW);};y.SnapshotOn=function(bU,bV,bW){var bX;bX=w.New({$:2,$0:bU,$1:[]});return y.CreateLazy(function(){return bX.s==null?w.SnapshotOn(bV(),bW()):(w.WhenObsolete(bV(),bX),bX);});};y.GetAsync=function(bU){return bE.FromContinuations(function(bV){return y.Get(bV,bU);});};y.WithInitOption=function(bU){return y.CreateLazy(function(){return w.WithInitOption(bU());});};y.WithInit=function(bU,bV){return y.CreateLazy(function(){return w.WithInit(bU,bV());});};y.Get=function(bU,bV){var bW;function bX(){w.WhenRun(bV(),function(bY){if(!bW[0]){bW[0]=true;bU(bY);}},function(){if(!bW[0])bX();});}bW=[false];bX();};y.MapAsync2=function(bU,bV,bW){return y.MapAsync(a.id,y.Map2(bU,bV,bW));};y.MapAsync=function(bU,bV){return y.CreateLazy(function(){return w.MapAsync(bU,bV());});};y.Map3=function(bU,bV,bW,bX){return y.CreateLazy(function(){return w.Map3(bU,bV(),bW(),bX());});};y.Map2Unit=function(bU,bV){return y.CreateLazy(function(){return w.Map2Unit(bU(),bV());});};y.Map2=function(bU,bV,bW){return y.CreateLazy(function(){return w.Map2(bU,bV(),bW());});};y.MapCached=function(bU,bV){return y.MapCachedBy(bC.Equals,bU,bV);};y.MapCachedBy=function(bU,bV,bW){var bX;bX=[null];return y.CreateLazy(function(){return w.MapCachedBy(bU,bX,bV,bW());});};y.Map=function(bU,bV){return y.CreateLazy(function(){return w.Map(bU,bV());});};y.CreateLazy=function(bU){var bV;bV={c:null,o:bU};return function(){var bW,bX;bW=bV.c;return bW===null?(bW=bV.o(),bV.c=bW,(bX=bW.s,bX!=null&&bX.$==0)?bV.o=null:w.WhenObsoleteRun(bW,function(){bV.c=null;}),bW):bW;};};B.B={$:0};C=c.Submitter=bB.Class({Trigger:function(){this["var"].Set(null);}},k,C);C.New=bB.Ctor(function(bU,bV){this.input=bU;this["var"]=x.Create();this.view=y.SnapshotOn(bV,this["var"].get_View(),this.input);},C);C.CreateOption=function(bU){return new C.New(y.Map(function(bV){return{$:1,$0:bV};},bU),null);};D.Fresh=function(){return{$:0,$0:h.Int()};};E=c.Model=bB.Class({},k,E);E.New=bB.Ctor(function(bU,bV){var bW;bW=x.Create$1(bV);E.New$1.call(this,bW,y.Map(bU,bW.get_View()));},E);E.New$1=bB.Ctor(function(bU,bV){this["var"]=bU;this.view=bV;},E);E.Update=function(bU,bV){x.Update(bV["var"],function(bW){bU(bW);return bW;});};E.Create=function(bU,bV){return new E.New(bU,bV);};F.Default=function(){L.$cctor();return L.Default;};H=G.ArrayStorage=bB.Class({SSet:function(bU){return bt.ofSeq(bU);},SSetAt:function(bU,bV,bW){bt.set(bW,bU,bV);return bW;},SRemoveIf:function(bU,bV){return bt.filter(function(bW){return!bU(bW);},bV);},SInit:function(){return this.init;},SPrependMany:function(bU,bV){var bW;bW=d.ofSeqNonCopying(bU);bV.unshift.apply(bV,bW);return bV;},SPrepend:function(bU,bV){bV.unshift(bU);return bV;},SAppendMany:function(bU,bV){var bW;bW=d.ofSeqNonCopying(bU);bV.push.apply(bV,bW);return bV;},SAppend:function(bU,bV){bV.push(bU);return bV;}},k,H);H.New=bB.Ctor(function(bU){this.init=bU;},H);I=G.LocalStorageBackend=bB.Class({clear:function(){this.storage.removeItem(this.id);},set:function(bU){this.storage.setItem(this.id,bL.stringify(bt.map(this.serializer.Encode,bU)));return bU;},SSet:function(bU){return this.set(bt.ofSeq(bU));},SSetAt:function(bU,bV,bW){bt.set(bW,bU,bV);return this.set(bW);},SRemoveIf:function(bU,bV){return this.set(bt.filter(function(bW){return!bU(bW);},bV));},SInit:function(){var bU;bU=this.storage.getItem(this.id);if(bU===null)return[];else try{return bt.map(this.serializer.Decode,bL.parse(bU));}catch(bV){return[];}},SPrependMany:function(bU,bV){var bW;bW=d.ofSeqNonCopying(bU);bV.unshift.apply(bV,bW);return this.set(bV);},SPrepend:function(bU,bV){bV.unshift(bU);return this.set(bV);},SAppendMany:function(bU,bV){var bW;bW=d.ofSeqNonCopying(bU);bV.push.apply(bV,bW);return this.set(bV);},SAppend:function(bU,bV){bV.push(bU);return this.set(bV);}},k,I);I.New=bB.Ctor(function(bU,bV){this.id=bU;this.serializer=bV;this.storage=a.localStorage;},I);G.LocalStorage=function(bU,bV){return new I.New(bU,bV);};G.InMemory=function(bU){return new H.New(bU);};J=c.ListModel=bB.Class({Wrap:function(bU,bV,bW){return J.Wrap(this,bU,bV,bW);},MapLens:function(bU){var bV;bV=this;return y.MapSeqCachedViewBy(bV.key,function(bW,bX){return bU(bW,bV["LensInto'"](a.id,function(bY,bZ){return bZ;},bW,bX));},this["var"].get_View());},Lens:function(bU){return this.LensInto(a.id,function(bV,bW){return bW;},bU);},LensInto:function(bU,bV,bW){return this["LensInto'"](bU,bV,bW,y.Map(bU,this.FindByKeyAsView(bW)));},"LensInto'":function(bU,bV,bW,bX){var bY,bZ,b0;bY=this;bZ=h.Id();b0=new x({Get:function(){return bU(bY.FindByKey(bW));},Set:function(b1){return bY.UpdateBy(function(b2){return{$:1,$0:bV(b2,b1)};},bW);},SetFinal:function(b1){return this.Set(b1);},Update:function(b1){return bY.UpdateBy(function(b2){return{$:1,$0:bV(b2,b1(bU(b2)))};},bW);},UpdateMaybe:function(b1){return bY.UpdateBy(function(b2){var b3;b3=b1(bU(b2));return b3==null?null:{$:1,$0:bV(b2,b3.$0)};},bW);},get_View:function(){return bX;},get_Id:function(){return bZ;}});x.New.call(b0);return b0;},get_LengthAsView:function(){return y.Map(bt.length,this["var"].get_View());},get_Length:function(){return bt.length(this["var"].Get());},Clear:function(){this["var"].Set(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(bU,bV){var bW,bX,bY,bZ,b0;bW=this;bX=this["var"].Get();bY=bt.tryFindIndex(function(b1){return bC.Equals(bW.key(b1),bV);},bX);bY!=null&&bY.$==1?(bZ=bY.$0,b0=bU(bt.get(bX,bZ)),b0!=null&&b0.$==1?(this["var"].Set(this.storage.SSetAt(bZ,b0.$0,bX)),this.ObsoleteKey(bV)):void 0):void 0;},UpdateAll:function(bU){var bV;bV=this;this["var"].Update(function(bW){bt.iteri(function(bX,bY){var bZ;bZ=bU(bY);return bZ==null?null:bt.set(bW,bX,bZ.$0);},bW);return bV.storage.SSet(bW);});this.ObsoleteAll();},FindByKeyAsView:function(bU){return y.Map(function(bV){return bV.$0;},this.TryFindByKeyAsView(bU));},TryFindByKeyAsView:function(bU){var bV;bV=this;return function(){var bW,bX,bY;bW=(bX=null,[bV.it.TryGetValue(bU,{get:function(){return bX;},set:function(bZ){bX=bZ;}}),bX]);return bW[0]?bW[1]:(bY=w.New({$:2,$0:bV.TryFindByKey(bU),$1:[]}),(bV.it.Add(bU,bY),bY));};},TryFindByKey:function(bU){var bV;bV=this;return bt.tryFind(function(bW){return bC.Equals(bV.key(bW),bU);},this["var"].Get());},FindByKey:function(bU){var bV;bV=this;return bt.find(function(bW){return bC.Equals(bV.key(bW),bU);},this["var"].Get());},TryFindAsView:function(bU){return y.Map(function(bV){return bt.tryFind(bU,bV);},this["var"].get_View());},FindAsView:function(bU){return y.Map(function(bV){return bt.find(bU,bV);},this["var"].get_View());},TryFind:function(bU){return bt.tryFind(bU,this["var"].Get());},Find:function(bU){return bt.find(bU,this["var"].Get());},ContainsKeyAsView:function(bU){var bV;function bW(bX){return bC.Equals(bV.key(bX),bU);}bV=this;return y.Map(function(bX){return bt.exists(bW,bX);},this["var"].get_View());},ContainsKey:function(bU){var bV;bV=this;return bt.exists(function(bW){return bC.Equals(bV.key(bW),bU);},this["var"].Get());},Set:function(bU){this["var"].Set(this.storage.SSet(bU));this.ObsoleteAll();},Iter:function(bU){bt.iter(bU,this["var"].Get());},RemoveByKey:function(bU){var bV;bV=this;this["var"].Set(this.storage.SRemoveIf(function(bW){return bC.Equals(bV.key(bW),bU);},this["var"].Get()));this.ObsoleteKey(bU);},RemoveBy:function(bU){var bV,bW,bX,bY;bV=this["var"].Get();for(bW=0,bX=bV.length-1;bW<=bX;bW++){bY=bt.get(bV,bW);bU(bY)?this.ObsoleteKey(this.key(bY)):void 0;}this["var"].Set(this.storage.SRemoveIf(bU,this["var"].Get()));},Remove:function(bU){var bV,bW,bX,bY;bV=this;bW=this["var"].Get();K.Contains(bV.key,bU,bW)?(bX=bV.key,bY=bX(bU),this["var"].Set(this.storage.SRemoveIf(function(bZ){return bC.Equals(bX(bZ),bY);},bW)),this.ObsoleteKey(bY)):void 0;},PrependMany:function(bU){var bV,bW;function bX(bY,bZ){var b0,b1;b0=bV.key(bZ);bV.ObsoleteKey(b0);b1=bt.tryFindIndex(function(b2){return bC.Equals(bV.key(b2),b0);},bY);return b1==null?(bW.push(bZ),bY):bV.storage.SSetAt(b1.$0,bZ,bY);}bV=this;bW=[];this["var"].Set(this.storage.SPrependMany(bW,(((bB.Curried3(bz.fold))(bX))(this["var"].Get()))(bU)));},Prepend:function(bU){var bV,bW,bX,bY;bV=this;bW=this["var"].Get();bX=this.key(bU);bY=bt.tryFindIndex(function(bZ){return bC.Equals(bV.key(bZ),bX);},bW);bY!=null&&bY.$==1?this["var"].Set(this.storage.SSetAt(bY.$0,bU,bW)):this["var"].Set(this.storage.SPrepend(bU,bW));this.ObsoleteKey(bX);},AppendMany:function(bU){var bV,bW;function bX(bY,bZ){var b0,b1;b0=bV.key(bZ);bV.ObsoleteKey(b0);b1=bt.tryFindIndex(function(b2){return bC.Equals(bV.key(b2),b0);},bY);return b1==null?(bW.push(bZ),bY):bV.storage.SSetAt(b1.$0,bZ,bY);}bV=this;bW=[];this["var"].Set(this.storage.SAppendMany(bW,(((bB.Curried3(bz.fold))(bX))(this["var"].Get()))(bU)));},Append:function(bU){var bV,bW,bX,bY;bV=this;bW=this["var"].Get();bX=this.key(bU);bY=bt.tryFindIndex(function(bZ){return bC.Equals(bV.key(bZ),bX);},bW);bY!=null&&bY.$==1?this["var"].Set(this.storage.SSetAt(bY.$0,bU,bW)):this["var"].Set(this.storage.SAppend(bU,bW));this.ObsoleteKey(bX);},ObsoleteAll:function(){bz.iter(function(bU){w.Obsolete(bU.V);},this.it);this.it.Clear();},ObsoleteKey:function(bU){var bV,bW;bV=(bW=null,[this.it.TryGetValue(bU,{get:function(){return bW;},set:function(bX){bW=bX;}}),bW]);bV[0]?(w.Obsolete(bV[1]),this.it.Remove(bU)):void 0;},GetEnumerator0:function(){return bu.Get0(this["var"].Get());},GetEnumerator:function(){return bu.Get(this["var"].Get());}},k,J);J.New=bB.Ctor(function(bU,bV){J.New$3.call(this,bU,x.Create$1(bt.ofSeq(bz.distinctBy(bU,bV.SInit()))),bV);},J);J.New$1=bB.Ctor(function(bU){J.New$2.call(this,bU,[]);},J);J.New$2=bB.Ctor(function(bU,bV){var bW;bW=bt.ofSeq(bV);J.New$3.call(this,bU,x.Create$1(bW),G.InMemory(bW));},J);J.New$3=bB.Ctor(function(bU,bV,bW){this.key=bU;this["var"]=bV;this.storage=bW;this.v=y.Map(function(bX){return bX.slice();},this["var"].get_View());this.it=new bK.New$5();},J);K.Contains=function(bU,bV,bW){var bX;bX=bU(bV);return bt.exists(function(bY){return bC.Equals(bU(bY),bX);},bW);};J.Wrap=function(bU,bV,bW,bX){var bY,bZ;bY=[new bK.New$5()];bZ=bt.map(function(b0){var b1;b1=bW(b0);bY[0].set_Item(bU.key(b0),b1);return b1;},bU["var"].Get());return new J.New$3(function(b0){return bU.key(bV(b0));},x.Lens(bU["var"],function(b0){var b1,b2;b1=new bK.New$5();b2=bt.map(function(b3){var b4,b5;b4=bU.key(b3);b5=bY[0].ContainsKey(b4)?bX(bY[0].get_Item(b4),b3):bW(b3);b1.set_Item(b4,b5);return b5;},b0);bY[0]=b1;return b2;},function(b0,b1){var b2,b3;b2=new bK.New$5();b3=bt.map(function(b4){var b5;b5=bV(b4);b2.set_Item(bU.key(b5),b4);return b5;},b1);bY[0]=b2;return b3;}),G.InMemory(bZ));};J.FromSeq=function(bU){return J.Create(a.id,bU);};J.Create=function(bU,bV){return J.CreateWithStorage(bU,G.InMemory(bt.ofSeq(bV)));};J.CreateWithStorage=function(bU,bV){return new J.New(bU,bV);};L.$cctor=function(){L.$cctor=a.ignore;L.Default={Encode:a.id,Decode:a.id};};M=c.ReactiveExtensions=bB.Class({},k,M);M.New=bB.Ctor(function(){},M);N=c.DoubleInterpolation=bB.Class({Interpolate:function(bU,bV,bW){return bV+bU*(bW-bV);}},null,N);N.DoubleInterpolation=new N({$:0});O.get_Double=function(){return N.DoubleInterpolation;};P=c.Easing=bB.Class({TransformTime:function(bU){return this.transformTime(bU);}},k,P);P.get_CubicInOut=function(){return Q.CubicInOut();};P.Custom=function(bU){return new P.New(bU);};P.New=bB.Ctor(function(bU){this.transformTime=bU;},P);Q.CubicInOut=function(){U.$cctor();return U.CubicInOut;};R.get_Empty=function(){return{$:0,$0:p.Empty()};};R.WhenDone=function(bU,bV){return R.Append({$:0,$0:p.Single({$:0,$0:bU})},bV);};R.Run=function(bU,bV){var bW;function bX(bY){function bZ(b0,b1){var b2;b2=b1-b0;bV.Compute(b2);bU();return b2<=bW?void a.requestAnimationFrame(function(b3){bZ(b0,b3);}):bY();}a.requestAnimationFrame(function(b0){bZ(b0,b0);});}bW=bV.Duration;return bW===0?bE.Zero():bE.FromContinuations(function(bY,bZ,b0){return bX.apply(null,[bY,bZ,b0]);});};R.Play=function(bU){var bV;bV=null;return bE.Delay(function(){return bE.Bind(R.Run(a.ignore,S.Actions(bU)),function(){S.Finalize(bU);return bE.Return(null);});});};R.Pack=function(bU){return{$:0,$0:p.Single({$:1,$0:bU})};};R.Map=function(bU,bV){var bW;return S.Def(bV.Duration,(bW=bV.Compute,function(bX){return bU(bW(bX));}));};R.Delayed=function(bU,bV,bW,bX,bY,bZ){return{Compute:function(b0){return b0<=bX?bY:bU.Interpolate(bV.TransformTime((b0-bX)/bW),bY,bZ);},Duration:bW+bX};};R.Simple=function(bU,bV,bW,bX,bY){return{Compute:function(bZ){return bU.Interpolate(bV.TransformTime(bZ/bW),bX,bY);},Duration:bW};};R.Const=function(bU){return S.Const(bU);};R.Concat=function(bU){return{$:0,$0:p.Concat(bz.map(S.List,bU))};};R.Append=function(bU,bV){return{$:0,$0:p.Append(bU.$0,bV.$0)};};R.set_UseAnimations=function(bU){S.set_UseAnimations(bU);};R.get_UseAnimations=function(){return S.UseAnimations();};S.UseAnimations=function(){U.$cctor();return U.UseAnimations;};S.set_UseAnimations=function(bU){U.$cctor();U.UseAnimations=bU;};S.Actions=function(bU){return S.ConcatActions(bt.choose(function(bV){return bV.$==1?{$:1,$0:bV.$0}:null;},p.ToArray(bU.$0)));};S.ConcatActions=function(bU){var bV,bW,bX,bY;bV=d.ofSeqNonCopying(bU);bW=bt.length(bV);return bW===0?S.Const():bW===1?bt.get(bV,0):(bX=bz.max(bz.map(function(bZ){return bZ.Duration;},bV)),(bY=bt.map(function(bZ){return S.Prolong(bX,bZ);},bV),S.Def(bX,function(bZ){bt.iter(function(b0){b0.Compute(bZ);},bY);})));};S.Prolong=function(bU,bV){var bW,bX,bY;bW=bV.Compute;bX=bV.Duration;bY=bJ.Create(function(){return bV.Compute(bV.Duration);});return{Compute:function(bZ){return bZ>=bX?bY.f():bW(bZ);},Duration:bU};};S.Const=function(bU){return S.Def(0,function(){return bU;});};S.Def=function(bU,bV){return{Compute:bV,Duration:bU};};S.Finalize=function(bU){bt.iter(function(bV){if(bV.$==0)bV.$0();},p.ToArray(bU.$0));};S.List=function(bU){return bU.$0;};T=c.Trans=bB.Class({Copy:function(bU,bV,bW,bX){var bY,bZ,b0,b1,b2;function b3(b4,b5){return bY.TChange(b4,b5);}bY=this;bZ=bU==null?function(b4){return function(b5){return b3(b4,b5);};}:bU.$0;return new T.New$3(function(b4,b5){return(bZ(b4))(b5);},(b0=this.get_TEnter(),bV==null?b0:bV.$0),(b1=this.get_TExit(),bW==null?b1:bW.$0),(b2=this.get_TFlags(),bX==null?b2:bX.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(bU,bV){return this.change(bU,bV);}},k,T);T.New=bB.Ctor(function(bU,bV,bW){T.New$3.call(this,bU,bC.Equals(bV,null)?R.Const:bV,bC.Equals(bW,null)?R.Const:bW,1|(bC.Equals(bV,null)?0:2)|(bC.Equals(bW,null)?0:4));},T);T.New$1=bB.Ctor(function(bU){T.New$3.call(this,bU,R.Const,R.Const,1);},T);T.New$2=bB.Ctor(function(){T.New$3.call(this,function(bU,bV){return R.Const(bV);},R.Const,R.Const,0);},T);T.New$3=bB.Ctor(function(bU,bV,bW,bX){this.change=bU;this.enter=bV;this.exit=bW;this.flags=bX;},T);T.Exit=function(bU,bV){return bV.Copy(null,null,{$:1,$0:bU},{$:1,$0:bV.get_TFlags()|4});};T.Enter=function(bU,bV){return bV.Copy(null,{$:1,$0:bU},null,{$:1,$0:bV.get_TFlags()|2});};T.Change=function(bU,bV){return bV.Copy({$:1,$0:bU},null,null,{$:1,$0:bV.get_TFlags()|1});};T.Create=function(bU){return new T.New$1(bU);};T.Trivial=function(){return new T.New$2();};T.CanAnimateExit=function(bU){var bV,bW;bV=bU.get_TFlags();bW=4;return(bV&bW)===bW;};T.CanAnimateEnter=function(bU){var bV,bW;bV=bU.get_TFlags();bW=2;return(bV&bW)===bW;};T.CanAnimateChange=function(bU){var bV,bW;bV=bU.get_TFlags();bW=1;return(bV&bW)===bW;};T.AnimateExit=function(bU,bV){return(bU.get_TExit())(bV);};T.AnimateEnter=function(bU,bV){return(bU.get_TEnter())(bV);};T.AnimateChange=function(bU,bV,bW){return bU.TChange(bV,bW);};U.$cctor=function(){U.$cctor=a.ignore;U.CubicInOut=P.Custom(function(bU){var bV;bV=bU*bU;return 3*bV-2*(bV*bU);});U.UseAnimations=true;};V=c.AnimatedAttrNode=bB.Class({sync:function(bU){var bV;if(this.dirty){bV=this.logical;bV==null?void 0:(this.push(bU))(bV.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(bU,bV){this.visible={$:1,$0:bV};this.dirty=true;(this.push(bU))(bV);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(bU){var bV,bW;bV=this;return R.WhenDone(function(){bV.dirty=true;bV.visible=null;},(bW=this.visible,bW!=null&&bW.$==1?R.Pack(R.Map(function(bX){bV.pushVisible(bU,bX);},T.AnimateExit(this.tr,bW.$0))):R.get_Empty()));},NGetEnterAnim:function(bU){var bV,bW,bX,bY,bZ;bV=this;return R.WhenDone(function(){bV.sync(bU);},(bW=this.visible,(bX=this.logical,bW!=null&&bW.$==1&&(bX!=null&&bX.$==1&&(this.dirty&&(bY=[bX.$0,bW.$0],true)))?R.Pack(R.Map(function(b0){bV.pushVisible(bU,b0);},T.AnimateChange(this.tr,bY[1],bY[0]))):bW==null&&(bX!=null&&bX.$==1)?R.Pack(R.Map(function(b0){bV.pushVisible(bU,b0);},T.AnimateEnter(this.tr,bX.$0))):R.get_Empty())));},NGetChangeAnim:function(bU){var bV,bW,bX,bY;bV=this;return R.WhenDone(function(){bV.sync(bU);},(bW=this.visible,(bX=this.logical,bW!=null&&bW.$==1&&(bX!=null&&bX.$==1&&(this.dirty&&(bY=[bX.$0,bW.$0],true)))?R.Pack(R.Map(function(bZ){bV.pushVisible(bU,bZ);},T.AnimateChange(this.tr,bY[1],bY[0]))):R.get_Empty())));}},k,V);V.New=bB.Ctor(function(bU,bV,bW){var bX;bX=this;this.tr=bU;this.push=bW;this.logical=null;this.visible=null;this.dirty=true;this.updates=y.Map(function(bY){bX.logical={$:1,$0:bY};bX.dirty=true;},bV);},V);W=c.DynamicAttrNode=bB.Class({NChanged:function(){return this.updates;},NSync:function(bU){if(this.dirty){(this.push(bU))(this.value);this.dirty=false;}},NGetExitAnim:function(bU){return R.get_Empty();},NGetEnterAnim:function(bU){return R.get_Empty();},NGetChangeAnim:function(bU){return R.get_Empty();}},k,W);W.New=bB.Ctor(function(bU,bV){var bW;bW=this;this.push=bV;this.value=void 0;this.dirty=false;this.updates=y.Map(function(bX){bW.value=bX;bW.dirty=true;},bU);},W);X=c.AttrProxy=bB.Class({},null,X);X.Handler=function(bU,bV){return X.HandlerImpl(bU,bV);};X.HandlerImpl=function(bU,bV){return _1.Static(function(bW){bW.addEventListener(bU,function(bX){return(bV(bW))(bX);},false);});};X.Concat=function(bU){var bV;bV=d.ofSeqNonCopying(bU);return d.TreeReduce(_1.EmptyAttr(),X.Append,bV);};X.Append=function(bU,bV){return _1.AppendTree(bU,bV);};X.Create=function(bU,bV){return _1.Static(function(bW){r.SetAttr(bW,bU,bV);});};_0.New=function(bU,bV,bW,bX){var bY;bY={DynElem:bU,DynFlags:bV,DynNodes:bW};bB.SetOptional(bY,"OnAfterRender",bX);return bY;};_1.Static=function(bU){return new X({$:3,$0:bU});};_1.Dynamic=function(bU,bV){return new X({$:1,$0:new W.New(bU,bV)});};_1.Animated=function(bU,bV,bW){var bX,bY,bZ;bX=new V.New(bU,bV,bW);bY=4;T.CanAnimateEnter(bU)?bY=bY|1:void 0;T.CanAnimateExit(bU)?bY=bY|2:void 0;bZ=new X({$:1,$0:bX});_1.SetFlags(bZ,bY);return bZ;};_1.EmptyAttr=function(){_4.$cctor();return _4.EmptyAttr;};_1.AppendTree=function(bU,bV){var bW;return bU===null?bV:bV===null?bU:(bW=new X({$:2,$0:bU,$1:bV}),(_1.SetFlags(bW,_1.Flags(bU)|_1.Flags(bV)),bW));};_1.GetChangeAnim=function(bU){return _1.GetAnim(bU,function(bV,bW){return bV.NGetChangeAnim(bW);});};_1.GetExitAnim=function(bU){return _1.GetAnim(bU,function(bV,bW){return bV.NGetExitAnim(bW);});};_1.GetEnterAnim=function(bU){return _1.GetAnim(bU,function(bV,bW){return bV.NGetEnterAnim(bW);});};_1.GetAnim=function(bU,bV){return R.Concat(bt.map(function(bW){return bV(bW,bU.DynElem);},bU.DynNodes));};_1.Updates=function(bU){return d.MapTreeReduce(function(bV){return bV.NChanged();},y.Const(),y.Map2Unit,bU.DynNodes);};_1.Empty=function(bU){return _0.New(bU,0,[],null);};_1.Insert=function(bU,bV){var bW,bX,bY;function bZ(b0){if(!(b0===null))if(b0!=null&&b0.$==1)bW.push(b0.$0);else if(b0!=null&&b0.$==2){bZ(b0.$0);bZ(b0.$1);}else if(b0!=null&&b0.$==3)b0.$0(bU);else if(b0!=null&&b0.$==4)bX.push(b0.$0);}bW=[];bX=[];bZ(bV);bY=bW.slice(0);return _0.New(bU,_1.Flags(bV),bY,bX.length===0?null:{$:1,$0:function(b0){bz.iter(function(b1){b1(b0);},bX);}});};_1.Sync=function(bU,bV){bt.iter(function(bW){bW.NSync(bU);},bV.DynNodes);};_1.SetFlags=function(bU,bV){bU.flags=bV;};_1.Flags=function(bU){return bU!==null&&bU.hasOwnProperty("flags")?bU.flags:0;};_1.HasExitAnim=function(bU){var bV;bV=2;return(bU.DynFlags&bV)===bV;};_1.HasEnterAnim=function(bU){var bV;bV=1;return(bU.DynFlags&bV)===bV;};_1.HasChangeAnim=function(bU){var bV;bV=4;return(bU.DynFlags&bV)===bV;};_2=c.CheckedInput=bB.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_2);_2.Make=function(bU){return new _2({$:0,$0:bU,$1:a.String(bU)});};_3.ValidateForm=function(){return _3.OnAfterRender(function(bU){if(window.H5F)window.H5F.setup(bU);});};_3.Checked=function(bU){function bV(bW,bX){return!bC.Equals(bU.Get(),bW.checked)?bU.Set(bW.checked):null;}return X.Concat([_3.DynamicProp("checked",bU.get_View()),_3.Handler("change",function(bW){return function(bX){return bV(bW,bX);};}),_3.Handler("click",function(bW){return function(bX){return bV(bW,bX);};})]);};_3.FloatValue=function(bU){return _3.CustomVar(bU,function(bV,bW){var bX;bX=bW.get_Input();return bV.value!==bX?void(bV.value=bX):null;},function(bV){var bW,bX;bW=bV.value;return{$:1,$0:e.isBlank(bW)?(bV.checkValidity?bV.checkValidity():true)?new _2({$:2,$0:bW}):new _2({$:1,$0:bW}):(bX=+bW,a.isNaN(bX)?new _2({$:1,$0:bW}):new _2({$:0,$0:bX,$1:bW}))};});};_3.FloatValueUnchecked=function(bU){return _3.CustomValue(bU,a.String,function(bV){var bW;return e.isBlank(bV)?{$:1,$0:0}:(bW=+bV,a.isNaN(bW)?null:{$:1,$0:bW});});};_3.IntValue=function(bU){return _3.CustomVar(bU,function(bV,bW){var bX;bX=bW.get_Input();return bV.value!==bX?void(bV.value=bX):null;},function(bV){var bW,bX,bY;bW=bV.value;return{$:1,$0:e.isBlank(bW)?(bV.checkValidity?bV.checkValidity():true)?new _2({$:2,$0:bW}):new _2({$:1,$0:bW}):(bX=(bY=0,[bM.TryParseInt32(bW,{get:function(){return bY;},set:function(bZ){bY=bZ;}}),bY]),bX[0]?new _2({$:0,$0:bX[1],$1:bW}):new _2({$:1,$0:bW}))};});};_3.IntValueUnchecked=function(bU){return _3.CustomValue(bU,a.String,function(bV){var bW;return e.isBlank(bV)?{$:1,$0:0}:(bW=+bV,bW!==bW>>0?null:{$:1,$0:bW});});};_3.Value=function(bU){function bV(bW){return{$:1,$0:bW};}return _3.CustomValue(bU,a.id,function(bW){return bV(a.id(bW));});};_3.ContentEditableHtml=function(bU){var bV;bV=_3.CustomVar(bU,function(bW,bX){bW.innerHTML=bX;},function(bW){return{$:1,$0:bW.innerHTML};});return X.Append(X.Create("contenteditable","true"),bV);};_3.ContentEditableText=function(bU){var bV;bV=_3.CustomVar(bU,function(bW,bX){bW.textContent=bX;},function(bW){return{$:1,$0:bW.textContent};});return X.Append(X.Create("contenteditable","true"),bV);};_3.CustomValue=function(bU,bV,bW){return _3.CustomVar(bU,function(bX,bY){bX.value=bV(bY);},function(bX){return bW(bX.value);});};_3.CustomVar=function(bU,bV,bW){function bX(bZ,b0){return bU.UpdateMaybe(function(b1){var b2,b3;b2=bW(bZ);return b2!=null&&b2.$==1&&(!bC.Equals(b2.$0,b1)&&(b3=[b2,b2.$0],true))?b3[0]:null;});}function bY(bZ,b0){var b1,b2;b1=bW(bZ);return b1!=null&&b1.$==1&&(bC.Equals(b1.$0,b0)&&(b2=b1.$0,true))?null:bV(bZ,b0);}return X.Concat([_3.Handler("change",function(bZ){return function(b0){return bX(bZ,b0);};}),_3.Handler("input",function(bZ){return function(b0){return bX(bZ,b0);};}),_3.Handler("keypress",function(bZ){return function(b0){return bX(bZ,b0);};}),_3.DynamicCustom(function(bZ){return function(b0){return bY(bZ,b0);};},bU.get_View())]);};_3.DynamicProp=function(bU,bV){return _1.Dynamic(bV,function(bW){return function(bX){bW[bU]=bX;};});};_3.DynamicPred=function(bU,bV,bW){function bX(bY,bZ){return bZ[0]?r.SetAttr(bY,bU,bZ[1]):r.RemoveAttr(bY,bU);}return _1.Dynamic(y.Map2(function(bY,bZ){return[bY,bZ];},bV,bW),function(bY){return function(bZ){return bX(bY,bZ);};});};_3.DynamicClass=function(bU,bV,bW){return _3.DynamicClassPred(bU,y.Map(bW,bV));};_3.Class=function(bU){return _3.ClassPred(bU,true);};_3.ClassPred=function(bU,bV){return _1.Static(function(bW){if(bV)r.AddClass(bW,bU);else r.RemoveClass(bW,bU);});};_3.DynamicClassPred=function(bU,bV){return _1.Dynamic(bV,function(bW){return function(bX){return bX?r.AddClass(bW,bU):r.RemoveClass(bW,bU);};});};_3.OnAfterRenderView=function(bU,bV){var bW;bW=h.Id();return X.Append(_3.OnAfterRender(function(bX){bV(bX,bX[bW]);}),_3.DynamicCustom(function(bX){return function(bY){bX[bW]=bY;};},bU));};_3.OnAfterRender=function(bU){return new X({$:4,$0:bU});};_3.HandlerView=function(bU,bV,bW){return _1.Static(function(bX){var bY;bY=bW(bX);bX.addEventListener(bU,function(bZ){return y.Get(bY(bZ),bV);},false);});};_3.Handler=function(bU,bV){return _1.Static(function(bW){bW.addEventListener(bU,function(bX){return(bV(bW))(bX);},false);});};_3.DynamicStyle=function(bU,bV){return _1.Dynamic(bV,function(bW){return function(bX){return r.SetStyle(bW,bU,bX);};});};_3.DynamicCustom=function(bU,bV){return _1.Dynamic(bV,bU);};_3.Dynamic=function(bU,bV){return _1.Dynamic(bV,function(bW){return function(bX){return r.SetAttr(bW,bU,bX);};});};_3.AnimatedStyle=function(bU,bV,bW,bX){return _1.Animated(bV,bW,function(bY){return function(bZ){return r.SetStyle(bY,bU,bX(bZ));};});};_3.Animated=function(bU,bV,bW,bX){return _1.Animated(bV,bW,function(bY){return function(bZ){return r.SetAttr(bY,bU,bX(bZ));};});};_3.Style=function(bU,bV){return _1.Static(function(bW){r.SetStyle(bW,bU,bV);});};_4.$cctor=function(){_4.$cctor=a.ignore;_4.EmptyAttr=null;};_5=c.DocElemNode=bB.Class({GetHashCode:function(){return this.ElKey;},Equals:function(bU){return this.ElKey===bU.ElKey;}},null,_5);_5.New=function(bU,bV,bW,bX,bY,bZ){var b0;return new _5((b0={Attr:bU,Children:bV,El:bX,ElKey:bY},(bB.SetOptional(b0,"Delimiters",bW),bB.SetOptional(b0,"Render",bZ),b0)));};_7.FoldBack=function(bU,bV,bW){return bt.foldBack(bU,bV.$0,bW);};_7.Iter=function(bU,bV){bt.iter(bU,bV.$0);};_7.Except=function(bU,bV){var bW;bW=bU.$0;return{$:0,$0:bt.filter(function(bX){return bt.forall(function(bY){return!(bX===bY);},bW);},bV.$0)};};_7.DocChildren=function(bU){var bV;function bW(bX){if(bX!=null&&bX.$==2)bW(bX.$0.Current);else if(bX!=null&&bX.$==1)bV.push(bX.$0.El);else if(bX==null);else if(bX!=null&&bX.$==5)bV.push(bX.$0);else if(bX!=null&&bX.$==4)bV.push(bX.$0.Text);else if(bX!=null&&bX.$==6)bt.iter(function(bY){if(bY.constructor===a.Object)bW(bY);else bV.push(bY);},bX.$0.Els);else{bW(bX.$0);bW(bX.$1);}}bV=[];bW(bU.Children);return{$:0,$0:d.ofSeqNonCopying(bV)};};_7.Children=function(bU,bV){var bW,bX,bY;if(bV!=null&&bV.$==1){bY=[];bW=bV.$0[0].nextSibling;while(bW!==bV.$0[1]){bY.push(bW);bW=bW.nextSibling;}return{$:0,$0:bY};}else return{$:0,$0:bt.init(bU.childNodes.length,(bX=bU.childNodes,function(bZ){return bX[bZ];}))};};_8.ToArray=function(bU){return i.ToArray(bU.$0);};_8.get_Empty=function(){return{$:0,$0:new by.New$3()};};_8.IsEmpty=function(bU){return bU.$0.get_Count()===0;};_8.Intersect=function(bU,bV){return{$:0,$0:i.Intersect(bU.$0,bV.$0)};};_8.Except=function(bU,bV){return{$:0,$0:i.Except(bU.$0,bV.$0)};};_8.FindAll=function(bU){var bV;function bW(bY){if(bY!=null&&bY.$==0){bW(bY.$0);bW(bY.$1);}else if(bY!=null&&bY.$==1)bX(bY.$0);else if(bY!=null&&bY.$==2)bW(bY.$0.Current);else if(bY!=null&&bY.$==6)bt.iter(bX,bY.$0.Holes);}function bX(bY){bV.push(bY);bW(bY.Children);}bV=[];bW(bU);return{$:0,$0:new by.New$2(bV)};};_8.Filter=function(bU,bV){return{$:0,$0:i.Filter(bU,bV.$0)};};_9.New=function(bU,bV){return{PreviousNodes:bU,Top:bV};};_.TextHoleRE=function(){bc.$cctor();return bc.TextHoleRE;};_.LocalTemplatesLoaded=function(){bc.$cctor();return bc.LocalTemplatesLoaded;};_.set_LocalTemplatesLoaded=function(bU){bc.$cctor();bc.LocalTemplatesLoaded=bU;};_.LoadedTemplateFile=function(bU){var bV,bW,bX;bV=(bW=null,[_.LoadedTemplates().TryGetValue(bU,{get:function(){return bW;},set:function(bY){bW=bY;}}),bW]);return bV[0]?bV[1]:(bX=new bK.New$5(),(_.LoadedTemplates().set_Item(bU,bX),bX));};_.LoadedTemplates=function(){bc.$cctor();return bc.LoadedTemplates;};_.UpdateTextNode=function(bU,bV){bU.Value=bV;bU.Dirty=true;};_.CreateTextNode=function(){return{Text:r.CreateText(""),Dirty:false,Value:""};};_.UpdateEmbedNode=function(bU,bV){bU.Current=bV;bU.Dirty=true;};_.CreateEmbedNode=function(){return{Current:null,Dirty:false};};_.PerformAnimatedUpdate=function(bU,bV){var bW;return R.get_UseAnimations()?(bW=null,bE.Delay(function(){var bX,bY,bZ;bX=_8.FindAll(bV);bY=_.ComputeChangeAnim(bU,bX);bZ=_.ComputeEnterAnim(bU,bX);return bE.Bind(R.Play(R.Append(bY,_.ComputeExitAnim(bU,bX))),function(){return bE.Bind(_.SyncElemNodesNextFrame(bU),function(){return bE.Bind(R.Play(bZ),function(){bU.PreviousNodes=bX;return bE.Return(null);});});});})):_.SyncElemNodesNextFrame(bU);};_.SyncElemNodesNextFrame=function(bU){function bV(bW){a.requestAnimationFrame(function(){_.SyncElemNode(bU.Top);bW();});}return bE.FromContinuations(function(bW,bX,bY){return bV.apply(null,[bW,bX,bY]);});};_.ComputeEnterAnim=function(bU,bV){return R.Concat(bt.map(function(bW){return _1.GetEnterAnim(bW.Attr);},_8.ToArray(_8.Except(bU.PreviousNodes,_8.Filter(function(bW){return _1.HasEnterAnim(bW.Attr);},bV)))));};_.ComputeChangeAnim=function(bU,bV){var bW;function bX(bY){return _1.HasChangeAnim(bY.Attr);}bW=function(bY){return _8.Filter(bX,bY);};return R.Concat(bt.map(function(bY){return _1.GetChangeAnim(bY.Attr);},_8.ToArray(_8.Intersect(bW(bU.PreviousNodes),bW(bV)))));};_.ComputeExitAnim=function(bU,bV){return R.Concat(bt.map(function(bW){return _1.GetExitAnim(bW.Attr);},_8.ToArray(_8.Except(bV,_8.Filter(function(bW){return _1.HasExitAnim(bW.Attr);},bU.PreviousNodes)))));};_.CreateDelimitedRunState=function(bU,bV,bW){return _9.New(_8.get_Empty(),_.CreateDelimitedElemNode(bU,bV,_1.EmptyAttr(),bW));};_.CreateRunState=function(bU,bV){return _9.New(_8.get_Empty(),_.CreateElemNode(bU,_1.EmptyAttr(),bV));};_.CreateDelimitedElemNode=function(bU,bV,bW,bX){var bY,bZ;bY=bU.parentNode;_.LinkPrevElement(bV,bX);bZ=_1.Insert(bY,bW);return _5.New(bZ,bX,{$:1,$0:[bU,bV]},bY,h.Int(),bB.GetOptional(bZ.OnAfterRender));};_.CreateElemNode=function(bU,bV,bW){var bX;_.LinkElement(bU,bW);bX=_1.Insert(bU,bV);return _5.New(bX,bW,null,bU,h.Int(),bB.GetOptional(bX.OnAfterRender));};_.SyncElemNode=function(bU){_.SyncElement(bU);_.Sync(bU.Children);_.AfterRender(bU);};_.Sync=function(bU){var bV,bW;if(bU!=null&&bU.$==1)_.SyncElemNode(bU.$0);else if(bU!=null&&bU.$==2)_.Sync(bU.$0.Current);else if(bU==null);else if(bU!=null&&bU.$==5);else if(bU!=null&&bU.$==4){bV=bU.$0;bV.Dirty?(bV.Text.nodeValue=bV.Value,bV.Dirty=false):void 0;}else if(bU!=null&&bU.$==6){bW=bU.$0;bt.iter(function(bX){_.SyncElemNode(bX);},bW.Holes);bt.iter(function(bX){_1.Sync(bX[0],bX[1]);},bW.Attrs);_.AfterRender(bW);}else{_.Sync(bU.$0);_.Sync(bU.$1);}};_.AfterRender=function(bU){var bV;bV=bB.GetOptional(bU.Render);bV!=null&&bV.$==1?(bV.$0(bU.El),bB.SetOptional(bU,"Render",null)):void 0;};_.InsertBeforeDelim=function(bU,bV){var bW,bX;bW=bU.parentNode;bX=a.document.createTextNode("");bW.insertBefore(bX,bU);_.LinkPrevElement(bU,bV);return bX;};_.LinkPrevElement=function(bU,bV){_.InsertDoc(bU.parentNode,bV,bU);};_.LinkElement=function(bU,bV){_.InsertDoc(bU,bV,null);};_.SyncElement=function(bU){function bV(bW){function bX(bY){var bZ,b0;return bY!=null&&bY.$==0?bX(bY.$0)||bX(bY.$1):bY!=null&&bY.$==2?(bZ=bY.$0,bZ.Dirty||bX(bZ.Current)):bY!=null&&bY.$==6&&(b0=bY.$0,b0.Dirty||bt.exists(bV,b0.Holes));}return bX(bW.Children);}_1.Sync(bU.El,bU.Attr);bV(bU)?_.DoSyncElement(bU):void 0;};_.DoSyncElement=function(bU){var bV,bW,bX;function bY(bZ,b0){var b1,b2;return bZ!=null&&bZ.$==1?bZ.$0.El:bZ!=null&&bZ.$==2?(b1=bZ.$0,b1.Dirty?(b1.Dirty=false,_.InsertDoc(bV,b1.Current,b0)):bY(b1.Current,b0)):bZ==null?b0:bZ!=null&&bZ.$==4?bZ.$0.Text:bZ!=null&&bZ.$==5?bZ.$0:bZ!=null&&bZ.$==6?(b2=bZ.$0,(b2.Dirty?b2.Dirty=false:void 0,bt.foldBack(function(b3,b4){return b3.constructor===a.Object?bY(b3,b4):b3;},b2.Els,b0))):bY(bZ.$0,bY(bZ.$1,b0));}bV=bU.El;_7.Iter((bW=bU.El,function(bZ){r.RemoveNode(bW,bZ);}),_7.Except(_7.DocChildren(bU),_7.Children(bU.El,bB.GetOptional(bU.Delimiters))));bY(bU.Children,(bX=bB.GetOptional(bU.Delimiters),bX!=null&&bX.$==1?bX.$0[1]:null));};_.InsertDoc=function(bU,bV,bW){var bX;return bV!=null&&bV.$==1?_.InsertNode(bU,bV.$0.El,bW):bV!=null&&bV.$==2?(bX=bV.$0,(bX.Dirty=false,_.InsertDoc(bU,bX.Current,bW))):bV==null?bW:bV!=null&&bV.$==4?_.InsertNode(bU,bV.$0.Text,bW):bV!=null&&bV.$==5?_.InsertNode(bU,bV.$0,bW):bV!=null&&bV.$==6?bt.foldBack(function(bY,bZ){return bY.constructor===a.Object?_.InsertDoc(bU,bY,bZ):_.InsertNode(bU,bY,bZ);},bV.$0.Els,bW):_.InsertDoc(bU,bV.$0,_.InsertDoc(bU,bV.$1,bW));};_.InsertNode=function(bU,bV,bW){r.InsertAt(bU,bW,bV);return bV;};$=c.Doc=bB.Class({ReplaceInDom:function(bU){var bV;bV=a.document.createTextNode("");bU.parentNode.replaceChild(bV,bU);$.RunBefore(bV,this);}},k,$);$.Append=function(bU,bV){return $.Mk({$:0,$0:bU.docNode,$1:bV.docNode},y.Map2Unit(bU.updates,bV.updates));};$.Concat=function(bU){var bV;bV=d.ofSeqNonCopying(bU);return d.TreeReduce($.Empty(),$.Append,bV);};$.Empty=function(){return $.Mk(null,y.Const());};$.TextNode=function(bU){return $.Mk({$:5,$0:r.CreateText(bU)},y.Const());};$.Verbatim=function(bU){var bV;return $.Mk(d.MapTreeReduce(function(bW){return bC.Equals(bW.nodeType,bN.TEXT_NODE)?{$:5,$0:bW}:{$:1,$0:_.CreateElemNode(bW,_1.EmptyAttr(),null)};},null,function(bW,bX){return{$:0,$0:bW,$1:bX};},(bV=bO.parseHTML(bU),bC.Equals(bV,null)?[]:bV)),y.Const());};$.SvgElementMixed=function(bU,bV){var bW;bW=$.MixedNodes(bV);return $.SvgElement(bU,bW[0],bW[1]);};$.SvgElement=function(bU,bV,bW){var bX,bY;bX=X.Concat(bV);bY=$.Concat(bW);return ba.New(r.CreateSvgElement(bU),bX,bY);};$.ElementMixed=function(bU,bV){var bW;bW=$.MixedNodes(bV);return $.Element(bU,bW[0],bW[1]);};$.ConcatMixed=function(bU){return $.Concat(bz.map($.ToMixedDoc,bU));};$.MixedNodes=function(bU){var bV,bW,bX,bY;bV=[];bW=[];bX=bu.Get(bU);try{while(bX.MoveNext()){bY=bX.Current();bY instanceof X?bV.push(bY):bW.push($.ToMixedDoc(bY));}}finally{if("Dispose"in bX)bX.Dispose();}return[bV,bW];};$.ToMixedDoc=function(bU){return bU instanceof $?bU:typeof bU=="string"?$.TextNode(bU):bU instanceof a.Element?$.Static(bU):typeof bU=="function"?$.EmbedView(y.Map($.ToMixedDoc,bU)):bU instanceof x?$.EmbedView(y.Map($.ToMixedDoc,bU.get_View())):bC.Equals(bU,null)?$.Empty():$.TextNode(a.String(bU));};$.Element=function(bU,bV,bW){var bX,bY;bX=X.Concat(bV);bY=$.Concat(bW);return ba.New(r.CreateElement(bU),bX,bY);};$.Radio=function(bU,bV,bW){var bX,bY;bX=r.CreateElement("input");bX.addEventListener("click",function(){return bW.Set(bV);},false);bY=_3.DynamicProp("checked",y.Map(function(bZ){return bC.Equals(bZ,bV);},bW.get_View()));return ba.New(bX,X.Concat(bs.append(bs.ofArray([X.Create("type","radio"),X.Create("name",bW.get_Id()),bY]),bs.ofSeq(bU))),$.Empty());};$.LinkView=function(bU,bV,bW,bX){var bY;bY=X.Concat(bz.append([_3.HandlerView("click",bW,function(){return function(){return bX;};}),X.Create("href","#")],bV));return ba.New(r.CreateElement("a"),bY,$.TextNode(bU));};$.Link=function(bU,bV,bW){var bX,bY;bX=(bY=X.Concat(bV),X.Append(X.Create("href","#"),bY));return ba.New($.Clickable("a",bW),bX,$.TextNode(bU));};$.ButtonView=function(bU,bV,bW,bX){var bY;bY=X.Concat(bz.append([_3.HandlerView("click",bW,function(){return function(){return bX;};})],bV));return ba.New(r.CreateElement("button"),bY,$.TextNode(bU));};$.Button=function(bU,bV,bW){var bX;bX=X.Concat(bV);return ba.New($.Clickable("button",bW),bX,$.TextNode(bU));};$.Clickable=function(bU,bV){var bW;bW=r.CreateElement(bU);bW.addEventListener("click",function(bX){bX.preventDefault();return bV();},false);return bW;};$.CheckBoxGroup=function(bU,bV,bW){function bX(bY){return bC.Equals(bV,bY);}return $.CheckBox(bU,x.Lens(bW,function(bY){return bs.exists(bX,bY);},function(bY,bZ){return bZ?bs.exists(function(b0){return bC.Equals(bV,b0);},bY)?bY:new bs.T({$:1,$0:bV,$1:bY}):bs.filter(function(b0){return!bC.Equals(bV,b0);},bY);}));};$.CheckBox=function(bU,bV){return $.InputInternal("input",function(){return bz.append(bU,[X.Create("type","checkbox"),_3.Checked(bV)]);});};$.SelectDynOptional=function(bU,bV,bW,bX,bY){return $.SelectDyn(bU,function(bZ){return bZ!=null&&bZ.$==1?bW(bZ.$0):bV;},y.Map(function(bZ){return new bs.T({$:1,$0:null,$1:bs.map(function(b0){return{$:1,$0:b0};},bZ)});},bX),bY);};$.SelectOptional=function(bU,bV,bW,bX,bY){return $.Select(bU,function(bZ){return bZ!=null&&bZ.$==1?bW(bZ.$0):bV;},new bs.T({$:1,$0:null,$1:bs.map(function(bZ){return{$:1,$0:bZ};},bX)}),bY);};$.Select=function(bU,bV,bW,bX){return $.SelectImpl(bU,bV,function(bY){bY[0]=bW;return $.Concat(bs.mapi(function(bZ,b0){return $.Element("option",bs.ofArray([X.Create("value",a.String(bZ))]),bs.ofArray([$.TextNode(bV(b0))]));},bW));},bX);};$.SelectDyn=function(bU,bV,bW,bX){return $.SelectImpl(bU,bV,function(bY){function bZ(b0,b1){return $.Element("option",bs.ofArray([X.Create("value",a.String(b0))]),bs.ofArray([$.TextNode(bV(b1))]));}return $.Convert(function(b0){return bZ(b0[0],b0[1]);},y.Map(function(b0){bY[0]=b0;return bz.mapi(function(b1,b2){return[b1,b2];},b0);},bW));},bX);};$.SelectImpl=function(bU,bV,bW,bX){var bY,bZ,b0,b1;function b2(b7){return b7.selectedIndex;}function b3(b7,b8){b7.selectedIndex=b8;}function b4(b7){var b8;b8=b2(b7);return bY[0].get_Item(b8);}function b5(b7){return bz.findIndex(function(b8){return bC.Equals(b7,b8);},bY[0]);}function b6(b7,b8){return b3(b7,b5(b8));}bY=[bs.T.Empty];bZ=r.CreateElement("select");b0=_3.DynamicCustom(function(b7){return function(b8){return b6(b7,b8);};},bX.get_View());bZ.addEventListener("change",function(){bX.UpdateMaybe(function(b7){var b8;b8=b4(bZ);return bC.Equals(b7,b8)?null:{$:1,$0:b8};});},false);return ba.New(bZ,(b1=X.Append(b0,X.Concat(bU)),X.Append(_3.OnAfterRender(function(b7){b6(b7,bX.Get());}),b1)),bW(bY));};$.InputArea=function(bU,bV){return $.InputInternal("textarea",function(){return bz.append(bU,[_3.Value(bV)]);});};$.FloatInput=function(bU,bV){return $.InputInternal("input",function(){return bz.append(bU,[_3.FloatValue(bV),X.Create("type","number")]);});};$.FloatInputUnchecked=function(bU,bV){return $.InputInternal("input",function(){return bz.append(bU,[bV.Get()===0?X.Create("value","0"):_1.EmptyAttr(),_3.FloatValueUnchecked(bV),X.Create("type","number")]);});};$.IntInput=function(bU,bV){return $.InputInternal("input",function(){return bz.append(bU,[_3.IntValue(bV),X.Create("type","number")]);});};$.IntInputUnchecked=function(bU,bV){return $.InputInternal("input",function(){return bz.append(bU,[bV.Get()===0?X.Create("value","0"):_1.EmptyAttr(),_3.IntValueUnchecked(bV),X.Create("type","number")]);});};$.PasswordBox=function(bU,bV){return $.InputInternal("input",function(){return bz.append(bU,[_3.Value(bV),X.Create("type","password")]);});};$.Input=function(bU,bV){return $.InputInternal("input",function(){return bz.append(bU,[_3.Value(bV)]);});};$.InputInternal=function(bU,bV){var bW;bW=r.CreateElement(bU);return ba.New(bW,X.Concat(bV(bW)),$.Empty());};$.ConvertSeqVarBy=function(bU,bV,bW){return $.Flatten(x.MapLens(bU,bV,bW));};$.ConvertSeqBy=function(bU,bV,bW){return $.Flatten(y.MapSeqCachedViewBy(bU,function(bX,bY){return(bV(bX))(bY);},bW));};$.ConvertSeq=function(bU,bV){return $.Flatten(y.MapSeqCachedView(bU,bV));};$.ConvertBy=function(bU,bV,bW){return $.Flatten(y.MapSeqCachedBy(bU,bV,bW));};$.Convert=function(bU,bV){return $.Flatten(y.MapSeqCached(bU,bV));};$.Flatten=function(bU){return $.EmbedView(y.Map($.Concat,bU));};$.GetOrLoadTemplate=function(bU,bV,bW,bX){$.LoadLocalTemplates$1();$.PrepareTemplate(bU,bV,bW);return $.NamedTemplate(bU,bV,bX);};$.NamedTemplate=function(bU,bV,bW){var bX,bY;bX=(bY=null,[_.LoadedTemplateFile(bU).TryGetValue(bV==null?"":bV.$0,{get:function(){return bY;},set:function(bZ){bY=bZ;}}),bY]);return bX[0]?$.ChildrenTemplate(bX[1].cloneNode(true),bW):(bD.warn("Local template doesn't exist",bV),$.Empty());};$.LoadLocalTemplates=function(bU){var bV;bV=_.LoadedTemplateFile("");bV.count>0?_.LoadedTemplates().set_Item(bU,bV):(function(){var bW,bX,bY,bZ;while(true){bW=a.document.querySelector("[ws-template]");if(bC.Equals(bW,null)){bX=a.document.querySelector("[ws-children-template]");if(bC.Equals(bX,null))return null;else{bY=bX.getAttribute("ws-children-template");bX.removeAttribute("ws-children-template");$.PrepareTemplate(bU,{$:1,$0:bY},function(b0){return function(){return r.ChildrenArray(b0);};}(bX));}}else{bZ=bW.getAttribute("ws-template");$.PrepareSingleTemplate(bU,{$:1,$0:bZ},bW);}}}(),_.LoadedTemplates().set_Item("",_.LoadedTemplateFile(bU)));};$.LoadLocalTemplates$1=function(){if(!_.LocalTemplatesLoaded()){_.set_LocalTemplatesLoaded(true);$.LoadLocalTemplates("");}};$.PrepareTemplate=function(bU,bV,bW){var bX,bY,bZ,b0,b1;if(!_.LoadedTemplateFile(bU).ContainsKey(bV==null?"":bV.$0)){bX=bW();for(bY=0,bZ=bX.length-1;bY<=bZ;bY++){b0=bt.get(bX,bY);b1=b0.parentNode;bC.Equals(b1,null)?void 0:b1.removeChild(b0);}$.PrepareTemplateStrict(bU,bV,bX);}};$.PrepareTemplateStrict=function(bU,bV,bW){var bX,bY;function bZ(b$){var cb,cc,cd,ce,cf,cg,ch,ci;function ca(cj){var ck;ck=b$.getAttribute(cj);ck===null?void 0:b$.setAttribute(cj,ck.toLowerCase());}cb=b$.attributes;cc=[];cd=[];ce=[];for(cf=0,cg=cb.length-1;cf<=cg;cf++){ch=cb.item(cf);bv.StartsWith(ch.nodeName,"ws-on")&&ch.nodeName!=="ws-onafterrender"&&ch.nodeName!=="ws-on"?(cc.push(ch.nodeName),cd.push(bP.string(ch.nodeName,{$:1,$0:"ws-on".length},null)+":"+ch.nodeValue.toLowerCase())):!bv.StartsWith(ch.nodeName,"ws-")&&(new a.RegExp(_.TextHoleRE())).test(ch.nodeValue)?(ch.nodeValue=(ci=new a.RegExp(_.TextHoleRE(),"g"),ch.nodeValue.replace(ci,function(cj,ck){return"${"+ck.toLowerCase()+"}";})),ce.push(ch.nodeName)):void 0;}!(cd.length==0)?b$.setAttribute("ws-on",bv.concat(" ",cd)):void 0;!(ce.length==0)?b$.setAttribute("ws-attr-holes",bv.concat(" ",ce)):void 0;ca("ws-hole");ca("ws-replace");ca("ws-attr");ca("ws-onafterrender");ca("ws-var");bt.iter(function(cj){b$.removeAttribute(cj);},cc);}function b0(b$){var ca,cb,cc,cd,ce,cf;ca=null;cb=0;cd=b$.textContent;ce=new a.RegExp(_.TextHoleRE(),"g");while(ca=ce.exec(cd),ca!==null){b$.parentNode.insertBefore(a.document.createTextNode(bP.string(cd,{$:1,$0:cb},{$:1,$0:ce.lastIndex-bt.get(ca,0).length-1})),b$);cb=ce.lastIndex;cf=a.document.createElement("span");cf.setAttribute("ws-replace",bt.get(ca,1).toLowerCase());b$.parentNode.insertBefore(cf,b$);}ce.lastIndex=0;b$.textContent=bP.string(cd,{$:1,$0:cb},null);}function b1(b$,ca){function cb(cc){r.IterSelector(b$,"["+cc+"]",function(cd){var ce,cf;ce=(cf=null,[ca.TryGetValue(cd.getAttribute(cc).toLowerCase(),{get:function(){return cf;},set:function(cg){cf=cg;}}),cf]);ce[0]?cd.setAttribute(cc,ce[1]):void 0;});}cb("ws-hole");cb("ws-replace");cb("ws-attr");cb("ws-onafterrender");cb("ws-var");r.IterSelector(b$,"[ws-on]",function(cc){cc.setAttribute("ws-on",bv.concat(" ",bt.map(function(cd){var ce,cf,cg;ce=bv.SplitChars(cd,[":"],1);cf=(cg=null,[ca.TryGetValue(bt.get(ce,1),{get:function(){return cg;},set:function(ch){cg=ch;}}),cg]);return cf[0]?bt.get(ce,0)+":"+cf[1]:cd;},bv.SplitChars(cc.getAttribute("ws-on"),[" "],1))));});return r.IterSelector(b$,"[ws-attr-holes]",function(cc){var cd,ce,cf;cd=bv.SplitChars(cc.getAttribute("ws-attr-holes"),[" "],1);for(ce=0,cf=cd.length-1;ce<=cf;ce++)(function(){var cg;function ch(ci,cj){var ck;ck=bH.KeyValue(cj);return ci.replace(new a.RegExp("\\${"+ck[0]+"}","ig"),"${"+ck[1]+"}");}cg=bt.get(cd,ce);return cc.setAttribute(cg,(((bB.Curried3(bz.fold))(ch))(cc.getAttribute(cg)))(ca));}());});}function b2(b$,ca){var cb,cc,cd,ce,cf;bZ(ca);cb=ca.nodeName.toLowerCase();cc=b$.querySelector("[ws-attr="+cb+"]");if(bC.Equals(cc,null))return bD.warn("Filling non-existent attr hole",cb);else{cc.removeAttribute("ws-attr");for(cd=0,ce=ca.attributes.length-1;cd<=ce;cd++){cf=ca.attributes.item(cd);cf.name==="class"&&cc.hasAttribute("class")?cc.setAttribute("class",cc.getAttribute("class")+" "+cf.nodeValue):cc.setAttribute(cf.name,cf.nodeValue);}return;}}function b3(b$,ca){function cb(cc){r.IterSelector(b$,"["+cc+"]",function(cd){if(!ca.Contains(cd.getAttribute(cc)))cd.removeAttribute(cc);});}cb("ws-attr");cb("ws-onafterrender");cb("ws-var");r.IterSelector(b$,"[ws-hole]",function(cc){if(!ca.Contains(cc.getAttribute("ws-hole"))){cc.removeAttribute("ws-hole");while(cc.hasChildNodes())cc.removeChild(cc.lastChild);}});r.IterSelector(b$,"[ws-replace]",function(cc){if(!ca.Contains(cc.getAttribute("ws-replace")))cc.parentNode.removeChild(cc);});r.IterSelector(b$,"[ws-on]",function(cc){cc.setAttribute("ws-on",bv.concat(" ",bt.filter(function(cd){return ca.Contains(bt.get(bv.SplitChars(cd,[":"],1),1));},bv.SplitChars(cc.getAttribute("ws-on"),[" "],1))));});return r.IterSelector(b$,"[ws-attr-holes]",function(cc){var cd,ce,cf,cg,ch;cd=bv.SplitChars(cc.getAttribute("ws-attr-holes"),[" "],1);for(ce=0,cf=cd.length-1;ce<=cf;ce++){cg=bt.get(cd,ce);cc.setAttribute(cg,(ch=new a.RegExp(_.TextHoleRE(),"g"),cc.getAttribute(cg).replace(ch,function(ci,cj){return ca.Contains(cj)?ci:"";})));}});}function b4(b$,ca){var cb;cb=b$.querySelector("[ws-replace]");return bC.Equals(cb,null)?(bD.warn("Filling non-existent text hole",bV),null):(cb.parentNode.replaceChild(new a.Text(ca),cb),{$:1,$0:cb.getAttribute("ws-replace")});}function b5(b$,ca,cb){while(true)if(b$.hasChildNodes())cb=ca.insertBefore(b$.lastChild,cb);else return null;}function b6(b$,ca,cb){var cc,cd,ce,cf,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC;function cg(cD){}while(true)switch(b$){case 0:ch=bP.string(ca.nodeName,{$:1,$0:3},null).toLowerCase();ci=(cc=ch.indexOf("."),cc===-1?[bU,ch]:[bP.string(ch,null,{$:1,$0:cc-1}),bP.string(ch,{$:1,$0:cc+1},null)]);cj=ci[1];ck=ci[0];if(!_.LoadedTemplates().ContainsKey(ck))return bD.warn("Instantiating non-loaded template",cj);else{cl=_.LoadedTemplates().get_Item(ck);if(!cl.ContainsKey(cj))return bD.warn("Instantiating non-loaded template",cj);else{cm=cl.get_Item(cj);cn=cm.cloneNode(true);co=new by.New$3();cp=new bK.New$5();cq=ca.attributes;for(cr=0,cs=cq.length-1;cr<=cs;cr++){ct=cq.item(cr).name.toLowerCase();cp.set_Item(ct,(cu=cq.item(cr).nodeValue,cu===""?ct:cu.toLowerCase()));!co.Add(ct)?bD.warn("Hole mapped twice",ct):void 0;}for(cv=0,cw=ca.childNodes.length-1;cv<=cw;cv++){cx=ca.childNodes[cv];bC.Equals(cx.nodeType,bN.ELEMENT_NODE)?!co.Add(cx.nodeName.toLowerCase())?bD.warn("Hole filled twice",cj):void 0:void 0;}cy=ca.childNodes.length===1&&bC.Equals(ca.firstChild.nodeType,bN.TEXT_NODE);if(cy){ce=b4(cn,ca.firstChild.textContent);((function(cD){return function(cE){if(cE!=null)cD(cE.$0);};}((cf=function(cD){return function(cE){return cD.Add(cE);};}(co),function(cD){return cg(cf(cD));})))(ce));}b3(cn,co);if(!cy){for(cz=0,cA=ca.childNodes.length-1;cz<=cA;cz++){cB=ca.childNodes[cz];bC.Equals(cB.nodeType,bN.ELEMENT_NODE)?cB.hasAttributes()?b2(cn,cB):b7(cn,cB):void 0;}}b1(cn,cp);(((function(cD){function cE(cF,cG){return b5(cD,cF,cG);}return function(cF){return function(cG){return cE(cF,cG);};};}(cn))(ca.parentNode))(ca));ca.parentNode.removeChild(ca);return;}}break;case 1:if(cb!==null){cC=cb.nextSibling;if(bC.Equals(cb.nodeType,bN.TEXT_NODE))b0(cb);else if(bC.Equals(cb.nodeType,bN.ELEMENT_NODE))b9(cb);cb=cC;}else return null;break;}}function b7(b$,ca){var cb,cd,ce;function cc(cf,cg){var ch,ci,cj;if(cd==="title"&&ca.hasChildNodes()){ch=bO.parseHTML(ca.textContent);ca.removeChild(ca.firstChild);for(ci=0,cj=ch.length-1;ci<=cj;ci++)ca.appendChild(bt.get(ch,ci));}else null;b9(ca);return b5(ca,cf,cg);}cd=ca.nodeName.toLowerCase();r.IterSelector(b$,"[ws-attr-holes]",function(cf){var cg,ch,ci,cj,ck;cg=bv.SplitChars(cf.getAttribute("ws-attr-holes"),[" "],1);for(ch=0,ci=cg.length-1;ch<=ci;ch++){cj=bt.get(cg,ch);cf.setAttribute(cj,(ck=new a.RegExp("\\${"+cd+"}","ig"),cf.getAttribute(cj).replace(ck,ca.textContent)));}});ce=b$.querySelector("[ws-hole="+cd+"]");if(bC.Equals(ce,null)){cb=b$.querySelector("[ws-replace="+cd+"]");return bC.Equals(cb,null)?null:(cc(cb.parentNode,cb),void cb.parentNode.removeChild(cb));}else{while(ce.hasChildNodes())ce.removeChild(ce.lastChild);ce.removeAttribute("ws-hole");return cc(ce,null);}}function b8(b$){return b6(0,b$);}function b9(b$){var ca,cb;if(bv.StartsWith(b$.nodeName.toLowerCase(),"ws-")&&!b$.hasAttribute("ws-template"))b8(b$);else{bZ(b$);ca=b$.getAttribute("ws-template");if(ca===null){cb=b$.getAttribute("ws-children-template");if(cb===null)b_(b$,b$.firstChild);else{b$.removeAttribute("ws-children-template");$.PrepareTemplate(bU,{$:1,$0:cb},function(){return r.ChildrenArray(b$);});while(b$.hasChildNodes())b$.removeChild(b$.lastChild);}}else $.PrepareSingleTemplate(bU,{$:1,$0:ca},b$);}}function b_(b$,ca){return b6(1,b$,ca);}bX=$.FakeRoot(bW);bY=(bV==null?"":bV.$0).toLowerCase();_.LoadedTemplateFile(bU).set_Item(bY,bX);bt.length(bW)>0?b_(bX,bt.get(bW,0)):void 0;};$.ComposeName=function(bU,bV){return(bU+"/"+(bV==null?"":bV.$0)).toLowerCase();};$.PrepareSingleTemplate=function(bU,bV,bW){var bX,bY,bZ;bW.removeAttribute("ws-template");bX=bW.getAttribute("ws-replace");bX===null?void 0:(bW.removeAttribute("ws-replace"),bY=bW.parentNode,bC.Equals(bY,null)?void 0:(bZ=a.document.createElement(bW.tagName),bZ.setAttribute("ws-replace",bX),bY.replaceChild(bZ,bW)));$.PrepareTemplateStrict(bU,bV,[bW]);};$.FakeRoot=function(bU){var bV,bW,bX;bV=a.document.createElement("div");for(bW=0,bX=bU.length-1;bW<=bX;bW++)bV.appendChild(bt.get(bU,bW));return bV;};$.ChildrenTemplate=function(bU,bV){var bW,bX,bY,bZ,b0,b3,b4,b5,b6,b7,b8,b9;function b1(b_,b$){var ca,cb,cc;ca=_1.Insert(b_,b$);b4.push(_1.Updates(ca));b5.push([b_,ca]);cb=bB.GetOptional(ca.OnAfterRender);return cb==null?null:(cc=cb.$0,void b6.push(function(){cc(b_);}));}function b2(b_){var b$,ca;b$=(ca=null,[b7.TryGetValue(b_,{get:function(){return ca;},set:function(cb){ca=cb;}}),ca]);return b$[0]?b$[1].$==0?{$:1,$0:b$[1].$1}:b$[1].$==1?{$:1,$0:$.TextNode(b$[1].$1)}:b$[1].$==2?{$:1,$0:$.TextView(b$[1].$1)}:b$[1].$==7?{$:1,$0:$.TextView(b$[1].$1.get_View())}:b$[1].$==8?{$:1,$0:$.TextView(y.Map(a.String,b$[1].$1.get_View()))}:b$[1].$==9?{$:1,$0:$.TextView(y.Map(function(cb){return cb.get_Input();},b$[1].$1.get_View()))}:b$[1].$==10?{$:1,$0:$.TextView(y.Map(a.String,b$[1].$1.get_View()))}:b$[1].$==11?{$:1,$0:$.TextView(y.Map(function(cb){return cb.get_Input();},b$[1].$1.get_View()))}:b$[1].$==12?{$:1,$0:$.TextView(y.Map(a.String,b$[1].$1.get_View()))}:(bD.warn("Content hole filled with attribute data",b_),null):null;}b3=[];b4=[];b5=[];b6=[];b7=new bK.New$5();b8=bu.Get(bV);try{while(b8.MoveNext()){b9=b8.Current();b7.set_Item(b9.$0,b9);}}finally{if("Dispose"in b8)b8.Dispose();}bW=r.ChildrenArray(bU);r.IterSelector(bU,"[ws-hole]",function(b_){var b$,ca,cb;cb=b_.getAttribute("ws-hole");b_.removeAttribute("ws-hole");while(b_.hasChildNodes())b_.removeChild(b_.lastChild);b$=b2(cb);b$!=null&&b$.$==1?(ca=b$.$0,_.LinkElement(b_,ca.docNode),b3.push(_5.New(_1.Empty(b_),ca.docNode,null,b_,h.Int(),null)),b4.push(ca.updates)):void 0;});r.IterSelector(bU,"[ws-replace]",function(b_){var b$,ca,cb,cc,cd,ce;b$=b2(b_.getAttribute("ws-replace"));b$!=null&&b$.$==1?(ca=b$.$0,cb=b_.parentNode,cc=a.document.createTextNode(""),cb.replaceChild(cc,b_),cd=_.InsertBeforeDelim(cc,ca.docNode),ce=bt.tryFindIndex(function(cf){return b_===cf;},bW),ce==null?void 0:bt.set(bW,ce.$0,ca.docNode),b3.push(_5.New(_1.Empty(cb),ca.docNode,{$:1,$0:[cd,cc]},cb,h.Int(),null)),b4.push(ca.updates)):void 0;});r.IterSelector(bU,"[ws-attr]",function(b_){var b$,ca,cb;b$=b_.getAttribute("ws-attr");b_.removeAttribute("ws-attr");ca=(cb=null,[b7.TryGetValue(b$,{get:function(){return cb;},set:function(cc){cb=cc;}}),cb]);ca[0]?ca[1].$==3?b1(b_,ca[1].$1):bD.warn("Attribute hole filled with non-attribute data",b$):void 0;});r.IterSelector(bU,"[ws-on]",function(b_){b1(b_,X.Concat(bt.choose(function(b$){var ca,cb,cc;ca=bv.SplitChars(b$,[":"],1);cb=(cc=null,[b7.TryGetValue(bt.get(ca,1),{get:function(){return cc;},set:function(cd){cc=cd;}}),cc]);return cb[0]?cb[1].$==4?{$:1,$0:_3.Handler(bt.get(ca,0),cb[1].$1)}:cb[1].$==5?{$:1,$0:X.Handler(bt.get(ca,0),cb[1].$2)}:(bD.warn("Event hole on"+bt.get(ca,0)+" filled with non-event data",bt.get(ca,1)),null):null;},bv.SplitChars(b_.getAttribute("ws-on"),[" "],1))));b_.removeAttribute("ws-on");});r.IterSelector(bU,"[ws-onafterrender]",function(b_){var b$,ca,cb;b$=b_.getAttribute("ws-onafterrender");ca=(cb=null,[b7.TryGetValue(b$,{get:function(){return cb;},set:function(cc){cb=cc;}}),cb]);ca[0]?ca[1].$==6?(b_.removeAttribute("ws-onafterrender"),b1(b_,_3.OnAfterRender(ca[1].$1))):bD.warn("onafterrender hole filled with non-onafterrender data",b$):void 0;});r.IterSelector(bU,"[ws-var]",function(b_){var b$,ca,cb;b$=b_.getAttribute("ws-var");b_.removeAttribute("ws-var");ca=(cb=null,[b7.TryGetValue(b$,{get:function(){return cb;},set:function(cc){cb=cc;}}),cb]);ca[0]?ca[1].$==7?b1(b_,_3.Value(ca[1].$1)):ca[1].$==8?b1(b_,_3.Checked(ca[1].$1)):ca[1].$==9?b1(b_,_3.IntValue(ca[1].$1)):ca[1].$==10?b1(b_,_3.IntValueUnchecked(ca[1].$1)):ca[1].$==11?b1(b_,_3.FloatValue(ca[1].$1)):ca[1].$==12?b1(b_,_3.FloatValueUnchecked(ca[1].$1)):bD.warn("Var hole filled with non-Var data",b$):void 0;});r.IterSelector(bU,"[ws-attr-holes]",function(b_){var b$,ca,cb,cc;b$=new a.RegExp(_.TextHoleRE(),"g");ca=bv.SplitChars(b_.getAttribute("ws-attr-holes"),[" "],1);b_.removeAttribute("ws-attr-holes");for(cb=0,cc=ca.length-1;cb<=cc;cb++)(function(){var cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp;cm=bt.get(ca,cb);cn=b_.getAttribute(cm);cd=null;ce=0;co=[];while(cd=b$.exec(cn),cd!==null){cp=bP.string(cn,{$:1,$0:ce},{$:1,$0:b$.lastIndex-bt.get(cd,0).length-1});ce=b$.lastIndex;co.push([cp,bt.get(cd,1)]);}cg=bP.string(cn,{$:1,$0:ce},null);b$.lastIndex=0;ch=bt.foldBack(function(cq,cr){return(function(cs){var ct,cu;ct=cs[0];cu=cs[1];return function(cv){var cw,cx,cy,cz,cA;cw=cv[0];cx=cv[1];cy=(cz=(cA=null,[b7.TryGetValue(cu,{get:function(){return cA;},set:function(cB){cA=cB;}}),cA]),cz[0]?cz[1].$==1?{$:0,$0:cz[1].$1}:cz[1].$==2?{$:1,$0:cz[1].$1}:cz[1].$==7?{$:1,$0:cz[1].$1.get_View()}:cz[1].$==8?{$:1,$0:y.Map(a.String,cz[1].$1.get_View())}:cz[1].$==9?{$:1,$0:y.Map(function(cB){return cB.get_Input();},cz[1].$1.get_View())}:cz[1].$==10?{$:1,$0:y.Map(a.String,cz[1].$1.get_View())}:cz[1].$==11?{$:1,$0:y.Map(function(cB){return cB.get_Input();},cz[1].$1.get_View())}:cz[1].$==12?{$:1,$0:y.Map(a.String,cz[1].$1.get_View())}:(bD.warn("Attribute value hole filled with non-text data",cu),{$:0,$0:""}):{$:0,$0:""});return cy.$==1?[ct,new bs.T({$:1,$0:cw===""?cy.$0:y.Map(function(cB){return cB+cw;},cy.$0),$1:cx})]:[ct+cy.$0+cw,cx];};}(cq))(cr);},co,[cg,bs.T.Empty]);return b1(b_,ch[1].$==1?ch[1].$1.$==1?ch[1].$1.$1.$==1?ch[1].$1.$1.$1.$==0?(ci=ch[0],_3.Dynamic(cm,y.Map3(function(cq,cr,cs){return ci+cq+cr+cs;},ch[1].$0,ch[1].$1.$0,ch[1].$1.$1.$0))):(cj=ch[0],_3.Dynamic(cm,y.Map(function(cq){return cj+bv.concat("",cq);},y.Sequence(ch[1])))):(ck=ch[0],_3.Dynamic(cm,y.Map2(function(cq,cr){return ck+cq+cr;},ch[1].$0,ch[1].$1.$0))):ch[0]===""?_3.Dynamic(cm,ch[1].$0):(cl=ch[0],_3.Dynamic(cm,y.Map(function(cq){return cl+cq;},ch[1].$0))):X.Create(cm,ch[0]));}());});bX=bB.DeleteEmptyFields({Els:bW,Dirty:true,Holes:b3,Attrs:b5,Render:(bY=b6.length==0?null:{$:1,$0:function(b_){bt.iter(function(b$){b$(b_);},b6);}},bY?bY.$0:void 0)},["Render"]);bZ=d.TreeReduce(y.Const(),y.Map2Unit,b4);return!bC.Equals(bW,null)&&bW.length===1&&(bt.get(bW,0)instanceof bN&&(bC.Equals(bt.get(bW,0).nodeType,bN.ELEMENT_NODE)&&(b0=bt.get(bW,0),true)))?ba.TreeNode(bX,bZ):$.Mk({$:6,$0:bX},bZ);};$.Template=function(bU,bV){return $.ChildrenTemplate($.FakeRoot(bU),bV);};$.TextView=function(bU){var bV;bV=_.CreateTextNode();return $.Mk({$:4,$0:bV},y.Map(function(bW){_.UpdateTextNode(bV,bW);},bU));};$.RunReplaceById=function(bU,bV){var bW;bW=r.Doc().getElementById(bU);bC.Equals(bW,null)?bH.FailWith("invalid id: "+bU):bV.ReplaceInDom(bW);};$.RunById=function(bU,bV){var bW;bW=r.Doc().getElementById(bU);bC.Equals(bW,null)?bH.FailWith("invalid id: "+bU):$.Run(bW,bV);};$.Run=function(bU,bV){var bW;$.LoadLocalTemplates$1();bW=bV.docNode;_.LinkElement(bU,bW);y.Sink(n.StartProcessor(_.PerformAnimatedUpdate(_.CreateRunState(bU,bW),bW)),bV.updates);};$.RunPrependById=function(bU,bV){var bW;bW=r.Doc().getElementById(bU);bC.Equals(bW,null)?bH.FailWith("invalid id: "+bU):$.RunPrepend(bW,bV);};$.RunPrepend=function(bU,bV){var bW;bW=a.document.createTextNode("");bU.insertBefore(bW,bU.firstChild);$.RunBefore(bW,bV);};$.RunAppendById=function(bU,bV){var bW;bW=r.Doc().getElementById(bU);bC.Equals(bW,null)?bH.FailWith("invalid id: "+bU):$.RunAppend(bW,bV);};$.RunAppend=function(bU,bV){var bW;bW=a.document.createTextNode("");bU.appendChild(bW);$.RunBefore(bW,bV);};$.RunAfterById=function(bU,bV){var bW;bW=r.Doc().getElementById(bU);bC.Equals(bW,null)?bH.FailWith("invalid id: "+bU):$.RunAfter(bW,bV);};$.RunAfter=function(bU,bV){var bW;bW=a.document.createTextNode("");bU.parentNode.insertBefore(bW,bU.nextSibling);$.RunBetween(bU,bW,bV);};$.RunBeforeById=function(bU,bV){var bW;bW=r.Doc().getElementById(bU);bC.Equals(bW,null)?bH.FailWith("invalid id: "+bU):$.RunBefore(bW,bV);};$.RunBefore=function(bU,bV){var bW;bW=a.document.createTextNode("");bU.parentNode.insertBefore(bW,bU);$.RunBetween(bW,bU,bV);};$.RunBetween=function(bU,bV,bW){_.LinkPrevElement(bV,bW.docNode);y.Sink(n.StartProcessor(_.PerformAnimatedUpdate(_.CreateDelimitedRunState(bU,bV,bW.docNode),bW.docNode)),bW.updates);};$.Async=function(bU){return $.EmbedView(y.MapAsync(a.id,y.Const(bU)));};$.BindView=function(bU,bV){return $.EmbedView(y.Map(bU,bV));};$.EmbedView=function(bU){var bV;bV=_.CreateEmbedNode();return $.Mk({$:2,$0:bV},y.Map(a.ignore,y.Bind(function(bW){_.UpdateEmbedNode(bV,bW.docNode);return bW.updates;},bU)));};$.Static=function(bU){return ba.New(bU,_1.EmptyAttr(),$.Empty());};$.Mk=function(bU,bV){return new $.New(bU,bV);};$.New=bB.Ctor(function(bU,bV){this.docNode=bU;this.updates=bV;},$);ba=c.Elt=bB.Class({AddClass:function(bU){return this.elt.className+=" "+bU;},ClearHoles:function(){var bU;bU=this.docNode$1;bU!=null&&bU.$==6?bU.$0.Holes=[]:void 0;},AddHole:function(bU){var bV;bV=this.docNode$1;bV!=null&&bV.$==6?bV.$0.Holes.push(bU):void 0;},SetStyle:function(bU,bV){this.elt.style[bU]=bV;},HasClass:function(bU){return(new a.RegExp("(\\s|^)"+bU+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(bU){this.elt.className=this.elt.className.replace(new a.RegExp("(?:(\\s|^)"+bU+")+(\\s|$)","g"),"$1");},GetProperty:function(bU){return this.elt[bU];},SetProperty:function(bU,bV){this.elt[bU]=bV;},RemoveAttribute:function(bU){this.elt.removeAttribute(bU);},HasAttribute:function(bU){return this.elt.hasAttribute(bU);},GetAttribute:function(bU){return this.elt.getAttribute(bU);},SetAttribute:function(bU,bV){this.elt.setAttribute(bU,bV);},SetText:function(bU){var bV;bV=this.docNode$1;bV!=null&&bV.$==1?bV.$0.Children=null:bV!=null&&bV.$==6?(bV.$0.Els=[],this.ClearHoles()):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());this.elt.textContent=bU;},GetText:function(){return this.elt.textContent;},SetValue:function(bU){this.elt.value=bU;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var bU;bU=this.docNode$1;bU!=null&&bU.$==1?bU.$0.Children=null:bU!=null&&bU.$==6?(bU.$0.Els=[],this.ClearHoles()):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(bU){var bV,bW,bX,bY,bZ;bV=this.docNode$1;bV!=null&&bV.$==1?(bW=bV.$0,bW.Children={$:0,$0:bU.docNode,$1:bW.Children},_.InsertDoc(this.elt,bU.docNode,(bX=this.elt.firstChild,bC.Equals(bX,null)?null:bX))):bV!=null&&bV.$==6?(bY=this.elt.insertBefore(a.document.createTextNode(""),this.elt.firstChild),bZ=_.InsertBeforeDelim(bY,bU.docNode),this.AddHole(_5.New(_1.Empty(this.elt),bU.docNode,{$:1,$0:[bZ,bY]},this.elt,h.Int(),null))):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,bU.updates));},Append:function(bU){var bV,bW,bX,bY;bV=this.docNode$1;bV!=null&&bV.$==1?(bW=bV.$0,bW.Children={$:0,$0:bW.Children,$1:bU.docNode},_.InsertDoc(this.elt,bU.docNode,null)):bV!=null&&bV.$==6?(bX=this.elt.appendChild(a.document.createTextNode("")),bY=_.InsertBeforeDelim(bX,bU.docNode),this.AddHole(_5.New(_1.Empty(this.elt),bU.docNode,{$:1,$0:[bY,bX]},this.elt,h.Int(),null))):bH.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,bU.updates));},ToUpdater:function(){var bU,bV;return new bb.New((bU=this.docNode$1,bU!=null&&bU.$==1?bB.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,bU.$0.Attr]],Render:(bV=null,bV?bV.$0:void 0)},["Render"]):bU!=null&&bU.$==6?bU.$0:bH.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,x.Create$1([]));},OnAfterRenderView:function(bU,bV){var bW,bX;bW=this;bX=h.Id();this.Append($.BindView(function(bY){bW.elt[bX]=bY;return $.Empty();},bU));return this.OnAfterRender(function(bY){bV(bY,bY[bX]);});},OnAfterRender:function(bU){var bV,bW,bX,bY,bZ,b0,b1;bV=this.docNode$1;bV!=null&&bV.$==1?(bW=bV.$0,bB.SetOptional(bW,"Render",(bX=bB.GetOptional(bW.Render),bX!=null&&bX.$==1?(bY=bX.$0,{$:1,$0:function(b2){bY(b2);bU(b2);}}):{$:1,$0:bU}))):bV!=null&&bV.$==6?(bZ=bV.$0,bB.SetOptional(bZ,"Render",(b0=bB.GetOptional(bZ.Render),b0!=null&&b0.$==1?(b1=b0.$0,{$:1,$0:function(b2){b1(b2);bU(b2);}}):{$:1,$0:bU}))):bH.FailWith("Invalid docNode in Elt");return this;},onView:function(bU,bV,bW){var bX;bX=bW(this.elt);this.elt.addEventListener(bU,function(bY){return y.Get(bX(bY),bV);},false);return this;},on:function(bU,bV){this.elt.addEventListener(bU,function(bW){return bV(bW.target,bW);},false);return this;}},$,ba);ba.TreeNode=function(bU,bV){var bW,bX;function bY(bZ){return bZ[1];}bW=A.Create(bV);return new ba.New$1({$:6,$0:bU},y.Map2Unit((bX=bt.map(function(bZ){return _1.Updates(bY(bZ));},bU.Attrs),d.TreeReduce(y.Const(),y.Map2Unit,bX)),bW.v),bt.get(bU.Els,0),bW);};ba.New=function(bU,bV,bW){var bX,bY;bX=_.CreateElemNode(bU,bV,bW.docNode);bY=A.Create(bW.updates);return new ba.New$1({$:1,$0:bX},y.Map2Unit(_1.Updates(bX.Attr),bY.v),bU,bY);};ba.New$1=bB.Ctor(function(bU,bV,bW,bX){$.New.call(this,bU,bV);this.docNode$1=bU;this.updates$1=bV;this.elt=bW;this.rvUpdates=bX;},ba);bb=Y.EltUpdater=bB.Class({RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;this.holeUpdates.Set([]);},RemoveUpdated:function(bU){var bV,bW;function bX(bY){return bY!==bW;}bV=bU.docNode;bV!=null&&bV.$==1?(bW=bV.$0.ElKey,this.treeNode.Holes=bt.filter(function(bY){return bY.ElKey!==bW;},this.treeNode.Holes),this.holeUpdates.Set(bt.filter(function(bY){return bX(bY[0]);},this.holeUpdates.Get()))):bH.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(bU){var bV,bW,bX;bV=bU.docNode;bV!=null&&bV.$==1?(bW=bV.$0,this.treeNode.Holes=this.treeNode.Holes.concat([bW]),bX=this.holeUpdates.Get(),bX.push([bW.ElKey,bU.updates]),this.holeUpdates.Set(bX)):bH.FailWith("DocUpdater.AddUpdated expects a single element node");},ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];this.holeUpdates.Set([]);},AddHole:function(bU){this.origHoles.push(bU);this.treeNode.Holes=this.treeNode.Holes.concat([bU]);}},ba,bb);bb.New=bB.Ctor(function(bU,bV,bW,bX,bY){var bZ,b0,b1,b2;function b3(b4){return b4[1];}ba.New$1.call(this,{$:6,$0:bU},y.Map2Unit(bV,(bZ=bY.get_View(),y.BindInner((b0=function(b4){return bt.map(b3,b4);},(b1=(b2=y.Const(),function(b4){return d.TreeReduce(b2,y.Map2Unit,b4);}),function(b4){return b1(b0(b4));})),bZ))),bW,bX);this.treeNode=bU;this.holeUpdates=bY;this.origHoles=this.treeNode.Holes;},bb);bc.$cctor=function(){bc.$cctor=a.ignore;bc.LoadedTemplates=new bK.New$5();bc.LocalTemplatesLoaded=false;bc.TextHoleRE="\\${([^}]+)}";};bd=c.Flow=bB.Class({get_Render:function(){return this.render;}},k,bd);bd.New=bB.Ctor(function(bU){bd.New$1.call(this,function(bV){return function(bW){return x.Set(bV,bU(bW));};});},bd);bd.New$1=bB.Ctor(function(bU){this.render=bU;},bd);bd.get_Do=function(){return new be.New();};bd.Static=function(bU){return new bd.New$1(function(bV){return function(bW){x.Set(bV,bU);return bW();};});};bd.Define=function(bU){return new bd.New(function(bV){return bU(function(bW){bV(bW);});});};bd.Embed=function(bU){var bV;bV=x.Create$1($.Empty());((bU.get_Render())(bV))(a.ignore);return $.EmbedView(bV.get_View());};bd.Return=function(bU){return new bd.New$1(function(){return function(bV){return bV(bU);};});};bd.Bind=function(bU,bV){return new bd.New$1(function(bW){return function(bX){return((bU.get_Render())(bW))(function(bY){((bV(bY).get_Render())(bW))(bX);});};});};bd.Map=function(bU,bV){return new bd.New$1(function(bW){return function(bX){return((bV.get_Render())(bW))(function(bY){bX(bU(bY));});};});};be=c.FlowBuilder=bB.Class({ReturnFrom:a.id,Return:function(bU){return bd.Return(bU);},Bind:function(bU,bV){return bd.Bind(bU,bV);}},k,be);be.New=bB.Ctor(function(){},be);bg=bf.attr=bB.Class({},k,bg);bg.New=bB.Ctor(function(){},bg);bh.InstallHash=function(bU,bV){var bW;function bX(b0){return bR.Parse(bV,bS.FromHash(b0,{$:1,$0:true}));}function bY(){var b0,b1;b0=a.location.hash;b1=bX(b0);return b1==null?((function(b2){return function(b3){return b2("Failed to parse route: "+bT.toSafe(b3));};}(function(b2){bD.log(b2);}))(b0),bU):b1.$0;}function bZ(b0){if(!bC.Equals(bW.Get(),b0))bW.Set(b0);}bW=x.Create$1(bY());a.onpopstate=function(){return bZ(bY());};a.onhashchange=function(){return bZ(bY());};bO(a.document.body).click(function(b0){var b1,b2,b3,b4;b1=bO(b0.target).closest("a").toArray();return!bC.Equals(b1,null)&&b1.length===1?(b2=bt.get(b1,0),b2.localName==="a"?(b3=b2.getAttribute("href"),!(b3==null)&&bv.StartsWith(b3,"#")?(b4=bX(b3),b4==null?null:(bZ(b4.$0),b0.preventDefault())):null):null):null;});y.Sink(function(b0){var b1;if(!bC.Equals(b0,bY())){b1=bR.HashLink(bV,b0);a.history.pushState(null,null,b1);}},bW.get_View());return bW;};bh.Install=function(bU,bV){var bW;function bX(b0){return bR.Parse(bV,b0);}function bY(){var b0,b1,b2;b0=a.location;b1=bS.FromUrl(b0.pathname+b0.search,null);b2=bX(b1);return b2==null?((function(b3){return function(b4){return b3("Failed to parse route: "+bT.toSafe(b4));};}(function(b3){bD.log(b3);}))(b1.ToLink()),bU):b2.$0;}function bZ(b0){if(!bC.Equals(bW.Get(),b0))bW.Set(b0);}bW=x.Create$1(bY());a.onpopstate=function(){return bZ(bY());};bO(a.document.body).click(function(b0){var b1,b2,b3,b4;b1=bO(b0.target).closest("a").toArray();return!bC.Equals(b1,null)&&b1.length===1?(b2=bt.get(b1,0),b2.localName==="a"?(b3=b2.getAttribute("href"),!(b3==null)?(b4=bX(bS.FromUrl(b3,null)),b4==null?null:(bZ(b4.$0),b0.preventDefault())):null):null):null;});y.Sink(function(b0){var b1;if(!bC.Equals(b0,bY())){b1=bR.Link(bV,b0);a.history.pushState(null,null,b1);}},bW.get_View());return bW;};bi.Append=function(bU,bV){return{$:0,$0:p.Append(bU.$0,bV.$0),$1:bF.FoldBack(function(bW,bX,bY){return bY.Add(bW,bX);},bU.$1,bV.$1)};};bi.FromList=function(bU,bV){return{$:0,$0:p.FromArray(bt.ofList(bU)),$1:bV};};bi.ToList=function(bU){return[bs.ofArray(p.ToArray(bU.$0)),bU.$1];};bi.SameHash=function(bU,bV){return bi.NoHash(bU)===bi.NoHash(bV);};bi.MakeHash=function(bU){var bV,bW;bV=bU.$1;bW=bv.concat("/",bt.map(function(bX){return a.encodeURIComponent(bX);},p.ToArray(bU.$0)));return bV.get_IsEmpty()?bW:bW+"?"+bv.concat("&",bz.map(function(bX){var bY;bY=bH.KeyValue(bX);return a.encodeURIComponent(bY[0])+"="+a.encodeURIComponent(bY[1]);},bV));};bi.ParseHash=function(bU){var bV,bW,bX,bY;bV=bi.NoHash(bU);bW=(bX=bV.indexOf("?"),bX===-1?[bV,""]:[bP.string(bV,null,{$:1,$0:bX-1}),bP.string(bV,{$:1,$0:bX+1},null)]);bY=bW[0];return{$:0,$0:p.FromArray(bY===""?[]:bt.map(function(bZ){return a.decodeURIComponent(bZ);},bv.SplitChars(bY,["/"],0))),$1:bF.OfArray(bt.map(function(bZ){var b0;b0=bZ.indexOf("=");return b0===-1?[a.decodeURIComponent(bZ),""]:[a.decodeURIComponent(bP.string(bZ,null,{$:1,$0:b0-1})),a.decodeURIComponent(bP.string(bZ,{$:1,$0:b0+1},null))];},bv.SplitChars(bW[1],["&"],0)))};};bi.NoHash=function(bU){return bv.StartsWith(bU,"#")?bU.substring(1):bU;};bj.DoLink=function(bU,bV){var bW;bW=bU.Ser(bV);return bi.FromList(bW[0],bW[1]);};bj.DoRoute=function(bU,bV){return bU.Des(bi.ToList(bV));};bj.InstallMap=function(bU){var bV;function bW(b0,b1){return bC.Equals(bU.Ser(b0),bU.Ser(b1));}function bX(){return bU.Des(bi.ToList(bi.ParseHash(a.location.hash)));}function bY(b0){if(!bW(bV.Get(),b0))bV.Set(b0);}function bZ(b0){return bY(bX());}bV=x.Create$1(bX());a.onpopstate=bZ;a.onhashchange=bZ;y.Sink(function(b0){var b1,b2;b1=bi.MakeHash((b2=bU.Ser(b0),bi.FromList(b2[0],b2[1])));!bi.SameHash(a.location.hash,b1)?a.location.replace("#"+b1):void 0;},bV.get_View());return bV;};bk.Install=function(bU){return bj.InstallMap(bU);};bk.Create=function(bU,bV){function bW(bX){return bX[0];}return{Des:function(bX){return bV(bW(bX));},Ser:function(bX){return[bU(bX),new bG.New([])];}};};bk.CreateWithQuery=function(bU,bV){return{Des:bV,Ser:bU};};bm.New=function(bU,bV){return{Active:bU,PosV:bV};};bn.New=function(bU,bV,bW,bX){return{Active:bU,Left:bV,Middle:bW,Right:bX};};bo.get_MousePressed=function(){bl.ActivateButtonListener();return y.Apply(y.Apply(y.Apply(y.Const(bB.Curried3(function(bU,bV,bW){return bU||bV||bW;})),bl.MouseBtnSt$1().Left.get_View()),bl.MouseBtnSt$1().Middle.get_View()),bl.MouseBtnSt$1().Right.get_View());};bo.get_RightPressed=function(){bl.ActivateButtonListener();return bl.MouseBtnSt$1().Right.get_View();};bo.get_MiddlePressed=function(){bl.ActivateButtonListener();return bl.MouseBtnSt$1().Middle.get_View();};bo.get_LeftPressed=function(){bl.ActivateButtonListener();return bl.MouseBtnSt$1().Left.get_View();};bo.get_Position=function(){!bl.MousePosSt$1().Active?(a.document.addEventListener("mousemove",function(bU){x.Set(bl.MousePosSt$1().PosV,[bU.clientX,bU.clientY]);},false),bl.MousePosSt$1().Active=true):void 0;return bl.MousePosSt$1().PosV.get_View();};bp.New=function(bU,bV,bW){return{KeysPressed:bU,KeyListenerActive:bV,LastPressed:bW};};bq.IsPressed=function(bU){function bV(bW){return bW===bU;}bl.ActivateKeyListener();return y.Map(function(bW){return bs.exists(bV,bW);},bl.KeyListenerState().KeysPressed.get_View());};bq.get_LastPressed=function(){bl.ActivateKeyListener();return bl.KeyListenerState().LastPressed.get_View();};bq.get_KeysPressed=function(){bl.ActivateKeyListener();return bl.KeyListenerState().KeysPressed.get_View();};bl.ActivateKeyListener=function(){br.$cctor();return br.ActivateKeyListener;};bl.KeyListenerState=function(){br.$cctor();return br.KeyListenerState;};bl.ActivateButtonListener=function(){br.$cctor();return br.ActivateButtonListener;};bl.MouseBtnSt$1=function(){br.$cctor();return br.MouseBtnSt;};bl.MousePosSt$1=function(){br.$cctor();return br.MousePosSt;};br.$cctor=function(){br.$cctor=a.ignore;function bU(bV,bW){var bX;bX=bV.button;return bX===0?x.Set(bl.MouseBtnSt$1().Left,bW):bX===1?x.Set(bl.MouseBtnSt$1().Middle,bW):bX===2?x.Set(bl.MouseBtnSt$1().Right,bW):null;}br.MousePosSt=bm.New(false,x.Create$1([0,0]));br.MouseBtnSt=bn.New(false,x.Create$1(false),x.Create$1(false),x.Create$1(false));br.ActivateButtonListener=!bl.MouseBtnSt$1().Active?(bl.MouseBtnSt$1().Active=true,a.document.addEventListener("mousedown",function(bV){return bU(bV,true);},false),a.document.addEventListener("mouseup",function(bV){return bU(bV,false);},false)):null;br.KeyListenerState=bp.New(x.Create$1(bs.T.Empty),false,x.Create$1(-1));br.ActivateKeyListener=!bl.KeyListenerState().KeyListenerActive?(bO(a.document).keydown(function(bV){var bW,bX;bW=bV.which;x.Set(bl.KeyListenerState().LastPressed,bW);bX=bl.KeyListenerState().KeysPressed.Get();return!bs.exists(function(bY){return bY===bW;},bX)?bl.KeyListenerState().KeysPressed.Set(bs.append(bX,bs.ofArray([bW]))):null;}),void bO(a.document).keyup(function(bV){var bW;function bX(bY){return bY!==bW;}bW=bV.which;return x.Update(bl.KeyListenerState().KeysPressed,function(bY){return bs.filter(bX,bY);});})):null;};}());
